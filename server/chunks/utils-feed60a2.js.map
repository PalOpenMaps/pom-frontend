{"version":3,"file":"utils-feed60a2.js","sources":["../../../.svelte-kit/adapter-node/chunks/utils.js"],"sourcesContent":["import { b as base } from \"./paths.js\";\nconst overlays = [\n  {\n    key: \"pal2020\",\n    name: \"Vector overlay, 2020s\",\n    attribution: \"OpenMapTiles / OpenStreetMap Contributors\",\n    description: \"Present day geographic features derived from OpenStreetMap, Wikidata and Natural Earth. Vector tiles generated using OpenMapTiles tools.\",\n    url: \"https://cdn.jsdelivr.net/gh/bothness/pom-tiles/pal2020s/{z}/{x}/{y}.pbf\"\n  },\n  {\n    key: \"pal1940\",\n    name: \"Vector overlay, 1940s\",\n    attribution: \"Palestine Open Maps community\",\n    description: 'Crowd-sourced digitisation of \"Palestine 1:20,000\" Survey of Palestine map series from the 1940s. Vector tiles generated using OpenMapTiles tools.',\n    url: \"https://cdn.jsdelivr.net/gh/bothness/pom-tiles/pal1940s/{z}/{x}/{y}.pbf\",\n    edit: \"http://data.palopenmaps.org/edit#background=custom:http://palopenmaps.org/tiles/pal20k-1940s/{z}/{x}/{y}@2x.jpg&disable_features=boundaries&map=\",\n    is_default: true\n  }\n];\nconst layer_aerial = {\n  \"id\": 16,\n  \"name\": \"Aerial imagery, 1940s\",\n  \"description\": \"A layer compiled from black and white aerial photographs captured by the British military in the 1940s. It is color-corrected and merged together into a single raster tileset.\",\n  \"boundaries\": null,\n  \"scale\": 1,\n  \"start_year\": \"1944-01-01\",\n  \"end_year\": \"1948-05-15\",\n  \"url\": \"https://cdn.jsdelivr.net/gh/bothness/pom-tiles/aerial1940s/{z}/{x}/{y}.png\",\n  \"attribution\": \"Royal Air Force, 1940s\",\n  \"is_active\": false,\n  \"is_default\": false,\n  \"is_overlay\": false,\n  \"order\": -1,\n  \"author\": 10,\n  \"sources\": [36],\n  \"further_readings\": []\n};\nasync function getPlaces(url, fetch = window.fetch) {\n  let res = await fetch(url);\n  return await res.json();\n}\nasync function getPlace(slug, fetch = window.fetch) {\n  let res = await fetch(`${base}/data/places/${slug}.json`);\n  return res ? await res.json() : null;\n}\nasync function getLayers(url, fetch = window.fetch) {\n  let layers = await (await fetch(url)).json();\n  layers = layers.filter((l) => l.is_active && !l.is_overlay);\n  if (!layers.map((l) => l.id).includes(16))\n    layers = [layers[0], layer_aerial, ...layers.slice(1)];\n  return layers;\n}\nasync function getSheets(url, layers, fetch = window.fetch) {\n  let res = await fetch(url);\n  let sheets = await res.json();\n  sheets.sort((a, b) => a.layer - b.layer);\n  let geojson = {\n    type: \"FeatureCollection\",\n    features: []\n  };\n  for (const sheet of sheets) {\n    let props = Object.fromEntries(Object.entries(sheet).filter(([key]) => key != \"boundaries\"));\n    let layer = layers.find((l) => l.id == sheet.layer);\n    props.year = props.year ? props.year.split(\"-\")[0] : layer.start_year.split(\"-\")[0];\n    geojson.features.push({\n      properties: { ...props, scale: layer.scale, author: layer.attribution.split(\",\")[0] },\n      geometry: sheet.boundaries\n    });\n  }\n  return geojson;\n}\nfunction i18n(key, texts, lang) {\n  if (lang != \"en\" && texts[lang] && texts[lang][key]) {\n    return texts[lang][key];\n  } else {\n    return key;\n  }\n}\nfunction makeDataset(place) {\n  let props = place.properties;\n  return {\n    p1945: {\n      pop: props.pop_1945,\n      pal: props.pal_1945 && props.pop_1945 ? 100 * props.pal_1945 / props.pop_1945 : null,\n      jsh: props.jsh_1945 && props.pop_1945 ? 100 * props.jsh_1945 / props.pop_1945 : null,\n      oth: null\n    },\n    p2016: {\n      pop: props.pop_2016,\n      pal: props.pal_2016 && props.pop_2016 ? 100 * props.pal_2016 / props.pop_2016 : null,\n      jsh: props.jsh_2016 && props.pop_2016 ? 100 * props.jsh_2016 / props.pop_2016 : null,\n      oth: props.oth_2016 && props.pop_2016 ? 100 * props.oth_2016 / props.pop_2016 : null\n    }\n  };\n}\nexport {\n  getLayers as a,\n  getSheets as b,\n  getPlace as c,\n  getPlaces as g,\n  i18n as i,\n  makeDataset as m,\n  overlays as o\n};\n"],"names":[],"mappings":"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"}