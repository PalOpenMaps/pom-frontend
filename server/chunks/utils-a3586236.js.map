{"version":3,"file":"utils-a3586236.js","sources":["../../../.svelte-kit/adapter-node/chunks/utils.js"],"sourcesContent":["import { csvParse, autoType } from \"d3-dsv\";\nasync function getPlaces(url, statuses, fetch = window.fetch) {\n  let res = await fetch(url);\n  let str = await res.text();\n  let locs = csvParse(str, autoType);\n  locs.sort((a, b) => a[\"name_en\"].localeCompare(b[\"name_en\"]));\n  let geojson = {\n    type: \"FeatureCollection\",\n    features: []\n  };\n  for (const loc of locs.filter((d) => d[\"change_2016\"] != \"Built & abandoned\" && d[\"grp_1945\"] != \"Syrian\" && d[\"lng\"])) {\n    let feature = {\n      type: \"Feature\",\n      geometry: {\n        type: \"Point\",\n        coordinates: [loc[\"lng\"], loc[\"lat\"]]\n      },\n      properties: {\n        type: loc[\"type_2016\"] ? loc[\"type_2016\"] : loc[\"type_1945\"],\n        group: loc[\"grp_2016\"] ? loc[\"grp_2016\"] : loc[\"grp_1945\"],\n        color: statuses[loc[\"change_2016\"]].color,\n        ...loc\n      }\n    };\n    feature.properties[\"name_ar\"] = loc[\"name_ar\"] ? loc[\"name_ar\"] : loc[\"name_en\"];\n    geojson.features.push(feature);\n  }\n  return geojson;\n}\nasync function getSheets(url, layers, fetch = window.fetch) {\n  let res = await fetch(url);\n  let sheets = await res.json();\n  sheets.sort((a, b) => a.layer - b.layer);\n  let geojson = {\n    type: \"FeatureCollection\",\n    features: []\n  };\n  for (const sheet of sheets) {\n    let props = Object.fromEntries(Object.entries(sheet).filter(([key]) => key != \"boundaries\"));\n    let layer = layers.find((l) => l.id == sheet.layer);\n    props.year = props.year ? props.year.split(\"-\")[0] : layer.start_year.split(\"-\")[0];\n    geojson.features.push({\n      properties: { ...props, scale: layer.scale, author: layer.attribution.split(\",\")[0] },\n      geometry: sheet.boundaries\n    });\n  }\n  return geojson;\n}\nfunction i18n(key, texts, lang) {\n  if (lang != \"en\" && texts[lang] && texts[lang][key]) {\n    return texts[lang][key];\n  } else {\n    return key;\n  }\n}\nfunction makeDataset(place) {\n  let props = place.properties;\n  return {\n    p1945: {\n      pop: props.pop_1945,\n      pal: props.pal_1945 && props.pop_1945 ? 100 * props.pal_1945 / props.pop_1945 : null,\n      jsh: props.jsh_1945 && props.pop_1945 ? 100 * props.jsh_1945 / props.pop_1945 : null,\n      oth: null\n    },\n    p2016: {\n      pop: props.pop_2016,\n      pal: props.pal_2016 && props.pop_2016 ? 100 * props.pal_2016 / props.pop_2016 : null,\n      jsh: props.jsh_2016 && props.pop_2016 ? 100 * props.jsh_2016 / props.pop_2016 : null,\n      oth: props.oth_2016 && props.pop_2016 ? 100 * props.oth_2016 / props.pop_2016 : null\n    }\n  };\n}\nexport {\n  getSheets as a,\n  getPlaces as g,\n  i18n as i,\n  makeDataset as m\n};\n"],"names":[],"mappings":"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"}