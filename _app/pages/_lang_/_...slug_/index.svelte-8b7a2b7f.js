var pm=Object.defineProperty,dm=Object.defineProperties;var fm=Object.getOwnPropertyDescriptors;var Td=Object.getOwnPropertySymbols;var mm=Object.prototype.hasOwnProperty,gm=Object.prototype.propertyIsEnumerable;var Id=(C,y,T)=>y in C?pm(C,y,{enumerable:!0,configurable:!0,writable:!0,value:T}):C[y]=T,qo=(C,y)=>{for(var T in y||(y={}))mm.call(y,T)&&Id(C,T,y[T]);if(Td)for(var T of Td(y))gm.call(y,T)&&Id(C,T,y[T]);return C},dd=(C,y)=>dm(C,fm(y));import{S as Qn,i as es,s as ts,G as Qc,H as eu,I as tu,q as Qe,o as mt,e as Ye,k as At,Q as yd,c as Je,d as xe,m as kt,a as dt,b as Re,J as Be,g as Ke,n as pr,p as dr,R as Lh,r as Pp,v as Ou,T as Bh,U as _m,F as iu,V as js,l as Pi,N as Yc,M as xd,E as ds,K as qi,L as nr,W as ru,X as Qf,t as Jt,h as $t,j as Kr,Y as tl,w as ai,x as Si,y as li,B as ci,D as Cp,O as hc,P as pc,Z as md,f as Ji,_ as ym,$ as xm,a0 as vm,a1 as bm,z as vd,A as em,C as bd,a2 as wm,a3 as Kc,a4 as lc,a5 as Sd,a6 as Ed,a7 as Tm,a8 as Im,a9 as Ad,aa as Sm}from"../../../chunks/index-b5f4775f.js";import{b as el}from"../../../chunks/paths-396f020f.js";import{I as Ns,L as fd,p as Em}from"../../../chunks/Icon-9b64b9a7.js";import{a as Am,g as kd}from"../../../chunks/navigation-13fd7038.js";import{s as zd,i as km,m as Cd}from"../../../chunks/config-0b4aec8a.js";import{w as zm}from"../../../chunks/index-bf67f47d.js";import"../../../chunks/singletons-d1fb5791.js";const gd=[{key:"pal1940",name:"Vector overlay, 1940s",attribution:"Palestine Open Maps Community / Survey of Palestine",description:'Crowd sourced digitisation of "Palestine 1:20,000" Survey of Palestine map series from the 1940s.',url:"https://ahmadbarclay.com/tiles/pal1940/{z}/{x}/{y}.pbf",is_default:!0},{key:"pal2020",name:"Vector overlay, 2020",attribution:"OpenMapTiles / &copy; OpenStreetMap Contributors",description:"Geographic features derived from OpenStreetMap, Wikidata and Natural Earth using OpenMapTiles tools.",url:"https://ahmadbarclay.com/tiles/pal2020/{z}/{x}/{y}.pbf"}],Pd=[{id:"building",group:"building",type:"fill","source-layer":"building",paint:{"fill-antialias":!0,"fill-color":{base:1,stops:[[15.5,"#f2eae2"],[16,"#dfdbd7"]]}}},{id:"tunnel-minor-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["==","class","minor"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":{stops:[[12,0],[12.5,1]]},"line-width":{base:1.2,stops:[[12,.5],[13,1],[14,4],[20,15]]}}},{id:"tunnel-secondary-tertiary-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["in","class","secondary","tertiary"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":1,"line-width":{base:1.2,stops:[[8,1.5],[20,17]]}}},{id:"tunnel-trunk-primary-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["in","class","primary","trunk"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-width":{base:1.2,stops:[[5,.4],[6,.6],[7,1.5],[20,22]]}}},{id:"tunnel-motorway-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["==","class","motorway"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-dasharray":[.5,.25],"line-width":{base:1.2,stops:[[5,.4],[6,.6],[7,1.5],[20,22]]}}},{id:"tunnel-path",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["==","brunnel","tunnel"],["==","class","path"]]],paint:{"line-color":"#cba","line-dasharray":[1.5,.75],"line-width":{base:1.2,stops:[[15,1.2],[20,4]]}}},{id:"tunnel-service-track",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["in","class","service","track"]],layout:{"line-join":"round"},paint:{"line-color":"#fff","line-width":{base:1.2,stops:[[15.5,0],[16,2],[20,7.5]]}}},{id:"tunnel-minor",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["==","class","minor_road"]],layout:{"line-join":"round"},paint:{"line-color":"#fff","line-opacity":1,"line-width":{base:1.2,stops:[[13.5,0],[14,2.5],[20,11.5]]}}},{id:"tunnel-secondary-tertiary",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["in","class","secondary","tertiary"]],layout:{"line-join":"round"},paint:{"line-color":"#fef2b4","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,10]]}}},{id:"tunnel-trunk-primary",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["in","class","primary","trunk"]],layout:{"line-join":"round"},paint:{"line-color":"#37c256","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,18]]}}},{id:"tunnel-motorway",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["==","class","motorway"]],layout:{"line-join":"round"},paint:{"line-color":"#06b1ca","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,18]]}}},{id:"tunnel-railway",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","tunnel"],["==","class","rail"]],paint:{"line-color":"#bbb","line-dasharray":[2,2],"line-width":{base:1.4,stops:[[14,.4],[15,.75],[20,2]]}}},{id:"aeroway-taxiway-casing",group:"transport",type:"line","source-layer":"aeroway",minzoom:12,filter:["all",["in","class","taxiway"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgba(153, 153, 153, 1)","line-opacity":1,"line-width":{base:1.5,stops:[[11,2],[17,12]]}}},{id:"aeroway-runway-casing",group:"transport",type:"line","source-layer":"aeroway",minzoom:12,filter:["all",["in","class","runway"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgba(153, 153, 153, 1)","line-opacity":1,"line-width":{base:1.5,stops:[[11,5],[17,55]]}}},{id:"aeroway-taxiway",group:"transport",type:"line","source-layer":"aeroway",minzoom:4,filter:["all",["in","class","taxiway"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgba(255, 255, 255, 1)","line-opacity":{base:1,stops:[[11,0],[12,1]]},"line-width":{base:1.5,stops:[[11,1],[17,10]]}}},{id:"aeroway-runway",group:"transport",type:"line","source-layer":"aeroway",minzoom:4,filter:["all",["in","class","runway"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgba(255, 255, 255, 1)","line-opacity":{base:1,stops:[[11,0],[12,1]]},"line-width":{base:1.5,stops:[[11,4],[17,50]]}}},{id:"highway-motorway-link-casing",group:"transport",type:"line","source-layer":"transportation",minzoom:12,filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","motorway_link"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}}},{id:"highway-link-casing",group:"transport",type:"line","source-layer":"transportation",minzoom:13,filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","primary_link","secondary_link","tertiary_link","trunk_link"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}}},{id:"highway-minor-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["!=","brunnel","tunnel"],["in","class","minor","service","track"]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":{stops:[[12,0],[12.5,1]]},"line-width":{base:1.2,stops:[[12,.5],[13,1],[14,4],[20,15]]}}},{id:"highway-secondary-tertiary-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","secondary","tertiary"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":1,"line-width":{base:1.2,stops:[[8,1.5],[20,17]]}}},{id:"highway-primary-casing",group:"transport",type:"line","source-layer":"transportation",minzoom:5,filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","primary"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":{stops:[[7,0],[8,1]]},"line-width":{base:1.2,stops:[[7,0],[8,.6],[9,1.5],[20,22]]}}},{id:"highway-trunk-casing",group:"transport",type:"line","source-layer":"transportation",minzoom:5,filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","trunk"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":{stops:[[5,0],[6,1]]},"line-width":{base:1.2,stops:[[5,0],[6,.6],[7,1.5],[20,22]]}}},{id:"highway-motorway-casing",group:"transport",type:"line","source-layer":"transportation",minzoom:4,filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","motorway"]],layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":{stops:[[4,0],[5,1]]},"line-width":{base:1.2,stops:[[4,0],[5,.4],[6,.6],[7,1.5],[20,22]]}}},{id:"highway-path",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["!in","brunnel","bridge","tunnel"],["==","class","path"]]],paint:{"line-color":"#cba","line-dasharray":[1.5,.75],"line-width":{base:1.2,stops:[[15,1.2],[20,4]]}}},{id:"highway-motorway-link",group:"transport",type:"line","source-layer":"transportation",minzoom:12,filter:["all",["!in","brunnel","bridge","tunnel"],["==","class","motorway_link"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#06b1ca","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}}},{id:"highway-link",group:"transport",type:"line","source-layer":"transportation",minzoom:13,filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","primary_link","secondary_link","tertiary_link","trunk_link"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fea","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}}},{id:"highway-minor",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["!=","brunnel","tunnel"],["in","class","minor","service","track"]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fff","line-opacity":1,"line-width":{base:1.2,stops:[[13.5,0],[14,2.5],[20,11.5]]}}},{id:"highway-secondary-tertiary",group:"transport",type:"line","source-layer":"transportation",filter:["all",["!in","brunnel","bridge","tunnel"],["in","class","secondary","tertiary"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fef2b4","line-width":{base:1.2,stops:[[6.5,0],[8,.5],[20,13]]}}},{id:"highway-primary",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["!in","brunnel","bridge","tunnel"],["in","class","primary"]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#ff889d","line-width":{base:1.2,stops:[[8.5,0],[9,.5],[20,18]]}}},{id:"highway-trunk",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["!in","brunnel","bridge","tunnel"],["in","class","trunk"]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#37c256","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,18]]}}},{id:"highway-motorway",group:"transport",type:"line","source-layer":"transportation",minzoom:5,filter:["all",["==","$type","LineString"],["all",["!in","brunnel","bridge","tunnel"],["==","class","motorway"]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#06b1ca","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,18]]}}},{id:"railway-transit",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],paint:{"line-color":"hsla(0, 0%, 73%, 0.77)","line-width":{base:1.4,stops:[[14,.4],[20,1]]}}},{id:"railway-transit-hatching",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],paint:{"line-color":"hsla(0, 0%, 73%, 0.68)","line-dasharray":[.2,8],"line-width":{base:1.4,stops:[[14.5,0],[15,2],[20,6]]}}},{id:"railway-service",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],paint:{"line-color":"hsla(0, 0%, 73%, 0.77)","line-width":{base:1.4,stops:[[14,.4],[20,1]]}}},{id:"railway-service-hatching",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],paint:{"line-color":"hsla(0, 0%, 73%, 0.68)","line-dasharray":[.2,8],"line-width":{base:1.4,stops:[[14.5,0],[15,2],[20,6]]}}},{id:"railway",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["!has","service"],["!in","brunnel","bridge","tunnel"],["==","class","rail"]]],paint:{"line-color":"#bbb","line-width":{base:1.4,stops:[[14,.4],[15,.75],[20,2]]}}},{id:"railway-hatching",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["!has","service"],["!in","brunnel","bridge","tunnel"],["==","class","rail"]]],paint:{"line-color":"#bbb","line-dasharray":[.2,8],"line-width":{base:1.4,stops:[[14.5,0],[15,3],[20,8]]}}},{id:"bridge-motorway-link-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["==","class","motorway_link"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}}},{id:"bridge-link-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["in","class","primary_link","secondary_link","tertiary_link","trunk_link"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":1,"line-width":{base:1.2,stops:[[12,1],[13,3],[14,4],[20,15]]}}},{id:"bridge-secondary-tertiary-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["in","class","secondary","tertiary"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-opacity":1,"line-width":{base:1.2,stops:[[8,1.5],[20,28]]}}},{id:"bridge-trunk-primary-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["in","class","primary","trunk"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-width":{base:1.2,stops:[[5,.4],[6,.6],[7,1.5],[20,26]]}}},{id:"bridge-motorway-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["==","class","motorway"]],layout:{"line-join":"round"},paint:{"line-color":"#8f8f8f","line-width":{base:1.2,stops:[[5,.4],[6,.6],[7,1.5],[20,22]]}}},{id:"bridge-path-casing",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["==","brunnel","bridge"],["==","class","path"]]],paint:{"line-color":"#8f8f8f","line-width":{base:1.2,stops:[[15,1.2],[20,18]]}}},{id:"bridge-path",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","$type","LineString"],["all",["==","brunnel","bridge"],["==","class","path"]]],paint:{"line-color":"#cba","line-dasharray":[1.5,.75],"line-width":{base:1.2,stops:[[15,1.2],[20,4]]}}},{id:"bridge-motorway-link",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["==","class","motorway_link"]],layout:{"line-join":"round"},paint:{"line-color":"#06b1ca","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}}},{id:"bridge-link",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["in","class","primary_link","secondary_link","tertiary_link","trunk_link"]],layout:{"line-join":"round"},paint:{"line-color":"#fea","line-width":{base:1.2,stops:[[12.5,0],[13,1.5],[14,2.5],[20,11.5]]}}},{id:"bridge-secondary-tertiary",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["in","class","secondary","tertiary"]],layout:{"line-join":"round"},paint:{"line-color":"#fef2b4","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,20]]}}},{id:"bridge-trunk-primary",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["in","class","primary","trunk"]],layout:{"line-join":"round"},paint:{"line-color":"#37c256","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,18]]}}},{id:"bridge-motorway",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["==","class","motorway"]],layout:{"line-join":"round"},paint:{"line-color":"#06b1ca","line-width":{base:1.2,stops:[[6.5,0],[7,.5],[20,18]]}}},{id:"bridge-railway",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["==","class","rail"]],paint:{"line-color":"#bbb","line-width":{base:1.4,stops:[[14,.4],[15,.75],[20,2]]}}},{id:"bridge-railway-hatching",group:"transport",type:"line","source-layer":"transportation",filter:["all",["==","brunnel","bridge"],["==","class","rail"]],paint:{"line-color":"#bbb","line-dasharray":[.2,8],"line-width":{base:1.4,stops:[[14.5,0],[15,3],[20,8]]}}},{id:"poi-level-3",group:"place",type:"symbol","source-layer":"poi",minzoom:16,filter:["all",["==","$type","Point"],[">=","rank",25],["any",["!has","level"],["==","level",0]]],layout:{"icon-image":"{class}_11","text-anchor":"top","text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-max-width":9,"text-offset":[0,.6],"text-padding":2,"text-size":12},paint:{"text-color":"#666","text-halo-blur":.5,"text-halo-color":"#ffffff","text-halo-width":1}},{id:"poi-level-2",group:"place",type:"symbol","source-layer":"poi",minzoom:15,filter:["all",["==","$type","Point"],["<=","rank",24],[">=","rank",15],["any",["!has","level"],["==","level",0]]],layout:{"icon-image":"{class}_11","text-anchor":"top","text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-max-width":9,"text-offset":[0,.6],"text-padding":2,"text-size":12},paint:{"text-color":"#666","text-halo-blur":.5,"text-halo-color":"#ffffff","text-halo-width":1}},{id:"poi-level-1",group:"place",type:"symbol","source-layer":"poi",minzoom:14,filter:["all",["==","$type","Point"],["<=","rank",14],["has","name"],["any",["!has","level"],["==","level",0]]],layout:{"icon-image":"{class}_11","text-anchor":"top","text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-max-width":9,"text-offset":[0,.6],"text-padding":2,"text-size":12},paint:{"text-color":"#666","text-halo-blur":.5,"text-halo-color":"#ffffff","text-halo-width":1}},{id:"poi-railway",group:"place",type:"symbol","source-layer":"poi",minzoom:13,filter:["all",["==","$type","Point"],["has","name"],["==","class","railway"],["==","subclass","station"]],layout:{"icon-allow-overlap":!1,"icon-ignore-placement":!1,"icon-image":"{class}_11","icon-optional":!1,"text-allow-overlap":!1,"text-anchor":"top","text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-ignore-placement":!1,"text-max-width":9,"text-offset":[0,.6],"text-optional":!0,"text-padding":2,"text-size":12},paint:{"text-color":"#666","text-halo-blur":.5,"text-halo-color":"#ffffff","text-halo-width":1}},{id:"highway-name-path",group:"place",type:"symbol","source-layer":"transportation_name",minzoom:15.5,filter:["==","class","path"],layout:{"symbol-placement":"line","text-field":"{name:latin} {name:nonlatin}","text-font":["Noto Sans Regular"],"text-rotation-alignment":"map","text-size":{base:1,stops:[[13,12],[14,13]]}},paint:{"text-color":"hsl(30, 23%, 62%)","text-halo-color":"#f8f4f0","text-halo-width":.5}},{id:"highway-name-minor",group:"transport",type:"symbol","source-layer":"transportation_name",minzoom:15,filter:["all",["==","$type","LineString"],["in","class","minor","service","track"]],layout:{"symbol-placement":"line","text-field":"{name:latin} {name:nonlatin}","text-font":["Noto Sans Regular"],"text-rotation-alignment":"map","text-size":{base:1,stops:[[13,12],[14,13]]}},paint:{"text-color":"#765","text-halo-blur":.5,"text-halo-width":1}},{id:"highway-name-major",group:"transport",type:"symbol","source-layer":"transportation_name",minzoom:12.2,filter:["in","class","primary","secondary","tertiary","trunk"],layout:{"symbol-placement":"line","text-field":"{name:latin} {name:nonlatin}","text-font":["Noto Sans Regular"],"text-rotation-alignment":"map","text-size":{base:1,stops:[[13,12],[14,13]]}},paint:{"text-color":"#765","text-halo-blur":.5,"text-halo-width":1}},{id:"airport-label-major",group:"place",type:"symbol","source-layer":"aerodrome_label",minzoom:10,filter:["all",["has","iata"]],layout:{"icon-image":"airport_11","icon-size":1,"text-anchor":"top","text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-max-width":9,"text-offset":[0,.6],"text-optional":!0,"text-padding":2,"text-size":12},paint:{"text-color":"#666","text-halo-blur":.5,"text-halo-color":"#ffffff","text-halo-width":1}},{id:"place-other",group:"place",type:"symbol","source-layer":"place",filter:["!in","class","city","town","village","country","continent"],layout:{"text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-letter-spacing":.1,"text-max-width":9,"text-size":{base:1.2,stops:[[12,10],[15,14]]},"text-transform":"uppercase"},paint:{"text-color":"#633","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1.2},minzoom:10},{id:"place-village",group:"place",type:"symbol","source-layer":"place",filter:["==","class","village"],layout:{"text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-max-width":8,"text-size":{base:1.2,stops:[[10,12],[15,22]]}},paint:{"text-color":"#333","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1.2},minzoom:10},{id:"place-town",group:"place",type:"symbol","source-layer":"place",filter:["==","class","town"],layout:{"text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-max-width":8,"text-size":{base:1.2,stops:[[10,14],[15,24]]}},paint:{"text-color":"#333","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1.2},minzoom:9},{id:"place-city",group:"place",type:"symbol","source-layer":"place",filter:["all",["==","class","city"]],layout:{"text-field":`{name:latin}
{name:ar}`,"text-font":["Noto Sans Regular"],"text-max-width":8,"text-size":{base:1.2,stops:[[7,14],[11,24]]}},paint:{"text-color":"#333","text-halo-color":"rgba(255,255,255,0.8)","text-halo-width":1.2}}];var tm=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},im={exports:{}};(function(C,y){(function(T,A){C.exports=A()})(tm,function(){var T,A,P;function O(l,W){if(!T)T=W;else if(!A)A=W;else{var $="var sharedChunk = {}; ("+T+")(sharedChunk); ("+A+")(sharedChunk);",ue={};T(ue),P=W(ue),typeof window!="undefined"&&(P.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}O(["exports"],function(l){var W=$;function $(i,t,o,p){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(p-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=o,this.p2y=p}function ue(i,t,o,p){const f=new W(i,t,o,p);return function(_){return f.solve(_)}}$.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,p=0;p<8;p++){var f=this.sampleCurveX(o)-i;if(Math.abs(f)<t)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=f/_}var x=0,E=1;for(o=i,p=0;p<20&&(f=this.sampleCurveX(o),!(Math.abs(f-i)<t));p++)i>f?x=o:E=o,o=.5*(E-x)+x;return o},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};const re=ue(.25,.1,.25,1);function Z(i,t,o){return Math.min(o,Math.max(t,i))}function me(i,t,o){const p=o-t,f=((i-t)%p+p)%p+t;return f===t?o:f}function _e(i,...t){for(const o of t)for(const p in o)i[p]=o[p];return i}let Fe=1;function gt(i,t){i.forEach(o=>{t[o]&&(t[o]=t[o].bind(t))})}function zt(i,t,o){const p={};for(const f in i)p[f]=t.call(o||this,i[f],f,i);return p}function Ct(i,t,o){const p={};for(const f in i)t.call(o||this,i[f],f,i)&&(p[f]=i[f]);return p}function it(i){return Array.isArray(i)?i.map(it):typeof i=="object"&&i?zt(i,it):i}const je={};function nt(i){je[i]||(typeof console!="undefined"&&console.warn(i),je[i]=!0)}function ct(i,t,o){return(o.y-i.y)*(t.x-i.x)>(t.y-i.y)*(o.x-i.x)}function Xe(i){let t=0;for(let o,p,f=0,_=i.length,x=_-1;f<_;x=f++)o=i[f],p=i[x],t+=(p.x-o.x)*(o.y+p.y);return t}function at(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function rt(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,p,f,_)=>{const x=f||_;return t[p]=!x||x.toLowerCase(),""}),t["max-age"]){const o=parseInt(t["max-age"],10);isNaN(o)?delete t["max-age"]:t["max-age"]=o}return t}let Oe,bt,We=null;function ft(i){if(We==null){const t=i.navigator?i.navigator.userAgent:null;We=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return We}function wt(i){return typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap}const Ze={now:typeof performance!="undefined"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){const o=window.document.createElement("canvas"),p=o.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return o.width=i.width,o.height=i.height,p.drawImage(i,0,0,i.width,i.height),p.getImageData(-t,-t,i.width+2*t,i.height+2*t)},resolveURL:i=>(Oe||(Oe=document.createElement("a")),Oe.href=i,Oe.href),hardwareConcurrency:typeof navigator!="undefined"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(bt==null&&(bt=matchMedia("(prefers-reduced-motion: reduce)")),bt.matches)}};var De=Wt;function Wt(i,t){this.x=i,this.y=t}Wt.prototype={clone:function(){return new Wt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,o=i.y-this.y;return t*t+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),o=Math.sin(i),p=o*this.x+t*this.y;return this.x=t*this.x-o*this.y,this.y=p,this},_rotateAround:function(i,t){var o=Math.cos(i),p=Math.sin(i),f=t.y+p*(this.x-t.x)+o*(this.y-t.y);return this.x=t.x+o*(this.x-t.x)-p*(this.y-t.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Wt.convert=function(i){return i instanceof Wt?i:Array.isArray(i)?new Wt(i[0],i[1]):i};const si={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},vt="mapbox-tiles";let Ht,gi,ui=500,Ci=50;function fi(){typeof caches=="undefined"||Ht||(Ht=caches.open(vt))}let ei=1/0;const _i={supported:!1,testSupport:function(i){!$e&&lt&&(di?Ui(i):$i=i)}};let $i,lt,$e=!1,di=!1;function Ui(i){const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,lt),i.isContextLost())return;_i.supported=!0}catch{}i.deleteTexture(t),$e=!0}typeof document!="undefined"&&(lt=document.createElement("img"),lt.onload=function(){$i&&Ui($i),$i=null,di=!0},lt.onerror=function(){$e=!0,$i=null},lt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Mr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Mr);class Ai extends Error{constructor(t,o,p,f){super(`AJAXError: ${o} (${t}): ${p}`),this.status=t,this.statusText=o,this.url=p,this.body=f}}const gr=at()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function _r(i,t){const o=new AbortController,p=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:gr(),signal:o.signal});let f=!1,_=!1;return i.type==="json"&&p.headers.set("Accept","application/json"),((x,E,z)=>{if(_)return;const R=Date.now();fetch(p).then(V=>V.ok?((q,X,Y)=>{(i.type==="arrayBuffer"?q.arrayBuffer():i.type==="json"?q.json():q.text()).then(Q=>{_||(X&&Y&&function(fe,de,Te){if(fi(),!Ht)return;const Pe={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach((Me,Le)=>Pe.headers.set(Le,Me));const Ee=rt(de.headers.get("Cache-Control")||"");Ee["no-store"]||(Ee["max-age"]&&Pe.headers.set("Expires",new Date(Te+1e3*Ee["max-age"]).toUTCString()),new Date(Pe.headers.get("Expires")).getTime()-Te<42e4||function(Me,Le){if(gi===void 0)try{new Response(new ReadableStream),gi=!0}catch{gi=!1}gi?Le(Me.body):Me.blob().then(Le)}(de,Me=>{const Le=new Response(Me,Pe);fi(),Ht&&Ht.then(Ue=>Ue.put(function(He){const Ge=He.indexOf("?");return Ge<0?He:He.slice(0,Ge)}(fe.url),Le)).catch(Ue=>nt(Ue.message))}))}(p,X,Y),f=!0,t(null,Q,q.headers.get("Cache-Control"),q.headers.get("Expires")))}).catch(Q=>{_||t(new Error(Q.message))})})(V,null,R):V.blob().then(q=>t(new Ai(V.status,V.statusText,i.url,q)))).catch(V=>{V.code!==20&&t(new Error(V.message))})})(),{cancel:()=>{_=!0,f||o.abort()}}}const Er=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(at()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!at()){const p=i.url.substring(0,i.url.indexOf("://"));return(si.REGISTERED_PROTOCOLS[p]||_r)(i,t)}}if(!(/^file:/.test(o=i.url)||/^file:/.test(gr())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return _r(i,t);if(at()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var o;return function(p,f){const _=new XMLHttpRequest;_.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const x in p.headers)_.setRequestHeader(x,p.headers[x]);return p.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=p.credentials==="include",_.onerror=()=>{f(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let x=_.response;if(p.type==="json")try{x=JSON.parse(_.response)}catch(E){return f(E)}f(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const x=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});f(new Ai(_.status,_.statusText,p.url,x))}},_.send(p.body),{cancel:()=>_.abort()}}(i,t)},Dr=function(i,t){return Er(_e(i,{type:"arrayBuffer"}),t)};function Jr(i){const t=window.document.createElement("a");return t.href=i,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}const bi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let br,cr;br=[],cr=0;const Hi=function(i,t){if(_i.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),cr>=si.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return br.push(_),_}cr++;let o=!1;const p=()=>{if(!o)for(o=!0,cr--;br.length&&cr<si.MAX_PARALLEL_IMAGE_REQUESTS;){const _=br.shift(),{requestParameters:x,callback:E,cancelled:z}=_;z||(_.cancel=Hi(x,E).cancel)}},f=Dr(i,(_,x,E,z)=>{p(),_?t(_):x&&function(R,V){typeof createImageBitmap=="function"?function(q,X){const Y=new Blob([new Uint8Array(q)],{type:"image/png"});createImageBitmap(Y).then(Q=>{X(null,Q)}).catch(Q=>{X(new Error(`Could not load image because of ${Q.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(R,V):function(q,X){const Y=new Image;Y.onload=()=>{X(null,Y),URL.revokeObjectURL(Y.src),Y.onload=null,window.requestAnimationFrame(()=>{Y.src=bi})},Y.onerror=()=>X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Q=new Blob([new Uint8Array(q)],{type:"image/png"});Y.src=q.byteLength?URL.createObjectURL(Q):bi}(R,V)}(x,(R,V)=>{R!=null?t(R):V!=null&&t(null,V,{cacheControl:E,expires:z})})});return{cancel:()=>{f.cancel(),p()}}};function Qt(i,t,o){o[i]&&o[i].indexOf(t)!==-1||(o[i]=o[i]||[],o[i].push(t))}function tr(i,t,o){if(o&&o[i]){const p=o[i].indexOf(t);p!==-1&&o[i].splice(p,1)}}class Di{constructor(t,o={}){_e(this,o),this.type=t}}class jt extends Di{constructor(t,o={}){super("error",_e({error:t},o))}}class Vi{on(t,o){return this._listeners=this._listeners||{},Qt(t,o,this._listeners),this}off(t,o){return tr(t,o,this._listeners),tr(t,o,this._oneTimeListeners),this}once(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},Qt(t,o,this._oneTimeListeners),this}fire(t,o){typeof t=="string"&&(t=new Di(t,o||{}));const p=t.type;if(this.listens(p)){t.target=this;const f=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const E of f)E.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const E of _)tr(p,E,this._oneTimeListeners),E.call(this,t);const x=this._eventedParent;x&&(_e(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof jt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,o){return this._eventedParent=t,this._eventedParentData=o,this}}var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ae{constructor(t,o,p,f){this.message=(t?`${t}: `:"")+p,f&&(this.identifier=f),o!=null&&o.__line__&&(this.line=o.__line__)}}function $r(i){const t=i.value;return t?[new Ae(i.key,t,"constants have been deprecated as of v8")]:[]}function yr(i,...t){for(const o of t)for(const p in o)i[p]=o[p];return i}function Gt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function hi(i){if(Array.isArray(i))return i.map(hi);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const o in i)t[o]=hi(i[o]);return t}return Gt(i)}class Ti extends Error{constructor(t,o){super(o),this.message=o,this.key=t}}class xr{constructor(t,o=[]){this.parent=t,this.bindings={};for(const[p,f]of o)this.bindings[p]=f}concat(t){return new xr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Mi={kind:"null"},Ve={kind:"number"},Dt={kind:"string"},Pt={kind:"boolean"},Ii={kind:"color"},Ar={kind:"object"},Mt={kind:"value"},kn={kind:"collator"},vr={kind:"formatted"},bn={kind:"resolvedImage"};function ki(i,t){return{kind:"array",itemType:i,N:t}}function pi(i){if(i.kind==="array"){const t=pi(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const hn=[Mi,Ve,Dt,Pt,Ii,vr,Ar,ki(Mt),bn];function mn(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!mn(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const o of hn)if(!mn(o,t))return null}}return`Expected ${pi(i)} but found ${pi(t)} instead.`}function wr(i,t){return t.some(o=>o.kind===i.kind)}function an(i,t){return t.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}var wn,is={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Tn(i){return(i=Math.round(i))<0?0:i>255?255:i}function ge(i){return Tn(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function B(i){return(t=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:t>1?1:t;var t}function M(i,t,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(t-i)*o*6:2*o<1?t:3*o<2?i+(t-i)*(2/3-o)*6:i}try{wn={}.parseCSSColor=function(i){var t,o=i.replace(/ /g,"").toLowerCase();if(o in is)return is[o].slice();if(o[0]==="#")return o.length===4?(t=parseInt(o.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:o.length===7&&(t=parseInt(o.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var p=o.indexOf("("),f=o.indexOf(")");if(p!==-1&&f+1===o.length){var _=o.substr(0,p),x=o.substr(p+1,f-(p+1)).split(","),E=1;switch(_){case"rgba":if(x.length!==4)return null;E=B(x.pop());case"rgb":return x.length!==3?null:[ge(x[0]),ge(x[1]),ge(x[2]),E];case"hsla":if(x.length!==4)return null;E=B(x.pop());case"hsl":if(x.length!==3)return null;var z=(parseFloat(x[0])%360+360)%360/360,R=B(x[1]),V=B(x[2]),q=V<=.5?V*(R+1):V+R-V*R,X=2*V-q;return[Tn(255*M(X,q,z+1/3)),Tn(255*M(X,q,z)),Tn(255*M(X,q,z-1/3)),E];default:return null}}return null}}catch{}class L{constructor(t,o,p,f=1){this.r=t,this.g=o,this.b=p,this.a=f}static parse(t){if(!t)return;if(t instanceof L)return t;if(typeof t!="string")return;const o=wn(t);return o?new L(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[t,o,p,f]=this.toArray();return`rgba(${Math.round(t)},${Math.round(o)},${Math.round(p)},${f})`}toArray(){const{r:t,g:o,b:p,a:f}=this;return f===0?[0,0,0,0]:[255*t/f,255*o/f,255*p/f,f]}}L.black=new L(0,0,0,1),L.white=new L(1,1,1,1),L.transparent=new L(0,0,0,0),L.red=new L(1,0,0,1);class G{constructor(t,o,p){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,o){return this.collator.compare(t,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class H{constructor(t,o,p,f,_){this.text=t,this.image=o,this.scale=p,this.fontStack=f,this.textColor=_}}class te{constructor(t){this.sections=t}static fromString(t){return new te([new H(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof te?t:te.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class ne{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ne({name:t,available:!1}):null}}function ie(i,t,o,p){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[i,t,o,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[i,t,o,p]:[i,t,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function se(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof L||i instanceof G||i instanceof te||i instanceof ne)return!0;if(Array.isArray(i)){for(const t of i)if(!se(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!se(i[t]))return!1;return!0}return!1}function pe(i){if(i===null)return Mi;if(typeof i=="string")return Dt;if(typeof i=="boolean")return Pt;if(typeof i=="number")return Ve;if(i instanceof L)return Ii;if(i instanceof G)return kn;if(i instanceof te)return vr;if(i instanceof ne)return bn;if(Array.isArray(i)){const t=i.length;let o;for(const p of i){const f=pe(p);if(o){if(o===f)continue;o=Mt;break}o=f}return ki(o||Mt,t)}return Ar}function Ie(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof L||i instanceof te||i instanceof ne?i.toString():JSON.stringify(i)}class Se{constructor(t,o){this.type=t,this.value=o}static parse(t,o){if(t.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!se(t[1]))return o.error("invalid value");const p=t[1];let f=pe(p);const _=o.expectedType;return f.kind!=="array"||f.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(f=_),new Se(f,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ke{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const st={string:Dt,number:Ve,boolean:Pt,object:Ar};class he{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let p,f=1;const _=t[0];if(_==="array"){let E,z;if(t.length>2){const R=t[1];if(typeof R!="string"||!(R in st)||R==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);E=st[R],f++}else E=Mt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);z=t[2],f++}p=ki(E,z)}else p=st[_];const x=[];for(;f<t.length;f++){const E=o.parse(t[f],f,Mt);if(!E)return null;x.push(E)}return new he(p,x)}evaluate(t){for(let o=0;o<this.args.length;o++){const p=this.args[o].evaluate(t);if(!mn(this.type,pe(p)))return p;if(o===this.args.length-1)throw new ke(`Expected value to be of type ${pi(this.type)}, but found ${pi(pe(p))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const qe={"to-boolean":Pt,"to-color":Ii,"to-number":Ve,"to-string":Dt};class ot{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const p=t[0];if((p==="to-boolean"||p==="to-string")&&t.length!==2)return o.error("Expected one argument.");const f=qe[p],_=[];for(let x=1;x<t.length;x++){const E=o.parse(t[x],x,Mt);if(!E)return null;_.push(E)}return new ot(f,_)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let o,p;for(const f of this.args){if(o=f.evaluate(t),p=null,o instanceof L)return o;if(typeof o=="string"){const _=t.parseColor(o);if(_)return _}else if(Array.isArray(o)&&(p=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:ie(o[0],o[1],o[2],o[3]),!p))return new L(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ke(p||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const p of this.args){if(o=p.evaluate(t),o===null)return 0;const f=Number(o);if(!isNaN(f))return f}throw new ke(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?te.fromString(Ie(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ne.fromString(Ie(this.args[0].evaluate(t))):Ie(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ut=["Unknown","Point","LineString","Polygon"];class Lt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ut[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=L.parse(t)),o}}class Et{constructor(t,o,p,f){this.name=t,this.type=o,this._evaluate=p,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,o){const p=t[0],f=Et.definitions[p];if(!f)return o.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,E=x.filter(([R])=>!Array.isArray(R)||R.length===t.length-1);let z=null;for(const[R,V]of E){z=new Zs(o.registry,o.path,null,o.scope);const q=[];let X=!1;for(let Y=1;Y<t.length;Y++){const Q=t[Y],fe=Array.isArray(R)?R[Y-1]:R.type,de=z.parse(Q,1+q.length,fe);if(!de){X=!0;break}q.push(de)}if(!X)if(Array.isArray(R)&&R.length!==q.length)z.error(`Expected ${R.length} arguments, but found ${q.length} instead.`);else{for(let Y=0;Y<q.length;Y++){const Q=Array.isArray(R)?R[Y]:R.type,fe=q[Y];z.concat(Y+1).checkSubtype(Q,fe.type)}if(z.errors.length===0)return new Et(p,_,V,q)}}if(E.length===1)o.errors.push(...z.errors);else{const R=(E.length?E:x).map(([q])=>{return X=q,Array.isArray(X)?`(${X.map(pi).join(", ")})`:`(${pi(X.type)}...)`;var X}).join(" | "),V=[];for(let q=1;q<t.length;q++){const X=o.parse(t[q],1+V.length);if(!X)return null;V.push(pi(X.type))}o.error(`Expected arguments of type ${R}, but found (${V.join(", ")}) instead.`)}return null}static register(t,o){Et.definitions=o;for(const p in o)t[p]=Et}}class Vt{constructor(t,o,p){this.type=kn,this.locale=p,this.caseSensitive=t,this.diacriticSensitive=o}static parse(t,o){if(t.length!==2)return o.error("Expected one argument.");const p=t[1];if(typeof p!="object"||Array.isArray(p))return o.error("Collator options argument must be an object.");const f=o.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Pt);if(!f)return null;const _=o.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Pt);if(!_)return null;let x=null;return p.locale&&(x=o.parse(p.locale,1,Dt),!x)?null:new Vt(f,_,x)}evaluate(t){return new G(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const Kt=8192;function Qi(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Ni(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function fr(i,t){const o=(180+i[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(o*f*Kt),Math.round(p*f*Kt)]}function gn(i,t,o){const p=i[0]-t[0],f=i[1]-t[1],_=i[0]-o[0],x=i[1]-o[1];return p*x-_*f==0&&p*_<=0&&f*x<=0}function Es(i,t){let o=!1;for(let x=0,E=t.length;x<E;x++){const z=t[x];for(let R=0,V=z.length;R<V-1;R++){if(gn(i,z[R],z[R+1]))return!1;(f=z[R])[1]>(p=i)[1]!=(_=z[R+1])[1]>p[1]&&p[0]<(_[0]-f[0])*(p[1]-f[1])/(_[1]-f[1])+f[0]&&(o=!o)}}var p,f,_;return o}function mr(i,t){for(let o=0;o<t.length;o++)if(Es(i,t[o]))return!0;return!1}function Tr(i,t,o,p){const f=p[0]-o[0],_=p[1]-o[1],x=(i[0]-o[0])*_-f*(i[1]-o[1]),E=(t[0]-o[0])*_-f*(t[1]-o[1]);return x>0&&E<0||x<0&&E>0}function il(i,t,o){for(const R of o)for(let V=0;V<R.length-1;++V)if((E=[(x=R[V+1])[0]-(_=R[V])[0],x[1]-_[1]])[0]*(z=[(f=t)[0]-(p=i)[0],f[1]-p[1]])[1]-E[1]*z[0]!=0&&Tr(p,f,_,x)&&Tr(_,x,p,f))return!0;var p,f,_,x,E,z;return!1}function Ta(i,t){for(let o=0;o<i.length;++o)if(!Es(i[o],t))return!1;for(let o=0;o<i.length-1;++o)if(il(i[o],i[o+1],t))return!1;return!0}function Pl(i,t){for(let o=0;o<t.length;o++)if(Ta(i,t[o]))return!0;return!1}function fo(i,t,o){const p=[];for(let f=0;f<i.length;f++){const _=[];for(let x=0;x<i[f].length;x++){const E=fr(i[f][x],o);Qi(t,E),_.push(E)}p.push(_)}return p}function rl(i,t,o){const p=[];for(let f=0;f<i.length;f++){const _=fo(i[f],t,o);p.push(_)}return p}function Go(i,t,o,p){if(i[0]<o[0]||i[0]>o[2]){const f=.5*p;let _=i[0]-o[0]>f?-p:o[0]-i[0]>f?p:0;_===0&&(_=i[0]-o[2]>f?-p:o[2]-i[0]>f?p:0),i[0]+=_}Qi(t,i)}function Zo(i,t,o,p){const f=Math.pow(2,p.z)*Kt,_=[p.x*Kt,p.y*Kt],x=[];for(const E of i)for(const z of E){const R=[z.x+_[0],z.y+_[1]];Go(R,t,o,f),x.push(R)}return x}function Ia(i,t,o,p){const f=Math.pow(2,p.z)*Kt,_=[p.x*Kt,p.y*Kt],x=[];for(const z of i){const R=[];for(const V of z){const q=[V.x+_[0],V.y+_[1]];Qi(t,q),R.push(q)}x.push(R)}if(t[2]-t[0]<=f/2){(E=t)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const z of x)for(const R of z)Go(R,t,o,f)}var E;return x}class qs{constructor(t,o){this.type=Pt,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(se(t[1])){const p=t[1];if(p.type==="FeatureCollection")for(let f=0;f<p.features.length;++f){const _=p.features[f].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new qs(p,p.features[f].geometry)}else if(p.type==="Feature"){const f=p.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new qs(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new qs(p,p)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,p){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(p.type==="Polygon"){const E=fo(p.coordinates,_,x),z=Zo(o.geometry(),f,_,x);if(!Ni(f,_))return!1;for(const R of z)if(!Es(R,E))return!1}if(p.type==="MultiPolygon"){const E=rl(p.coordinates,_,x),z=Zo(o.geometry(),f,_,x);if(!Ni(f,_))return!1;for(const R of z)if(!mr(R,E))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,p){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(p.type==="Polygon"){const E=fo(p.coordinates,_,x),z=Ia(o.geometry(),f,_,x);if(!Ni(f,_))return!1;for(const R of z)if(!Ta(R,E))return!1}if(p.type==="MultiPolygon"){const E=rl(p.coordinates,_,x),z=Ia(o.geometry(),f,_,x);if(!Ni(f,_))return!1;for(const R of z)if(!Pl(R,E))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Xo(i){if(i instanceof Et&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof qs)return!1;let t=!0;return i.eachChild(o=>{t&&!Xo(o)&&(t=!1)}),t}function rs(i){if(i instanceof Et&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(o=>{t&&!rs(o)&&(t=!1)}),t}function Gs(i,t){if(i instanceof Et&&t.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(p=>{o&&!Gs(p,t)&&(o=!1)}),o}class fs{constructor(t,o){this.type=o.type,this.name=t,this.boundExpression=o}static parse(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const p=t[1];return o.scope.has(p)?new fs(p,o.scope.get(p)):o.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Zs{constructor(t,o=[],p,f=new xr,_=[]){this.registry=t,this.path=o,this.key=o.map(x=>`[${x}]`).join(""),this.scope=f,this.errors=_,this.expectedType=p}parse(t,o,p,f,_={}){return o?this.concat(o,p,f)._parse(t,_):this._parse(t,_)}_parse(t,o){function p(f,_,x){return x==="assert"?new he(_,[f]):x==="coerce"?new ot(_,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[f];if(_){let x=_.parse(t,this);if(!x)return null;if(this.expectedType){const E=this.expectedType,z=x.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||z.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||z.kind!=="value"&&z.kind!=="string"){if(this.checkSubtype(E,z))return null}else x=p(x,E,o.typeAnnotation||"coerce");else x=p(x,E,o.typeAnnotation||"assert")}if(!(x instanceof Se)&&x.type.kind!=="resolvedImage"&&mo(x)){const E=new Lt;try{x=new Se(x.type,x.evaluate(E))}catch(z){return this.error(z.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,o,p){const f=typeof t=="number"?this.path.concat(t):this.path,_=p?this.scope.concat(p):this.scope;return new Zs(this.registry,f,o||null,_,this.errors)}error(t,...o){const p=`${this.key}${o.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ti(p,t))}checkSubtype(t,o){const p=mn(t,o);return p&&this.error(p),p}}function mo(i){if(i instanceof fs)return mo(i.boundExpression);if(i instanceof Et&&i.name==="error"||i instanceof Vt||i instanceof qs)return!1;const t=i instanceof ot||i instanceof he;let o=!0;return i.eachChild(p=>{o=t?o&&mo(p):o&&p instanceof Se}),!!o&&Xo(i)&&Gs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function As(i,t){const o=i.length-1;let p,f,_=0,x=o,E=0;for(;_<=x;)if(E=Math.floor((_+x)/2),p=i[E],f=i[E+1],p<=t){if(E===o||t<f)return E;_=E+1}else{if(!(p>t))throw new ke("Input is not a number.");x=E-1}return 0}class ks{constructor(t,o,p){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(const[f,_]of p)this.labels.push(f),this.outputs.push(_)}static parse(t,o){if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");const p=o.parse(t[1],1,Ve);if(!p)return null;const f=[];let _=null;o.expectedType&&o.expectedType.kind!=="value"&&(_=o.expectedType);for(let x=1;x<t.length;x+=2){const E=x===1?-1/0:t[x],z=t[x+1],R=x,V=x+1;if(typeof E!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(f.length&&f[f.length-1][0]>=E)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const q=o.parse(z,V,_);if(!q)return null;_=_||q.type,f.push([E,q])}return new ks(_,p,f)}evaluate(t){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(t);const f=this.input.evaluate(t);if(f<=o[0])return p[0].evaluate(t);const _=o.length;return f>=o[_-1]?p[_-1].evaluate(t):p[As(o,f)].evaluate(t)}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Qr(i,t,o){return i*(1-o)+t*o}var Xs=Object.freeze({__proto__:null,number:Qr,color:function(i,t,o){return new L(Qr(i.r,t.r,o),Qr(i.g,t.g,o),Qr(i.b,t.b,o),Qr(i.a,t.a,o))},array:function(i,t,o){return i.map((p,f)=>Qr(p,t[f],o))}});const rn=.95047,Qs=1.08883,Sa=4/29,Ea=6/29,Aa=3*Ea*Ea,Wo=Math.PI/180,nl=180/Math.PI;function sl(i){return i>.008856451679035631?Math.pow(i,1/3):i/Aa+Sa}function ol(i){return i>Ea?i*i*i:Aa*(i-Sa)}function Ho(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Ko(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ka(i){const t=Ko(i.r),o=Ko(i.g),p=Ko(i.b),f=sl((.4124564*t+.3575761*o+.1804375*p)/rn),_=sl((.2126729*t+.7151522*o+.072175*p)/1);return{l:116*_-16,a:500*(f-_),b:200*(_-sl((.0193339*t+.119192*o+.9503041*p)/Qs)),alpha:i.a}}function za(i){let t=(i.l+16)/116,o=isNaN(i.a)?t:t+i.a/500,p=isNaN(i.b)?t:t-i.b/200;return t=1*ol(t),o=rn*ol(o),p=Qs*ol(p),new L(Ho(3.2404542*o-1.5371385*t-.4985314*p),Ho(-.969266*o+1.8760108*t+.041556*p),Ho(.0556434*o-.2040259*t+1.0572252*p),i.alpha)}function sr(i,t,o){const p=t-i;return i+o*(p>180||p<-180?p-360*Math.round(p/360):p)}const er={forward:ka,reverse:za,interpolate:function(i,t,o){return{l:Qr(i.l,t.l,o),a:Qr(i.a,t.a,o),b:Qr(i.b,t.b,o),alpha:Qr(i.alpha,t.alpha,o)}}},Yo={forward:function(i){const{l:t,a:o,b:p}=ka(i),f=Math.atan2(p,o)*nl;return{h:f<0?f+360:f,c:Math.sqrt(o*o+p*p),l:t,alpha:i.a}},reverse:function(i){const t=i.h*Wo,o=i.c;return za({l:i.l,a:Math.cos(t)*o,b:Math.sin(t)*o,alpha:i.alpha})},interpolate:function(i,t,o){return{h:sr(i.h,t.h,o),c:Qr(i.c,t.c,o),l:Qr(i.l,t.l,o),alpha:Qr(i.alpha,t.alpha,o)}}};var go=Object.freeze({__proto__:null,lab:er,hcl:Yo});class zn{constructor(t,o,p,f,_){this.type=t,this.operator=o,this.interpolation=p,this.input=f,this.labels=[],this.outputs=[];for(const[x,E]of _)this.labels.push(x),this.outputs.push(E)}static interpolationFactor(t,o,p,f){let _=0;if(t.name==="exponential")_=Ca(o,t.base,p,f);else if(t.name==="linear")_=Ca(o,1,p,f);else if(t.name==="cubic-bezier"){const x=t.controlPoints;_=new W(x[0],x[1],x[2],x[3]).solve(Ca(o,1,p,f))}return _}static parse(t,o){let[p,f,_,...x]=t;if(!Array.isArray(f)||f.length===0)return o.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const R=f[1];if(typeof R!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:R}}else{if(f[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const R=f.slice(1);if(R.length!==4||R.some(V=>typeof V!="number"||V<0||V>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:R}}}if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(_=o.parse(_,2,Ve),!_)return null;const E=[];let z=null;p==="interpolate-hcl"||p==="interpolate-lab"?z=Ii:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(let R=0;R<x.length;R+=2){const V=x[R],q=x[R+1],X=R+3,Y=R+4;if(typeof V!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(E.length&&E[E.length-1][0]>=V)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const Q=o.parse(q,Y,z);if(!Q)return null;z=z||Q.type,E.push([V,Q])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new zn(z,p,f,_,E):o.error(`Type ${pi(z)} is not interpolatable.`)}evaluate(t){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(t);const f=this.input.evaluate(t);if(f<=o[0])return p[0].evaluate(t);const _=o.length;if(f>=o[_-1])return p[_-1].evaluate(t);const x=As(o,f),E=zn.interpolationFactor(this.interpolation,f,o[x],o[x+1]),z=p[x].evaluate(t),R=p[x+1].evaluate(t);return this.operator==="interpolate"?Xs[this.type.kind.toLowerCase()](z,R,E):this.operator==="interpolate-hcl"?Yo.reverse(Yo.interpolate(Yo.forward(z),Yo.forward(R),E)):er.reverse(er.interpolate(er.forward(z),er.forward(R),E))}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ca(i,t,o,p){const f=p-o,_=i-o;return f===0?0:t===1?_/f:(Math.pow(t,_)-1)/(Math.pow(t,f)-1)}class Ln{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expectected at least one argument.");let p=null;const f=o.expectedType;f&&f.kind!=="value"&&(p=f);const _=[];for(const E of t.slice(1)){const z=o.parse(E,1+_.length,p,void 0,{typeAnnotation:"omit"});if(!z)return null;p=p||z.type,_.push(z)}const x=f&&_.some(E=>mn(f,E.type));return new Ln(x?Mt:p,_)}evaluate(t){let o,p=null,f=0;for(const _ of this.args)if(f++,p=_.evaluate(t),p&&p instanceof ne&&!p.available&&(o||(o=p.name),p=null,f===this.args.length&&(p=o)),p!==null)break;return p}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class _o{constructor(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const o of this.bindings)t(o[1]);t(this.result)}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const p=[];for(let _=1;_<t.length-1;_+=2){const x=t[_];if(typeof x!="string")return o.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return o.error("Variable names must contain only alphanumeric characters or '_'.",_);const E=o.parse(t[_+1],_+1);if(!E)return null;p.push([x,E])}const f=o.parse(t[t.length-1],t.length-1,o.expectedType,p);return f?new _o(p,f):null}outputDefined(){return this.result.outputDefined()}}class yo{constructor(t,o,p){this.type=t,this.index=o,this.input=p}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const p=o.parse(t[1],1,Ve),f=o.parse(t[2],2,ki(o.expectedType||Mt));return p&&f?new yo(f.type.itemType,p,f):null}evaluate(t){const o=this.index.evaluate(t),p=this.input.evaluate(t);if(o<0)throw new ke(`Array index out of bounds: ${o} < 0.`);if(o>=p.length)throw new ke(`Array index out of bounds: ${o} > ${p.length-1}.`);if(o!==Math.floor(o))throw new ke(`Array index must be an integer, but found ${o} instead.`);return p[o]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class xo{constructor(t,o){this.type=Pt,this.needle=t,this.haystack=o}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const p=o.parse(t[1],1,Mt),f=o.parse(t[2],2,Mt);return p&&f?wr(p.type,[Pt,Dt,Ve,Mi,Mt])?new xo(p,f):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(p.type)} instead`):null}evaluate(t){const o=this.needle.evaluate(t),p=this.haystack.evaluate(t);if(!p)return!1;if(!an(o,["boolean","string","number","null"]))throw new ke(`Expected first argument to be of type boolean, string, number or null, but found ${pi(pe(o))} instead.`);if(!an(p,["string","array"]))throw new ke(`Expected second argument to be of type array or string, but found ${pi(pe(p))} instead.`);return p.indexOf(o)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class vo{constructor(t,o,p){this.type=Ve,this.needle=t,this.haystack=o,this.fromIndex=p}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const p=o.parse(t[1],1,Mt),f=o.parse(t[2],2,Mt);if(!p||!f)return null;if(!wr(p.type,[Pt,Dt,Ve,Mi,Mt]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(p.type)} instead`);if(t.length===4){const _=o.parse(t[3],3,Ve);return _?new vo(p,f,_):null}return new vo(p,f)}evaluate(t){const o=this.needle.evaluate(t),p=this.haystack.evaluate(t);if(!an(o,["boolean","string","number","null"]))throw new ke(`Expected first argument to be of type boolean, string, number or null, but found ${pi(pe(o))} instead.`);if(!an(p,["string","array"]))throw new ke(`Expected second argument to be of type array or string, but found ${pi(pe(p))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(t);return p.indexOf(o,f)}return p.indexOf(o)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Jo{constructor(t,o,p,f,_,x){this.inputType=t,this.type=o,this.input=p,this.cases=f,this.outputs=_,this.otherwise=x}static parse(t,o){if(t.length<5)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return o.error("Expected an even number of arguments.");let p,f;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);const _={},x=[];for(let R=2;R<t.length-1;R+=2){let V=t[R];const q=t[R+1];Array.isArray(V)||(V=[V]);const X=o.concat(R);if(V.length===0)return X.error("Expected at least one branch label.");for(const Q of V){if(typeof Q!="number"&&typeof Q!="string")return X.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return X.error("Numeric branch labels must be integer values.");if(p){if(X.checkSubtype(p,pe(Q)))return null}else p=pe(Q);if(_[String(Q)]!==void 0)return X.error("Branch labels must be unique.");_[String(Q)]=x.length}const Y=o.parse(q,R,f);if(!Y)return null;f=f||Y.type,x.push(Y)}const E=o.parse(t[1],1,Mt);if(!E)return null;const z=o.parse(t[t.length-1],t.length-1,f);return z?E.type.kind!=="value"&&o.concat(1).checkSubtype(p,E.type)?null:new Jo(p,f,E,_,x,z):null}evaluate(t){const o=this.input.evaluate(t);return(pe(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class bo{constructor(t,o,p){this.type=t,this.branches=o,this.otherwise=p}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return o.error("Expected an odd number of arguments.");let p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const f=[];for(let x=1;x<t.length-1;x+=2){const E=o.parse(t[x],x,Pt);if(!E)return null;const z=o.parse(t[x+1],x+1,p);if(!z)return null;f.push([E,z]),p=p||z.type}const _=o.parse(t[t.length-1],t.length-1,p);return _?new bo(p,f,_):null}evaluate(t){for(const[o,p]of this.branches)if(o.evaluate(t))return p.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[o,p]of this.branches)t(o),t(p);t(this.otherwise)}outputDefined(){return this.branches.every(([t,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class wo{constructor(t,o,p,f){this.type=t,this.input=o,this.beginIndex=p,this.endIndex=f}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const p=o.parse(t[1],1,Mt),f=o.parse(t[2],2,Ve);if(!p||!f)return null;if(!wr(p.type,[ki(Mt),Dt,Mt]))return o.error(`Expected first argument to be of type array or string, but found ${pi(p.type)} instead`);if(t.length===4){const _=o.parse(t[3],3,Ve);return _?new wo(p.type,p,f,_):null}return new wo(p.type,p,f)}evaluate(t){const o=this.input.evaluate(t),p=this.beginIndex.evaluate(t);if(!an(o,["string","array"]))throw new ke(`Expected first argument to be of type array or string, but found ${pi(pe(o))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(t);return o.slice(p,f)}return o.slice(p)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Pa(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function $o(i,t,o,p){return p.compare(t,o)===0}function eo(i,t,o){const p=i!=="=="&&i!=="!=";return class rm{constructor(_,x,E){this.type=Pt,this.lhs=_,this.rhs=x,this.collator=E,this.hasUntypedArgument=_.type.kind==="value"||x.type.kind==="value"}static parse(_,x){if(_.length!==3&&_.length!==4)return x.error("Expected two or three arguments.");const E=_[0];let z=x.parse(_[1],1,Mt);if(!z)return null;if(!Pa(E,z.type))return x.concat(1).error(`"${E}" comparisons are not supported for type '${pi(z.type)}'.`);let R=x.parse(_[2],2,Mt);if(!R)return null;if(!Pa(E,R.type))return x.concat(2).error(`"${E}" comparisons are not supported for type '${pi(R.type)}'.`);if(z.type.kind!==R.type.kind&&z.type.kind!=="value"&&R.type.kind!=="value")return x.error(`Cannot compare types '${pi(z.type)}' and '${pi(R.type)}'.`);p&&(z.type.kind==="value"&&R.type.kind!=="value"?z=new he(R.type,[z]):z.type.kind!=="value"&&R.type.kind==="value"&&(R=new he(z.type,[R])));let V=null;if(_.length===4){if(z.type.kind!=="string"&&R.type.kind!=="string"&&z.type.kind!=="value"&&R.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(V=x.parse(_[3],3,kn),!V)return null}return new rm(z,R,V)}evaluate(_){const x=this.lhs.evaluate(_),E=this.rhs.evaluate(_);if(p&&this.hasUntypedArgument){const z=pe(x),R=pe(E);if(z.kind!==R.kind||z.kind!=="string"&&z.kind!=="number")throw new ke(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${z.kind}, ${R.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const z=pe(x),R=pe(E);if(z.kind!=="string"||R.kind!=="string")return t(_,x,E)}return this.collator?o(_,x,E,this.collator.evaluate(_)):t(_,x,E)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Ml=eo("==",function(i,t,o){return t===o},$o),To=eo("!=",function(i,t,o){return t!==o},function(i,t,o,p){return!$o(0,t,o,p)}),dc=eo("<",function(i,t,o){return t<o},function(i,t,o,p){return p.compare(t,o)<0}),fc=eo(">",function(i,t,o){return t>o},function(i,t,o,p){return p.compare(t,o)>0}),mc=eo("<=",function(i,t,o){return t<=o},function(i,t,o,p){return p.compare(t,o)<=0}),gc=eo(">=",function(i,t,o){return t>=o},function(i,t,o,p){return p.compare(t,o)>=0});class al{constructor(t,o,p,f,_){this.type=Dt,this.number=t,this.locale=o,this.currency=p,this.minFractionDigits=f,this.maxFractionDigits=_}static parse(t,o){if(t.length!==3)return o.error("Expected two arguments.");const p=o.parse(t[1],1,Ve);if(!p)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return o.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=o.parse(f.locale,1,Dt),!_))return null;let x=null;if(f.currency&&(x=o.parse(f.currency,1,Dt),!x))return null;let E=null;if(f["min-fraction-digits"]&&(E=o.parse(f["min-fraction-digits"],1,Ve),!E))return null;let z=null;return f["max-fraction-digits"]&&(z=o.parse(f["max-fraction-digits"],1,Ve),!z)?null:new al(p,_,x,E,z)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ma{constructor(t){this.type=vr,this.sections=t}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const p=t[1];if(!Array.isArray(p)&&typeof p=="object")return o.error("First argument must be an image or text section.");const f=[];let _=!1;for(let x=1;x<=t.length-1;++x){const E=t[x];if(_&&typeof E=="object"&&!Array.isArray(E)){_=!1;let z=null;if(E["font-scale"]&&(z=o.parse(E["font-scale"],1,Ve),!z))return null;let R=null;if(E["text-font"]&&(R=o.parse(E["text-font"],1,ki(Dt)),!R))return null;let V=null;if(E["text-color"]&&(V=o.parse(E["text-color"],1,Ii),!V))return null;const q=f[f.length-1];q.scale=z,q.font=R,q.textColor=V}else{const z=o.parse(t[x],1,Mt);if(!z)return null;const R=z.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:z,scale:null,font:null,textColor:null})}}return new Ma(f)}evaluate(t){return new te(this.sections.map(o=>{const p=o.content.evaluate(t);return pe(p)===bn?new H("",p,null,null,null):new H(Ie(p),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))}eachChild(t){for(const o of this.sections)t(o.content),o.scale&&t(o.scale),o.font&&t(o.font),o.textColor&&t(o.textColor)}outputDefined(){return!1}}class Qo{constructor(t){this.type=bn,this.input=t}static parse(t,o){if(t.length!==2)return o.error("Expected two arguments.");const p=o.parse(t[1],1,Dt);return p?new Qo(p):o.error("No image name provided.")}evaluate(t){const o=this.input.evaluate(t),p=ne.fromString(o);return p&&t.availableImages&&(p.available=t.availableImages.indexOf(o)>-1),p}eachChild(t){t(this.input)}outputDefined(){return!1}}class ea{constructor(t){this.type=Ve,this.input=t}static parse(t,o){if(t.length!==2)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const p=o.parse(t[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${pi(p.type)} instead.`):new ea(p):null}evaluate(t){const o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ke(`Expected value to be of type string or array, but found ${pi(pe(o))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const ns={"==":Ml,"!=":To,">":fc,"<":dc,">=":gc,"<=":mc,array:he,at:yo,boolean:he,case:bo,coalesce:Ln,collator:Vt,format:Ma,image:Qo,in:xo,"index-of":vo,interpolate:zn,"interpolate-hcl":zn,"interpolate-lab":zn,length:ea,let:_o,literal:Se,match:Jo,number:he,"number-format":al,object:he,slice:wo,step:ks,string:he,"to-boolean":ot,"to-color":ot,"to-number":ot,"to-string":ot,var:fs,within:qs};function ll(i,[t,o,p,f]){t=t.evaluate(i),o=o.evaluate(i),p=p.evaluate(i);const _=f?f.evaluate(i):1,x=ie(t,o,p,_);if(x)throw new ke(x);return new L(t/255*_,o/255*_,p/255*_,_)}function cl(i,t){return i in t}function ta(i,t){const o=t[i];return o===void 0?null:o}function jn(i){return{type:i}}function Da(i){return{result:"success",value:i}}function Kn(i){return{result:"error",value:i}}function ss(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ul(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Vr(i){return!!i.expression&&i.expression.interpolated}function qt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Li(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function or(i){return i}function kr(i,t){const o=t.type==="color",p=i.stops&&typeof i.stops[0][0]=="object",f=p||!(p||i.property!==void 0),_=i.type||(Vr(t)?"exponential":"interval");if(o&&((i=yr({},i)).stops&&(i.stops=i.stops.map(R=>[R[0],L.parse(R[1])])),i.default=L.parse(i.default?i.default:t.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!go[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let x,E,z;if(_==="exponential")x=La;else if(_==="interval")x=ia;else if(_==="categorical"){x=Nr,E=Object.create(null);for(const R of i.stops)E[R[0]]=R[1];z=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);x=_c}if(p){const R={},V=[];for(let Y=0;Y<i.stops.length;Y++){const Q=i.stops[Y],fe=Q[0].zoom;R[fe]===void 0&&(R[fe]={zoom:fe,type:i.type,property:i.property,default:i.default,stops:[]},V.push(fe)),R[fe].stops.push([Q[0].value,Q[1]])}const q=[];for(const Y of V)q.push([R[Y].zoom,kr(R[Y],t)]);const X={name:"linear"};return{kind:"composite",interpolationType:X,interpolationFactor:zn.interpolationFactor.bind(void 0,X),zoomStops:q.map(Y=>Y[0]),evaluate:({zoom:Y},Q)=>La({stops:q,base:i.base},t,Y).evaluate(Y,Q)}}if(f){const R=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:zn.interpolationFactor.bind(void 0,R),zoomStops:i.stops.map(V=>V[0]),evaluate:({zoom:V})=>x(i,t,V,E,z)}}return{kind:"source",evaluate(R,V){const q=V&&V.properties?V.properties[i.property]:void 0;return q===void 0?yi(i.default,t.default):x(i,t,q,E,z)}}}function yi(i,t,o){return i!==void 0?i:t!==void 0?t:o!==void 0?o:void 0}function Nr(i,t,o,p,f){return yi(typeof o===f?p[o]:void 0,i.default,t.default)}function ia(i,t,o){if(qt(o)!=="number")return yi(i.default,t.default);const p=i.stops.length;if(p===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[p-1][0])return i.stops[p-1][1];const f=As(i.stops.map(_=>_[0]),o);return i.stops[f][1]}function La(i,t,o){const p=i.base!==void 0?i.base:1;if(qt(o)!=="number")return yi(i.default,t.default);const f=i.stops.length;if(f===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[f-1][0])return i.stops[f-1][1];const _=As(i.stops.map(V=>V[0]),o),x=function(V,q,X,Y){const Q=Y-X,fe=V-X;return Q===0?0:q===1?fe/Q:(Math.pow(q,fe)-1)/(Math.pow(q,Q)-1)}(o,p,i.stops[_][0],i.stops[_+1][0]),E=i.stops[_][1],z=i.stops[_+1][1];let R=Xs[t.type]||or;if(i.colorSpace&&i.colorSpace!=="rgb"){const V=go[i.colorSpace];R=(q,X)=>V.reverse(V.interpolate(V.forward(q),V.forward(X),x))}return typeof E.evaluate=="function"?{evaluate(...V){const q=E.evaluate.apply(void 0,V),X=z.evaluate.apply(void 0,V);if(q!==void 0&&X!==void 0)return R(q,X,x)}}:R(E,z,x)}function _c(i,t,o){return t.type==="color"?o=L.parse(o):t.type==="formatted"?o=te.fromString(o.toString()):t.type==="resolvedImage"?o=ne.fromString(o.toString()):qt(o)===t.type||t.type==="enum"&&t.values[o]||(o=void 0),yi(o,i.default,t.default)}Et.register(ns,{error:[{kind:"error"},[Dt],(i,[t])=>{throw new ke(t.evaluate(i))}],typeof:[Dt,[Mt],(i,[t])=>pi(pe(t.evaluate(i)))],"to-rgba":[ki(Ve,4),[Ii],(i,[t])=>t.evaluate(i).toArray()],rgb:[Ii,[Ve,Ve,Ve],ll],rgba:[Ii,[Ve,Ve,Ve,Ve],ll],has:{type:Pt,overloads:[[[Dt],(i,[t])=>cl(t.evaluate(i),i.properties())],[[Dt,Ar],(i,[t,o])=>cl(t.evaluate(i),o.evaluate(i))]]},get:{type:Mt,overloads:[[[Dt],(i,[t])=>ta(t.evaluate(i),i.properties())],[[Dt,Ar],(i,[t,o])=>ta(t.evaluate(i),o.evaluate(i))]]},"feature-state":[Mt,[Dt],(i,[t])=>ta(t.evaluate(i),i.featureState||{})],properties:[Ar,[],i=>i.properties()],"geometry-type":[Dt,[],i=>i.geometryType()],id:[Mt,[],i=>i.id()],zoom:[Ve,[],i=>i.globals.zoom],"heatmap-density":[Ve,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ve,[],i=>i.globals.lineProgress||0],accumulated:[Mt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ve,jn(Ve),(i,t)=>{let o=0;for(const p of t)o+=p.evaluate(i);return o}],"*":[Ve,jn(Ve),(i,t)=>{let o=1;for(const p of t)o*=p.evaluate(i);return o}],"-":{type:Ve,overloads:[[[Ve,Ve],(i,[t,o])=>t.evaluate(i)-o.evaluate(i)],[[Ve],(i,[t])=>-t.evaluate(i)]]},"/":[Ve,[Ve,Ve],(i,[t,o])=>t.evaluate(i)/o.evaluate(i)],"%":[Ve,[Ve,Ve],(i,[t,o])=>t.evaluate(i)%o.evaluate(i)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(i,[t,o])=>Math.pow(t.evaluate(i),o.evaluate(i))],sqrt:[Ve,[Ve],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Ve,[Ve],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Ve,[Ve],(i,[t])=>Math.log(t.evaluate(i))],log2:[Ve,[Ve],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Ve,[Ve],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Ve,[Ve],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Ve,[Ve],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Ve,[Ve],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Ve,[Ve],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Ve,[Ve],(i,[t])=>Math.atan(t.evaluate(i))],min:[Ve,jn(Ve),(i,t)=>Math.min(...t.map(o=>o.evaluate(i)))],max:[Ve,jn(Ve),(i,t)=>Math.max(...t.map(o=>o.evaluate(i)))],abs:[Ve,[Ve],(i,[t])=>Math.abs(t.evaluate(i))],round:[Ve,[Ve],(i,[t])=>{const o=t.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[Ve,[Ve],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Ve,[Ve],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Pt,[Dt,Mt],(i,[t,o])=>i.properties()[t.value]===o.value],"filter-id-==":[Pt,[Mt],(i,[t])=>i.id()===t.value],"filter-type-==":[Pt,[Dt],(i,[t])=>i.geometryType()===t.value],"filter-<":[Pt,[Dt,Mt],(i,[t,o])=>{const p=i.properties()[t.value],f=o.value;return typeof p==typeof f&&p<f}],"filter-id-<":[Pt,[Mt],(i,[t])=>{const o=i.id(),p=t.value;return typeof o==typeof p&&o<p}],"filter->":[Pt,[Dt,Mt],(i,[t,o])=>{const p=i.properties()[t.value],f=o.value;return typeof p==typeof f&&p>f}],"filter-id->":[Pt,[Mt],(i,[t])=>{const o=i.id(),p=t.value;return typeof o==typeof p&&o>p}],"filter-<=":[Pt,[Dt,Mt],(i,[t,o])=>{const p=i.properties()[t.value],f=o.value;return typeof p==typeof f&&p<=f}],"filter-id-<=":[Pt,[Mt],(i,[t])=>{const o=i.id(),p=t.value;return typeof o==typeof p&&o<=p}],"filter->=":[Pt,[Dt,Mt],(i,[t,o])=>{const p=i.properties()[t.value],f=o.value;return typeof p==typeof f&&p>=f}],"filter-id->=":[Pt,[Mt],(i,[t])=>{const o=i.id(),p=t.value;return typeof o==typeof p&&o>=p}],"filter-has":[Pt,[Mt],(i,[t])=>t.value in i.properties()],"filter-has-id":[Pt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Pt,[ki(Dt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Pt,[ki(Mt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Pt,[Dt,ki(Mt)],(i,[t,o])=>o.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Pt,[Dt,ki(Mt)],(i,[t,o])=>function(p,f,_,x){for(;_<=x;){const E=_+x>>1;if(f[E]===p)return!0;f[E]>p?x=E-1:_=E+1}return!1}(i.properties()[t.value],o.value,0,o.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(i,[t,o])=>t.evaluate(i)&&o.evaluate(i)],[jn(Pt),(i,t)=>{for(const o of t)if(!o.evaluate(i))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(i,[t,o])=>t.evaluate(i)||o.evaluate(i)],[jn(Pt),(i,t)=>{for(const o of t)if(o.evaluate(i))return!0;return!1}]]},"!":[Pt,[Pt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Pt,[Dt],(i,[t])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(t.evaluate(i))}],upcase:[Dt,[Dt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Dt,[Dt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Dt,jn(Mt),(i,t)=>t.map(o=>Ie(o.evaluate(i))).join("")],"resolved-locale":[Dt,[kn],(i,[t])=>t.evaluate(i).resolvedLocale()]});class ra{constructor(t,o){this.expression=t,this._warningHistory={},this._evaluator=new Lt,this._defaultValue=o?function(p){return p.type==="color"&&Li(p.default)?new L(0,0,0,0):p.type==="color"?L.parse(p.default)||null:p.default===void 0?null:p.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(t,o,p,f,_,x){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=p,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,o,p,f,_,x){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=p||null,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new ke(`Expected value to be one of ${Object.keys(this._enumValues).map(z=>JSON.stringify(z)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console!="undefined"&&console.warn(E.message)),this._defaultValue}}}function to(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ns}function Ws(i,t){const o=new Zs(ns,[],t?function(f){const _={color:Ii,string:Dt,number:Ve,enum:Dt,boolean:Pt,formatted:vr,resolvedImage:bn};return f.type==="array"?ki(_[f.value]||Mt,f.length):_[f.type]}(t):void 0),p=o.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Da(new ra(p,t)):Kn(o.errors)}class io{constructor(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!rs(o.expression)}evaluateWithoutErrorHandling(t,o,p,f,_,x){return this._styleExpression.evaluateWithoutErrorHandling(t,o,p,f,_,x)}evaluate(t,o,p,f,_,x){return this._styleExpression.evaluate(t,o,p,f,_,x)}}class ro{constructor(t,o,p,f){this.kind=t,this.zoomStops=p,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!rs(o.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,o,p,f,_,x){return this._styleExpression.evaluateWithoutErrorHandling(t,o,p,f,_,x)}evaluate(t,o,p,f,_,x){return this._styleExpression.evaluate(t,o,p,f,_,x)}interpolationFactor(t,o,p){return this.interpolationType?zn.interpolationFactor(this.interpolationType,t,o,p):0}}function Io(i,t){const o=Ws(i,t);if(o.result==="error")return o;const p=o.value.expression,f=Xo(p);if(!f&&!ss(t))return Kn([new Ti("","data expressions not supported")]);const _=Gs(p,["zoom"]);if(!_&&!ul(t))return Kn([new Ti("","zoom expressions not supported")]);const x=no(p);return x||_?x instanceof Ti?Kn([x]):x instanceof zn&&!Vr(t)?Kn([new Ti("",'"interpolate" expressions cannot be used with this property')]):Da(x?new ro(f?"camera":"composite",o.value,x.labels,x instanceof zn?x.interpolation:void 0):new io(f?"constant":"source",o.value)):Kn([new Ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zs{constructor(t,o){this._parameters=t,this._specification=o,yr(this,kr(this._parameters,this._specification))}static deserialize(t){return new zs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function no(i){let t=null;if(i instanceof _o)t=no(i.result);else if(i instanceof Ln){for(const o of i.args)if(t=no(o),t)break}else(i instanceof ks||i instanceof zn)&&i.input instanceof Et&&i.input.name==="zoom"&&(t=i);return t instanceof Ti||i.eachChild(o=>{const p=no(o);p instanceof Ti?t=p:!t&&p?t=new Ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&p&&t!==p&&(t=new Ti("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ln(i){const t=i.key,o=i.value,p=i.valueSpec||{},f=i.objectElementValidators||{},_=i.style,x=i.styleSpec;let E=[];const z=qt(o);if(z!=="object")return[new Ae(t,o,`object expected, ${z} found`)];for(const R in o){const V=R.split(".")[0],q=p[V]||p["*"];let X;if(f[V])X=f[V];else if(p[V])X=en;else if(f["*"])X=f["*"];else{if(!p["*"]){E.push(new Ae(t,o[R],`unknown property "${R}"`));continue}X=en}E=E.concat(X({key:(t&&`${t}.`)+R,value:o[R],valueSpec:q,style:_,styleSpec:x,object:o,objectKey:R},o))}for(const R in p)f[R]||p[R].required&&p[R].default===void 0&&o[R]===void 0&&E.push(new Ae(t,o,`missing required property "${R}"`));return E}function hl(i){const t=i.value,o=i.valueSpec,p=i.style,f=i.styleSpec,_=i.key,x=i.arrayElementValidator||en;if(qt(t)!=="array")return[new Ae(_,t,`array expected, ${qt(t)} found`)];if(o.length&&t.length!==o.length)return[new Ae(_,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new Ae(_,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let E={type:o.value,values:o.values};f.$version<7&&(E.function=o.function),qt(o.value)==="object"&&(E=o.value);let z=[];for(let R=0;R<t.length;R++)z=z.concat(x({array:t,arrayIndex:R,value:t[R],valueSpec:E,style:p,styleSpec:f,key:`${_}[${R}]`}));return z}function pl(i){const t=i.key,o=i.value,p=i.valueSpec;let f=qt(o);return f==="number"&&o!=o&&(f="NaN"),f!=="number"?[new Ae(t,o,`number expected, ${f} found`)]:"minimum"in p&&o<p.minimum?[new Ae(t,o,`${o} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&o>p.maximum?[new Ae(t,o,`${o} is greater than the maximum value ${p.maximum}`)]:[]}function dl(i){const t=i.valueSpec,o=Gt(i.value.type);let p,f,_,x={};const E=o!=="categorical"&&i.value.property===void 0,z=!E,R=qt(i.value.stops)==="array"&&qt(i.value.stops[0])==="array"&&qt(i.value.stops[0][0])==="object",V=ln({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Y){if(o==="identity")return[new Ae(Y.key,Y.value,'identity function may not have a "stops" property')];let Q=[];const fe=Y.value;return Q=Q.concat(hl({key:Y.key,value:fe,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:q})),qt(fe)==="array"&&fe.length===0&&Q.push(new Ae(Y.key,fe,"array must have at least one stop")),Q},default:function(Y){return en({key:Y.key,value:Y.value,valueSpec:t,style:Y.style,styleSpec:Y.styleSpec})}}});return o==="identity"&&E&&V.push(new Ae(i.key,i.value,'missing required property "property"')),o==="identity"||i.value.stops||V.push(new Ae(i.key,i.value,'missing required property "stops"')),o==="exponential"&&i.valueSpec.expression&&!Vr(i.valueSpec)&&V.push(new Ae(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(z&&!ss(i.valueSpec)?V.push(new Ae(i.key,i.value,"property functions not supported")):E&&!ul(i.valueSpec)&&V.push(new Ae(i.key,i.value,"zoom functions not supported"))),o!=="categorical"&&!R||i.value.property!==void 0||V.push(new Ae(i.key,i.value,'"property" property is required')),V;function q(Y){let Q=[];const fe=Y.value,de=Y.key;if(qt(fe)!=="array")return[new Ae(de,fe,`array expected, ${qt(fe)} found`)];if(fe.length!==2)return[new Ae(de,fe,`array length 2 expected, length ${fe.length} found`)];if(R){if(qt(fe[0])!=="object")return[new Ae(de,fe,`object expected, ${qt(fe[0])} found`)];if(fe[0].zoom===void 0)return[new Ae(de,fe,"object stop key must have zoom")];if(fe[0].value===void 0)return[new Ae(de,fe,"object stop key must have value")];if(_&&_>Gt(fe[0].zoom))return[new Ae(de,fe[0].zoom,"stop zoom values must appear in ascending order")];Gt(fe[0].zoom)!==_&&(_=Gt(fe[0].zoom),f=void 0,x={}),Q=Q.concat(ln({key:`${de}[0]`,value:fe[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:pl,value:X}}))}else Q=Q.concat(X({key:`${de}[0]`,value:fe[0],valueSpec:{},style:Y.style,styleSpec:Y.styleSpec},fe));return to(hi(fe[1]))?Q.concat([new Ae(`${de}[1]`,fe[1],"expressions are not allowed in function stops.")]):Q.concat(en({key:`${de}[1]`,value:fe[1],valueSpec:t,style:Y.style,styleSpec:Y.styleSpec}))}function X(Y,Q){const fe=qt(Y.value),de=Gt(Y.value),Te=Y.value!==null?Y.value:Q;if(p){if(fe!==p)return[new Ae(Y.key,Te,`${fe} stop domain type must match previous stop domain type ${p}`)]}else p=fe;if(fe!=="number"&&fe!=="string"&&fe!=="boolean")return[new Ae(Y.key,Te,"stop domain value must be a number, string, or boolean")];if(fe!=="number"&&o!=="categorical"){let Pe=`number expected, ${fe} found`;return ss(t)&&o===void 0&&(Pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ae(Y.key,Te,Pe)]}return o!=="categorical"||fe!=="number"||isFinite(de)&&Math.floor(de)===de?o!=="categorical"&&fe==="number"&&f!==void 0&&de<f?[new Ae(Y.key,Te,"stop domain values must appear in ascending order")]:(f=de,o==="categorical"&&de in x?[new Ae(Y.key,Te,"stop domain values must be unique")]:(x[de]=!0,[])):[new Ae(Y.key,Te,`integer expected, found ${de}`)]}}function os(i){const t=(i.expressionContext==="property"?Io:Ws)(hi(i.value),i.valueSpec);if(t.result==="error")return t.value.map(p=>new Ae(`${i.key}${p.key}`,i.value,p.message));const o=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!o.outputDefined())return[new Ae(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!rs(o))return[new Ae(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!rs(o))return[new Ae(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Gs(o,["zoom","feature-state"]))return[new Ae(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Xo(o))return[new Ae(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function so(i){const t=i.key,o=i.value,p=i.valueSpec,f=[];return Array.isArray(p.values)?p.values.indexOf(Gt(o))===-1&&f.push(new Ae(t,o,`expected one of [${p.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(p.values).indexOf(Gt(o))===-1&&f.push(new Ae(t,o,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(o)} found`)),f}function So(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!So(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const fl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cs(i){if(i==null)return{filter:()=>!0,needGeometry:!1};So(i)||(i=Ps(i));const t=Ws(i,fl);if(t.result==="error")throw new Error(t.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,p,f)=>t.value.evaluate(o,p,{},f),needGeometry:Ra(i)}}function Ba(i,t){return i<t?-1:i>t?1:0}function Ra(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(Ra(i[t]))return!0;return!1}function Ps(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?na(i[1],i[2],"=="):t==="!="?as(na(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?na(i[1],i[2],t):t==="any"?(o=i.slice(1),["any"].concat(o.map(Ps))):t==="all"?["all"].concat(i.slice(1).map(Ps)):t==="none"?["all"].concat(i.slice(1).map(Ps).map(as)):t==="in"?Eo(i[1],i.slice(2)):t==="!in"?as(Eo(i[1],i.slice(2))):t==="has"?sa(i[1]):t==="!has"?as(sa(i[1])):t!=="within"||i;var o}function na(i,t,o){switch(i){case"$type":return[`filter-type-${o}`,t];case"$id":return[`filter-id-${o}`,t];default:return[`filter-${o}`,i,t]}}function Eo(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(o=>typeof o!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Ba)]]:["filter-in-small",i,["literal",t]]}}function sa(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function as(i){return["!",i]}function ms(i){return So(hi(i.value))?os(yr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):oa(i)}function oa(i){const t=i.value,o=i.key;if(qt(t)!=="array")return[new Ae(o,t,`array expected, ${qt(t)} found`)];const p=i.styleSpec;let f,_=[];if(t.length<1)return[new Ae(o,t,"filter array must have at least 1 element")];switch(_=_.concat(so({key:`${o}[0]`,value:t[0],valueSpec:p.filter_operator,style:i.style,styleSpec:i.styleSpec})),Gt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Gt(t[1])==="$type"&&_.push(new Ae(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new Ae(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=qt(t[1]),f!=="string"&&_.push(new Ae(`${o}[1]`,t[1],`string expected, ${f} found`)));for(let x=2;x<t.length;x++)f=qt(t[x]),Gt(t[1])==="$type"?_=_.concat(so({key:`${o}[${x}]`,value:t[x],valueSpec:p.geometry_type,style:i.style,styleSpec:i.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&_.push(new Ae(`${o}[${x}]`,t[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)_=_.concat(oa({key:`${o}[${x}]`,value:t[x],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":f=qt(t[1]),t.length!==2?_.push(new Ae(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&_.push(new Ae(`${o}[1]`,t[1],`string expected, ${f} found`));break;case"within":f=qt(t[1]),t.length!==2?_.push(new Ae(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="object"&&_.push(new Ae(`${o}[1]`,t[1],`object expected, ${f} found`))}return _}function Hs(i,t){const o=i.key,p=i.style,f=i.styleSpec,_=i.value,x=i.objectKey,E=f[`${t}_${i.layerType}`];if(!E)return[];const z=x.match(/^(.*)-transition$/);if(t==="paint"&&z&&E[z[1]]&&E[z[1]].transition)return en({key:o,value:_,valueSpec:f.transition,style:p,styleSpec:f});const R=i.valueSpec||E[x];if(!R)return[new Ae(o,_,`unknown property "${x}"`)];let V;if(qt(_)==="string"&&ss(R)&&!R.tokens&&(V=/^{([^}]+)}$/.exec(_)))return[new Ae(o,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const q=[];return i.layerType==="symbol"&&(x==="text-field"&&p&&!p.glyphs&&q.push(new Ae(o,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Li(hi(_))&&Gt(_.type)==="identity"&&q.push(new Ae(o,_,'"text-font" does not support identity functions'))),q.concat(en({key:i.key,value:_,valueSpec:R,style:p,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:x}))}function ml(i){return Hs(i,"paint")}function Ao(i){return Hs(i,"layout")}function gl(i){let t=[];const o=i.value,p=i.key,f=i.style,_=i.styleSpec;o.type||o.ref||t.push(new Ae(p,o,'either "type" or "ref" is required'));let x=Gt(o.type);const E=Gt(o.ref);if(o.id){const z=Gt(o.id);for(let R=0;R<i.arrayIndex;R++){const V=f.layers[R];Gt(V.id)===z&&t.push(new Ae(p,o.id,`duplicate layer id "${o.id}", previously used at line ${V.id.__line__}`))}}if("ref"in o){let z;["type","source","source-layer","filter","layout"].forEach(R=>{R in o&&t.push(new Ae(p,o[R],`"${R}" is prohibited for ref layers`))}),f.layers.forEach(R=>{Gt(R.id)===E&&(z=R)}),z?z.ref?t.push(new Ae(p,o.ref,"ref cannot reference another ref layer")):x=Gt(z.type):t.push(new Ae(p,o.ref,`ref layer "${E}" not found`))}else if(x!=="background")if(o.source){const z=f.sources&&f.sources[o.source],R=z&&Gt(z.type);z?R==="vector"&&x==="raster"?t.push(new Ae(p,o.source,`layer "${o.id}" requires a raster source`)):R==="raster"&&x!=="raster"?t.push(new Ae(p,o.source,`layer "${o.id}" requires a vector source`)):R!=="vector"||o["source-layer"]?R==="raster-dem"&&x!=="hillshade"?t.push(new Ae(p,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!o.paint||!o.paint["line-gradient"]||R==="geojson"&&z.lineMetrics||t.push(new Ae(p,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ae(p,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new Ae(p,o.source,`source "${o.source}" not found`))}else t.push(new Ae(p,o,'missing required property "source"'));return t=t.concat(ln({key:p,value:o,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>en({key:`${p}.type`,value:o.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,object:o,objectKey:"type"}),filter:ms,layout:z=>ln({layer:o,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":R=>Ao(yr({layerType:x},R))}}),paint:z=>ln({layer:o,key:z.key,value:z.value,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":R=>ml(yr({layerType:x},R))}})}})),t}function ls(i){const t=i.value,o=i.key,p=qt(t);return p!=="string"?[new Ae(o,t,`string expected, ${p} found`)]:[]}const _l={promoteId:function({key:i,value:t}){if(qt(t)==="string")return ls({key:i,value:t});{const o=[];for(const p in t)o.push(...ls({key:`${i}.${p}`,value:t[p]}));return o}}};function ko(i){const t=i.value,o=i.key,p=i.styleSpec,f=i.style;if(!t.type)return[new Ae(o,t,'"type" is required')];const _=Gt(t.type);let x;switch(_){case"vector":case"raster":case"raster-dem":return x=ln({key:o,value:t,valueSpec:p[`source_${_.replace("-","_")}`],style:i.style,styleSpec:p,objectElementValidators:_l}),x;case"geojson":if(x=ln({key:o,value:t,valueSpec:p.source_geojson,style:f,styleSpec:p,objectElementValidators:_l}),t.cluster)for(const E in t.clusterProperties){const[z,R]=t.clusterProperties[E],V=typeof z=="string"?[z,["accumulated"],["get",E]]:z;x.push(...os({key:`${o}.${E}.map`,value:R,expressionContext:"cluster-map"})),x.push(...os({key:`${o}.${E}.reduce`,value:V,expressionContext:"cluster-reduce"}))}return x;case"video":return ln({key:o,value:t,valueSpec:p.source_video,style:f,styleSpec:p});case"image":return ln({key:o,value:t,valueSpec:p.source_image,style:f,styleSpec:p});case"canvas":return[new Ae(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return so({key:`${o}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:p})}}function zo(i){const t=i.value,o=i.styleSpec,p=o.light,f=i.style;let _=[];const x=qt(t);if(t===void 0)return _;if(x!=="object")return _=_.concat([new Ae("light",t,`object expected, ${x} found`)]),_;for(const E in t){const z=E.match(/^(.*)-transition$/);_=_.concat(z&&p[z[1]]&&p[z[1]].transition?en({key:E,value:t[E],valueSpec:o.transition,style:f,styleSpec:o}):p[E]?en({key:E,value:t[E],valueSpec:p[E],style:f,styleSpec:o}):[new Ae(E,t[E],`unknown property "${E}"`)])}return _}function Cn(i){const t=i.value,o=i.styleSpec,p=o.terrain,f=i.style;let _=[];const x=qt(t);if(t===void 0)return _;if(x!=="object")return _=_.concat([new Ae("terrain",t,`object expected, ${x} found`)]),_;for(const E in t)_=_.concat(p[E]?en({key:E,value:t[E],valueSpec:p[E],style:f,styleSpec:o}):[new Ae(E,t[E],`unknown property "${E}"`)]);return _}const In={"*":()=>[],array:hl,boolean:function(i){const t=i.value,o=i.key,p=qt(t);return p!=="boolean"?[new Ae(o,t,`boolean expected, ${p} found`)]:[]},number:pl,color:function(i){const t=i.key,o=i.value,p=qt(o);return p!=="string"?[new Ae(t,o,`color expected, ${p} found`)]:wn(o)===null?[new Ae(t,o,`color expected, "${o}" found`)]:[]},constants:$r,enum:so,filter:ms,function:dl,layer:gl,object:ln,source:ko,light:zo,terrain:Cn,string:ls,formatted:function(i){return ls(i).length===0?[]:os(i)},resolvedImage:function(i){return ls(i).length===0?[]:os(i)}};function en(i){const t=i.value,o=i.valueSpec,p=i.styleSpec;return o.expression&&Li(Gt(t))?dl(i):o.expression&&to(hi(t))?os(i):o.type&&In[o.type]?In[o.type](i):ln(yr({},i,{valueSpec:o.type?p[o.type]:o}))}function gs(i){const t=i.value,o=i.key,p=ls(i);return p.length||(t.indexOf("{fontstack}")===-1&&p.push(new Ae(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&p.push(new Ae(o,t,'"glyphs" url must include a "{range}" token'))),p}function Ms(i,t=ae){let o=[];return o=o.concat(en({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,objectElementValidators:{glyphs:gs,"*":()=>[]}})),i.constants&&(o=o.concat($r({key:"constants",value:i.constants,style:i,styleSpec:t}))),oo(o)}function oo(i){return[].concat(i).sort((t,o)=>t.line-o.line)}function qn(i){return function(...t){return oo(i.apply(this,t))}}Ms.source=qn(ko),Ms.light=qn(zo),Ms.terrain=qn(Cn),Ms.layer=qn(gl),Ms.filter=qn(ms),Ms.paintProperty=qn(ml),Ms.layoutProperty=qn(Ao);const aa=Ms,la=aa.light,yc=aa.paintProperty,Fa=aa.layoutProperty;function Ks(i,t){let o=!1;if(t&&t.length)for(const p of t)i.fire(new jt(new Error(p.message))),o=!0;return o}class _s{constructor(t,o,p){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(o=x[1])+2*(p=x[2]);for(let z=0;z<this.d*this.d;z++){const R=x[3+z],V=x[3+z+1];f.push(R===V?null:x.subarray(R,V))}const E=x[3+f.length+1];this.keys=x.subarray(x[3+f.length],E),this.bboxes=x.subarray(E),this.insert=this._insertReadonly}else{this.d=o+2*p;for(let x=0;x<this.d*this.d;x++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=p,this.scale=o/t,this.uid=0;const _=p/o*t;this.min=-_,this.max=t+_}insert(t,o,p,f,_){this._forEachCell(o,p,f,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(f),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,o,p,f,_,x){this.cells[_].push(x)}query(t,o,p,f,_){const x=this.min,E=this.max;if(t<=x&&o<=x&&E<=p&&E<=f&&!_)return Array.prototype.slice.call(this.keys);{const z=[];return this._forEachCell(t,o,p,f,this._queryCell,z,{},_),z}}_queryCell(t,o,p,f,_,x,E,z){const R=this.cells[_];if(R!==null){const V=this.keys,q=this.bboxes;for(let X=0;X<R.length;X++){const Y=R[X];if(E[Y]===void 0){const Q=4*Y;(z?z(q[Q+0],q[Q+1],q[Q+2],q[Q+3]):t<=q[Q+2]&&o<=q[Q+3]&&p>=q[Q+0]&&f>=q[Q+1])?(E[Y]=!0,x.push(V[Y])):E[Y]=!1}}}}_forEachCell(t,o,p,f,_,x,E,z){const R=this._convertToCellCoord(t),V=this._convertToCellCoord(o),q=this._convertToCellCoord(p),X=this._convertToCellCoord(f);for(let Y=R;Y<=q;Y++)for(let Q=V;Q<=X;Q++){const fe=this.d*Q+Y;if((!z||z(this._convertFromCellCoord(Y),this._convertFromCellCoord(Q),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(Q+1)))&&_.call(this,t,o,p,f,fe,x,E,z))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,o=3+this.cells.length+1+1;let p=0;for(let x=0;x<this.cells.length;x++)p+=this.cells[x].length;const f=new Int32Array(o+p+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let _=o;for(let x=0;x<t.length;x++){const E=t[x];f[3+x]=_,f.set(E,_),_+=E.length}return f[3+t.length]=_,f.set(this.keys,_),_+=this.keys.length,f[3+t.length+1]=_,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer}static serialize(t,o){const p=t.toArrayBuffer();return o&&o.push(p),{buffer:p}}static deserialize(t){return new _s(t.buffer)}}const Nt={};function Zt(i,t,o={}){Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Nt[i]={klass:t,omit:o.omit||[],shallow:o.shallow||[]}}Zt("Object",Object),Zt("TransferableGridIndex",_s),Zt("Color",L),Zt("Error",Error),Zt("AJAXError",Ai),Zt("ResolvedImage",ne),Zt("StylePropertyFunction",zs),Zt("StyleExpression",ra,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",ro),Zt("ZoomConstantExpression",io),Zt("CompoundExpression",Et,{omit:["_evaluate"]});for(const i in ns)ns[i]._classRegistryKey||Zt(`Expression_${i}`,ns[i]);function ao(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Yn(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(ao(i)||wt(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const o=i;return t&&t.push(o.buffer),o}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const p of i)o.push(Yn(p,t));return o}if(typeof i=="object"){const o=i.constructor,p=o._classRegistryKey;if(!p)throw new Error("can't serialize object of unregistered class");const f=o.serialize?o.serialize(i,t):{};if(!o.serialize){for(const _ in i){if(!i.hasOwnProperty(_)||Nt[p].omit.indexOf(_)>=0)continue;const x=i[_];f[_]=Nt[p].shallow.indexOf(_)>=0?x:Yn(x,t)}i instanceof Error&&(f.message=i.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(f.$name=p),f}throw new Error("can't serialize object of type "+typeof i)}function Ds(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||ao(i)||wt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Ds);if(typeof i=="object"){const t=i.$name||"Object";if(!Nt[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:o}=Nt[t];if(!o)throw new Error(`can't deserialize unregistered class ${t}`);if(o.deserialize)return o.deserialize(i);const p=Object.create(o.prototype);for(const f of Object.keys(i)){if(f==="$name")continue;const _=i[f];p[f]=Nt[t].shallow.indexOf(f)>=0?_:Ds(_)}return p}throw new Error("can't deserialize object of type "+typeof i)}class Rt{constructor(){this.first=!0}update(t,o){const p=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=p,!0))}}const Bt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function ca(i){for(const t of i)if(Oa(t.charCodeAt(0)))return!0;return!1}function xc(i){for(const t of i)if(!Co(t.charCodeAt(0)))return!1;return!0}function Co(i){return!(Bt.Arabic(i)||Bt["Arabic Supplement"](i)||Bt["Arabic Extended-A"](i)||Bt["Arabic Presentation Forms-A"](i)||Bt["Arabic Presentation Forms-B"](i))}function Oa(i){return!(i!==746&&i!==747&&(i<4352||!(Bt["Bopomofo Extended"](i)||Bt.Bopomofo(i)||Bt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Bt["CJK Compatibility Ideographs"](i)||Bt["CJK Compatibility"](i)||Bt["CJK Radicals Supplement"](i)||Bt["CJK Strokes"](i)||!(!Bt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Bt["CJK Unified Ideographs Extension A"](i)||Bt["CJK Unified Ideographs"](i)||Bt["Enclosed CJK Letters and Months"](i)||Bt["Hangul Compatibility Jamo"](i)||Bt["Hangul Jamo Extended-A"](i)||Bt["Hangul Jamo Extended-B"](i)||Bt["Hangul Jamo"](i)||Bt["Hangul Syllables"](i)||Bt.Hiragana(i)||Bt["Ideographic Description Characters"](i)||Bt.Kanbun(i)||Bt["Kangxi Radicals"](i)||Bt["Katakana Phonetic Extensions"](i)||Bt.Katakana(i)&&i!==12540||!(!Bt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Bt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Bt["Unified Canadian Aboriginal Syllabics"](i)||Bt["Unified Canadian Aboriginal Syllabics Extended"](i)||Bt["Vertical Forms"](i)||Bt["Yijing Hexagram Symbols"](i)||Bt["Yi Syllables"](i)||Bt["Yi Radicals"](i))))}function ua(i){return!(Oa(i)||function(t){return!!(Bt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Bt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Bt["Letterlike Symbols"](t)||Bt["Number Forms"](t)||Bt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Bt["Control Pictures"](t)&&t!==9251||Bt["Optical Character Recognition"](t)||Bt["Enclosed Alphanumerics"](t)||Bt["Geometric Shapes"](t)||Bt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Bt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Bt["CJK Symbols and Punctuation"](t)||Bt.Katakana(t)||Bt["Private Use Area"](t)||Bt["CJK Compatibility Forms"](t)||Bt["Small Form Variants"](t)||Bt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function Dl(i){return i>=1424&&i<=2303||Bt["Arabic Presentation Forms-A"](i)||Bt["Arabic Presentation Forms-B"](i)}function vc(i,t){return!(!t&&Dl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Bt.Khmer(i))}function Ua(i){for(const t of i)if(Dl(t.charCodeAt(0)))return!0;return!1}const ha="deferred",Po="loading",pa="loaded";let Bn=null,cn="unavailable",Ls=null;const Va=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(cn="error"),Bn&&Bn(i)};function Ys(){da.fire(new Di("pluginStateChange",{pluginStatus:cn,pluginURL:Ls}))}const da=new Vi,Bs=function(){return cn},Gn=function(){if(cn!==ha||!Ls)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");cn=Po,Ys(),Ls&&Dr({url:Ls},i=>{i?Va(i):(cn=pa,Ys())})},Ki={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>cn===pa||Ki.applyArabicShaping!=null,isLoading:()=>cn===Po,setState(i){cn=i.pluginStatus,Ls=i.pluginURL},isParsed:()=>Ki.applyArabicShaping!=null&&Ki.processBidirectionalText!=null&&Ki.processStyledBidirectionalText!=null,getPluginURL:()=>Ls};class zr{constructor(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Rt,this.transition={})}isSupportedScript(t){return function(o,p){for(const f of o)if(!vc(f.charCodeAt(0),p))return!1;return!0}(t,Ki.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,o=t-Math.floor(t),p=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*o}}}class lo{constructor(t,o){this.property=t,this.value=o,this.expression=function(p,f){if(Li(p))return new zs(p,f);if(to(p)){const _=Io(p,f);if(_.result==="error")throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=p;return typeof p=="string"&&f.type==="color"&&(_=L.parse(p)),{kind:"constant",evaluate:()=>_}}}(o===void 0?t.specification.default:o,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,o,p){return this.property.possiblyEvaluate(this,t,o,p)}}class fa{constructor(t){this.property=t,this.value=new lo(t,void 0)}transitioned(t,o){return new ja(this.property,this.value,o,_e({},t.transition,this.transition),t.now)}untransitioned(){return new ja(this.property,this.value,null,{},0)}}class Na{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return it(this._values[t].value.value)}setValue(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new fa(this._values[t].property)),this._values[t].value=new lo(this._values[t].property,o===null?void 0:it(o))}getTransition(t){return it(this._values[t].transition)}setTransition(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new fa(this._values[t].property)),this._values[t].transition=it(o)||void 0}serialize(){const t={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(t[o]=p);const f=this.getTransition(o);f!==void 0&&(t[`${o}-transition`]=f)}return t}transitioned(t,o){const p=new Ll(this._properties);for(const f of Object.keys(this._values))p._values[f]=this._values[f].transitioned(t,o._values[f]);return p}untransitioned(){const t=new Ll(this._properties);for(const o of Object.keys(this._values))t._values[o]=this._values[o].untransitioned();return t}}class ja{constructor(t,o,p,f,_){this.property=t,this.value=o,this.begin=_+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=p)}possiblyEvaluate(t,o,p){const f=t.now||0,_=this.value.possiblyEvaluate(t,o,p),x=this.prior;if(x){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return x.possiblyEvaluate(t,o,p);{const E=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,o,p),_,function(z){if(z<=0)return 0;if(z>=1)return 1;const R=z*z,V=R*z;return 4*(z<.5?V:3*(z-R)+V-.75)}(E))}}return _}}class Ll{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,o,p){const f=new Yt(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(t,o,p);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ys{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return it(this._values[t].value)}setValue(t,o){this._values[t]=new lo(this._values[t].property,o===null?void 0:it(o))}serialize(){const t={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(t[o]=p)}return t}possiblyEvaluate(t,o,p){const f=new Yt(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(t,o,p);return f}}class Zn{constructor(t,o,p){this.property=t,this.value=o,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,o,p,f){return this.property.evaluate(this.value,this.parameters,t,o,p,f)}}class Yt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class _t{constructor(t){this.specification=t}possiblyEvaluate(t,o){return t.expression.evaluate(o)}interpolate(t,o,p){const f=Xs[this.specification.type];return f?f(t,o,p):t}}class ri{constructor(t,o){this.specification=t,this.overrides=o}possiblyEvaluate(t,o,p,f){return new Zn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},p,f)}:t.expression,o)}interpolate(t,o,p){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new Zn(this,{kind:"constant",value:void 0},t.parameters);const f=Xs[this.specification.type];return f?new Zn(this,{kind:"constant",value:f(t.value.value,o.value.value,p)},t.parameters):t}evaluate(t,o,p,f,_,x){return t.kind==="constant"?t.value:t.evaluate(o,p,f,_,x)}}class xs extends ri{possiblyEvaluate(t,o,p,f){if(t.value===void 0)return new Zn(this,{kind:"constant",value:void 0},o);if(t.expression.kind==="constant"){const _=t.expression.evaluate(o,null,{},p,f),x=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,E=this._calculate(x,x,x,o);return new Zn(this,{kind:"constant",value:E},o)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:o.zoom-1}),t.expression.evaluate({zoom:o.zoom}),t.expression.evaluate({zoom:o.zoom+1}),o);return new Zn(this,{kind:"constant",value:_},o)}return new Zn(this,t.expression,o)}evaluate(t,o,p,f,_,x){if(t.kind==="source"){const E=t.evaluate(o,p,f,_,x);return this._calculate(E,E,E,o)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(o.zoom)-1},p,f),t.evaluate({zoom:Math.floor(o.zoom)},p,f),t.evaluate({zoom:Math.floor(o.zoom)+1},p,f),o):t.value}_calculate(t,o,p,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:p,to:o}}interpolate(t){return t}}class Mo{constructor(t){this.specification=t}possiblyEvaluate(t,o,p,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(o,null,{},p,f);return this._calculate(_,_,_,o)}return this._calculate(t.expression.evaluate(new zr(Math.floor(o.zoom-1),o)),t.expression.evaluate(new zr(Math.floor(o.zoom),o)),t.expression.evaluate(new zr(Math.floor(o.zoom+1),o)),o)}}_calculate(t,o,p,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:p,to:o}}interpolate(t){return t}}class tn{constructor(t){this.specification=t}possiblyEvaluate(t,o,p,f){return!!t.expression.evaluate(o,null,{},p,f)}interpolate(){return!1}}class pn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in t){const p=t[o];p.specification.overridable&&this.overridableProperties.push(o);const f=this.defaultPropertyValues[o]=new lo(p,void 0),_=this.defaultTransitionablePropertyValues[o]=new fa(p);this.defaultTransitioningPropertyValues[o]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=f.possiblyEvaluate({})}}}Zt("DataDrivenProperty",ri),Zt("DataConstantProperty",_t),Zt("CrossFadedDataDrivenProperty",xs),Zt("CrossFadedProperty",Mo),Zt("ColorRampProperty",tn);const nn="-transition";class Xn extends Vi{constructor(t,o){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),o.layout&&(this._unevaluatedLayout=new ys(o.layout)),o.paint)){this._transitionablePaint=new Na(o.paint);for(const p in t.paint)this.setPaintProperty(p,t.paint[p],{validate:!1});for(const p in t.layout)this.setLayoutProperty(p,t.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yt(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,o,p={}){o!=null&&this._validate(Fa,`layers.${this.id}.layout.${t}`,t,o,p)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,o):this.visibility=o)}getPaintProperty(t){return t.endsWith(nn)?this._transitionablePaint.getTransition(t.slice(0,-nn.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,o,p={}){if(o!=null&&this._validate(yc,`layers.${this.id}.paint.${t}`,t,o,p))return!1;if(t.endsWith(nn))return this._transitionablePaint.setTransition(t.slice(0,-nn.length),o||void 0),!1;{const f=this._transitionablePaint._values[t],_=f.property.specification["property-type"]==="cross-faded-data-driven",x=f.value.isDataDriven(),E=f.value;this._transitionablePaint.setValue(t,o),this._handleSpecialPaintPropertyUpdate(t);const z=this._transitionablePaint._values[t].value;return z.isDataDriven()||x||_||this._handleOverridablePaintPropertyUpdate(t,E,z)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,o,p){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,o){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,o)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ct(t,(o,p)=>!(o===void 0||p==="layout"&&!Object.keys(o).length||p==="paint"&&!Object.keys(o).length))}_validate(t,o,p,f,_={}){return(!_||_.validate!==!1)&&Ks(this,t.call(aa,{key:o,layerType:this.type,objectKey:p,value:f,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const o=this.paint.get(t);if(o instanceof Zn&&ss(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Rs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ir{constructor(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Oi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function jr(i,t=1){let o=0,p=0;return{members:i.map(f=>{const _=Rs[f.type].BYTES_PER_ELEMENT,x=o=co(o,Math.max(t,_)),E=f.components||1;return p=Math.max(p,_),o+=_*E,{name:f.name,type:f.type,components:E,offset:x}}),size:co(o,Math.max(p,t)),alignment:t}}function co(i,t){return Math.ceil(i/t)*t}class Fs extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o){const p=this.length;return this.resize(p+1),this.emplace(p,t,o)}emplace(t,o,p){const f=2*t;return this.int16[f+0]=o,this.int16[f+1]=p,t}}Fs.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",Fs);class w extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,o,p,f)}emplace(t,o,p,f,_){const x=4*t;return this.int16[x+0]=o,this.int16[x+1]=p,this.int16[x+2]=f,this.int16[x+3]=_,t}}w.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",w);class a extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,o,p,f,_,x)}emplace(t,o,p,f,_,x,E){const z=6*t;return this.int16[z+0]=o,this.int16[z+1]=p,this.int16[z+2]=f,this.int16[z+3]=_,this.int16[z+4]=x,this.int16[z+5]=E,t}}a.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",a);class r extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,o,p,f,_,x)}emplace(t,o,p,f,_,x,E){const z=4*t,R=8*t;return this.int16[z+0]=o,this.int16[z+1]=p,this.uint8[R+4]=f,this.uint8[R+5]=_,this.uint8[R+6]=x,this.uint8[R+7]=E,t}}r.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",r);class e extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o){const p=this.length;return this.resize(p+1),this.emplace(p,t,o)}emplace(t,o,p){const f=2*t;return this.float32[f+0]=o,this.float32[f+1]=p,t}}e.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",e);class s extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_,x,E,z,R,V){const q=this.length;return this.resize(q+1),this.emplace(q,t,o,p,f,_,x,E,z,R,V)}emplace(t,o,p,f,_,x,E,z,R,V,q){const X=10*t;return this.uint16[X+0]=o,this.uint16[X+1]=p,this.uint16[X+2]=f,this.uint16[X+3]=_,this.uint16[X+4]=x,this.uint16[X+5]=E,this.uint16[X+6]=z,this.uint16[X+7]=R,this.uint16[X+8]=V,this.uint16[X+9]=q,t}}s.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",s);class u extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_,x,E,z,R,V,q,X){const Y=this.length;return this.resize(Y+1),this.emplace(Y,t,o,p,f,_,x,E,z,R,V,q,X)}emplace(t,o,p,f,_,x,E,z,R,V,q,X,Y){const Q=12*t;return this.int16[Q+0]=o,this.int16[Q+1]=p,this.int16[Q+2]=f,this.int16[Q+3]=_,this.uint16[Q+4]=x,this.uint16[Q+5]=E,this.uint16[Q+6]=z,this.uint16[Q+7]=R,this.int16[Q+8]=V,this.int16[Q+9]=q,this.int16[Q+10]=X,this.int16[Q+11]=Y,t}}u.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",u);class d extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,p){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,p)}emplace(t,o,p,f){const _=3*t;return this.float32[_+0]=o,this.float32[_+1]=p,this.float32[_+2]=f,t}}d.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",d);class g extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint32[1*t+0]=o,t}}g.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",g);class b extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_,x,E,z,R){const V=this.length;return this.resize(V+1),this.emplace(V,t,o,p,f,_,x,E,z,R)}emplace(t,o,p,f,_,x,E,z,R,V){const q=10*t,X=5*t;return this.int16[q+0]=o,this.int16[q+1]=p,this.int16[q+2]=f,this.int16[q+3]=_,this.int16[q+4]=x,this.int16[q+5]=E,this.uint32[X+3]=z,this.uint16[q+8]=R,this.uint16[q+9]=V,t}}b.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",b);class I extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,t,o,p,f,_,x)}emplace(t,o,p,f,_,x,E){const z=6*t;return this.int16[z+0]=o,this.int16[z+1]=p,this.int16[z+2]=f,this.int16[z+3]=_,this.int16[z+4]=x,this.int16[z+5]=E,t}}I.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",I);class k extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,t,o,p,f,_)}emplace(t,o,p,f,_,x){const E=4*t,z=8*t;return this.float32[E+0]=o,this.float32[E+1]=p,this.float32[E+2]=f,this.int16[z+6]=_,this.int16[z+7]=x,t}}k.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",k);class D extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,o,p,f)}emplace(t,o,p,f,_){const x=12*t,E=3*t;return this.uint8[x+0]=o,this.uint8[x+1]=p,this.float32[E+1]=f,this.float32[E+2]=_,t}}D.prototype.bytesPerElement=12,Zt("StructArrayLayout2ub2f12",D);class F extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,p){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,p)}emplace(t,o,p,f){const _=3*t;return this.uint16[_+0]=o,this.uint16[_+1]=p,this.uint16[_+2]=f,t}}F.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",F);class j extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te)}emplace(t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te,Pe){const Ee=24*t,Me=12*t,Le=48*t;return this.int16[Ee+0]=o,this.int16[Ee+1]=p,this.uint16[Ee+2]=f,this.uint16[Ee+3]=_,this.uint32[Me+2]=x,this.uint32[Me+3]=E,this.uint32[Me+4]=z,this.uint16[Ee+10]=R,this.uint16[Ee+11]=V,this.uint16[Ee+12]=q,this.float32[Me+7]=X,this.float32[Me+8]=Y,this.uint8[Le+36]=Q,this.uint8[Le+37]=fe,this.uint8[Le+38]=de,this.uint32[Me+10]=Te,this.int16[Ee+22]=Pe,t}}j.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",j);class N extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te,Pe,Ee,Me,Le,Ue,He,Ge,tt,et,ht,Tt){const St=this.length;return this.resize(St+1),this.emplace(St,t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te,Pe,Ee,Me,Le,Ue,He,Ge,tt,et,ht,Tt)}emplace(t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te,Pe,Ee,Me,Le,Ue,He,Ge,tt,et,ht,Tt,St){const pt=34*t,Xt=17*t;return this.int16[pt+0]=o,this.int16[pt+1]=p,this.int16[pt+2]=f,this.int16[pt+3]=_,this.int16[pt+4]=x,this.int16[pt+5]=E,this.int16[pt+6]=z,this.int16[pt+7]=R,this.uint16[pt+8]=V,this.uint16[pt+9]=q,this.uint16[pt+10]=X,this.uint16[pt+11]=Y,this.uint16[pt+12]=Q,this.uint16[pt+13]=fe,this.uint16[pt+14]=de,this.uint16[pt+15]=Te,this.uint16[pt+16]=Pe,this.uint16[pt+17]=Ee,this.uint16[pt+18]=Me,this.uint16[pt+19]=Le,this.uint16[pt+20]=Ue,this.uint16[pt+21]=He,this.uint16[pt+22]=Ge,this.uint32[Xt+12]=tt,this.float32[Xt+13]=et,this.float32[Xt+14]=ht,this.float32[Xt+15]=Tt,this.float32[Xt+16]=St,t}}N.prototype.bytesPerElement=68,Zt("StructArrayLayout8i15ui1ul4f68",N);class K extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.float32[1*t+0]=o,t}}K.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",K);class J extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,p){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,p)}emplace(t,o,p,f){const _=3*t;return this.int16[_+0]=o,this.int16[_+1]=p,this.int16[_+2]=f,t}}J.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",J);class ee extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,p){const f=this.length;return this.resize(f+1),this.emplace(f,t,o,p)}emplace(t,o,p,f){const _=4*t;return this.uint32[2*t+0]=o,this.uint16[_+2]=p,this.uint16[_+3]=f,t}}ee.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",ee);class le extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o){const p=this.length;return this.resize(p+1),this.emplace(p,t,o)}emplace(t,o,p){const f=2*t;return this.uint16[f+0]=o,this.uint16[f+1]=p,t}}le.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",le);class ce extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint16[1*t+0]=o,t}}ce.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",ce);class ye extends Oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,o,p,f)}emplace(t,o,p,f,_){const x=4*t;return this.float32[x+0]=o,this.float32[x+1]=p,this.float32[x+2]=f,this.float32[x+3]=_,t}}ye.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",ye);class oe extends Ir{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new De(this.anchorPointX,this.anchorPointY)}}oe.prototype.size=20;class ve extends b{get(t){return new oe(this,t)}}Zt("CollisionBoxArray",ve);class be extends Ir{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}be.prototype.size=48;class ze extends j{get(t){return new be(this,t)}}Zt("PlacedSymbolArray",ze);class we extends Ir{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}we.prototype.size=68;class Ne extends N{get(t){return new we(this,t)}}Zt("SymbolInstanceArray",Ne);class Ce extends K{getoffsetX(t){return this.float32[1*t+0]}}Zt("GlyphOffsetArray",Ce);class ut extends J{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Zt("SymbolLineVertexArray",ut);class yt extends Ir{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}yt.prototype.size=8;class xt extends ee{get(t){return new yt(this,t)}}Zt("FeatureIndexArray",xt);class Ft extends Fs{}class ti extends Fs{}class It extends Fs{}class ii extends a{}class oi extends r{}class xi extends e{}class vi extends s{}class Gi extends u{}class Yr extends d{}class Pn extends g{}class qr extends I{}class _n extends D{}class Sn extends F{}class Or extends le{}const Ri=jr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yi}=Ri;class Zi{constructor(t=[]){this.segments=t}prepareSegment(t,o,p,f){let _=this.segments[this.segments.length-1];return t>Zi.MAX_VERTEX_ARRAY_LENGTH&&nt(`Max vertices per segment is ${Zi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!_||_.vertexLength+t>Zi.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f)&&(_={vertexOffset:o.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},f!==void 0&&(_.sortKey=f),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const t of this.segments)for(const o in t.vaos)t.vaos[o].destroy()}static simpleSegment(t,o,p,f){return new Zi([{vertexOffset:t,primitiveOffset:o,vertexLength:p,primitiveLength:f,vaos:{},sortKey:0}])}}function rr(i,t){return 256*(i=Z(Math.floor(i),0,255))+Z(Math.floor(t),0,255)}Zi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Zi);const wi=jr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Fi={exports:{}},Gr={exports:{}};Gr.exports=function(i,t){var o,p,f,_,x,E,z,R;for(p=i.length-(o=3&i.length),f=t,x=3432918353,E=461845907,R=0;R<p;)z=255&i.charCodeAt(R)|(255&i.charCodeAt(++R))<<8|(255&i.charCodeAt(++R))<<16|(255&i.charCodeAt(++R))<<24,++R,f=27492+(65535&(_=5*(65535&(f=(f^=z=(65535&(z=(z=(65535&z)*x+(((z>>>16)*x&65535)<<16)&4294967295)<<15|z>>>17))*E+(((z>>>16)*E&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(z=0,o){case 3:z^=(255&i.charCodeAt(R+2))<<16;case 2:z^=(255&i.charCodeAt(R+1))<<8;case 1:f^=z=(65535&(z=(z=(65535&(z^=255&i.charCodeAt(R)))*x+(((z>>>16)*x&65535)<<16)&4294967295)<<15|z>>>17))*E+(((z>>>16)*E&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0};var Mn={exports:{}};Mn.exports=function(i,t){for(var o,p=i.length,f=t^p,_=0;p>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(o>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),p-=4,++_;switch(p){case 3:f^=(255&i.charCodeAt(_+2))<<16;case 2:f^=(255&i.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};var Lr=Gr.exports,Un=Mn.exports;Fi.exports=Lr,Fi.exports.murmur3=Lr,Fi.exports.murmur2=Un;class vs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,o,p,f){this.ids.push(bs(t)),this.positions.push(o,p,f)}getPositions(t){const o=bs(t);let p=0,f=this.ids.length-1;for(;p<f;){const x=p+f>>1;this.ids[x]>=o?f=x:p=x+1}const _=[];for(;this.ids[p]===o;)_.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return _}static serialize(t,o){const p=new Float64Array(t.ids),f=new Uint32Array(t.positions);return Js(p,f,0,p.length-1),o&&o.push(p.buffer,f.buffer),{ids:p,positions:f}}static deserialize(t){const o=new vs;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o}}function bs(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Fi.exports(String(i))}function Js(i,t,o,p){for(;o<p;){const f=i[o+p>>1];let _=o-1,x=p+1;for(;;){do _++;while(i[_]<f);do x--;while(i[x]>f);if(_>=x)break;Wn(i,_,x),Wn(t,3*_,3*x),Wn(t,3*_+1,3*x+1),Wn(t,3*_+2,3*x+2)}x-o<p-x?(Js(i,t,o,x),o=x+1):(Js(i,t,x+1,p),p=x)}}function Wn(i,t,o){const p=i[t];i[t]=i[o],i[o]=p}Zt("FeaturePositionMap",vs);class Jn{constructor(t,o){this.gl=t.gl,this.location=o}}class uo extends Jn{constructor(t,o){super(t,o),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class bc extends Jn{constructor(t,o){super(t,o),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class yl extends Jn{constructor(t,o){super(t,o),this.current=L.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const xl=new Float32Array(16);function vl(i){return[rr(255*i.r,255*i.g),rr(255*i.b,255*i.a)]}class Do{constructor(t,o,p){this.value=t,this.uniformNames=o.map(f=>`u_${f}`),this.type=p}setUniform(t,o,p){t.set(p.constantOr(this.value))}getBinding(t,o,p){return this.type==="color"?new yl(t,o):new uo(t,o)}}class ws{constructor(t,o){this.uniformNames=o.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr}setUniform(t,o,p,f){const _=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,o,p){return p.substr(0,9)==="u_pattern"?new bc(t,o):new uo(t,o)}}class Rn{constructor(t,o,p,f){this.expression=t,this.type=p,this.maxValue=0,this.paintVertexAttributes=o.map(_=>({name:`a_${_}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,o,p,f,_){const x=this.paintVertexArray.length,E=this.expression.evaluate(new zr(0),o,{},f,[],_);this.paintVertexArray.resize(t),this._setPaintValue(x,t,E)}updatePaintArray(t,o,p,f){const _=this.expression.evaluate({zoom:0},p,f);this._setPaintValue(t,o,_)}_setPaintValue(t,o,p){if(this.type==="color"){const f=vl(p);for(let _=t;_<o;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=t;f<o;f++)this.paintVertexArray.emplace(f,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vn{constructor(t,o,p,f,_,x){this.expression=t,this.uniformNames=o.map(E=>`u_${E}_t`),this.type=p,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=o.map(E=>({name:`a_${E}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,o,p,f,_){const x=this.expression.evaluate(new zr(this.zoom),o,{},f,[],_),E=this.expression.evaluate(new zr(this.zoom+1),o,{},f,[],_),z=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(z,t,x,E)}updatePaintArray(t,o,p,f){const _=this.expression.evaluate({zoom:this.zoom},p,f),x=this.expression.evaluate({zoom:this.zoom+1},p,f);this._setPaintValue(t,o,_,x)}_setPaintValue(t,o,p,f){if(this.type==="color"){const _=vl(p),x=vl(f);for(let E=t;E<o;E++)this.paintVertexArray.emplace(E,_[0],_[1],x[0],x[1])}else{for(let _=t;_<o;_++)this.paintVertexArray.emplace(_,p,f);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,o){const p=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,f=Z(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,o,p){return new uo(t,o)}}class ma{constructor(t,o,p,f,_,x){this.expression=t,this.type=o,this.useIntegerZoom=p,this.zoom=f,this.layerId=x,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,o,p){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,o.patterns&&o.patterns[this.layerId],p)}updatePaintArray(t,o,p,f,_){this._setPaintValues(t,o,p.patterns&&p.patterns[this.layerId],_)}_setPaintValues(t,o,p,f){if(!f||!p)return;const{min:_,mid:x,max:E}=p,z=f[_],R=f[x],V=f[E];if(z&&R&&V)for(let q=t;q<o;q++)this.zoomInPaintVertexArray.emplace(q,R.tl[0],R.tl[1],R.br[0],R.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],R.pixelRatio,z.pixelRatio),this.zoomOutPaintVertexArray.emplace(q,R.tl[0],R.tl[1],R.br[0],R.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],R.pixelRatio,V.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,wi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,wi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qa{constructor(t,o,p){this.binders={},this._buffers=[];const f=[];for(const _ in t.paint._values){if(!p(_))continue;const x=t.paint.get(_);if(!(x instanceof Zn&&ss(x.property.specification)))continue;const E=Fh(_,t.type),z=x.value,R=x.property.specification.type,V=x.property.useIntegerZoom,q=x.property.specification["property-type"],X=q==="cross-faded"||q==="cross-faded-data-driven";if(z.kind==="constant")this.binders[_]=X?new ws(z.value,E):new Do(z.value,E,R),f.push(`/u_${_}`);else if(z.kind==="source"||X){const Y=En(_,R,"source");this.binders[_]=X?new ma(z,R,V,o,Y,t.id):new Rn(z,E,R,Y),f.push(`/a_${_}`)}else{const Y=En(_,R,"composite");this.binders[_]=new Vn(z,E,R,V,o,Y),f.push(`/z_${_}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const o=this.binders[t];return o instanceof Rn||o instanceof Vn?o.maxValue:0}populatePaintArrays(t,o,p,f,_){for(const x in this.binders){const E=this.binders[x];(E instanceof Rn||E instanceof Vn||E instanceof ma)&&E.populatePaintArray(t,o,p,f,_)}}setConstantPatternPositions(t,o){for(const p in this.binders){const f=this.binders[p];f instanceof ws&&f.setConstantPatternPositions(t,o)}}updatePaintArrays(t,o,p,f,_){let x=!1;for(const E in t){const z=o.getPositions(E);for(const R of z){const V=p.feature(R.index);for(const q in this.binders){const X=this.binders[q];if((X instanceof Rn||X instanceof Vn||X instanceof ma)&&X.expression.isStateDependent===!0){const Y=f.paint.get(q);X.expression=Y.value,X.updatePaintArray(R.start,R.end,V,t[E],_),x=!0}}}}return x}defines(){const t=[];for(const o in this.binders){const p=this.binders[o];(p instanceof Do||p instanceof ws)&&t.push(...p.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof Rn||p instanceof Vn)for(let f=0;f<p.paintVertexAttributes.length;f++)t.push(p.paintVertexAttributes[f].name);else if(p instanceof ma)for(let f=0;f<wi.members.length;f++)t.push(wi.members[f].name)}return t}getBinderUniforms(){const t=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof Do||p instanceof ws||p instanceof Vn)for(const f of p.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,o){const p=[];for(const f in this.binders){const _=this.binders[f];if(_ instanceof Do||_ instanceof ws||_ instanceof Vn){for(const x of _.uniformNames)if(o[x]){const E=_.getBinding(t,o[x],x);p.push({name:x,property:f,binding:E})}}}return p}setUniforms(t,o,p,f){for(const{name:_,property:x,binding:E}of o)this.binders[x].setUniform(E,f,p.get(x),_)}updatePaintBuffers(t){this._buffers=[];for(const o in this.binders){const p=this.binders[o];if(t&&p instanceof ma){const f=t.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(p instanceof Rn||p instanceof Vn)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(t){for(const o in this.binders){const p=this.binders[o];(p instanceof Rn||p instanceof Vn||p instanceof ma)&&p.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const o=this.binders[t];(o instanceof Rn||o instanceof Vn||o instanceof ma)&&o.destroy()}}}class bl{constructor(t,o,p=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new qa(f,o,p);this.needsUpload=!1,this._featureMap=new vs,this._bufferOffset=0}populatePaintArrays(t,o,p,f,_,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(t,o,f,_,x);o.id!==void 0&&this._featureMap.add(o.id,p,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,o,p,f){for(const _ of p)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,o,_,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Fh(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function En(i,t,o){const p={color:{source:e,composite:ye},number:{source:K,composite:e}},f=function(_){return{"line-pattern":{source:vi,composite:vi},"fill-pattern":{source:vi,composite:vi},"fill-extrusion-pattern":{source:vi,composite:vi}}[_]}(i);return f&&f[o]||p[t][o]}Zt("ConstantBinder",Do),Zt("CrossFadedConstantBinder",ws),Zt("SourceExpressionBinder",Rn),Zt("CrossFadedCompositeBinder",ma),Zt("CompositeExpressionBinder",Vn),Zt("ProgramConfiguration",qa,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",bl);var yn=8192;const nu=Math.pow(2,14)-1,Ga=-nu-1;function Os(i){const t=yn/i.extent,o=i.loadGeometry();for(let p=0;p<o.length;p++){const f=o[p];for(let _=0;_<f.length;_++){const x=f[_],E=Math.round(x.x*t),z=Math.round(x.y*t);x.x=Z(E,Ga,nu),x.y=Z(z,Ga,nu),(E<x.x||E>x.x+1||z<x.y||z>x.y+1)&&nt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function Lo(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Os(i):[]}}function Bl(i,t,o,p,f){i.emplaceBack(2*t+(p+1)/2,2*o+(f+1)/2)}class su{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ti,this.indexArray=new Sn,this.segments=new Zi,this.programConfigurations=new bl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,p){const f=this.layers[0],_=[];let x=null,E=!1;f.type==="circle"&&(x=f.layout.get("circle-sort-key"),E=!x.isConstant());for(const{feature:z,id:R,index:V,sourceLayerIndex:q}of t){const X=this.layers[0]._featureFilter.needGeometry,Y=Lo(z,X);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),Y,p))continue;const Q=E?x.evaluate(Y,{},p):void 0,fe={id:R,properties:z.properties,type:z.type,sourceLayerIndex:q,index:V,geometry:X?Y.geometry:Os(z),patterns:{},sortKey:Q};_.push(fe)}E&&_.sort((z,R)=>z.sortKey-R.sortKey);for(const z of _){const{geometry:R,index:V,sourceLayerIndex:q}=z,X=t[V].feature;this.addFeature(z,R,V,p),o.featureIndex.insert(X,R,V,q,this.index)}}update(t,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,p,f){for(const _ of o)for(const x of _){const E=x.x,z=x.y;if(E<0||E>=yn||z<0||z>=yn)continue;const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),V=R.vertexLength;Bl(this.layoutVertexArray,E,z,-1,-1),Bl(this.layoutVertexArray,E,z,1,-1),Bl(this.layoutVertexArray,E,z,1,1),Bl(this.layoutVertexArray,E,z,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,p,{},f)}}function Oh(i,t){for(let o=0;o<i.length;o++)if(Rl(t,i[o]))return!0;for(let o=0;o<t.length;o++)if(Rl(i,t[o]))return!0;return!!Vu(i,t)}function Uh(i,t,o){return!!Rl(i,t)||!!ou(t,i,o)}function Vh(i,t){if(i.length===1)return wl(t,i[0]);for(let o=0;o<t.length;o++){const p=t[o];for(let f=0;f<p.length;f++)if(Rl(i,p[f]))return!0}for(let o=0;o<i.length;o++)if(wl(t,i[o]))return!0;for(let o=0;o<t.length;o++)if(Vu(i,t[o]))return!0;return!1}function Uu(i,t,o){if(i.length>1){if(Vu(i,t))return!0;for(let p=0;p<t.length;p++)if(ou(t[p],i,o))return!0}for(let p=0;p<i.length;p++)if(ou(i[p],t,o))return!0;return!1}function Vu(i,t){if(i.length===0||t.length===0)return!1;for(let o=0;o<i.length-1;o++){const p=i[o],f=i[o+1];for(let _=0;_<t.length-1;_++)if(Nu(p,f,t[_],t[_+1]))return!0}return!1}function Nu(i,t,o,p){return ct(i,o,p)!==ct(t,o,p)&&ct(i,t,o)!==ct(i,t,p)}function ou(i,t,o){const p=o*o;if(t.length===1)return i.distSqr(t[0])<p;for(let f=1;f<t.length;f++)if(ju(i,t[f-1],t[f])<p)return!0;return!1}function ju(i,t,o){const p=t.distSqr(o);if(p===0)return i.distSqr(t);const f=((i.x-t.x)*(o.x-t.x)+(i.y-t.y)*(o.y-t.y))/p;return i.distSqr(f<0?t:f>1?o:o.sub(t)._mult(f)._add(t))}function wl(i,t){let o,p,f,_=!1;for(let x=0;x<i.length;x++){o=i[x];for(let E=0,z=o.length-1;E<o.length;z=E++)p=o[E],f=o[z],p.y>t.y!=f.y>t.y&&t.x<(f.x-p.x)*(t.y-p.y)/(f.y-p.y)+p.x&&(_=!_)}return _}function Rl(i,t){let o=!1;for(let p=0,f=i.length-1;p<i.length;f=p++){const _=i[p],x=i[f];_.y>t.y!=x.y>t.y&&t.x<(x.x-_.x)*(t.y-_.y)/(x.y-_.y)+_.x&&(o=!o)}return o}function wc(i,t,o){const p=o[0],f=o[2];if(i.x<p.x&&t.x<p.x||i.x>f.x&&t.x>f.x||i.y<p.y&&t.y<p.y||i.y>f.y&&t.y>f.y)return!1;const _=ct(i,t,o[0]);return _!==ct(i,t,o[1])||_!==ct(i,t,o[2])||_!==ct(i,t,o[3])}function Za(i,t,o){const p=t.paint.get(i).value;return p.kind==="constant"?p.value:o.programConfigurations.get(t.id).getMaxValue(i)}function Tl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function au(i,t,o,p,f){if(!t[0]&&!t[1])return i;const _=De.convert(t)._mult(f);o==="viewport"&&_._rotate(-p);const x=[];for(let E=0;E<i.length;E++)x.push(i[E].sub(_));return x}Zt("CircleBucket",su,{omit:["layers"]});const Lp=new pn({"circle-sort-key":new ri(ae.layout_circle["circle-sort-key"])});var Fl={paint:new pn({"circle-radius":new ri(ae.paint_circle["circle-radius"]),"circle-color":new ri(ae.paint_circle["circle-color"]),"circle-blur":new ri(ae.paint_circle["circle-blur"]),"circle-opacity":new ri(ae.paint_circle["circle-opacity"]),"circle-translate":new _t(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new _t(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _t(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _t(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ri(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ri(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ri(ae.paint_circle["circle-stroke-opacity"])}),layout:Lp},Nn=1e-6,Hn=typeof Float32Array!="undefined"?Float32Array:Array;function Ol(){var i=new Hn(9);return Hn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function qu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Tc(i,t,o){var p=t[0],f=t[1],_=t[2],x=t[3],E=t[4],z=t[5],R=t[6],V=t[7],q=t[8],X=t[9],Y=t[10],Q=t[11],fe=t[12],de=t[13],Te=t[14],Pe=t[15],Ee=o[0],Me=o[1],Le=o[2],Ue=o[3];return i[0]=Ee*p+Me*E+Le*q+Ue*fe,i[1]=Ee*f+Me*z+Le*X+Ue*de,i[2]=Ee*_+Me*R+Le*Y+Ue*Te,i[3]=Ee*x+Me*V+Le*Q+Ue*Pe,i[4]=(Ee=o[4])*p+(Me=o[5])*E+(Le=o[6])*q+(Ue=o[7])*fe,i[5]=Ee*f+Me*z+Le*X+Ue*de,i[6]=Ee*_+Me*R+Le*Y+Ue*Te,i[7]=Ee*x+Me*V+Le*Q+Ue*Pe,i[8]=(Ee=o[8])*p+(Me=o[9])*E+(Le=o[10])*q+(Ue=o[11])*fe,i[9]=Ee*f+Me*z+Le*X+Ue*de,i[10]=Ee*_+Me*R+Le*Y+Ue*Te,i[11]=Ee*x+Me*V+Le*Q+Ue*Pe,i[12]=(Ee=o[12])*p+(Me=o[13])*E+(Le=o[14])*q+(Ue=o[15])*fe,i[13]=Ee*f+Me*z+Le*X+Ue*de,i[14]=Ee*_+Me*R+Le*Y+Ue*Te,i[15]=Ee*x+Me*V+Le*Q+Ue*Pe,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Ul,Nh=Tc;function jh(){var i=new Hn(3);return Hn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function lu(i,t,o){var p=new Hn(3);return p[0]=i,p[1]=t,p[2]=o,p}function Ic(i,t,o){var p=t[0],f=t[1],_=t[2],x=t[3];return i[0]=o[0]*p+o[4]*f+o[8]*_+o[12]*x,i[1]=o[1]*p+o[5]*f+o[9]*_+o[13]*x,i[2]=o[2]*p+o[6]*f+o[10]*_+o[14]*x,i[3]=o[3]*p+o[7]*f+o[11]*_+o[15]*x,i}function cu(){var i=new Hn(4);return Hn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Vl(i,t){const o=Ic([],[i.x,i.y,0,1],t);return new De(o[0]/o[3],o[1]/o[3])}jh(),Ul=new Hn(4),Hn!=Float32Array&&(Ul[0]=0,Ul[1]=0,Ul[2]=0,Ul[3]=0),jh(),lu(1,0,0),lu(0,1,0),cu(),cu(),Ol(),function(){var i;i=new Hn(2),Hn!=Float32Array&&(i[0]=0,i[1]=0)}();class Ts extends su{}Zt("HeatmapBucket",Ts,{omit:["layers"]});var qh={paint:new pn({"heatmap-radius":new ri(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ri(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _t(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tn(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _t(ae.paint_heatmap["heatmap-opacity"])})};function Gu(i,{width:t,height:o},p,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*o*p)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*o*p}`)}else f=new Uint8Array(t*o*p);return i.width=t,i.height=o,i.data=f,i}function Gh(i,{width:t,height:o},p){if(t===i.width&&o===i.height)return;const f=Gu({},{width:t,height:o},p);Zu(i,f,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,o)},p),i.width=t,i.height=o,i.data=f.data}function Zu(i,t,o,p,f,_){if(f.width===0||f.height===0)return t;if(f.width>i.width||f.height>i.height||o.x>i.width-f.width||o.y>i.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||p.x>t.width-f.width||p.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=i.data,E=t.data;for(let z=0;z<f.height;z++){const R=((o.y+z)*i.width+o.x)*_,V=((p.y+z)*t.width+p.x)*_;for(let q=0;q<f.width*_;q++)E[V+q]=x[R+q]}return t}class Il{constructor(t,o){Gu(this,t,1,o)}resize(t){Gh(this,t,1)}clone(){return new Il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,p,f,_){Zu(t,o,p,f,_,1)}}class $n{constructor(t,o){Gu(this,t,4,o)}resize(t){Gh(this,t,4)}replace(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new $n({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,p,f,_){Zu(t,o,p,f,_,4)}}function Xu(i){const t={},o=i.resolution||256,p=i.clips?i.clips.length:1,f=i.image||new $n({width:o,height:p}),_=(x,E,z)=>{t[i.evaluationKey]=z;const R=i.expression.evaluate(t);f.data[x+E+0]=Math.floor(255*R.r/R.a),f.data[x+E+1]=Math.floor(255*R.g/R.a),f.data[x+E+2]=Math.floor(255*R.b/R.a),f.data[x+E+3]=Math.floor(255*R.a)};if(i.clips)for(let x=0,E=0;x<p;++x,E+=4*o)for(let z=0,R=0;z<o;z++,R+=4){const V=z/(o-1),{start:q,end:X}=i.clips[x];_(E,R,q*(1-V)+X*V)}else for(let x=0,E=0;x<o;x++,E+=4)_(0,E,x/(o-1));return f}Zt("AlphaImage",Il),Zt("RGBAImage",$n);var Xa={paint:new pn({"hillshade-illumination-direction":new _t(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _t(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _t(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _t(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _t(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _t(ae.paint_hillshade["hillshade-accent-color"])})};const Sc=jr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bp}=Sc;var uu={exports:{}};function hu(i,t,o){o=o||2;var p,f,_,x,E,z,R,V=t&&t.length,q=V?t[0]*o:i.length,X=Zh(i,0,q,o,!0),Y=[];if(!X||X.next===X.prev)return Y;if(V&&(X=function(fe,de,Te,Pe){var Ee,Me,Le,Ue=[];for(Ee=0,Me=de.length;Ee<Me;Ee++)(Le=Zh(fe,de[Ee]*Pe,Ee<Me-1?de[Ee+1]*Pe:fe.length,Pe,!1))===Le.next&&(Le.steiner=!0),Ue.push(fu(Le));for(Ue.sort(Op),Ee=0;Ee<Ue.length;Ee++)Te=Wa(Te=xn(Ue[Ee],Te),Te.next);return Te}(i,t,X,o)),i.length>80*o){p=_=i[0],f=x=i[1];for(var Q=o;Q<q;Q+=o)(E=i[Q])<p&&(p=E),(z=i[Q+1])<f&&(f=z),E>_&&(_=E),z>x&&(x=z);R=(R=Math.max(_-p,x-f))!==0?1/R:0}return Ec(X,Y,o,p,f,R),Y}function Zh(i,t,o,p,f){var _,x;if(f===zc(i,t,o,p)>0)for(_=t;_<o;_+=p)x=Hu(_,i[_],i[_+1],x);else for(_=o-p;_>=t;_-=p)x=Hu(_,i[_],i[_+1],x);return x&&kc(x,x.next)&&(_a(x),x=x.next),x}function Wa(i,t){if(!i)return i;t||(t=i);var o,p=i;do if(o=!1,p.steiner||!kc(p,p.next)&&dn(p.prev,p,p.next)!==0)p=p.next;else{if(_a(p),(p=t=p.prev)===p.next)break;o=!0}while(o||p!==t);return t}function Ec(i,t,o,p,f,_,x){if(i){!x&&_&&function(V,q,X,Y){var Q=V;do Q.z===null&&(Q.z=du(Q.x,Q.y,q,X,Y)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==V);Q.prevZ.nextZ=null,Q.prevZ=null,function(fe){var de,Te,Pe,Ee,Me,Le,Ue,He,Ge=1;do{for(Te=fe,fe=null,Me=null,Le=0;Te;){for(Le++,Pe=Te,Ue=0,de=0;de<Ge&&(Ue++,Pe=Pe.nextZ);de++);for(He=Ge;Ue>0||He>0&&Pe;)Ue!==0&&(He===0||!Pe||Te.z<=Pe.z)?(Ee=Te,Te=Te.nextZ,Ue--):(Ee=Pe,Pe=Pe.nextZ,He--),Me?Me.nextZ=Ee:fe=Ee,Ee.prevZ=Me,Me=Ee;Te=Pe}Me.nextZ=null,Ge*=2}while(Le>1)}(Q)}(i,p,f,_);for(var E,z,R=i;i.prev!==i.next;)if(E=i.prev,z=i.next,_?Wu(i,p,f,_):Rp(i))t.push(E.i/o),t.push(i.i/o),t.push(z.i/o),_a(i),i=z.next,R=z.next;else if((i=z)===R){x?x===1?Ec(i=Fp(Wa(i),t,o),t,o,p,f,_,2):x===2&&Nl(i,t,o,p,f,_):Ec(Wa(i),t,o,p,f,_,1);break}}}function Rp(i){var t=i.prev,o=i,p=i.next;if(dn(t,o,p)>=0)return!1;for(var f=i.next.next;f!==i.prev;){if(ga(t.x,t.y,o.x,o.y,p.x,p.y,f.x,f.y)&&dn(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Wu(i,t,o,p){var f=i.prev,_=i,x=i.next;if(dn(f,_,x)>=0)return!1;for(var E=f.x>_.x?f.x>x.x?f.x:x.x:_.x>x.x?_.x:x.x,z=f.y>_.y?f.y>x.y?f.y:x.y:_.y>x.y?_.y:x.y,R=du(f.x<_.x?f.x<x.x?f.x:x.x:_.x<x.x?_.x:x.x,f.y<_.y?f.y<x.y?f.y:x.y:_.y<x.y?_.y:x.y,t,o,p),V=du(E,z,t,o,p),q=i.prevZ,X=i.nextZ;q&&q.z>=R&&X&&X.z<=V;){if(q!==i.prev&&q!==i.next&&ga(f.x,f.y,_.x,_.y,x.x,x.y,q.x,q.y)&&dn(q.prev,q,q.next)>=0||(q=q.prevZ,X!==i.prev&&X!==i.next&&ga(f.x,f.y,_.x,_.y,x.x,x.y,X.x,X.y)&&dn(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;q&&q.z>=R;){if(q!==i.prev&&q!==i.next&&ga(f.x,f.y,_.x,_.y,x.x,x.y,q.x,q.y)&&dn(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;X&&X.z<=V;){if(X!==i.prev&&X!==i.next&&ga(f.x,f.y,_.x,_.y,x.x,x.y,X.x,X.y)&&dn(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function Fp(i,t,o){var p=i;do{var f=p.prev,_=p.next.next;!kc(f,_)&&jl(f,p,p.next,_)&&Zl(f,_)&&Zl(_,f)&&(t.push(f.i/o),t.push(p.i/o),t.push(_.i/o),_a(p),_a(p.next),p=i=_),p=p.next}while(p!==i);return Wa(p)}function Nl(i,t,o,p,f,_){var x=i;do{for(var E=x.next.next;E!==x.prev;){if(x.i!==E.i&&Ac(x,E)){var z=Xh(x,E);return x=Wa(x,x.next),z=Wa(z,z.next),Ec(x,t,o,p,f,_),void Ec(z,t,o,p,f,_)}E=E.next}x=x.next}while(x!==i)}function Op(i,t){return i.x-t.x}function xn(i,t){var o=function(_,x){var E,z=x,R=_.x,V=_.y,q=-1/0;do{if(V<=z.y&&V>=z.next.y&&z.next.y!==z.y){var X=z.x+(V-z.y)*(z.next.x-z.x)/(z.next.y-z.y);if(X<=R&&X>q){if(q=X,X===R){if(V===z.y)return z;if(V===z.next.y)return z.next}E=z.x<z.next.x?z:z.next}}z=z.next}while(z!==x);if(!E)return null;if(R===q)return E;var Y,Q=E,fe=E.x,de=E.y,Te=1/0;z=E;do R>=z.x&&z.x>=fe&&R!==z.x&&ga(V<de?R:q,V,fe,de,V<de?q:R,V,z.x,z.y)&&(Y=Math.abs(V-z.y)/(R-z.x),Zl(z,_)&&(Y<Te||Y===Te&&(z.x>E.x||z.x===E.x&&pu(E,z)))&&(E=z,Te=Y)),z=z.next;while(z!==Q);return E}(i,t);if(!o)return t;var p=Xh(o,i),f=Wa(o,o.next);return Wa(p,p.next),t===o?f:t}function pu(i,t){return dn(i.prev,i,t.prev)<0&&dn(t.next,i,i.next)<0}function du(i,t,o,p,f){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-o)*f)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-p)*f)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function fu(i){var t=i,o=i;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==i);return o}function ga(i,t,o,p,f,_,x,E){return(f-x)*(t-E)-(i-x)*(_-E)>=0&&(i-x)*(p-E)-(o-x)*(t-E)>=0&&(o-x)*(_-E)-(f-x)*(p-E)>=0}function Ac(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(o,p){var f=o;do{if(f.i!==o.i&&f.next.i!==o.i&&f.i!==p.i&&f.next.i!==p.i&&jl(f,f.next,o,p))return!0;f=f.next}while(f!==o);return!1}(i,t)&&(Zl(i,t)&&Zl(t,i)&&function(o,p){var f=o,_=!1,x=(o.x+p.x)/2,E=(o.y+p.y)/2;do f.y>E!=f.next.y>E&&f.next.y!==f.y&&x<(f.next.x-f.x)*(E-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next;while(f!==o);return _}(i,t)&&(dn(i.prev,i,t.prev)||dn(i,t.prev,t))||kc(i,t)&&dn(i.prev,i,i.next)>0&&dn(t.prev,t,t.next)>0)}function dn(i,t,o){return(t.y-i.y)*(o.x-t.x)-(t.x-i.x)*(o.y-t.y)}function kc(i,t){return i.x===t.x&&i.y===t.y}function jl(i,t,o,p){var f=Gl(dn(i,t,o)),_=Gl(dn(i,t,p)),x=Gl(dn(o,p,i)),E=Gl(dn(o,p,t));return f!==_&&x!==E||!(f!==0||!ql(i,o,t))||!(_!==0||!ql(i,p,t))||!(x!==0||!ql(o,i,p))||!(E!==0||!ql(o,t,p))}function ql(i,t,o){return t.x<=Math.max(i.x,o.x)&&t.x>=Math.min(i.x,o.x)&&t.y<=Math.max(i.y,o.y)&&t.y>=Math.min(i.y,o.y)}function Gl(i){return i>0?1:i<0?-1:0}function Zl(i,t){return dn(i.prev,i,i.next)<0?dn(i,t,i.next)>=0&&dn(i,i.prev,t)>=0:dn(i,t,i.prev)<0||dn(i,i.next,t)<0}function Xh(i,t){var o=new Ku(i.i,i.x,i.y),p=new Ku(t.i,t.x,t.y),f=i.next,_=t.prev;return i.next=t,t.prev=i,o.next=f,f.prev=o,p.next=o,o.prev=p,_.next=p,p.prev=_,p}function Hu(i,t,o,p){var f=new Ku(i,t,o);return p?(f.next=p.next,f.prev=p,p.next.prev=f,p.next=f):(f.prev=f,f.next=f),f}function _a(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ku(i,t,o){this.i=i,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zc(i,t,o,p){for(var f=0,_=t,x=o-p;_<o;_+=p)f+=(i[x]-i[_])*(i[_+1]+i[x+1]),x=_;return f}function Up(i,t,o,p,f){mu(i,t,o||0,p||i.length-1,f||Yu)}function mu(i,t,o,p,f){for(;p>o;){if(p-o>600){var _=p-o+1,x=t-o+1,E=Math.log(_),z=.5*Math.exp(2*E/3),R=.5*Math.sqrt(E*z*(_-z)/_)*(x-_/2<0?-1:1);mu(i,t,Math.max(o,Math.floor(t-x*z/_+R)),Math.min(p,Math.floor(t+(_-x)*z/_+R)),f)}var V=i[t],q=o,X=p;for(Sl(i,o,t),f(i[p],V)>0&&Sl(i,o,p);q<X;){for(Sl(i,q,X),q++,X--;f(i[q],V)<0;)q++;for(;f(i[X],V)>0;)X--}f(i[o],V)===0?Sl(i,o,X):Sl(i,++X,p),X<=t&&(o=X+1),t<=X&&(p=X-1)}}function Sl(i,t,o){var p=i[t];i[t]=i[o],i[o]=p}function Yu(i,t){return i<t?-1:i>t?1:0}function Ju(i,t){const o=i.length;if(o<=1)return[i];const p=[];let f,_;for(let x=0;x<o;x++){const E=Xe(i[x]);E!==0&&(i[x].area=Math.abs(E),_===void 0&&(_=E<0),_===E<0?(f&&p.push(f),f=[i[x]]):f.push(i[x]))}if(f&&p.push(f),t>1)for(let x=0;x<p.length;x++)p[x].length<=t||(Up(p[x],t,1,p[x].length-1,Vp),p[x]=p[x].slice(0,t));return p}function Vp(i,t){return t.area-i.area}function $u(i,t,o){const p=o.patternDependencies;let f=!1;for(const _ of t){const x=_.paint.get(`${i}-pattern`);x.isConstant()||(f=!0);const E=x.constantOr(null);E&&(f=!0,p[E.to]=!0,p[E.from]=!0)}return f}function Qu(i,t,o,p,f){const _=f.patternDependencies;for(const x of t){const E=x.paint.get(`${i}-pattern`).value;if(E.kind!=="constant"){let z=E.evaluate({zoom:p-1},o,{},f.availableImages),R=E.evaluate({zoom:p},o,{},f.availableImages),V=E.evaluate({zoom:p+1},o,{},f.availableImages);z=z&&z.name?z.name:z,R=R&&R.name?R.name:R,V=V&&V.name?V.name:V,_[z]=!0,_[R]=!0,_[V]=!0,o.patterns[x.id]={min:z,mid:R,max:V}}}return o}uu.exports=hu,uu.exports.default=hu,hu.deviation=function(i,t,o,p){var f=t&&t.length,_=Math.abs(zc(i,0,f?t[0]*o:i.length,o));if(f)for(var x=0,E=t.length;x<E;x++)_-=Math.abs(zc(i,t[x]*o,x<E-1?t[x+1]*o:i.length,o));var z=0;for(x=0;x<p.length;x+=3){var R=p[x]*o,V=p[x+1]*o,q=p[x+2]*o;z+=Math.abs((i[R]-i[q])*(i[V+1]-i[R+1])-(i[R]-i[V])*(i[q+1]-i[R+1]))}return _===0&&z===0?0:Math.abs((z-_)/_)},hu.flatten=function(i){for(var t=i[0][0].length,o={vertices:[],holes:[],dimensions:t},p=0,f=0;f<i.length;f++){for(var _=0;_<i[f].length;_++)for(var x=0;x<t;x++)o.vertices.push(i[f][_][x]);f>0&&o.holes.push(p+=i[f-1].length)}return o};class Bo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new It,this.indexArray=new Sn,this.indexArray2=new Or,this.programConfigurations=new bl(t.layers,t.zoom),this.segments=new Zi,this.segments2=new Zi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,p){this.hasPattern=$u("fill",this.layers,o);const f=this.layers[0].layout.get("fill-sort-key"),_=!f.isConstant(),x=[];for(const{feature:E,id:z,index:R,sourceLayerIndex:V}of t){const q=this.layers[0]._featureFilter.needGeometry,X=Lo(E,q);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),X,p))continue;const Y=_?f.evaluate(X,{},p,o.availableImages):void 0,Q={id:z,properties:E.properties,type:E.type,sourceLayerIndex:V,index:R,geometry:q?X.geometry:Os(E),patterns:{},sortKey:Y};x.push(Q)}_&&x.sort((E,z)=>E.sortKey-z.sortKey);for(const E of x){const{geometry:z,index:R,sourceLayerIndex:V}=E;if(this.hasPattern){const q=Qu("fill",this.layers,E,this.zoom,o);this.patternFeatures.push(q)}else this.addFeature(E,z,R,p,{});o.featureIndex.insert(t[R].feature,z,R,V,this.index)}}update(t,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,p)}addFeatures(t,o,p){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,o,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,o,p,f,_){for(const x of Ju(o,500)){let E=0;for(const Y of x)E+=Y.length;const z=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),R=z.vertexLength,V=[],q=[];for(const Y of x){if(Y.length===0)continue;Y!==x[0]&&q.push(V.length/2);const Q=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),fe=Q.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(fe+Y.length-1,fe),V.push(Y[0].x),V.push(Y[0].y);for(let de=1;de<Y.length;de++)this.layoutVertexArray.emplaceBack(Y[de].x,Y[de].y),this.indexArray2.emplaceBack(fe+de-1,fe+de),V.push(Y[de].x),V.push(Y[de].y);Q.vertexLength+=Y.length,Q.primitiveLength+=Y.length}const X=uu.exports(V,q);for(let Y=0;Y<X.length;Y+=3)this.indexArray.emplaceBack(R+X[Y],R+X[Y+1],R+X[Y+2]);z.vertexLength+=E,z.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,p,_,f)}}Zt("FillBucket",Bo,{omit:["layers","patternFeatures"]});const Np=new pn({"fill-sort-key":new ri(ae.layout_fill["fill-sort-key"])});var Wh={paint:new pn({"fill-antialias":new _t(ae.paint_fill["fill-antialias"]),"fill-opacity":new ri(ae.paint_fill["fill-opacity"]),"fill-color":new ri(ae.paint_fill["fill-color"]),"fill-outline-color":new ri(ae.paint_fill["fill-outline-color"]),"fill-translate":new _t(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new _t(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new xs(ae.paint_fill["fill-pattern"])}),layout:Np};const Xl=jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),jp=jr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:qp}=Xl;var Ha={},Hh=De,eh=Wl;function Wl(i,t,o,p,f){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=p,this._values=f,i.readFields(Gp,this,t)}function Gp(i,t,o){i==1?t.id=o.readVarint():i==2?function(p,f){for(var _=p.readVarint()+p.pos;p.pos<_;){var x=f._keys[p.readVarint()],E=f._values[p.readVarint()];f.properties[x]=E}}(o,t):i==3?t.type=o.readVarint():i==4&&(t._geometry=o.pos)}function Zp(i){for(var t,o,p=0,f=0,_=i.length,x=_-1;f<_;x=f++)p+=((o=i[x]).x-(t=i[f]).x)*(t.y+o.y);return p}Wl.types=["Unknown","Point","LineString","Polygon"],Wl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,o=i.readVarint()+i.pos,p=1,f=0,_=0,x=0,E=[];i.pos<o;){if(f<=0){var z=i.readVarint();p=7&z,f=z>>3}if(f--,p===1||p===2)_+=i.readSVarint(),x+=i.readSVarint(),p===1&&(t&&E.push(t),t=[]),t.push(new Hh(_,x));else{if(p!==7)throw new Error("unknown command "+p);t&&t.push(t[0].clone())}}return t&&E.push(t),E},Wl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,o=1,p=0,f=0,_=0,x=1/0,E=-1/0,z=1/0,R=-1/0;i.pos<t;){if(p<=0){var V=i.readVarint();o=7&V,p=V>>3}if(p--,o===1||o===2)(f+=i.readSVarint())<x&&(x=f),f>E&&(E=f),(_+=i.readSVarint())<z&&(z=_),_>R&&(R=_);else if(o!==7)throw new Error("unknown command "+o)}return[x,z,E,R]},Wl.prototype.toGeoJSON=function(i,t,o){var p,f,_=this.extent*Math.pow(2,o),x=this.extent*i,E=this.extent*t,z=this.loadGeometry(),R=Wl.types[this.type];function V(Y){for(var Q=0;Q<Y.length;Q++){var fe=Y[Q];Y[Q]=[360*(fe.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(fe.y+E)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(p=0;p<z.length;p++)q[p]=z[p][0];V(z=q);break;case 2:for(p=0;p<z.length;p++)V(z[p]);break;case 3:for(z=function(Y){var Q=Y.length;if(Q<=1)return[Y];for(var fe,de,Te=[],Pe=0;Pe<Q;Pe++){var Ee=Zp(Y[Pe]);Ee!==0&&(de===void 0&&(de=Ee<0),de===Ee<0?(fe&&Te.push(fe),fe=[Y[Pe]]):fe.push(Y[Pe]))}return fe&&Te.push(fe),Te}(z),p=0;p<z.length;p++)for(f=0;f<z[p].length;f++)V(z[p][f])}z.length===1?z=z[0]:R="Multi"+R;var X={type:"Feature",geometry:{type:R,coordinates:z},properties:this.properties};return"id"in this&&(X.id=this.id),X};var Xp=eh,gu=Hl;function Hl(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(th,this,t),this.length=this._features.length}function th(i,t,o){i===15?t.version=o.readVarint():i===1?t.name=o.readString():i===5?t.extent=o.readVarint():i===2?t._features.push(o.pos):i===3?t._keys.push(o.readString()):i===4&&t._values.push(function(p){for(var f=null,_=p.readVarint()+p.pos;p.pos<_;){var x=p.readVarint()>>3;f=x===1?p.readString():x===2?p.readFloat():x===3?p.readDouble():x===4?p.readVarint64():x===5?p.readVarint():x===6?p.readSVarint():x===7?p.readBoolean():null}return f}(o))}Hl.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Xp(this._pbf,t,this.extent,this._keys,this._values)};var Wp=gu;function Hp(i,t,o){if(i===3){var p=new Wp(o,o.readVarint()+o.pos);p.length&&(t[p.name]=p)}}Ha.VectorTile=function(i,t){this.layers=i.readFields(Hp,{},t)},Ha.VectorTileFeature=eh,Ha.VectorTileLayer=gu;const Kp=Ha.VectorTileFeature.types,El=Math.pow(2,13);function Kl(i,t,o,p,f,_,x,E){i.emplaceBack(t,o,2*Math.floor(p*El)+x,f*El*2,_*El*2,Math.round(E))}class ih{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ii,this.centroidVertexArray=new Ft,this.indexArray=new Sn,this.programConfigurations=new bl(t.layers,t.zoom),this.segments=new Zi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,p){this.features=[],this.hasPattern=$u("fill-extrusion",this.layers,o);for(const{feature:f,id:_,index:x,sourceLayerIndex:E}of t){const z=this.layers[0]._featureFilter.needGeometry,R=Lo(f,z);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),R,p))continue;const V={id:_,sourceLayerIndex:E,index:x,geometry:z?R.geometry:Os(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Qu("fill-extrusion",this.layers,V,this.zoom,o)):this.addFeature(V,V.geometry,x,p,{}),o.featureIndex.insert(f,V.geometry,x,E,this.index,!0)}}addFeatures(t,o,p){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,o,p)}}update(t,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,jp.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,o,p,f,_){const x={x:0,y:0,vertexCount:0};for(const E of Ju(o,500)){let z=0;for(const Q of E)z+=Q.length;let R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Q of E){if(Q.length===0||Jp(Q))continue;let fe=0;for(let de=0;de<Q.length;de++){const Te=Q[de];if(de>=1){const Pe=Q[de-1];if(!Yp(Te,Pe)){R.vertexLength+4>Zi.MAX_VERTEX_ARRAY_LENGTH&&(R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ee=Te.sub(Pe)._perp()._unit(),Me=Pe.dist(Te);fe+Me>32768&&(fe=0),Kl(this.layoutVertexArray,Te.x,Te.y,Ee.x,Ee.y,0,0,fe),Kl(this.layoutVertexArray,Te.x,Te.y,Ee.x,Ee.y,0,1,fe),x.x+=2*Te.x,x.y+=2*Te.y,x.vertexCount+=2,fe+=Me,Kl(this.layoutVertexArray,Pe.x,Pe.y,Ee.x,Ee.y,0,0,fe),Kl(this.layoutVertexArray,Pe.x,Pe.y,Ee.x,Ee.y,0,1,fe),x.x+=2*Pe.x,x.y+=2*Pe.y,x.vertexCount+=2;const Le=R.vertexLength;this.indexArray.emplaceBack(Le,Le+2,Le+1),this.indexArray.emplaceBack(Le+1,Le+2,Le+3),R.vertexLength+=4,R.primitiveLength+=2}}}}if(R.vertexLength+z>Zi.MAX_VERTEX_ARRAY_LENGTH&&(R=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),Kp[t.type]!=="Polygon")continue;const V=[],q=[],X=R.vertexLength;for(const Q of E)if(Q.length!==0){Q!==E[0]&&q.push(V.length/2);for(let fe=0;fe<Q.length;fe++){const de=Q[fe];Kl(this.layoutVertexArray,de.x,de.y,0,0,1,1,0),x.x+=de.x,x.y+=de.y,x.vertexCount+=1,V.push(de.x),V.push(de.y)}}const Y=uu.exports(V,q);for(let Q=0;Q<Y.length;Q+=3)this.indexArray.emplaceBack(X+Y[Q],X+Y[Q+2],X+Y[Q+1]);R.primitiveLength+=Y.length/3,R.vertexLength+=z}for(let E=0;E<x.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,p,_,f)}}function Yp(i,t){return i.x===t.x&&(i.x<0||i.x>yn)||i.y===t.y&&(i.y<0||i.y>yn)}function Jp(i){return i.every(t=>t.x<0)||i.every(t=>t.x>yn)||i.every(t=>t.y<0)||i.every(t=>t.y>yn)}Zt("FillExtrusionBucket",ih,{omit:["layers","features"]});var $p={paint:new pn({"fill-extrusion-opacity":new _t(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ri(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _t(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _t(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new xs(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ri(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ri(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _t(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Cc(i,t){return i.x*t.x+i.y*t.y}function Kh(i,t){if(i.length===1){let o=0;const p=t[o++];let f;for(;!f||p.equals(f);)if(f=t[o++],!f)return 1/0;for(;o<t.length;o++){const _=t[o],x=i[0],E=f.sub(p),z=_.sub(p),R=x.sub(p),V=Cc(E,E),q=Cc(E,z),X=Cc(z,z),Y=Cc(R,E),Q=Cc(R,z),fe=V*X-q*q,de=(X*Y-q*Q)/fe,Te=(V*Q-q*Y)/fe,Pe=p.z*(1-de-Te)+f.z*de+_.z*Te;if(isFinite(Pe))return Pe}return 1/0}{let o=1/0;for(const p of t)o=Math.min(o,p.z);return o}}const Yh=jr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:rh}=Yh,Qp=jr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Jh}=Qp,$h=Ha.VectorTileFeature.types,Qh=Math.cos(Math.PI/180*37.5),ep=Math.pow(2,14)/.5;class nh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new oi,this.layoutVertexArray2=new xi,this.indexArray=new Sn,this.programConfigurations=new bl(t.layers,t.zoom),this.segments=new Zi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,p){this.hasPattern=$u("line",this.layers,o);const f=this.layers[0].layout.get("line-sort-key"),_=!f.isConstant(),x=[];for(const{feature:E,id:z,index:R,sourceLayerIndex:V}of t){const q=this.layers[0]._featureFilter.needGeometry,X=Lo(E,q);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),X,p))continue;const Y=_?f.evaluate(X,{},p):void 0,Q={id:z,properties:E.properties,type:E.type,sourceLayerIndex:V,index:R,geometry:q?X.geometry:Os(E),patterns:{},sortKey:Y};x.push(Q)}_&&x.sort((E,z)=>E.sortKey-z.sortKey);for(const E of x){const{geometry:z,index:R,sourceLayerIndex:V}=E;if(this.hasPattern){const q=Qu("line",this.layers,E,this.zoom,o);this.patternFeatures.push(q)}else this.addFeature(E,z,R,p,{});o.featureIndex.insert(t[R].feature,z,R,V,this.index)}}update(t,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,p)}addFeatures(t,o,p){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,o,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Jh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,o,p,f,_){const x=this.layers[0].layout,E=x.get("line-join").evaluate(t,{}),z=x.get("line-cap"),R=x.get("line-miter-limit"),V=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const q of o)this.addLine(q,t,E,z,R,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,p,_,f)}addLine(t,o,p,f,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Te=0;Te<t.length-1;Te++)this.totalDistance+=t[Te].dist(t[Te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=$h[o.type]==="Polygon";let z=t.length;for(;z>=2&&t[z-1].equals(t[z-2]);)z--;let R=0;for(;R<z-1&&t[R].equals(t[R+1]);)R++;if(z<(E?3:2))return;p==="bevel"&&(_=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let X,Y,Q,fe,de;this.e1=this.e2=-1,E&&(X=t[z-2],de=t[R].sub(X)._unit()._perp());for(let Te=R;Te<z;Te++){if(Q=Te===z-1?E?t[R+1]:void 0:t[Te+1],Q&&t[Te].equals(Q))continue;de&&(fe=de),X&&(Y=X),X=t[Te],de=Q?Q.sub(X)._unit()._perp():fe,fe=fe||de;let Pe=fe.add(de);Pe.x===0&&Pe.y===0||Pe._unit();const Ee=fe.x*de.x+fe.y*de.y,Me=Pe.x*de.x+Pe.y*de.y,Le=Me!==0?1/Me:1/0,Ue=2*Math.sqrt(2-2*Me),He=Me<Qh&&Y&&Q,Ge=fe.x*de.y-fe.y*de.x>0;if(He&&Te>R){const ht=X.dist(Y);if(ht>2*V){const Tt=X.sub(X.sub(Y)._mult(V/ht)._round());this.updateDistance(Y,Tt),this.addCurrentVertex(Tt,fe,0,0,q),Y=Tt}}const tt=Y&&Q;let et=tt?p:E?"butt":f;if(tt&&et==="round"&&(Le<x?et="miter":Le<=2&&(et="fakeround")),et==="miter"&&Le>_&&(et="bevel"),et==="bevel"&&(Le>2&&(et="flipbevel"),Le<_&&(et="miter")),Y&&this.updateDistance(Y,X),et==="miter")Pe._mult(Le),this.addCurrentVertex(X,Pe,0,0,q);else if(et==="flipbevel"){if(Le>100)Pe=de.mult(-1);else{const ht=Le*fe.add(de).mag()/fe.sub(de).mag();Pe._perp()._mult(ht*(Ge?-1:1))}this.addCurrentVertex(X,Pe,0,0,q),this.addCurrentVertex(X,Pe.mult(-1),0,0,q)}else if(et==="bevel"||et==="fakeround"){const ht=-Math.sqrt(Le*Le-1),Tt=Ge?ht:0,St=Ge?0:ht;if(Y&&this.addCurrentVertex(X,fe,Tt,St,q),et==="fakeround"){const pt=Math.round(180*Ue/Math.PI/20);for(let Xt=1;Xt<pt;Xt++){let Ot=Xt/pt;if(Ot!==.5){const Ei=Ot-.5;Ot+=Ot*Ei*(Ot-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Ei*Ei+(.848013+Ee*(.215638*Ee-1.06021)))}const ni=de.sub(fe)._mult(Ot)._add(fe)._unit()._mult(Ge?-1:1);this.addHalfVertex(X,ni.x,ni.y,!1,Ge,0,q)}}Q&&this.addCurrentVertex(X,de,-Tt,-St,q)}else if(et==="butt")this.addCurrentVertex(X,Pe,0,0,q);else if(et==="square"){const ht=Y?1:-1;this.addCurrentVertex(X,Pe,ht,ht,q)}else et==="round"&&(Y&&(this.addCurrentVertex(X,fe,0,0,q),this.addCurrentVertex(X,fe,1,1,q,!0)),Q&&(this.addCurrentVertex(X,de,-1,-1,q,!0),this.addCurrentVertex(X,de,0,0,q)));if(He&&Te<z-1){const ht=X.dist(Q);if(ht>2*V){const Tt=X.add(Q.sub(X)._mult(V/ht)._round());this.updateDistance(X,Tt),this.addCurrentVertex(Tt,de,0,0,q),X=Tt}}}}addCurrentVertex(t,o,p,f,_,x=!1){const E=o.y*f-o.x,z=-o.y-o.x*f;this.addHalfVertex(t,o.x+o.y*p,o.y-o.x*p,x,!1,p,_),this.addHalfVertex(t,E,z,x,!0,-f,_),this.distance>ep/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,p,f,_,x))}addHalfVertex({x:t,y:o},p,f,_,x,E,z){const R=.5*(this.lineClips?this.scaledDistance*(ep-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(o<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*f)+128,1+(E===0?0:E<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const V=z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),z.primitiveLength++),x?this.e2=V:this.e1=V}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,o){this.distance+=t.dist(o),this.updateScaledDistance()}}Zt("LineBucket",nh,{omit:["layers","patternFeatures"]});const ed=new pn({"line-cap":new _t(ae.layout_line["line-cap"]),"line-join":new ri(ae.layout_line["line-join"]),"line-miter-limit":new _t(ae.layout_line["line-miter-limit"]),"line-round-limit":new _t(ae.layout_line["line-round-limit"]),"line-sort-key":new ri(ae.layout_line["line-sort-key"])});var sh={paint:new pn({"line-opacity":new ri(ae.paint_line["line-opacity"]),"line-color":new ri(ae.paint_line["line-color"]),"line-translate":new _t(ae.paint_line["line-translate"]),"line-translate-anchor":new _t(ae.paint_line["line-translate-anchor"]),"line-width":new ri(ae.paint_line["line-width"]),"line-gap-width":new ri(ae.paint_line["line-gap-width"]),"line-offset":new ri(ae.paint_line["line-offset"]),"line-blur":new ri(ae.paint_line["line-blur"]),"line-dasharray":new Mo(ae.paint_line["line-dasharray"]),"line-pattern":new xs(ae.paint_line["line-pattern"]),"line-gradient":new tn(ae.paint_line["line-gradient"])}),layout:ed};const tp=new class extends ri{possiblyEvaluate(i,t){return t=new zr(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,o,p){return t=_e({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,o,p)}}(sh.paint.properties["line-width"].specification);function ip(i,t){return t>0?t+2*i:i}tp.useIntegerZoom=!0;const Pc=jr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Fn=jr([{name:"a_projected_pos",components:3,type:"Float32"}],4);jr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const oh=jr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);jr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ah=jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rp=jr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Br(i,t,o){return i.sections.forEach(p=>{p.text=function(f,_,x){const E=_.layout.get("text-transform").evaluate(x,{});return E==="uppercase"?f=f.toLocaleUpperCase():E==="lowercase"&&(f=f.toLocaleLowerCase()),Ki.applyArabicShaping&&(f=Ki.applyArabicShaping(f)),f}(p.text,t,o)}),i}jr([{name:"triangle",components:3,type:"Uint16"}]),jr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),jr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),jr([{type:"Float32",name:"offsetX"}]),jr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const $s={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Dn=24,_u=ur,lh=function(i,t,o,p,f){var _,x,E=8*f-p-1,z=(1<<E)-1,R=z>>1,V=-7,q=o?f-1:0,X=o?-1:1,Y=i[t+q];for(q+=X,_=Y&(1<<-V)-1,Y>>=-V,V+=E;V>0;_=256*_+i[t+q],q+=X,V-=8);for(x=_&(1<<-V)-1,_>>=-V,V+=p;V>0;x=256*x+i[t+q],q+=X,V-=8);if(_===0)_=1-R;else{if(_===z)return x?NaN:1/0*(Y?-1:1);x+=Math.pow(2,p),_-=R}return(Y?-1:1)*x*Math.pow(2,_-p)},Ro=function(i,t,o,p,f,_){var x,E,z,R=8*_-f-1,V=(1<<R)-1,q=V>>1,X=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=p?0:_-1,Q=p?1:-1,fe=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(E=isNaN(t)?1:0,x=V):(x=Math.floor(Math.log(t)/Math.LN2),t*(z=Math.pow(2,-x))<1&&(x--,z*=2),(t+=x+q>=1?X/z:X*Math.pow(2,1-q))*z>=2&&(x++,z/=2),x+q>=V?(E=0,x=V):x+q>=1?(E=(t*z-1)*Math.pow(2,f),x+=q):(E=t*Math.pow(2,q-1)*Math.pow(2,f),x=0));f>=8;i[o+Y]=255&E,Y+=Q,E/=256,f-=8);for(x=x<<f|E,R+=f;R>0;i[o+Y]=255&x,Y+=Q,x/=256,R-=8);i[o+Y-Q]|=128*fe};function ur(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ur.Varint=0,ur.Fixed64=1,ur.Bytes=2,ur.Fixed32=5;var ya,ch=4294967296,np=1/ch,sp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function xa(i){return i.type===ur.Bytes?i.readVarint()+i.pos:i.pos+1}function Yl(i,t,o){return o?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function op(i,t,o){var p=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));o.realloc(p);for(var f=o.pos-1;f>=i;f--)o.buf[f+p]=o.buf[f]}function td(i,t){for(var o=0;o<i.length;o++)t.writeVarint(i[o])}function id(i,t){for(var o=0;o<i.length;o++)t.writeSVarint(i[o])}function rd(i,t){for(var o=0;o<i.length;o++)t.writeFloat(i[o])}function yu(i,t){for(var o=0;o<i.length;o++)t.writeDouble(i[o])}function Jl(i,t){for(var o=0;o<i.length;o++)t.writeBoolean(i[o])}function ap(i,t){for(var o=0;o<i.length;o++)t.writeFixed32(i[o])}function nd(i,t){for(var o=0;o<i.length;o++)t.writeSFixed32(i[o])}function sd(i,t){for(var o=0;o<i.length;o++)t.writeFixed64(i[o])}function od(i,t){for(var o=0;o<i.length;o++)t.writeSFixed64(i[o])}function Mc(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Ka(i,t,o){i[o]=t,i[o+1]=t>>>8,i[o+2]=t>>>16,i[o+3]=t>>>24}function uh(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function xu(i,t,o){i===1&&o.readMessage(Dc,t)}function Dc(i,t,o){if(i===3){const{id:p,bitmap:f,width:_,height:x,left:E,top:z,advance:R}=o.readMessage($l,{});t.push({id:p,bitmap:new Il({width:_+6,height:x+6},f),metrics:{width:_,height:x,left:E,top:z,advance:R}})}}function $l(i,t,o){i===1?t.id=o.readVarint():i===2?t.bitmap=o.readBytes():i===3?t.width=o.readVarint():i===4?t.height=o.readVarint():i===5?t.left=o.readSVarint():i===6?t.top=o.readSVarint():i===7&&(t.advance=o.readVarint())}function Lc(i){let t=0,o=0;for(const x of i)t+=x.w*x.h,o=Math.max(o,x.w);i.sort((x,E)=>E.h-x.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),o),h:1/0}];let f=0,_=0;for(const x of i)for(let E=p.length-1;E>=0;E--){const z=p[E];if(!(x.w>z.w||x.h>z.h)){if(x.x=z.x,x.y=z.y,_=Math.max(_,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===z.w&&x.h===z.h){const R=p.pop();E<p.length&&(p[E]=R)}else x.h===z.h?(z.x+=x.w,z.w-=x.w):x.w===z.w?(z.y+=x.h,z.h-=x.h):(p.push({x:z.x+x.w,y:z.y,w:z.w-x.w,h:x.h}),z.y+=x.h,z.h-=x.h);break}}return{w:f,h:_,fill:t/(f*_)||0}}ur.prototype={destroy:function(){this.buf=null},readFields:function(i,t,o){for(o=o||this.length;this.pos<o;){var p=this.readVarint(),f=p>>3,_=this.pos;this.type=7&p,i(f,t,this),this.pos===_&&this.skip(p)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Mc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=uh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Mc(this.buf,this.pos)+Mc(this.buf,this.pos+4)*ch;return this.pos+=8,i},readSFixed64:function(){var i=Mc(this.buf,this.pos)+uh(this.buf,this.pos+4)*ch;return this.pos+=8,i},readFloat:function(){var i=lh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=lh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,o,p=this.buf;return t=127&(o=p[this.pos++]),o<128?t:(t|=(127&(o=p[this.pos++]))<<7,o<128?t:(t|=(127&(o=p[this.pos++]))<<14,o<128?t:(t|=(127&(o=p[this.pos++]))<<21,o<128?t:function(f,_,x){var E,z,R=x.buf;if(E=(112&(z=R[x.pos++]))>>4,z<128||(E|=(127&(z=R[x.pos++]))<<3,z<128)||(E|=(127&(z=R[x.pos++]))<<10,z<128)||(E|=(127&(z=R[x.pos++]))<<17,z<128)||(E|=(127&(z=R[x.pos++]))<<24,z<128)||(E|=(1&(z=R[x.pos++]))<<31,z<128))return Yl(f,E,_);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(o=p[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&sp?function(o,p,f){return sp.decode(o.subarray(p,f))}(this.buf,t,i):function(o,p,f){for(var _="",x=p;x<f;){var E,z,R,V=o[x],q=null,X=V>239?4:V>223?3:V>191?2:1;if(x+X>f)break;X===1?V<128&&(q=V):X===2?(192&(E=o[x+1]))==128&&(q=(31&V)<<6|63&E)<=127&&(q=null):X===3?(z=o[x+2],(192&(E=o[x+1]))==128&&(192&z)==128&&((q=(15&V)<<12|(63&E)<<6|63&z)<=2047||q>=55296&&q<=57343)&&(q=null)):X===4&&(z=o[x+2],R=o[x+3],(192&(E=o[x+1]))==128&&(192&z)==128&&(192&R)==128&&((q=(15&V)<<18|(63&E)<<12|(63&z)<<6|63&R)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,X=1):q>65535&&(q-=65536,_+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),_+=String.fromCharCode(q),x+=X}return _}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==ur.Bytes)return i.push(this.readVarint(t));var o=xa(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==ur.Bytes)return i.push(this.readSVarint());var t=xa(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ur.Bytes)return i.push(this.readBoolean());var t=xa(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ur.Bytes)return i.push(this.readFloat());var t=xa(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ur.Bytes)return i.push(this.readDouble());var t=xa(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ur.Bytes)return i.push(this.readFixed32());var t=xa(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ur.Bytes)return i.push(this.readSFixed32());var t=xa(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ur.Bytes)return i.push(this.readFixed64());var t=xa(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ur.Bytes)return i.push(this.readSFixed64());var t=xa(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===ur.Varint)for(;this.buf[this.pos++]>127;);else if(t===ur.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ur.Fixed32)this.pos+=4;else{if(t!==ur.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf),this.buf=o,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ka(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ka(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ka(this.buf,-1&i,this.pos),Ka(this.buf,Math.floor(i*np),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ka(this.buf,-1&i,this.pos),Ka(this.buf,Math.floor(i*np),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,o){var p,f;if(t>=0?(p=t%4294967296|0,f=t/4294967296|0):(f=~(-t/4294967296),4294967295^(p=~(-t%4294967296))?p=p+1|0:(p=0,f=f+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(_,x,E){E.buf[E.pos++]=127&_|128,_>>>=7,E.buf[E.pos++]=127&_|128,_>>>=7,E.buf[E.pos++]=127&_|128,_>>>=7,E.buf[E.pos++]=127&_|128,E.buf[E.pos]=127&(_>>>=7)}(p,0,o),function(_,x){var E=(7&_)<<4;x.buf[x.pos++]|=E|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(f,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(p,f,_){for(var x,E,z=0;z<f.length;z++){if((x=f.charCodeAt(z))>55295&&x<57344){if(!E){x>56319||z+1===f.length?(p[_++]=239,p[_++]=191,p[_++]=189):E=x;continue}if(x<56320){p[_++]=239,p[_++]=191,p[_++]=189,E=x;continue}x=E-55296<<10|x-56320|65536,E=null}else E&&(p[_++]=239,p[_++]=191,p[_++]=189,E=null);x<128?p[_++]=x:(x<2048?p[_++]=x>>6|192:(x<65536?p[_++]=x>>12|224:(p[_++]=x>>18|240,p[_++]=x>>12&63|128),p[_++]=x>>6&63|128),p[_++]=63&x|128)}return _}(this.buf,i,this.pos);var o=this.pos-t;o>=128&&op(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),Ro(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Ro(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,t){this.pos++;var o=this.pos;i(t,this);var p=this.pos-o;p>=128&&op(o,p,this),this.pos=o-1,this.writeVarint(p),this.pos+=p},writeMessage:function(i,t,o){this.writeTag(i,ur.Bytes),this.writeRawMessage(t,o)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,td,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,id,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Jl,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,rd,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,yu,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,ap,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,nd,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,sd,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,od,t)},writeBytesField:function(i,t){this.writeTag(i,ur.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,ur.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,ur.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,ur.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,ur.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,ur.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,ur.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,ur.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,ur.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,ur.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,Boolean(t))}};class Ql{constructor(t,{pixelRatio:o,version:p,stretchX:f,stretchY:_,content:x}){this.paddedRect=t,this.pixelRatio=o,this.stretchX=f,this.stretchY=_,this.content=x,this.version=p}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class lp{constructor(t,o){const p={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,p,_),this.addImages(o,f,_);const{w:x,h:E}=Lc(_),z=new $n({width:x||1,height:E||1});for(const R in t){const V=t[R],q=p[R].paddedRect;$n.copy(V.data,z,{x:0,y:0},{x:q.x+1,y:q.y+1},V.data)}for(const R in o){const V=o[R],q=f[R].paddedRect,X=q.x+1,Y=q.y+1,Q=V.data.width,fe=V.data.height;$n.copy(V.data,z,{x:0,y:0},{x:X,y:Y},V.data),$n.copy(V.data,z,{x:0,y:fe-1},{x:X,y:Y-1},{width:Q,height:1}),$n.copy(V.data,z,{x:0,y:0},{x:X,y:Y+fe},{width:Q,height:1}),$n.copy(V.data,z,{x:Q-1,y:0},{x:X-1,y:Y},{width:1,height:fe}),$n.copy(V.data,z,{x:0,y:0},{x:X+Q,y:Y},{width:1,height:fe})}this.image=z,this.iconPositions=p,this.patternPositions=f}addImages(t,o,p){for(const f in t){const _=t[f],x={x:0,y:0,w:_.data.width+2,h:_.data.height+2};p.push(x),o[f]=new Ql(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,o){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in t.updatedImages)this.patchUpdatedImage(this.iconPositions[p],t.getImage(p),o),this.patchUpdatedImage(this.patternPositions[p],t.getImage(p),o)}patchUpdatedImage(t,o,p){if(!t||!o||t.version===o.version)return;t.version=o.version;const[f,_]=t.tl;p.update(o.data,void 0,{x:f,y:_})}}Zt("ImagePosition",Ql),Zt("ImageAtlas",lp),l.WritingMode=void 0,(ya=l.WritingMode||(l.WritingMode={}))[ya.none=0]="none",ya[ya.horizontal=1]="horizontal",ya[ya.vertical=2]="vertical",ya[ya.horizontalOnly=3]="horizontalOnly";const Bc=-17;class ec{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,o){const p=new ec;return p.scale=t||1,p.fontStack=o,p}static forImage(t){const o=new ec;return o.imageName=t,o}}class tc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,o){const p=new tc;for(let f=0;f<t.sections.length;f++){const _=t.sections[f];_.image?p.addImageSection(_):p.addTextSection(_,o)}return p}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let o="";for(let p=0;p<t.length;p++){const f=t.charCodeAt(p+1)||null,_=t.charCodeAt(p-1)||null;o+=f&&ua(f)&&!$s[t[p+1]]||_&&ua(_)&&!$s[t[p-1]]||!$s[t[p]]?t[p]:$s[t[p]]}return o}(this.text)}trim(){let t=0;for(let p=0;p<this.text.length&&Fc[this.text.charCodeAt(p)];p++)t++;let o=this.text.length;for(let p=this.text.length-1;p>=0&&p>=t&&Fc[this.text.charCodeAt(p)];p--)o--;this.text=this.text.substring(t,o),this.sectionIndex=this.sectionIndex.slice(t,o)}substring(t,o){const p=new tc;return p.text=this.text.substring(t,o),p.sectionIndex=this.sectionIndex.slice(t,o),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,o)=>Math.max(t,this.sections[o].scale),0)}addTextSection(t,o){this.text+=t.text,this.sections.push(ec.forText(t.scale,t.fontStack||o));const p=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(p)}addImageSection(t){const o=t.image?t.image.name:"";if(o.length===0)return void nt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(ec.forImage(o)),this.sectionIndex.push(this.sections.length-1)):nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rc(i,t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe){const de=tc.fromFeature(i,f);let Te;q===l.WritingMode.vertical&&de.verticalizePunctuation();const{processBidirectionalText:Pe,processStyledBidirectionalText:Ee}=Ki;if(Pe&&de.sections.length===1){Te=[];const Ue=Pe(de.toString(),bu(de,R,_,t,p,Y,Q));for(const He of Ue){const Ge=new tc;Ge.text=He,Ge.sections=de.sections;for(let tt=0;tt<He.length;tt++)Ge.sectionIndex.push(0);Te.push(Ge)}}else if(Ee){Te=[];const Ue=Ee(de.text,de.sectionIndex,bu(de,R,_,t,p,Y,Q));for(const He of Ue){const Ge=new tc;Ge.text=He[0],Ge.sectionIndex=He[1],Ge.sections=de.sections,Te.push(Ge)}}else Te=function(Ue,He){const Ge=[],tt=Ue.text;let et=0;for(const ht of He)Ge.push(Ue.substring(et,ht)),et=ht;return et<tt.length&&Ge.push(Ue.substring(et,tt.length)),Ge}(de,bu(de,R,_,t,p,Y,Q));const Me=[],Le={positionedLines:Me,text:de.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(Ue,He,Ge,tt,et,ht,Tt,St,pt,Xt,Ot,ni){let Ei=0,ji=Bc,Xi=0,Cr=0;const Wi=St==="right"?1:St==="left"?0:.5;let ir=0;for(const Bi of et){Bi.trim();const ar=Bi.getMaxScale(),mi=(ar-1)*Dn,Xr={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[ir]=Xr;const Pr=Xr.positionedGlyphs;let Fr=0;if(!Bi.length()){ji+=ht,++ir;continue}for(let Ur=0;Ur<Bi.length();Ur++){const zi=Bi.getSection(Ur),An=Bi.getSectionIndex(Ur),Wr=Bi.getCharCode(Ur);let Hr=0,sn=null,On=null,cs=null,Vo=Dn;const Ss=!(pt===l.WritingMode.horizontal||!Ot&&!Oa(Wr)||Ot&&(Fc[Wr]||(hr=Wr,Bt.Arabic(hr)||Bt["Arabic Supplement"](hr)||Bt["Arabic Extended-A"](hr)||Bt["Arabic Presentation Forms-A"](hr)||Bt["Arabic Presentation Forms-B"](hr))));if(zi.imageName){const us=tt[zi.imageName];if(!us)continue;cs=zi.imageName,Ue.iconsInText=Ue.iconsInText||!0,On=us.paddedRect;const vn=us.displaySize;zi.scale=zi.scale*Dn/ni,sn={width:vn[0],height:vn[1],left:1,top:-3,advance:Ss?vn[1]:vn[0]},Hr=mi+(Dn-vn[1]*zi.scale),Vo=sn.advance;const No=Ss?vn[0]*zi.scale-Dn*ar:vn[1]*zi.scale-Dn*ar;No>0&&No>Fr&&(Fr=No)}else{const us=Ge[zi.fontStack],vn=us&&us[Wr];if(vn&&vn.rect)On=vn.rect,sn=vn.metrics;else{const No=He[zi.fontStack],Cl=No&&No[Wr];if(!Cl)continue;sn=Cl.metrics}Hr=(ar-zi.scale)*Dn}Ss?(Ue.verticalizable=!0,Pr.push({glyph:Wr,imageName:cs,x:Ei,y:ji+Hr,vertical:Ss,scale:zi.scale,fontStack:zi.fontStack,sectionIndex:An,metrics:sn,rect:On}),Ei+=Vo*zi.scale+Xt):(Pr.push({glyph:Wr,imageName:cs,x:Ei,y:ji+Hr,vertical:Ss,scale:zi.scale,fontStack:zi.fontStack,sectionIndex:An,metrics:sn,rect:On}),Ei+=sn.advance*zi.scale+Xt)}Pr.length!==0&&(Xi=Math.max(Ei-Xt,Xi),up(Pr,0,Pr.length-1,Wi,Fr)),Ei=0;const lr=ht*ar+Fr;Xr.lineOffset=Math.max(Fr,mi),ji+=lr,Cr=Math.max(lr,Cr),++ir}var hr;const Sr=ji-Bc,{horizontalAlign:Rr,verticalAlign:Zr}=Oo(Tt);(function(Bi,ar,mi,Xr,Pr,Fr,lr,Ur,zi){const An=(ar-mi)*Pr;let Wr=0;Wr=Fr!==lr?-Ur*Xr-Bc:(-Xr*zi+.5)*lr;for(const Hr of Bi)for(const sn of Hr.positionedGlyphs)sn.x+=An,sn.y+=Wr})(Ue.positionedLines,Wi,Rr,Zr,Xi,Cr,ht,Sr,et.length),Ue.top+=-Zr*Sr,Ue.bottom=Ue.top+Sr,Ue.left+=-Rr*Xi,Ue.right=Ue.left+Xi}(Le,t,o,p,Te,x,E,z,q,R,X,fe),!function(Ue){for(const He of Ue)if(He.positionedGlyphs.length!==0)return!1;return!0}(Me)&&Le}const Fc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hh={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vu(i,t,o,p,f,_){if(t.imageName){const x=p[t.imageName];return x?x.displaySize[0]*t.scale*Dn/_+f:0}{const x=o[t.fontStack],E=x&&x[i];return E?E.metrics.advance*t.scale+f:0}}function cp(i,t,o,p){const f=Math.pow(i-t,2);return p?i<t?f/2:2*f:f+Math.abs(o)*o}function ad(i,t,o){let p=0;return i===10&&(p-=1e4),o&&(p+=150),i!==40&&i!==65288||(p+=50),t!==41&&t!==65289||(p+=50),p}function ph(i,t,o,p,f,_){let x=null,E=cp(t,o,f,_);for(const z of p){const R=cp(t-z.x,o,f,_)+z.badness;R<=E&&(x=z,E=R)}return{index:i,x:t,priorBreak:x,badness:E}}function Fo(i){return i?Fo(i.priorBreak).concat(i.index):[]}function bu(i,t,o,p,f,_,x){if(_!=="point")return[];if(!i)return[];const E=[],z=function(X,Y,Q,fe,de,Te){let Pe=0;for(let Ee=0;Ee<X.length();Ee++){const Me=X.getSection(Ee);Pe+=vu(X.getCharCode(Ee),Me,fe,de,Y,Te)}return Pe/Math.max(1,Math.ceil(Pe/Q))}(i,t,o,p,f,x),R=i.text.indexOf("\u200B")>=0;let V=0;for(let X=0;X<i.length();X++){const Y=i.getSection(X),Q=i.getCharCode(X);if(Fc[Q]||(V+=vu(Q,Y,p,f,t,x)),X<i.length()-1){const fe=!((q=Q)<11904||!(Bt["Bopomofo Extended"](q)||Bt.Bopomofo(q)||Bt["CJK Compatibility Forms"](q)||Bt["CJK Compatibility Ideographs"](q)||Bt["CJK Compatibility"](q)||Bt["CJK Radicals Supplement"](q)||Bt["CJK Strokes"](q)||Bt["CJK Symbols and Punctuation"](q)||Bt["CJK Unified Ideographs Extension A"](q)||Bt["CJK Unified Ideographs"](q)||Bt["Enclosed CJK Letters and Months"](q)||Bt["Halfwidth and Fullwidth Forms"](q)||Bt.Hiragana(q)||Bt["Ideographic Description Characters"](q)||Bt["Kangxi Radicals"](q)||Bt["Katakana Phonetic Extensions"](q)||Bt.Katakana(q)||Bt["Vertical Forms"](q)||Bt["Yi Radicals"](q)||Bt["Yi Syllables"](q)));(hh[Q]||fe||Y.imageName)&&E.push(ph(X+1,V,z,E,ad(Q,i.getCharCode(X+1),fe&&R),!1))}}var q;return Fo(ph(i.length(),V,z,E,0,!0))}function Oo(i){let t=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:t,verticalAlign:o}}function up(i,t,o,p,f){if(!p&&!f)return;const _=i[o],x=(i[o].x+_.metrics.advance*_.scale)*p;for(let E=t;E<=o;E++)i[E].x-=x,i[E].y+=f}function hp(i,t,o){const{horizontalAlign:p,verticalAlign:f}=Oo(o),_=t[0]-i.displaySize[0]*p,x=t[1]-i.displaySize[1]*f;return{image:i,top:x,bottom:x+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function dh(i,t,o,p,f,_){const x=i.image;let E;if(x.content){const de=x.content,Te=x.pixelRatio||1;E=[de[0]/Te,de[1]/Te,x.displaySize[0]-de[2]/Te,x.displaySize[1]-de[3]/Te]}const z=t.left*_,R=t.right*_;let V,q,X,Y;o==="width"||o==="both"?(Y=f[0]+z-p[3],q=f[0]+R+p[1]):(Y=f[0]+(z+R-x.displaySize[0])/2,q=Y+x.displaySize[0]);const Q=t.top*_,fe=t.bottom*_;return o==="height"||o==="both"?(V=f[1]+Q-p[0],X=f[1]+fe+p[2]):(V=f[1]+(Q+fe-x.displaySize[1])/2,X=V+x.displaySize[1]),{image:x,top:V,right:q,bottom:X,left:Y,collisionPadding:E}}const Uo=128;function pp(i,t){const{expression:o}=t;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new zr(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:f}=o;let _=0;for(;_<p.length&&p[_]<=i;)_++;_=Math.max(0,_-1);let x=_;for(;x<p.length&&p[x]<i+1;)x++;x=Math.min(p.length-1,x);const E=p[_],z=p[x];return o.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:z,interpolationType:f}:{kind:"camera",minZoom:E,maxZoom:z,minSize:o.evaluate(new zr(E)),maxSize:o.evaluate(new zr(z)),interpolationType:f}}}class Ya extends De{constructor(t,o,p,f){super(t,o),this.angle=p,f!==void 0&&(this.segment=f)}clone(){return new Ya(this.x,this.y,this.angle,this.segment)}}function fh(i,t,o,p,f){if(t.segment===void 0)return!0;let _=t,x=t.segment+1,E=0;for(;E>-o/2;){if(x--,x<0)return!1;E-=i[x].dist(_),_=i[x]}E+=i[x].dist(i[x+1]),x++;const z=[];let R=0;for(;E<o/2;){const V=i[x],q=i[x+1];if(!q)return!1;let X=i[x-1].angleTo(V)-V.angleTo(q);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:E,angleDelta:X}),R+=X;E-z[0].distance>p;)R-=z.shift().angleDelta;if(R>f)return!1;x++,E+=V.dist(q)}return!0}function mh(i){let t=0;for(let o=0;o<i.length-1;o++)t+=i[o].dist(i[o+1]);return t}function gh(i,t,o){return i?.6*t*o:0}function Oc(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function dp(i,t,o,p,f,_){const x=gh(o,f,_),E=Oc(o,p)*_;let z=0;const R=mh(i)/2;for(let V=0;V<i.length-1;V++){const q=i[V],X=i[V+1],Y=q.dist(X);if(z+Y>R){const Q=(R-z)/Y,fe=Qr(q.x,X.x,Q),de=Qr(q.y,X.y,Q),Te=new Ya(fe,de,X.angleTo(q),V);return Te._round(),!x||fh(i,Te,E,x,t)?Te:void 0}z+=Y}}function wu(i,t,o,p,f,_,x,E,z){const R=gh(p,_,x),V=Oc(p,f),q=V*x,X=i[0].x===0||i[0].x===z||i[0].y===0||i[0].y===z;return t-q<t/4&&(t=q+t/4),Uc(i,X?t/2*E%t:(V/2+2*_)*x*E%t,t,R,o,q,X,!1,z)}function Uc(i,t,o,p,f,_,x,E,z){const R=_/2,V=mh(i);let q=0,X=t-o,Y=[];for(let Q=0;Q<i.length-1;Q++){const fe=i[Q],de=i[Q+1],Te=fe.dist(de),Pe=de.angleTo(fe);for(;X+o<q+Te;){X+=o;const Ee=(X-q)/Te,Me=Qr(fe.x,de.x,Ee),Le=Qr(fe.y,de.y,Ee);if(Me>=0&&Me<z&&Le>=0&&Le<z&&X-R>=0&&X+R<=V){const Ue=new Ya(Me,Le,Pe,Q);Ue._round(),p&&!fh(i,Ue,_,p,f)||Y.push(Ue)}}q+=Te}return E||Y.length||x||(Y=Uc(i,q/2,o,p,f,_,x,!0,z)),Y}function Vc(i,t,o,p,f){const _=[];for(let x=0;x<i.length;x++){const E=i[x];let z;for(let R=0;R<E.length-1;R++){let V=E[R],q=E[R+1];V.x<t&&q.x<t||(V.x<t?V=new De(t,V.y+(t-V.x)/(q.x-V.x)*(q.y-V.y))._round():q.x<t&&(q=new De(t,V.y+(t-V.x)/(q.x-V.x)*(q.y-V.y))._round()),V.y<o&&q.y<o||(V.y<o?V=new De(V.x+(o-V.y)/(q.y-V.y)*(q.x-V.x),o)._round():q.y<o&&(q=new De(V.x+(o-V.y)/(q.y-V.y)*(q.x-V.x),o)._round()),V.x>=p&&q.x>=p||(V.x>=p?V=new De(p,V.y+(p-V.x)/(q.x-V.x)*(q.y-V.y))._round():q.x>=p&&(q=new De(p,V.y+(p-V.x)/(q.x-V.x)*(q.y-V.y))._round()),V.y>=f&&q.y>=f||(V.y>=f?V=new De(V.x+(f-V.y)/(q.y-V.y)*(q.x-V.x),f)._round():q.y>=f&&(q=new De(V.x+(f-V.y)/(q.y-V.y)*(q.x-V.x),f)._round()),z&&V.equals(z[z.length-1])||(z=[V],_.push(z)),z.push(q)))))}}return _}function fp(i,t,o,p){const f=[],_=i.image,x=_.pixelRatio,E=_.paddedRect.w-2,z=_.paddedRect.h-2,R=i.right-i.left,V=i.bottom-i.top,q=_.stretchX||[[0,E]],X=_.stretchY||[[0,z]],Y=(ht,Tt)=>ht+Tt[1]-Tt[0],Q=q.reduce(Y,0),fe=X.reduce(Y,0),de=E-Q,Te=z-fe;let Pe=0,Ee=Q,Me=0,Le=fe,Ue=0,He=de,Ge=0,tt=Te;if(_.content&&p){const ht=_.content;Pe=Tu(q,0,ht[0]),Me=Tu(X,0,ht[1]),Ee=Tu(q,ht[0],ht[2]),Le=Tu(X,ht[1],ht[3]),Ue=ht[0]-Pe,Ge=ht[1]-Me,He=ht[2]-ht[0]-Ee,tt=ht[3]-ht[1]-Le}const et=(ht,Tt,St,pt)=>{const Xt=Iu(ht.stretch-Pe,Ee,R,i.left),Ot=va(ht.fixed-Ue,He,ht.stretch,Q),ni=Iu(Tt.stretch-Me,Le,V,i.top),Ei=va(Tt.fixed-Ge,tt,Tt.stretch,fe),ji=Iu(St.stretch-Pe,Ee,R,i.left),Xi=va(St.fixed-Ue,He,St.stretch,Q),Cr=Iu(pt.stretch-Me,Le,V,i.top),Wi=va(pt.fixed-Ge,tt,pt.stretch,fe),ir=new De(Xt,ni),hr=new De(ji,ni),Sr=new De(ji,Cr),Rr=new De(Xt,Cr),Zr=new De(Ot/x,Ei/x),Bi=new De(Xi/x,Wi/x),ar=t*Math.PI/180;if(ar){const Pr=Math.sin(ar),Fr=Math.cos(ar),lr=[Fr,-Pr,Pr,Fr];ir._matMult(lr),hr._matMult(lr),Rr._matMult(lr),Sr._matMult(lr)}const mi=ht.stretch+ht.fixed,Xr=Tt.stretch+Tt.fixed;return{tl:ir,tr:hr,bl:Rr,br:Sr,tex:{x:_.paddedRect.x+1+mi,y:_.paddedRect.y+1+Xr,w:St.stretch+St.fixed-mi,h:pt.stretch+pt.fixed-Xr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:Bi,minFontScaleX:He/x/R,minFontScaleY:tt/x/V,isSDF:o}};if(p&&(_.stretchX||_.stretchY)){const ht=mp(q,de,Q),Tt=mp(X,Te,fe);for(let St=0;St<ht.length-1;St++){const pt=ht[St],Xt=ht[St+1];for(let Ot=0;Ot<Tt.length-1;Ot++)f.push(et(pt,Tt[Ot],Xt,Tt[Ot+1]))}}else f.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:z+1}));return f}function Tu(i,t,o){let p=0;for(const f of i)p+=Math.max(t,Math.min(o,f[1]))-Math.max(t,Math.min(o,f[0]));return p}function mp(i,t,o){const p=[{fixed:-1,stretch:0}];for(const[f,_]of i){const x=p[p.length-1];p.push({fixed:f-x.stretch,stretch:x.stretch}),p.push({fixed:f-x.stretch,stretch:x.stretch+(_-f)})}return p.push({fixed:t+1,stretch:o}),p}function Iu(i,t,o,p){return i/t*o+p}function va(i,t,o,p){return i-t*o/p}Zt("Anchor",Ya);class ic{constructor(t,o,p,f,_,x,E,z,R,V){if(this.boxStartIndex=t.length,R){let q=x.top,X=x.bottom;const Y=x.collisionPadding;Y&&(q-=Y[1],X+=Y[3]);let Q=X-q;Q>0&&(Q=Math.max(10,Q),this.circleDiameter=Q)}else{let q=x.top*E-z,X=x.bottom*E+z,Y=x.left*E-z,Q=x.right*E+z;const fe=x.collisionPadding;if(fe&&(Y-=fe[0]*E,q-=fe[1]*E,Q+=fe[2]*E,X+=fe[3]*E),V){const de=new De(Y,q),Te=new De(Q,q),Pe=new De(Y,X),Ee=new De(Q,X),Me=V*Math.PI/180;de._rotate(Me),Te._rotate(Me),Pe._rotate(Me),Ee._rotate(Me),Y=Math.min(de.x,Te.x,Pe.x,Ee.x),Q=Math.max(de.x,Te.x,Pe.x,Ee.x),q=Math.min(de.y,Te.y,Pe.y,Ee.y),X=Math.max(de.y,Te.y,Pe.y,Ee.y)}t.emplaceBack(o.x,o.y,Y,q,Q,X,p,f,_)}this.boxEndIndex=t.length}}class gp{constructor(t=[],o=_h){if(this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:o,compare:p}=this,f=o[t];for(;t>0;){const _=t-1>>1,x=o[_];if(p(f,x)>=0)break;o[t]=x,t=_}o[t]=f}_down(t){const{data:o,compare:p}=this,f=this.length>>1,_=o[t];for(;t<f;){let x=1+(t<<1),E=o[x];const z=x+1;if(z<this.length&&p(o[z],E)<0&&(x=z,E=o[z]),p(E,_)>=0)break;o[t]=E,t=x}o[t]=_}}function _h(i,t){return i<t?-1:i>t?1:0}function ld(i,t=1,o=!1){let p=1/0,f=1/0,_=-1/0,x=-1/0;const E=i[0];for(let Y=0;Y<E.length;Y++){const Q=E[Y];(!Y||Q.x<p)&&(p=Q.x),(!Y||Q.y<f)&&(f=Q.y),(!Y||Q.x>_)&&(_=Q.x),(!Y||Q.y>x)&&(x=Q.y)}const z=Math.min(_-p,x-f);let R=z/2;const V=new gp([],Ja);if(z===0)return new De(p,f);for(let Y=p;Y<_;Y+=z)for(let Q=f;Q<x;Q+=z)V.push(new Al(Y+R,Q+R,R,i));let q=function(Y){let Q=0,fe=0,de=0;const Te=Y[0];for(let Pe=0,Ee=Te.length,Me=Ee-1;Pe<Ee;Me=Pe++){const Le=Te[Pe],Ue=Te[Me],He=Le.x*Ue.y-Ue.x*Le.y;fe+=(Le.x+Ue.x)*He,de+=(Le.y+Ue.y)*He,Q+=3*He}return new Al(fe/Q,de/Q,0,Y)}(i),X=V.length;for(;V.length;){const Y=V.pop();(Y.d>q.d||!q.d)&&(q=Y,o&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,X)),Y.max-q.d<=t||(R=Y.h/2,V.push(new Al(Y.p.x-R,Y.p.y-R,R,i)),V.push(new Al(Y.p.x+R,Y.p.y-R,R,i)),V.push(new Al(Y.p.x-R,Y.p.y+R,R,i)),V.push(new Al(Y.p.x+R,Y.p.y+R,R,i)),X+=4)}return o&&(console.log(`num probes: ${X}`),console.log(`best distance: ${q.d}`)),q.p}function Ja(i,t){return t.max-i.max}function Al(i,t,o,p){this.p=new De(i,t),this.h=o,this.d=function(f,_){let x=!1,E=1/0;for(let z=0;z<_.length;z++){const R=_[z];for(let V=0,q=R.length,X=q-1;V<q;X=V++){const Y=R[V],Q=R[X];Y.y>f.y!=Q.y>f.y&&f.x<(Q.x-Y.x)*(f.y-Y.y)/(Q.y-Y.y)+Y.x&&(x=!x),E=Math.min(E,ju(f,Y,Q))}}return(x?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}const Su=Number.POSITIVE_INFINITY;function _p(i,t){return t[1]!==Su?function(o,p,f){let _=0,x=0;switch(p=Math.abs(p),f=Math.abs(f),o){case"top-right":case"top-left":case"top":x=f-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-f}switch(o){case"top-right":case"bottom-right":case"right":_=-p;break;case"top-left":case"bottom-left":case"left":_=p}return[_,x]}(i,t[0],t[1]):function(o,p){let f=0,_=0;p<0&&(p=0);const x=p/Math.sqrt(2);switch(o){case"top-right":case"top-left":_=x-7;break;case"bottom-right":case"bottom-left":_=7-x;break;case"bottom":_=7-p;break;case"top":_=p-7}switch(o){case"top-right":case"bottom-right":f=-x;break;case"top-left":case"bottom-left":f=x;break;case"left":f=p;break;case"right":f=-p}return[f,_]}(i,t[0])}function yh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cd(i,t,o,p,f,_,x,E,z,R,V){let q=_.textMaxSize.evaluate(t,{});q===void 0&&(q=x);const X=i.layers[0].layout,Y=X.get("icon-offset").evaluate(t,{},V),Q=yp(o.horizontal),fe=x/24,de=i.tilePixelRatio*fe,Te=i.tilePixelRatio*q/24,Pe=i.tilePixelRatio*E,Ee=i.tilePixelRatio*X.get("symbol-spacing"),Me=X.get("text-padding")*i.tilePixelRatio,Le=X.get("icon-padding")*i.tilePixelRatio,Ue=X.get("text-max-angle")/180*Math.PI,He=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",Ge=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",tt=X.get("symbol-placement"),et=Ee/2,ht=X.get("icon-text-fit");let Tt;p&&ht!=="none"&&(i.allowVerticalPlacement&&o.vertical&&(Tt=dh(p,o.vertical,ht,X.get("icon-text-fit-padding"),Y,fe)),Q&&(p=dh(p,Q,ht,X.get("icon-text-fit-padding"),Y,fe)));const St=(pt,Xt)=>{Xt.x<0||Xt.x>=yn||Xt.y<0||Xt.y>=yn||function(Ot,ni,Ei,ji,Xi,Cr,Wi,ir,hr,Sr,Rr,Zr,Bi,ar,mi,Xr,Pr,Fr,lr,Ur,zi,An,Wr,Hr,sn){const On=Ot.addToLineVertexArray(ni,Ei);let cs,Vo,Ss,us,vn=0,No=0,Cl=0,Lu=0,Bu=-1,Ah=-1;const wa={};let Ep=Fi.exports(""),kh=0,zh=0;if(ir._unevaluatedLayout.getValue("text-radial-offset")===void 0?[kh,zh]=ir.layout.get("text-offset").evaluate(zi,{},Hr).map(Vs=>Vs*Dn):(kh=ir.layout.get("text-radial-offset").evaluate(zi,{},Hr)*Dn,zh=Su),Ot.allowVerticalPlacement&&ji.vertical){const Vs=ir.layout.get("text-rotate").evaluate(zi,{},Hr)+90;Ss=new ic(hr,ni,Sr,Rr,Zr,ji.vertical,Bi,ar,mi,Vs),Wi&&(us=new ic(hr,ni,Sr,Rr,Zr,Wi,Pr,Fr,mi,Vs))}if(Xi){const Vs=ir.layout.get("icon-rotate").evaluate(zi,{}),Qa=ir.layout.get("icon-text-fit")!=="none",Ch=fp(Xi,Vs,Wr,Qa),Ph=Wi?fp(Wi,Vs,Wr,Qa):void 0;Vo=new ic(hr,ni,Sr,Rr,Zr,Xi,Pr,Fr,!1,Vs),vn=4*Ch.length;const wd=Ot.iconSizeData;let Hc=null;wd.kind==="source"?(Hc=[Uo*ir.layout.get("icon-size").evaluate(zi,{})],Hc[0]>ho&&nt(`${Ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):wd.kind==="composite"&&(Hc=[Uo*An.compositeIconSizes[0].evaluate(zi,{},Hr),Uo*An.compositeIconSizes[1].evaluate(zi,{},Hr)],(Hc[0]>ho||Hc[1]>ho)&&nt(`${Ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,Ch,Hc,Ur,lr,zi,l.WritingMode.none,ni,On.lineStartIndex,On.lineLength,-1,Hr),Bu=Ot.icon.placedSymbolArray.length-1,Ph&&(No=4*Ph.length,Ot.addSymbols(Ot.icon,Ph,Hc,Ur,lr,zi,l.WritingMode.vertical,ni,On.lineStartIndex,On.lineLength,-1,Hr),Ah=Ot.icon.placedSymbolArray.length-1)}const Ap=Object.keys(ji.horizontal);for(const Vs of Ap){const Qa=ji.horizontal[Vs];if(!cs){Ep=Fi.exports(Qa.text);const Ph=ir.layout.get("text-rotate").evaluate(zi,{},Hr);cs=new ic(hr,ni,Sr,Rr,Zr,Qa,Bi,ar,mi,Ph)}const Ch=Qa.positionedLines.length===1;if(Cl+=Eu(Ot,ni,Qa,Cr,ir,mi,zi,Xr,On,ji.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,Ch?Ap:[Vs],wa,Bu,An,Hr),Ch)break}ji.vertical&&(Lu+=Eu(Ot,ni,ji.vertical,Cr,ir,mi,zi,Xr,On,l.WritingMode.vertical,["vertical"],wa,Ah,An,Hr));const hd=cs?cs.boxStartIndex:Ot.collisionBoxArray.length,pd=cs?cs.boxEndIndex:Ot.collisionBoxArray.length,po=Ss?Ss.boxStartIndex:Ot.collisionBoxArray.length,Ru=Ss?Ss.boxEndIndex:Ot.collisionBoxArray.length,kp=Vo?Vo.boxStartIndex:Ot.collisionBoxArray.length,hs=Vo?Vo.boxEndIndex:Ot.collisionBoxArray.length,jo=us?us.boxStartIndex:Ot.collisionBoxArray.length,Xc=us?us.boxEndIndex:Ot.collisionBoxArray.length;let ps=-1;const Wc=(Vs,Qa)=>Vs&&Vs.circleDiameter?Math.max(Vs.circleDiameter,Qa):Qa;ps=Wc(cs,ps),ps=Wc(Ss,ps),ps=Wc(Vo,ps),ps=Wc(us,ps);const $a=ps>-1?1:0;$a&&(ps*=sn/Dn),Ot.glyphOffsetArray.length>=sc.MAX_GLYPHS&&nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zi.sortKey!==void 0&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,zi.sortKey),Ot.symbolInstances.emplaceBack(ni.x,ni.y,wa.right>=0?wa.right:-1,wa.center>=0?wa.center:-1,wa.left>=0?wa.left:-1,wa.vertical||-1,Bu,Ah,Ep,hd,pd,po,Ru,kp,hs,jo,Xc,Sr,Cl,Lu,vn,No,$a,0,Bi,kh,zh,ps)}(i,Xt,pt,o,p,f,Tt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,de,Me,He,z,Pe,Le,Ge,Y,t,_,R,V,x)};if(tt==="line")for(const pt of Vc(t.geometry,0,0,yn,yn)){const Xt=wu(pt,Ee,Ue,o.vertical||Q,p,24,Te,i.overscaling,yn);for(const Ot of Xt){const ni=Q;ni&&xh(i,ni.text,et,Ot)||St(pt,Ot)}}else if(tt==="line-center"){for(const pt of t.geometry)if(pt.length>1){const Xt=dp(pt,Ue,o.vertical||Q,p,24,Te);Xt&&St(pt,Xt)}}else if(t.type==="Polygon")for(const pt of Ju(t.geometry,0)){const Xt=ld(pt,16);St(pt[0],new Ya(Xt.x,Xt.y,0))}else if(t.type==="LineString")for(const pt of t.geometry)St(pt,new Ya(pt[0].x,pt[0].y,0));else if(t.type==="Point")for(const pt of t.geometry)for(const Xt of pt)St([Xt],new Ya(Xt.x,Xt.y,0))}const ho=32640;function Eu(i,t,o,p,f,_,x,E,z,R,V,q,X,Y,Q){const fe=function(Pe,Ee,Me,Le,Ue,He,Ge,tt){const et=Le.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,ht=[];for(const Tt of Ee.positionedLines)for(const St of Tt.positionedGlyphs){if(!St.rect)continue;const pt=St.rect||{};let Xt=4,Ot=!0,ni=1,Ei=0;const ji=(Ue||tt)&&St.vertical,Xi=St.metrics.advance*St.scale/2;if(tt&&Ee.verticalizable){const lr=(St.scale-1)*Dn,Ur=(Dn-St.metrics.width*St.scale)/2;Ei=Tt.lineOffset/2-(St.imageName?-Ur:lr)}if(St.imageName){const lr=Ge[St.imageName];Ot=lr.sdf,ni=lr.pixelRatio,Xt=1/ni}const Cr=Ue?[St.x+Xi,St.y]:[0,0];let Wi=Ue?[0,0]:[St.x+Xi+Me[0],St.y+Me[1]-Ei],ir=[0,0];ji&&(ir=Wi,Wi=[0,0]);const hr=(St.metrics.left-Xt)*St.scale-Xi+Wi[0],Sr=(-St.metrics.top-Xt)*St.scale+Wi[1],Rr=hr+pt.w*St.scale/ni,Zr=Sr+pt.h*St.scale/ni,Bi=new De(hr,Sr),ar=new De(Rr,Sr),mi=new De(hr,Zr),Xr=new De(Rr,Zr);if(ji){const lr=new De(-Xi,Xi-Bc),Ur=-Math.PI/2,zi=12-Xi,An=new De(22-zi,-(St.imageName?zi:0)),Wr=new De(...ir);Bi._rotateAround(Ur,lr)._add(An)._add(Wr),ar._rotateAround(Ur,lr)._add(An)._add(Wr),mi._rotateAround(Ur,lr)._add(An)._add(Wr),Xr._rotateAround(Ur,lr)._add(An)._add(Wr)}if(et){const lr=Math.sin(et),Ur=Math.cos(et),zi=[Ur,-lr,lr,Ur];Bi._matMult(zi),ar._matMult(zi),mi._matMult(zi),Xr._matMult(zi)}const Pr=new De(0,0),Fr=new De(0,0);ht.push({tl:Bi,tr:ar,bl:mi,br:Xr,tex:pt,writingMode:Ee.writingMode,glyphOffset:Cr,sectionIndex:St.sectionIndex,isSDF:Ot,pixelOffsetTL:Pr,pixelOffsetBR:Fr,minFontScaleX:0,minFontScaleY:0})}return ht}(0,o,E,f,_,x,p,i.allowVerticalPlacement),de=i.textSizeData;let Te=null;de.kind==="source"?(Te=[Uo*f.layout.get("text-size").evaluate(x,{})],Te[0]>ho&&nt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):de.kind==="composite"&&(Te=[Uo*Y.compositeTextSizes[0].evaluate(x,{},Q),Uo*Y.compositeTextSizes[1].evaluate(x,{},Q)],(Te[0]>ho||Te[1]>ho)&&nt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,fe,Te,E,_,x,R,t,z.lineStartIndex,z.lineLength,X,Q);for(const Pe of V)q[Pe]=i.text.placedSymbolArray.length-1;return 4*fe.length}function yp(i){for(const t in i)return i[t];return null}function xh(i,t,o,p){const f=i.compareText;if(t in f){const _=f[t];for(let x=_.length-1;x>=0;x--)if(p.dist(_[x])<o)return!0}else f[t]=[];return f[t].push(p),!1}const vh=Ha.VectorTileFeature.types,rc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Au(i,t,o,p,f,_,x,E,z,R,V,q,X){const Y=E?Math.min(ho,Math.round(E[0])):0,Q=E?Math.min(ho,Math.round(E[1])):0;i.emplaceBack(t,o,Math.round(32*p),Math.round(32*f),_,x,(Y<<1)+(z?1:0),Q,16*R,16*V,256*q,256*X)}function Nc(i,t,o){i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o)}function xp(i){for(const t of i.sections)if(Ua(t.text))return!0;return!1}class nc{constructor(t){this.layoutVertexArray=new Gi,this.indexArray=new Sn,this.programConfigurations=t,this.segments=new Zi,this.dynamicLayoutVertexArray=new Yr,this.opacityVertexArray=new Pn,this.placedSymbolArray=new ze}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,o,p,f){this.isEmpty()||(p&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Pc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Fn.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,rc,!0),this.opacityVertexBuffer.itemSize=1),(p||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",nc);class jc{constructor(t,o,p){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new p,this.segments=new Zi,this.collisionVertexArray=new _n}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,oh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",jc);class sc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qu([]),this.placementViewportMatrix=qu([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=pp(this.zoom,o["text-size"]),this.iconSizeData=pp(this.zoom,o["icon-size"]);const p=this.layers[0].layout,f=p.get("symbol-sort-key"),_=p.get("symbol-z-order");this.canOverlap=zu(p,"text-overlap","text-allow-overlap")!=="never"||zu(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(x=>l.WritingMode[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID}createArrays(){this.text=new nc(new bl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new nc(new bl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Ce,this.lineVertexArray=new ut,this.symbolInstances=new Ne}calculateGlyphDependencies(t,o,p,f,_){for(let x=0;x<t.length;x++)if(o[t.charCodeAt(x)]=!0,(p||f)&&_){const E=$s[t.charAt(x)];E&&(o[E.charCodeAt(0)]=!0)}}populate(t,o,p){const f=this.layers[0],_=f.layout,x=_.get("text-font"),E=_.get("text-field"),z=_.get("icon-image"),R=(E.value.kind!=="constant"||E.value.value instanceof te&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),V=z.value.kind!=="constant"||!!z.value.value||Object.keys(z.parameters).length>0,q=_.get("symbol-sort-key");if(this.features=[],!R&&!V)return;const X=o.iconDependencies,Y=o.glyphDependencies,Q=o.availableImages,fe=new zr(this.zoom);for(const{feature:de,id:Te,index:Pe,sourceLayerIndex:Ee}of t){const Me=f._featureFilter.needGeometry,Le=Lo(de,Me);if(!f._featureFilter.filter(fe,Le,p))continue;let Ue,He;if(Me||(Le.geometry=Os(de)),R){const tt=f.getValueAndResolveTokens("text-field",Le,p,Q),et=te.factory(tt);xp(et)&&(this.hasRTLText=!0),(!this.hasRTLText||Bs()==="unavailable"||this.hasRTLText&&Ki.isParsed())&&(Ue=Br(et,f,Le))}if(V){const tt=f.getValueAndResolveTokens("icon-image",Le,p,Q);He=tt instanceof ne?tt:ne.fromString(tt)}if(!Ue&&!He)continue;const Ge=this.sortFeaturesByKey?q.evaluate(Le,{},p):void 0;if(this.features.push({id:Te,text:Ue,icon:He,index:Pe,sourceLayerIndex:Ee,geometry:Le.geometry,properties:de.properties,type:vh[de.type],sortKey:Ge}),He&&(X[He.name]=!0),Ue){const tt=x.evaluate(Le,{},p).join(","),et=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const ht of Ue.sections)if(ht.image)X[ht.image.name]=!0;else{const Tt=ca(Ue.toString()),St=ht.fontStack||tt,pt=Y[St]=Y[St]||{};this.calculateGlyphDependencies(ht.text,pt,et,this.allowVerticalPlacement,Tt)}}}_.get("symbol-placement")==="line"&&(this.features=function(de){const Te={},Pe={},Ee=[];let Me=0;function Le(tt){Ee.push(de[tt]),Me++}function Ue(tt,et,ht){const Tt=Pe[tt];return delete Pe[tt],Pe[et]=Tt,Ee[Tt].geometry[0].pop(),Ee[Tt].geometry[0]=Ee[Tt].geometry[0].concat(ht[0]),Tt}function He(tt,et,ht){const Tt=Te[et];return delete Te[et],Te[tt]=Tt,Ee[Tt].geometry[0].shift(),Ee[Tt].geometry[0]=ht[0].concat(Ee[Tt].geometry[0]),Tt}function Ge(tt,et,ht){const Tt=ht?et[0][et[0].length-1]:et[0][0];return`${tt}:${Tt.x}:${Tt.y}`}for(let tt=0;tt<de.length;tt++){const et=de[tt],ht=et.geometry,Tt=et.text?et.text.toString():null;if(!Tt){Le(tt);continue}const St=Ge(Tt,ht),pt=Ge(Tt,ht,!0);if(St in Pe&&pt in Te&&Pe[St]!==Te[pt]){const Xt=He(St,pt,ht),Ot=Ue(St,pt,Ee[Xt].geometry);delete Te[St],delete Pe[pt],Pe[Ge(Tt,Ee[Ot].geometry,!0)]=Ot,Ee[Xt].geometry=null}else St in Pe?Ue(St,pt,ht):pt in Te?He(St,pt,ht):(Le(tt),Te[St]=Me-1,Pe[pt]=Me-1)}return Ee.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((de,Te)=>de.sortKey-Te.sortKey)}update(t,o,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,p),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,o){const p=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(o[t.segment+1]),_=t.dist(o[t.segment]);const x={};for(let E=t.segment+1;E<o.length;E++)x[E]={x:o[E].x,y:o[E].y,tileUnitDistanceFromAnchor:f},E<o.length-1&&(f+=o[E+1].dist(o[E]));for(let E=t.segment||0;E>=0;E--)x[E]={x:o[E].x,y:o[E].y,tileUnitDistanceFromAnchor:_},E>0&&(_+=o[E-1].dist(o[E]));for(let E=0;E<o.length;E++){const z=x[E];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(t,o,p,f,_,x,E,z,R,V,q,X){const Y=t.indexArray,Q=t.layoutVertexArray,fe=t.segments.prepareSegment(4*o.length,Q,Y,this.canOverlap?x.sortKey:void 0),de=this.glyphOffsetArray.length,Te=fe.vertexLength,Pe=this.allowVerticalPlacement&&E===l.WritingMode.vertical?Math.PI/2:0,Ee=x.text&&x.text.sections;for(let Me=0;Me<o.length;Me++){const{tl:Le,tr:Ue,bl:He,br:Ge,tex:tt,pixelOffsetTL:et,pixelOffsetBR:ht,minFontScaleX:Tt,minFontScaleY:St,glyphOffset:pt,isSDF:Xt,sectionIndex:Ot}=o[Me],ni=fe.vertexLength,Ei=pt[1];Au(Q,z.x,z.y,Le.x,Ei+Le.y,tt.x,tt.y,p,Xt,et.x,et.y,Tt,St),Au(Q,z.x,z.y,Ue.x,Ei+Ue.y,tt.x+tt.w,tt.y,p,Xt,ht.x,et.y,Tt,St),Au(Q,z.x,z.y,He.x,Ei+He.y,tt.x,tt.y+tt.h,p,Xt,et.x,ht.y,Tt,St),Au(Q,z.x,z.y,Ge.x,Ei+Ge.y,tt.x+tt.w,tt.y+tt.h,p,Xt,ht.x,ht.y,Tt,St),Nc(t.dynamicLayoutVertexArray,z,Pe),Y.emplaceBack(ni,ni+1,ni+2),Y.emplaceBack(ni+1,ni+2,ni+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),Me!==o.length-1&&Ot===o[Me+1].sectionIndex||t.programConfigurations.populatePaintArrays(Q.length,x,x.index,{},X,Ee&&Ee[Ot])}t.placedSymbolArray.emplaceBack(z.x,z.y,de,this.glyphOffsetArray.length-de,Te,R,V,z.segment,p?p[0]:0,p?p[1]:0,f[0],f[1],E,0,!1,0,q)}_addCollisionDebugVertex(t,o,p,f,_,x){return o.emplaceBack(0,0),t.emplaceBack(p.x,p.y,f,_,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,o,p,f,_,x,E){const z=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),R=z.vertexLength,V=_.layoutVertexArray,q=_.collisionVertexArray,X=E.anchorX,Y=E.anchorY;this._addCollisionDebugVertex(V,q,x,X,Y,new De(t,o)),this._addCollisionDebugVertex(V,q,x,X,Y,new De(p,o)),this._addCollisionDebugVertex(V,q,x,X,Y,new De(p,f)),this._addCollisionDebugVertex(V,q,x,X,Y,new De(t,f)),z.vertexLength+=4;const Q=_.indexArray;Q.emplaceBack(R,R+1),Q.emplaceBack(R+1,R+2),Q.emplaceBack(R+2,R+3),Q.emplaceBack(R+3,R),z.primitiveLength+=4}addDebugCollisionBoxes(t,o,p,f){for(let _=t;_<o;_++){const x=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,f?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jc(qr,ah.members,Or),this.iconCollisionBox=new jc(qr,ah.members,Or);for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(t,o,p,f,_,x,E,z,R){const V={};for(let q=o;q<p;q++){const X=t.get(q);V.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.textFeatureIndex=X.featureIndex;break}for(let q=f;q<_;q++){const X=t.get(q);V.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.verticalTextFeatureIndex=X.featureIndex;break}for(let q=x;q<E;q++){const X=t.get(q);V.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.iconFeatureIndex=X.featureIndex;break}for(let q=z;q<R;q++){const X=t.get(q);V.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.verticalIconFeatureIndex=X.featureIndex;break}return V}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const p=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,o){const p=t.placedSymbolArray.get(o),f=p.vertexStartIndex+4*p.numGlyphs;for(let _=p.vertexStartIndex;_<f;_+=4)t.indexArray.emplaceBack(_,_+1,_+2),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(t),p=Math.cos(t),f=[],_=[],x=[];for(let E=0;E<this.symbolInstances.length;++E){x.push(E);const z=this.symbolInstances.get(E);f.push(0|Math.round(o*z.anchorX+p*z.anchorY)),_.push(z.featureIndex)}return x.sort((E,z)=>f[E]-f[z]||_[z]-_[E]),x}addToSortKeyRanges(t,o){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===o?p.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const p=this.symbolInstances.get(o);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((f,_,x)=>{f>=0&&x.indexOf(f)===_&&this.addIndicesForPlacedSymbol(this.text,f)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Zt("SymbolBucket",sc,{omit:["layers","collisionBoxArray","features","compareText"]}),sc.MAX_GLYPHS=65535,sc.addDynamicAttributes=Nc;const ud=new pn({"symbol-placement":new _t(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new _t(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _t(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ri(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _t(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _t(ae.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _t(ae.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _t(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new _t(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _t(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new ri(ae.layout_symbol["icon-size"]),"icon-text-fit":new _t(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new ri(ae.layout_symbol["icon-image"]),"icon-rotate":new ri(ae.layout_symbol["icon-rotate"]),"icon-padding":new _t(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new _t(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new ri(ae.layout_symbol["icon-offset"]),"icon-anchor":new ri(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _t(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _t(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _t(ae.layout_symbol["text-rotation-alignment"]),"text-field":new ri(ae.layout_symbol["text-field"]),"text-font":new ri(ae.layout_symbol["text-font"]),"text-size":new ri(ae.layout_symbol["text-size"]),"text-max-width":new ri(ae.layout_symbol["text-max-width"]),"text-line-height":new _t(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new ri(ae.layout_symbol["text-letter-spacing"]),"text-justify":new ri(ae.layout_symbol["text-justify"]),"text-radial-offset":new ri(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _t(ae.layout_symbol["text-variable-anchor"]),"text-anchor":new ri(ae.layout_symbol["text-anchor"]),"text-max-angle":new _t(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new _t(ae.layout_symbol["text-writing-mode"]),"text-rotate":new ri(ae.layout_symbol["text-rotate"]),"text-padding":new _t(ae.layout_symbol["text-padding"]),"text-keep-upright":new _t(ae.layout_symbol["text-keep-upright"]),"text-transform":new ri(ae.layout_symbol["text-transform"]),"text-offset":new ri(ae.layout_symbol["text-offset"]),"text-allow-overlap":new _t(ae.layout_symbol["text-allow-overlap"]),"text-overlap":new _t(ae.layout_symbol["text-overlap"]),"text-ignore-placement":new _t(ae.layout_symbol["text-ignore-placement"]),"text-optional":new _t(ae.layout_symbol["text-optional"])});var bh={paint:new pn({"icon-opacity":new ri(ae.paint_symbol["icon-opacity"]),"icon-color":new ri(ae.paint_symbol["icon-color"]),"icon-halo-color":new ri(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new ri(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ri(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new _t(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new _t(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new ri(ae.paint_symbol["text-opacity"]),"text-color":new ri(ae.paint_symbol["text-color"],{runtimeType:Ii,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ri(ae.paint_symbol["text-halo-color"]),"text-halo-width":new ri(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new ri(ae.paint_symbol["text-halo-blur"]),"text-translate":new _t(ae.paint_symbol["text-translate"]),"text-translate-anchor":new _t(ae.paint_symbol["text-translate-anchor"])}),layout:ud};class vp{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Mi,this.defaultValue=t}evaluate(t){if(t.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",vp,{omit:["defaultValue"]});class ku extends Xn{constructor(t){super(t,bh)}recalculate(t,o){if(super.recalculate(t,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const f=[];for(const _ of p)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,o,p,f){const _=this.layout.get(t).evaluate(o,{},p,f),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||to(x.value)||!_?_:function(E,z){return z.replace(/{([^{}]+)}/g,(R,V)=>V in E?String(E[V]):"")}(o.properties,_)}createBucket(t){return new sc(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of bh.paint.overridableProperties){if(!ku.hasPaintOverride(this.layout,t))continue;const o=this.paint.get(t),p=new vp(o),f=new ra(p,o.property.specification);let _=null;_=o.value.kind==="constant"||o.value.kind==="source"?new io("source",f):new ro("composite",f,o.value.zoomStops,o.value._interpolationType),this.paint._values[t]=new Zn(o.property,_,o.parameters)}}_handleOverridablePaintPropertyUpdate(t,o,p){return!(!this.layout||o.isDataDriven()||p.isDataDriven())&&ku.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,o){const p=t.get("text-field"),f=bh.paint.properties[o];let _=!1;const x=E=>{for(const z of E)if(f.overrides&&f.overrides.hasOverride(z))return void(_=!0)};if(p.value.kind==="constant"&&p.value.value instanceof te)x(p.value.value.sections);else if(p.value.kind==="source"){const E=R=>{_||(R instanceof Se&&pe(R.value)===vr?x(R.value.sections):R instanceof Ma?x(R.sections):R.eachChild(E))},z=p.value;z._styleExpression&&E(z._styleExpression.expression)}return _}}function zu(i,t,o){let p="never";const f=i.get(t);return f?p=f:i.get(o)&&(p="always"),p}var fn={paint:new pn({"background-color":new _t(ae.paint_background["background-color"]),"background-pattern":new Mo(ae.paint_background["background-pattern"]),"background-opacity":new _t(ae.paint_background["background-opacity"])})},kl={paint:new pn({"raster-opacity":new _t(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new _t(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _t(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _t(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new _t(ae.paint_raster["raster-saturation"]),"raster-contrast":new _t(ae.paint_raster["raster-contrast"]),"raster-resampling":new _t(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new _t(ae.paint_raster["raster-fade-duration"])})};class bp extends Xn{constructor(t){super(t,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const wp={circle:class extends Xn{constructor(i){super(i,Fl)}createBucket(i){return new su(i)}queryRadius(i){const t=i;return Za("circle-radius",this,t)+Za("circle-stroke-width",this,t)+Tl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,o,p,f,_,x,E){const z=au(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,x),R=this.paint.get("circle-radius").evaluate(t,o)+this.paint.get("circle-stroke-width").evaluate(t,o),V=this.paint.get("circle-pitch-alignment")==="map",q=V?z:function(Y,Q){return Y.map(fe=>Vl(fe,Q))}(z,E),X=V?R*x:R;for(const Y of p)for(const Q of Y){const fe=V?Q:Vl(Q,E);let de=X;const Te=Ic([],[Q.x,Q.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?de*=Te[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(de*=_.cameraToCenterDistance/Te[3]),Uh(q,fe,de))return!0}return!1}},heatmap:class extends Xn{constructor(i){super(i,qh),this._updateColorRamp()}createBucket(i){return new Ts(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Xn{constructor(i){super(i,Xa)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Xn{constructor(i){super(i,Wh)}recalculate(i,t){super.recalculate(i,t);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Bo(i)}queryRadius(){return Tl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,o,p,f,_,x){return Vh(au(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,x),p)}isTileClipped(){return!0}},"fill-extrusion":class extends Xn{constructor(i){super(i,$p)}createBucket(i){return new ih(i)}queryRadius(){return Tl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,t,o,p,f,_,x,E){const z=au(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,x),R=this.paint.get("fill-extrusion-height").evaluate(t,o),V=this.paint.get("fill-extrusion-base").evaluate(t,o),q=function(Y,Q,fe,de){const Te=[];for(const Pe of Y){const Ee=[Pe.x,Pe.y,0,1];Ic(Ee,Ee,Q),Te.push(new De(Ee[0]/Ee[3],Ee[1]/Ee[3]))}return Te}(z,E),X=function(Y,Q,fe,de){const Te=[],Pe=[],Ee=de[8]*Q,Me=de[9]*Q,Le=de[10]*Q,Ue=de[11]*Q,He=de[8]*fe,Ge=de[9]*fe,tt=de[10]*fe,et=de[11]*fe;for(const ht of Y){const Tt=[],St=[];for(const pt of ht){const Xt=pt.x,Ot=pt.y,ni=de[0]*Xt+de[4]*Ot+de[12],Ei=de[1]*Xt+de[5]*Ot+de[13],ji=de[2]*Xt+de[6]*Ot+de[14],Xi=de[3]*Xt+de[7]*Ot+de[15],Cr=ji+Le,Wi=Xi+Ue,ir=ni+He,hr=Ei+Ge,Sr=ji+tt,Rr=Xi+et,Zr=new De((ni+Ee)/Wi,(Ei+Me)/Wi);Zr.z=Cr/Wi,Tt.push(Zr);const Bi=new De(ir/Rr,hr/Rr);Bi.z=Sr/Rr,St.push(Bi)}Te.push(Tt),Pe.push(St)}return[Te,Pe]}(p,V,R,E);return function(Y,Q,fe){let de=1/0;Vh(fe,Q)&&(de=Kh(fe,Q[0]));for(let Te=0;Te<Q.length;Te++){const Pe=Q[Te],Ee=Y[Te];for(let Me=0;Me<Pe.length-1;Me++){const Le=Pe[Me],Ue=[Le,Pe[Me+1],Ee[Me+1],Ee[Me],Le];Oh(fe,Ue)&&(de=Math.min(de,Kh(fe,Ue)))}}return de!==1/0&&de}(X[0],X[1],q)}},line:class extends Xn{constructor(i){super(i,sh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ks,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=tp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new nh(i)}queryRadius(i){const t=i,o=ip(Za("line-width",this,t),Za("line-gap-width",this,t)),p=Za("line-offset",this,t);return o/2+Math.abs(p)+Tl(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,o,p,f,_,x){const E=au(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,x),z=x/2*ip(this.paint.get("line-width").evaluate(t,o),this.paint.get("line-gap-width").evaluate(t,o)),R=this.paint.get("line-offset").evaluate(t,o);return R&&(p=function(V,q){const X=[];for(let Y=0;Y<V.length;Y++){const Q=V[Y],fe=[];for(let de=0;de<Q.length;de++){const Te=Q[de-1],Pe=Q[de],Ee=Q[de+1],Me=de===0?new De(0,0):Pe.sub(Te)._unit()._perp(),Le=de===Q.length-1?new De(0,0):Ee.sub(Pe)._unit()._perp(),Ue=Me._add(Le)._unit(),He=Ue.x*Le.x+Ue.y*Le.y;He!==0&&Ue._mult(1/He),fe.push(Ue._mult(q)._add(Pe))}X.push(fe)}return X}(p,R*x)),function(V,q,X){for(let Y=0;Y<q.length;Y++){const Q=q[Y];if(V.length>=3){for(let fe=0;fe<Q.length;fe++)if(Rl(V,Q[fe]))return!0}if(Uu(V,Q,X))return!0}return!1}(E,p,z)}isTileClipped(){return!0}},symbol:ku,background:class extends Xn{constructor(i){super(i,fn)}},raster:class extends Xn{constructor(i){super(i,kl)}}};class Tp{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const wh=63710088e-1;class un{constructor(t,o){if(isNaN(t)||isNaN(o))throw new Error(`Invalid LngLat object: (${t}, ${o})`);if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new un(me(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const o=Math.PI/180,p=this.lat*o,f=t.lat*o,_=Math.sin(p)*Math.sin(f)+Math.cos(p)*Math.cos(f)*Math.cos((t.lng-this.lng)*o);return wh*Math.acos(Math.min(_,1))}toBounds(t=0){const o=360*t/40075017,p=o/Math.cos(Math.PI/180*this.lat);return new ba(new un(this.lng-p,this.lat-o),new un(this.lng+p,this.lat+o))}static convert(t){if(t instanceof un)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new un(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new un(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ba{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof un?new un(t.lng,t.lat):un.convert(t),this}setSouthWest(t){return this._sw=t instanceof un?new un(t.lng,t.lat):un.convert(t),this}extend(t){const o=this._sw,p=this._ne;let f,_;if(t instanceof un)f=t,_=t;else{if(!(t instanceof ba))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ba.convert(t)):this.extend(un.convert(t)):this;if(f=t._sw,_=t._ne,!f||!_)return this}return o||p?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),p.lng=Math.max(_.lng,p.lng),p.lat=Math.max(_.lat,p.lat)):(this._sw=new un(f.lng,f.lat),this._ne=new un(_.lng,_.lat)),this}getCenter(){return new un((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new un(this.getWest(),this.getNorth())}getSouthEast(){return new un(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:p}=un.convert(t);let f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&f}static convert(t){return t instanceof ba?t:t&&new ba(t)}}const qc=2*Math.PI*wh;function Th(i){return qc*Math.cos(i*Math.PI/180)}function Cu(i){return(180+i)/360}function Ih(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Us(i,t){return i/Th(t)}function zl(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Gc{constructor(t,o,p=0){this.x=+t,this.y=+o,this.z=+p}static fromLngLat(t,o=0){const p=un.convert(t);return new Gc(Cu(p.lng),Ih(p.lat),Us(o,p.lat))}toLngLat(){return new un(360*this.x-180,zl(this.y))}toAltitude(){return this.z*Th(zl(this.y))}meterInMercatorCoordinateUnits(){return 1/qc*(t=zl(this.y),1/Math.cos(t*Math.PI/180));var t}}function Sh(i,t,o){var p=2*Math.PI*6378137/256/Math.pow(2,o);return[i*p-2*Math.PI*6378137/2,t*p-2*Math.PI*6378137/2]}class Pu{constructor(t,o,p){this.z=t,this.x=o,this.y=p,this.key=oc(0,t,t,o,p)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,o,p){const f=(x=this.y,E=this.z,z=Sh(256*(_=this.x),256*(x=Math.pow(2,E)-x-1),E),R=Sh(256*(_+1),256*(x+1),E),z[0]+","+z[1]+","+R[0]+","+R[1]);var _,x,E,z,R;const V=function(q,X,Y){let Q,fe="";for(let de=q;de>0;de--)Q=1<<de-1,fe+=(X&Q?1:0)+(Y&Q?2:0);return fe}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,V).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const o=this.z-t.z;return o>0&&t.x===this.x>>o&&t.y===this.y>>o}getTilePoint(t){const o=Math.pow(2,this.z);return new De((t.x*o-this.x)*yn,(t.y*o-this.y)*yn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Eh{constructor(t,o){this.wrap=t,this.canonical=o,this.key=oc(t,o.z,o.z,o.x,o.y)}}class Is{constructor(t,o,p,f,_){this.overscaledZ=t,this.wrap=o,this.canonical=new Pu(p,+f,+_),this.key=oc(o,t,p,f,_)}clone(){return new Is(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const o=this.canonical.z-t;return t>this.canonical.z?new Is(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Is(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(t,o){const p=this.canonical.z-t;return t>this.canonical.z?oc(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):oc(this.wrap*+o,t,t,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o}children(t){if(this.overscaledZ>=t)return[new Is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,p=2*this.canonical.x,f=2*this.canonical.y;return[new Is(o,this.wrap,o,p,f),new Is(o,this.wrap,o,p+1,f),new Is(o,this.wrap,o,p,f+1),new Is(o,this.wrap,o,p+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Is(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Eh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Gc(t.x-this.wrap,t.y))}}function oc(i,t,o,p,f){(i*=2)<0&&(i=-1*i-1);const _=1<<o;return(_*_*i+_*f+p).toString(36)+o.toString(36)+t.toString(36)}Zt("CanonicalTileID",Pu),Zt("OverscaledTileID",Is,{omit:["posMatrix"]});class Ip{constructor(t,o,p){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return void nt(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const f=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=p||"mapbox";for(let _=0;_<f;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(f,_)]=this.data[this._idx(f-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,f)]=this.data[this._idx(_,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let _=0;_<f;_++)for(let x=0;x<f;x++){const E=this.get(_,x);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,o){const p=new Uint8Array(this.data.buffer),f=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[f],p[f+1],p[f+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)}_unpackMapbox(t,o,p){return(256*t*256+256*o+p)/10-1e4}_unpackTerrarium(t,o,p){return 256*t+o+p/256-32768}getPixels(){return new $n({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,o,p){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=o*this.dim,_=o*this.dim+this.dim,x=p*this.dim,E=p*this.dim+this.dim;switch(o){case-1:f=_-1;break;case 1:_=f+1}switch(p){case-1:x=E-1;break;case 1:E=x+1}const z=-o*this.dim,R=-p*this.dim;for(let V=x;V<E;V++)for(let q=f;q<_;q++)this.data[this._idx(q,V)]=t.data[this._idx(q+z,V+R)]}}Zt("DEMData",Ip);class Mu{constructor(t){this._stringToNumber={},this._numberToString=[];for(let o=0;o<t.length;o++){const p=t[o];this._stringToNumber[p]=o,this._numberToString[o]=p}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class Zc{constructor(t,o,p,f,_){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=p,t._y=f,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t}}class ac{constructor(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new _s(yn,16,0),this.grid3D=new _s(yn,16,0),this.featureIndexArray=new xt,this.promoteId=o}insert(t,o,p,f,_,x){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,f,_);const z=x?this.grid3D:this.grid;for(let R=0;R<o.length;R++){const V=o[R],q=[1/0,1/0,-1/0,-1/0];for(let X=0;X<V.length;X++){const Y=V[X];q[0]=Math.min(q[0],Y.x),q[1]=Math.min(q[1],Y.y),q[2]=Math.max(q[2],Y.x),q[3]=Math.max(q[3],Y.y)}q[0]<yn&&q[1]<yn&&q[2]>=0&&q[3]>=0&&z.insert(E,q[0],q[1],q[2],q[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ha.VectorTile(new _u(this.rawTileData)).layers,this.sourceLayerCoder=new Mu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,o,p,f){this.loadVTLayers();const _=t.params||{},x=yn/t.tileSize/t.scale,E=Cs(_.filter),z=t.queryGeometry,R=t.queryPadding*x,V=Sp(z),q=this.grid.query(V.minX-R,V.minY-R,V.maxX+R,V.maxY+R),X=Sp(t.cameraQueryGeometry),Y=this.grid3D.query(X.minX-R,X.minY-R,X.maxX+R,X.maxY+R,(de,Te,Pe,Ee)=>function(Me,Le,Ue,He,Ge){for(const et of Me)if(Le<=et.x&&Ue<=et.y&&He>=et.x&&Ge>=et.y)return!0;const tt=[new De(Le,Ue),new De(Le,Ge),new De(He,Ge),new De(He,Ue)];if(Me.length>2){for(const et of tt)if(Rl(Me,et))return!0}for(let et=0;et<Me.length-1;et++)if(wc(Me[et],Me[et+1],tt))return!0;return!1}(t.cameraQueryGeometry,de-R,Te-R,Pe+R,Ee+R));for(const de of Y)q.push(de);q.sort(c);const Q={};let fe;for(let de=0;de<q.length;de++){const Te=q[de];if(Te===fe)continue;fe=Te;const Pe=this.featureIndexArray.get(Te);let Ee=null;this.loadMatchingFeature(Q,Pe.bucketIndex,Pe.sourceLayerIndex,Pe.featureIndex,E,_.layers,_.availableImages,o,p,f,(Me,Le,Ue)=>(Ee||(Ee=Os(Me)),Le.queryIntersectsFeature(z,Me,Ue,Ee,this.z,t.transform,x,t.pixelPosMatrix)))}return Q}loadMatchingFeature(t,o,p,f,_,x,E,z,R,V,q){const X=this.bucketLayerIDs[o];if(x&&!function(de,Te){for(let Pe=0;Pe<de.length;Pe++)if(Te.indexOf(de[Pe])>=0)return!0;return!1}(x,X))return;const Y=this.sourceLayerCoder.decode(p),Q=this.vtLayers[Y].feature(f);if(_.needGeometry){const de=Lo(Q,!0);if(!_.filter(new zr(this.tileID.overscaledZ),de,this.tileID.canonical))return}else if(!_.filter(new zr(this.tileID.overscaledZ),Q))return;const fe=this.getId(Q,Y);for(let de=0;de<X.length;de++){const Te=X[de];if(x&&x.indexOf(Te)<0)continue;const Pe=z[Te];if(!Pe)continue;let Ee={};fe&&V&&(Ee=V.getState(Pe.sourceLayer||"_geojsonTileLayer",fe));const Me=_e({},R[Te]);Me.paint=Du(Me.paint,Pe.paint,Q,Ee,E),Me.layout=Du(Me.layout,Pe.layout,Q,Ee,E);const Le=!q||q(Q,Pe,Ee);if(!Le)continue;const Ue=new Zc(Q,this.z,this.x,this.y,fe);Ue.layer=Me;let He=t[Te];He===void 0&&(He=t[Te]=[]),He.push({featureIndex:f,feature:Ue,intersectionZ:Le})}}lookupSymbolFeatures(t,o,p,f,_,x,E,z){const R={};this.loadVTLayers();const V=Cs(_);for(const q of t)this.loadMatchingFeature(R,p,f,q,V,x,E,z,o);return R}hasLayer(t){for(const o of this.bucketLayerIDs)for(const p of o)if(t===p)return!0;return!1}getId(t,o){let p=t.id;return this.promoteId&&(p=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof p=="boolean"&&(p=Number(p))),p}}function Du(i,t,o,p,f){return zt(i,(_,x)=>{const E=t instanceof Yt?t.get(x):null;return E&&E.evaluate?E.evaluate(o,p,f):E})}function Sp(i){let t=1/0,o=1/0,p=-1/0,f=-1/0;for(const _ of i)t=Math.min(t,_.x),o=Math.min(o,_.y),p=Math.max(p,_.x),f=Math.max(f,_.y);return{minX:t,minY:o,maxX:p,maxY:f}}function c(i,t){return t-i}var n;Zt("FeatureIndex",ac,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(n=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",n.load="load",n.fullLoad="fullLoad";let h=null,m=[];const v=1e3/30,S={mark(i){performance.mark(i)},frame(i){const t=i;h!=null&&m.push(t-h),h=t},clearMetrics(){h=null,m=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,t=performance.getEntriesByName("fullLoadTime")[0].duration,o=m.length,p=1/(m.reduce((_,x)=>_+x,0)/o/1e3),f=m.filter(_=>_>v).reduce((_,x)=>_+(x-v)/v,0);return{loadTime:i,fullLoadTime:t,fps:p,percentDroppedFrames:f/(o+f)*100}}};l.AJAXError=Ai,l.ARRAY_TYPE=Hn,l.Actor=class{constructor(i,t,o){this.target=i,this.parent=t,this.mapId=o,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},gt(["receive","process"],this),this.invoker=new Tp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=at()?i:window}send(i,t,o,p,f=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(this.callbacks[_]=o);const x=ft(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!o,targetMapId:p,mustQueue:f,sourceMapId:this.mapId,data:Yn(t,x)},x),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(i){const t=i.data,o=t.id;if(o&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[o];const p=this.cancelCallbacks[o];delete this.cancelCallbacks[o],p&&p()}else at()||t.mustQueue?(this.tasks[o]=t,this.taskQueue.push(o),this.invoker.trigger()):this.processTask(o,t)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){if(t.type==="<response>"){const o=this.callbacks[i];delete this.callbacks[i],o&&(t.error?o(Ds(t.error)):o(null,Ds(t.data)))}else{let o=!1;const p=ft(this.globalScope)?void 0:[],f=t.hasCallback?(E,z)=>{o=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:E?Yn(E):null,data:Yn(z,p)},p)}:E=>{o=!0};let _=null;const x=Ds(t.data);if(this.parent[t.type])_=this.parent[t.type](t.sourceMapId,x,f);else if(this.parent.getWorkerSource){const E=t.type.split(".");_=this.parent.getWorkerSource(t.sourceMapId,E[0],x.source)[E[1]](x,f)}else f(new Error(`Could not find function ${t.type}`));!o&&_&&_.cancel&&(this.cancelCallbacks[i]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=Il,l.CanonicalTileID=Pu,l.CollisionBoxArray=ve,l.CollisionCircleLayoutArray=class extends k{},l.Color=L,l.DEMData=Ip,l.DataConstantProperty=_t,l.DictionaryCoder=Mu,l.EXTENT=yn,l.ErrorEvent=jt,l.EvaluationParameters=zr,l.Event=Di,l.Evented=Vi,l.FeatureIndex=ac,l.FillBucket=Bo,l.FillExtrusionBucket=ih,l.GeoJSONFeature=Zc,l.ImageAtlas=lp,l.ImagePosition=Ql,l.LineBucket=nh,l.LineStripIndexArray=class extends ce{},l.LngLat=un,l.LngLatBounds=ba,l.MercatorCoordinate=Gc,l.ONE_EM=Dn,l.OverscaledTileID=Is,l.PerformanceUtils=S,l.PosArray=Ft,l.Properties=pn,l.QuadTriangleArray=class extends F{},l.RGBAImage=$n,l.RasterBoundsArray=class extends w{},l.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},l.ResourceType=Mr,l.SegmentVector=Zi,l.SymbolBucket=sc,l.Transitionable=Na,l.TriangleIndexArray=Sn,l.Uniform1f=uo,l.Uniform1i=class extends Jn{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},l.Uniform2f=class extends Jn{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},l.Uniform3f=class extends Jn{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},l.Uniform4f=bc,l.UniformColor=yl,l.UniformMatrix4f=class extends Jn{constructor(i,t){super(i,t),this.current=xl}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},l.UnwrappedTileID=Eh,l.ValidationError=Ae,l.ZoomHistory=Rt,l.add=function(i,t,o){return i[0]=t[0]+o[0],i[1]=t[1]+o[1],i[2]=t[2]+o[2],i},l.addDynamicAttributes=Nc,l.asyncAll=function(i,t,o){if(!i.length)return o(null,[]);let p=i.length;const f=new Array(i.length);let _=null;i.forEach((x,E)=>{t(x,(z,R)=>{z&&(_=z),f[E]=R,--p==0&&o(_,f)})})},l.bezier=ue,l.bindAll=gt,l.cacheEntryPossiblyAdded=function(i){ei++,ei>Ci&&(i.getActor().send("enforceCacheSizeLimit",ui),ei=0)},l.clamp=Z,l.clearTileCache=function(i){const t=caches.delete(vt);i&&t.catch(i).then(()=>i())},l.clipLine=Vc,l.clone=function(i){var t=new Hn(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},l.clone$1=it,l.clone$2=function(i){var t=new Hn(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},l.collisionCircleLayout=rp,l.config=si,l.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},l.create=function(){var i=new Hn(16);return Hn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},l.create$1=Ol,l.createExpression=Ws,l.createFilter=Cs,l.createLayout=jr,l.createStyleLayer=function(i){return i.type==="custom"?new bp(i):new wp[i.type](i)},l.cross=function(i,t,o){var p=t[0],f=t[1],_=t[2],x=o[0],E=o[1],z=o[2];return i[0]=f*z-_*E,i[1]=_*x-p*z,i[2]=p*E-f*x,i},l.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},l.dot$1=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},l.ease=re,l.emitValidationErrors=Ks,l.enforceCacheSizeLimit=function(i){fi(),Ht&&Ht.then(t=>{t.keys().then(o=>{for(let p=0;p<o.length-i;p++)t.delete(o[p])})})},l.equals=function(i,t){var o=i[0],p=i[1],f=i[2],_=i[3],x=i[4],E=i[5],z=i[6],R=i[7],V=i[8],q=i[9],X=i[10],Y=i[11],Q=i[12],fe=i[13],de=i[14],Te=i[15],Pe=t[0],Ee=t[1],Me=t[2],Le=t[3],Ue=t[4],He=t[5],Ge=t[6],tt=t[7],et=t[8],ht=t[9],Tt=t[10],St=t[11],pt=t[12],Xt=t[13],Ot=t[14],ni=t[15];return Math.abs(o-Pe)<=Nn*Math.max(1,Math.abs(o),Math.abs(Pe))&&Math.abs(p-Ee)<=Nn*Math.max(1,Math.abs(p),Math.abs(Ee))&&Math.abs(f-Me)<=Nn*Math.max(1,Math.abs(f),Math.abs(Me))&&Math.abs(_-Le)<=Nn*Math.max(1,Math.abs(_),Math.abs(Le))&&Math.abs(x-Ue)<=Nn*Math.max(1,Math.abs(x),Math.abs(Ue))&&Math.abs(E-He)<=Nn*Math.max(1,Math.abs(E),Math.abs(He))&&Math.abs(z-Ge)<=Nn*Math.max(1,Math.abs(z),Math.abs(Ge))&&Math.abs(R-tt)<=Nn*Math.max(1,Math.abs(R),Math.abs(tt))&&Math.abs(V-et)<=Nn*Math.max(1,Math.abs(V),Math.abs(et))&&Math.abs(q-ht)<=Nn*Math.max(1,Math.abs(q),Math.abs(ht))&&Math.abs(X-Tt)<=Nn*Math.max(1,Math.abs(X),Math.abs(Tt))&&Math.abs(Y-St)<=Nn*Math.max(1,Math.abs(Y),Math.abs(St))&&Math.abs(Q-pt)<=Nn*Math.max(1,Math.abs(Q),Math.abs(pt))&&Math.abs(fe-Xt)<=Nn*Math.max(1,Math.abs(fe),Math.abs(Xt))&&Math.abs(de-Ot)<=Nn*Math.max(1,Math.abs(de),Math.abs(Ot))&&Math.abs(Te-ni)<=Nn*Math.max(1,Math.abs(Te),Math.abs(ni))},l.evaluateSizeForFeature=function(i,{uSize:t,uSizeT:o},{lowerSize:p,upperSize:f}){return i.kind==="source"?p/Uo:i.kind==="composite"?Qr(p/Uo,f/Uo,o):t},l.evaluateSizeForZoom=function(i,t){let o=0,p=0;if(i.kind==="constant")p=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:f,minZoom:_,maxZoom:x}=i,E=f?Z(zn.interpolationFactor(f,t,_,x),0,1):0;i.kind==="camera"?p=Qr(i.minSize,i.maxSize,E):o=E}return{uSizeT:o,uSize:p}},l.evaluateVariableOffset=_p,l.evented=da,l.exported=Ze,l.exported$1=_i,l.extend=_e,l.filterObject=Ct,l.fromRotation=function(i,t){var o=Math.sin(t),p=Math.cos(t);return i[0]=p,i[1]=o,i[2]=0,i[3]=-o,i[4]=p,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},l.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},l.getAnchorAlignment=Oo,l.getAnchorJustification=yh,l.getArrayBuffer=Dr,l.getImage=Hi,l.getJSON=function(i,t){return Er(_e(i,{type:"json"}),t)},l.getOverlapMode=zu,l.getRTLTextPluginStatus=Bs,l.getReferrer=gr,l.getVideo=function(i,t){const o=window.document.createElement("video");o.muted=!0,o.onloadstart=function(){t(null,o)};for(let p=0;p<i.length;p++){const f=window.document.createElement("source");Jr(i[p])||(o.crossOrigin="Anonymous"),f.src=i[p],o.appendChild(f)}return{cancel:()=>{}}},l.identity=qu,l.invert=function(i,t){var o=t[0],p=t[1],f=t[2],_=t[3],x=t[4],E=t[5],z=t[6],R=t[7],V=t[8],q=t[9],X=t[10],Y=t[11],Q=t[12],fe=t[13],de=t[14],Te=t[15],Pe=o*E-p*x,Ee=o*z-f*x,Me=o*R-_*x,Le=p*z-f*E,Ue=p*R-_*E,He=f*R-_*z,Ge=V*fe-q*Q,tt=V*de-X*Q,et=V*Te-Y*Q,ht=q*de-X*fe,Tt=q*Te-Y*fe,St=X*Te-Y*de,pt=Pe*St-Ee*Tt+Me*ht+Le*et-Ue*tt+He*Ge;return pt?(i[0]=(E*St-z*Tt+R*ht)*(pt=1/pt),i[1]=(f*Tt-p*St-_*ht)*pt,i[2]=(fe*He-de*Ue+Te*Le)*pt,i[3]=(X*Ue-q*He-Y*Le)*pt,i[4]=(z*et-x*St-R*tt)*pt,i[5]=(o*St-f*et+_*tt)*pt,i[6]=(de*Me-Q*He-Te*Ee)*pt,i[7]=(V*He-X*Me+Y*Ee)*pt,i[8]=(x*Tt-E*et+R*Ge)*pt,i[9]=(p*et-o*Tt-_*Ge)*pt,i[10]=(Q*Ue-fe*Me+Te*Pe)*pt,i[11]=(q*Me-V*Ue-Y*Pe)*pt,i[12]=(E*tt-x*ht-z*Ge)*pt,i[13]=(o*ht-p*tt+f*Ge)*pt,i[14]=(fe*Ee-Q*Le-de*Pe)*pt,i[15]=(V*Le-q*Ee+X*Pe)*pt,i):null},l.isImageBitmap=wt,l.isSafari=ft,l.keysDifference=function(i,t){const o=[];for(const p in i)p in t||o.push(p);return o},l.lazyLoadRTLTextPlugin=function(){Ki.isLoading()||Ki.isLoaded()||Bs()!=="deferred"||Gn()},l.makeRequest=Er,l.mapObject=zt,l.mercatorXfromLng=Cu,l.mercatorYfromLat=Ih,l.mercatorZfromAltitude=Us,l.mul=Nh,l.mul$1=function(i,t,o){return i[0]=t[0]*o[0],i[1]=t[1]*o[1],i[2]=t[2]*o[2],i[3]=t[3]*o[3],i},l.multiply=Tc,l.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},l.normalize=function(i,t){var o=t[0],p=t[1],f=t[2],_=o*o+p*p+f*f;return _>0&&(_=1/Math.sqrt(_)),i[0]=t[0]*_,i[1]=t[1]*_,i[2]=t[2]*_,i},l.number=Qr,l.ortho=function(i,t,o,p,f,_,x){var E=1/(t-o),z=1/(p-f),R=1/(_-x);return i[0]=-2*E,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*z,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*R,i[11]=0,i[12]=(t+o)*E,i[13]=(f+p)*z,i[14]=(x+_)*R,i[15]=1,i},l.parseCacheControl=rt,l.parseGlyphPbf=function(i){return new _u(i).readFields(xu,[])},l.pbf=_u,l.performSymbolLayout=function(i,t,o,p,f,_,x){i.createArrays(),i.tilePixelRatio=yn/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const E=i.layers[0].layout,z=i.layers[0]._unevaluatedLayout._values,R={layoutIconSize:z["icon-size"].possiblyEvaluate(new zr(i.zoom+1),x),layoutTextSize:z["text-size"].possiblyEvaluate(new zr(i.zoom+1),x),textMaxSize:z["text-size"].possiblyEvaluate(new zr(18))};if(i.textSizeData.kind==="composite"){const{minZoom:Q,maxZoom:fe}=i.textSizeData;R.compositeTextSizes=[z["text-size"].possiblyEvaluate(new zr(Q),x),z["text-size"].possiblyEvaluate(new zr(fe),x)]}if(i.iconSizeData.kind==="composite"){const{minZoom:Q,maxZoom:fe}=i.iconSizeData;R.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new zr(Q),x),z["icon-size"].possiblyEvaluate(new zr(fe),x)]}const V=E.get("text-line-height")*Dn,q=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point",X=E.get("text-keep-upright"),Y=E.get("text-size");for(const Q of i.features){const fe=E.get("text-font").evaluate(Q,{},x).join(","),de=Y.evaluate(Q,{},x),Te=R.layoutTextSize.evaluate(Q,{},x),Pe=R.layoutIconSize.evaluate(Q,{},x),Ee={horizontal:{},vertical:void 0},Me=Q.text;let Le,Ue=[0,0];if(Me){const tt=Me.toString(),et=E.get("text-letter-spacing").evaluate(Q,{},x)*Dn,ht=xc(tt)?et:0,Tt=E.get("text-anchor").evaluate(Q,{},x),St=E.get("text-variable-anchor");if(!St){const Ei=E.get("text-radial-offset").evaluate(Q,{},x);Ue=Ei?_p(Tt,[Ei*Dn,Su]):E.get("text-offset").evaluate(Q,{},x).map(ji=>ji*Dn)}let pt=q?"center":E.get("text-justify").evaluate(Q,{},x);const Xt=E.get("symbol-placement"),Ot=Xt==="point"?E.get("text-max-width").evaluate(Q,{},x)*Dn:0,ni=()=>{i.allowVerticalPlacement&&ca(tt)&&(Ee.vertical=Rc(Me,t,o,f,fe,Ot,V,Tt,"left",ht,Ue,l.WritingMode.vertical,!0,Xt,Te,de))};if(!q&&St){const Ei=pt==="auto"?St.map(Xi=>yh(Xi)):[pt];let ji=!1;for(let Xi=0;Xi<Ei.length;Xi++){const Cr=Ei[Xi];if(!Ee.horizontal[Cr])if(ji)Ee.horizontal[Cr]=Ee.horizontal[0];else{const Wi=Rc(Me,t,o,f,fe,Ot,V,"center",Cr,ht,Ue,l.WritingMode.horizontal,!1,Xt,Te,de);Wi&&(Ee.horizontal[Cr]=Wi,ji=Wi.positionedLines.length===1)}}ni()}else{pt==="auto"&&(pt=yh(Tt));const Ei=Rc(Me,t,o,f,fe,Ot,V,Tt,pt,ht,Ue,l.WritingMode.horizontal,!1,Xt,Te,de);Ei&&(Ee.horizontal[pt]=Ei),ni(),ca(tt)&&q&&X&&(Ee.vertical=Rc(Me,t,o,f,fe,Ot,V,Tt,pt,ht,Ue,l.WritingMode.vertical,!1,Xt,Te,de))}}let He=!1;if(Q.icon&&Q.icon.name){const tt=p[Q.icon.name];tt&&(Le=hp(f[Q.icon.name],E.get("icon-offset").evaluate(Q,{},x),E.get("icon-anchor").evaluate(Q,{},x)),He=!!tt.sdf,i.sdfIcons===void 0?i.sdfIcons=He:i.sdfIcons!==He&&nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==i.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ge=yp(Ee.horizontal)||Ee.vertical;i.iconsInText=!!Ge&&Ge.iconsInText,(Ge||Le)&&cd(i,Q,Ee,Le,p,R,Te,Pe,Ue,He,x)}_&&i.generateCollisionDebugBuffers()},l.perspective=function(i,t,o,p,f){var _,x=1/Math.tan(t/2);return i[0]=x/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,f!=null&&f!==1/0?(i[10]=(f+p)*(_=1/(p-f)),i[14]=2*f*p*_):(i[10]=-1,i[14]=-2*p),i},l.pick=function(i,t){const o={};for(let p=0;p<t.length;p++){const f=t[p];f in i&&(o[f]=i[f])}return o},l.plugin=Ki,l.pointGeometry=De,l.polygonIntersectsPolygon=Oh,l.potpack=Lc,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=Zt,l.registerForPluginStateChange=function(i){return i({pluginStatus:cn,pluginURL:Ls}),da.on("pluginStateChange",i),i},l.renderColorRamp=Xu,l.rotateX=function(i,t,o){var p=Math.sin(o),f=Math.cos(o),_=t[4],x=t[5],E=t[6],z=t[7],R=t[8],V=t[9],q=t[10],X=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=_*f+R*p,i[5]=x*f+V*p,i[6]=E*f+q*p,i[7]=z*f+X*p,i[8]=R*f-_*p,i[9]=V*f-x*p,i[10]=q*f-E*p,i[11]=X*f-z*p,i},l.rotateZ=function(i,t,o){var p=Math.sin(o),f=Math.cos(o),_=t[0],x=t[1],E=t[2],z=t[3],R=t[4],V=t[5],q=t[6],X=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=_*f+R*p,i[1]=x*f+V*p,i[2]=E*f+q*p,i[3]=z*f+X*p,i[4]=R*f-_*p,i[5]=V*f-x*p,i[6]=q*f-E*p,i[7]=X*f-z*p,i},l.scale=function(i,t,o){var p=o[0],f=o[1],_=o[2];return i[0]=t[0]*p,i[1]=t[1]*p,i[2]=t[2]*p,i[3]=t[3]*p,i[4]=t[4]*f,i[5]=t[5]*f,i[6]=t[6]*f,i[7]=t[7]*f,i[8]=t[8]*_,i[9]=t[9]*_,i[10]=t[10]*_,i[11]=t[11]*_,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},l.scale$1=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i},l.setCacheLimits=function(i,t){ui=i,Ci=t},l.setRTLTextPlugin=function(i,t,o=!1){if(cn===ha||cn===Po||cn===pa)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ls=Ze.resolveURL(i),cn=ha,Bn=t,Ys(),o||Gn()},l.spec=ae,l.sphericalToCartesian=function([i,t,o]){return t+=90,t*=Math.PI/180,o*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(o),y:i*Math.sin(t)*Math.sin(o),z:i*Math.cos(o)}},l.sqrLen=function(i){var t=i[0],o=i[1];return t*t+o*o},l.sub=function(i,t,o){return i[0]=t[0]-o[0],i[1]=t[1]-o[1],i[2]=t[2]-o[2],i},l.toEvaluationFeature=Lo,l.transformMat3=function(i,t,o){var p=t[0],f=t[1],_=t[2];return i[0]=p*o[0]+f*o[3]+_*o[6],i[1]=p*o[1]+f*o[4]+_*o[7],i[2]=p*o[2]+f*o[5]+_*o[8],i},l.transformMat4=Ic,l.transformMat4$1=function(i,t,o){var p=t[0],f=t[1];return i[0]=o[0]*p+o[4]*f+o[12],i[1]=o[1]*p+o[5]*f+o[13],i},l.translate=function(i,t,o){var p,f,_,x,E,z,R,V,q,X,Y,Q,fe=o[0],de=o[1],Te=o[2];return t===i?(i[12]=t[0]*fe+t[4]*de+t[8]*Te+t[12],i[13]=t[1]*fe+t[5]*de+t[9]*Te+t[13],i[14]=t[2]*fe+t[6]*de+t[10]*Te+t[14],i[15]=t[3]*fe+t[7]*de+t[11]*Te+t[15]):(f=t[1],_=t[2],x=t[3],E=t[4],z=t[5],R=t[6],V=t[7],q=t[8],X=t[9],Y=t[10],Q=t[11],i[0]=p=t[0],i[1]=f,i[2]=_,i[3]=x,i[4]=E,i[5]=z,i[6]=R,i[7]=V,i[8]=q,i[9]=X,i[10]=Y,i[11]=Q,i[12]=p*fe+E*de+q*Te+t[12],i[13]=f*fe+z*de+X*Te+t[13],i[14]=_*fe+R*de+Y*Te+t[14],i[15]=x*fe+V*de+Q*Te+t[15]),i},l.triggerPluginCompletionEvent=Va,l.unicodeBlockLookup=Bt,l.uniqueId=function(){return Fe++},l.validateCustomStyleLayer=function(i){const t=[],o=i.id;return o===void 0&&t.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),t},l.validateLight=la,l.validateStyle=aa,l.vectorTile=Ha,l.warnOnce=nt,l.wrap=me}),O(["./shared"],function(l){function W(ge){const B=typeof ge;if(B==="number"||B==="boolean"||B==="string"||ge==null)return JSON.stringify(ge);if(Array.isArray(ge)){let G="[";for(const H of ge)G+=`${W(H)},`;return`${G}]`}const M=Object.keys(ge).sort();let L="{";for(let G=0;G<M.length;G++)L+=`${JSON.stringify(M[G])}:${W(ge[M[G]])},`;return`${L}}`}function $(ge){let B="";for(const M of l.refProperties)B+=`/${W(ge[M])}`;return B}class ue{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,M){for(const G of B){this._layerConfigs[G.id]=G;const H=this._layers[G.id]=l.createStyleLayer(G);H._featureFilter=l.createFilter(H.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of M)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const L=function(G,H){const te={};for(let ie=0;ie<G.length;ie++){const se=H&&H[G[ie].id]||$(G[ie]);H&&(H[G[ie].id]=se);let pe=te[se];pe||(pe=te[se]=[]),pe.push(G[ie])}const ne=[];for(const ie in te)ne.push(te[ie]);return ne}(Object.values(this._layerConfigs),this.keyCache);for(const G of L){const H=G.map(Ie=>this._layers[Ie.id]),te=H[0];if(te.visibility==="none")continue;const ne=te.source||"";let ie=this.familiesBySource[ne];ie||(ie=this.familiesBySource[ne]={});const se=te.sourceLayer||"_geojsonTileLayer";let pe=ie[se];pe||(pe=ie[se]=[]),pe.push(H)}}}class re{constructor(B){const M={},L=[];for(const ne in B){const ie=B[ne],se=M[ne]={};for(const pe in ie){const Ie=ie[+pe];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Se={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};L.push(Se),se[pe]={rect:Se,metrics:Ie.metrics}}}const{w:G,h:H}=l.potpack(L),te=new l.AlphaImage({width:G||1,height:H||1});for(const ne in B){const ie=B[ne];for(const se in ie){const pe=ie[+se];if(!pe||pe.bitmap.width===0||pe.bitmap.height===0)continue;const Ie=M[ne][se].rect;l.AlphaImage.copy(pe.bitmap,te,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},pe.bitmap)}}this.image=te,this.positions=M}}l.register("GlyphAtlas",re);class Z{constructor(B){this.tileID=new l.OverscaledTileID(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId}parse(B,M,L,G,H){this.status="parsing",this.data=B,this.collisionBoxArray=new l.CollisionBoxArray;const te=new l.DictionaryCoder(Object.keys(B.layers).sort()),ne=new l.FeatureIndex(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const ie={},se={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:L},pe=M.familiesBySource[this.source];for(const Lt in pe){const Et=B.layers[Lt];if(!Et)continue;Et.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${Lt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vt=te.encode(Lt),Kt=[];for(let Qi=0;Qi<Et.length;Qi++){const Ni=Et.feature(Qi),fr=ne.getId(Ni,Lt);Kt.push({feature:Ni,id:fr,index:Qi,sourceLayerIndex:Vt})}for(const Qi of pe[Lt]){const Ni=Qi[0];Ni.minzoom&&this.zoom<Math.floor(Ni.minzoom)||Ni.maxzoom&&this.zoom>=Ni.maxzoom||Ni.visibility!=="none"&&(me(Qi,this.zoom,L),(ie[Ni.id]=Ni.createBucket({index:ne.bucketLayerIDs.length,layers:Qi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vt,sourceID:this.source})).populate(Kt,se,this.tileID.canonical),ne.bucketLayerIDs.push(Qi.map(fr=>fr.id)))}}let Ie,Se,ke,st;const he=l.mapObject(se.glyphDependencies,Lt=>Object.keys(Lt).map(Number));Object.keys(he).length?G.send("getGlyphs",{uid:this.uid,stacks:he},(Lt,Et)=>{Ie||(Ie=Lt,Se=Et,Ut.call(this))}):Se={};const qe=Object.keys(se.iconDependencies);qe.length?G.send("getImages",{icons:qe,source:this.source,tileID:this.tileID,type:"icons"},(Lt,Et)=>{Ie||(Ie=Lt,ke=Et,Ut.call(this))}):ke={};const ot=Object.keys(se.patternDependencies);function Ut(){if(Ie)return H(Ie);if(Se&&ke&&st){const Lt=new re(Se),Et=new l.ImageAtlas(ke,st);for(const Vt in ie){const Kt=ie[Vt];Kt instanceof l.SymbolBucket?(me(Kt.layers,this.zoom,L),l.performSymbolLayout(Kt,Se,Lt.positions,ke,Et.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Kt.hasPattern&&(Kt instanceof l.LineBucket||Kt instanceof l.FillBucket||Kt instanceof l.FillExtrusionBucket)&&(me(Kt.layers,this.zoom,L),Kt.addFeatures(se,this.tileID.canonical,Et.patternPositions))}this.status="done",H(null,{buckets:Object.values(ie).filter(Vt=>!Vt.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Lt.image,imageAtlas:Et,glyphMap:this.returnDependencies?Se:null,iconMap:this.returnDependencies?ke:null,glyphPositions:this.returnDependencies?Lt.positions:null})}}ot.length?G.send("getImages",{icons:ot,source:this.source,tileID:this.tileID,type:"patterns"},(Lt,Et)=>{Ie||(Ie=Lt,st=Et,Ut.call(this))}):st={},Ut.call(this)}}function me(ge,B,M){const L=new l.EvaluationParameters(B);for(const G of ge)G.recalculate(L,M)}function _e(ge,B){const M=l.getArrayBuffer(ge.request,(L,G,H,te)=>{L?B(L):G&&B(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(G)),rawData:G,cacheControl:H,expires:te})});return()=>{M.cancel(),B()}}class Fe{constructor(B,M,L,G){this.actor=B,this.layerIndex=M,this.availableImages=L,this.loadVectorData=G||_e,this.loading={},this.loaded={}}loadTile(B,M){const L=B.uid;this.loading||(this.loading={});const G=!!(B&&B.request&&B.request.collectResourceTiming)&&new l.RequestPerformance(B.request),H=this.loading[L]=new Z(B);H.abort=this.loadVectorData(B,(te,ne)=>{if(delete this.loading[L],te||!ne)return H.status="done",this.loaded[L]=H,M(te);const ie=ne.rawData,se={};ne.expires&&(se.expires=ne.expires),ne.cacheControl&&(se.cacheControl=ne.cacheControl);const pe={};if(G){const Ie=G.finish();Ie&&(pe.resourceTiming=JSON.parse(JSON.stringify(Ie)))}H.vectorTile=ne.vectorTile,H.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ie,Se)=>{if(Ie||!Se)return M(Ie);M(null,l.extend({rawTileData:ie.slice(0)},Se,se,pe))}),this.loaded=this.loaded||{},this.loaded[L]=H})}reloadTile(B,M){const L=this.loaded,G=B.uid,H=this;if(L&&L[G]){const te=L[G];te.showCollisionBoxes=B.showCollisionBoxes;const ne=(ie,se)=>{const pe=te.reloadCallback;pe&&(delete te.reloadCallback,te.parse(te.vectorTile,H.layerIndex,this.availableImages,H.actor,pe)),M(ie,se)};te.status==="parsing"?te.reloadCallback=ne:te.status==="done"&&(te.vectorTile?te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,ne):ne())}}abortTile(B,M){const L=this.loading,G=B.uid;L&&L[G]&&L[G].abort&&(L[G].abort(),delete L[G]),M()}removeTile(B,M){const L=this.loaded,G=B.uid;L&&L[G]&&delete L[G],M()}}class gt{constructor(){this.loaded={}}loadTile(B,M){const{uid:L,encoding:G,rawImageData:H}=B,te=l.isImageBitmap(H)?this.getImageData(H):H,ne=new l.DEMData(L,te,G);this.loaded=this.loaded||{},this.loaded[L]=ne,M(null,ne)}getImageData(B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const M=this.offscreenCanvasContext.getImageData(-1,-1,B.width+2,B.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:M.width,height:M.height},M.data)}removeTile(B){const M=this.loaded,L=B.uid;M&&M[L]&&delete M[L]}}var zt=function ge(B,M){var L,G=B&&B.type;if(G==="FeatureCollection")for(L=0;L<B.features.length;L++)ge(B.features[L],M);else if(G==="GeometryCollection")for(L=0;L<B.geometries.length;L++)ge(B.geometries[L],M);else if(G==="Feature")ge(B.geometry,M);else if(G==="Polygon")Ct(B.coordinates,M);else if(G==="MultiPolygon")for(L=0;L<B.coordinates.length;L++)Ct(B.coordinates[L],M);return B};function Ct(ge,B){if(ge.length!==0){it(ge[0],B);for(var M=1;M<ge.length;M++)it(ge[M],!B)}}function it(ge,B){for(var M=0,L=0,G=0,H=ge.length,te=H-1;G<H;te=G++){var ne=(ge[G][0]-ge[te][0])*(ge[te][1]+ge[G][1]),ie=M+ne;L+=Math.abs(M)>=Math.abs(ne)?M-ie+ne:ne-ie+M,M=ie}M+L>=0!=!!B&&ge.reverse()}const je=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class nt{constructor(B){this._feature=B,this.extent=l.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const M of this._feature.geometry)B.push([new l.pointGeometry(M[0],M[1])]);return B}{const B=[];for(const M of this._feature.geometry){const L=[];for(const G of M)L.push(new l.pointGeometry(G[0],G[1]));B.push(L)}return B}}toGeoJSON(B,M,L){return je.call(this,B,M,L)}}class ct{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=B.length,this._features=B}feature(B){return new nt(this._features[B])}}var Xe={exports:{}},at=l.pointGeometry,rt=l.vectorTile.VectorTileFeature,Oe=bt;function bt(ge,B){this.options=B||{},this.features=ge,this.length=ge.length}function We(ge,B){this.id=typeof ge.id=="number"?ge.id:void 0,this.type=ge.type,this.rawGeometry=ge.type===1?[ge.geometry]:ge.geometry,this.properties=ge.tags,this.extent=B||4096}bt.prototype.feature=function(ge){return new We(this.features[ge],this.options.extent)},We.prototype.loadGeometry=function(){var ge=this.rawGeometry;this.geometry=[];for(var B=0;B<ge.length;B++){for(var M=ge[B],L=[],G=0;G<M.length;G++)L.push(new at(M[G][0],M[G][1]));this.geometry.push(L)}return this.geometry},We.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ge=this.geometry,B=1/0,M=-1/0,L=1/0,G=-1/0,H=0;H<ge.length;H++)for(var te=ge[H],ne=0;ne<te.length;ne++){var ie=te[ne];B=Math.min(B,ie.x),M=Math.max(M,ie.x),L=Math.min(L,ie.y),G=Math.max(G,ie.y)}return[B,L,M,G]},We.prototype.toGeoJSON=rt.prototype.toGeoJSON;var ft=l.pbf,wt=Oe;function Ze(ge){var B=new ft;return function(M,L){for(var G in M.layers)L.writeMessage(3,De,M.layers[G])}(ge,B),B.finish()}function De(ge,B){var M;B.writeVarintField(15,ge.version||1),B.writeStringField(1,ge.name||""),B.writeVarintField(5,ge.extent||4096);var L={keys:[],values:[],keycache:{},valuecache:{}};for(M=0;M<ge.length;M++)L.feature=ge.feature(M),B.writeMessage(2,Wt,L);var G=L.keys;for(M=0;M<G.length;M++)B.writeStringField(3,G[M]);var H=L.values;for(M=0;M<H.length;M++)B.writeMessage(4,ui,H[M])}function Wt(ge,B){var M=ge.feature;M.id!==void 0&&B.writeVarintField(1,M.id),B.writeMessage(2,si,ge),B.writeVarintField(3,M.type),B.writeMessage(4,gi,M)}function si(ge,B){var M=ge.feature,L=ge.keys,G=ge.values,H=ge.keycache,te=ge.valuecache;for(var ne in M.properties){var ie=M.properties[ne],se=H[ne];if(ie!==null){se===void 0&&(L.push(ne),H[ne]=se=L.length-1),B.writeVarint(se);var pe=typeof ie;pe!=="string"&&pe!=="boolean"&&pe!=="number"&&(ie=JSON.stringify(ie));var Ie=pe+":"+ie,Se=te[Ie];Se===void 0&&(G.push(ie),te[Ie]=Se=G.length-1),B.writeVarint(Se)}}}function vt(ge,B){return(B<<3)+(7&ge)}function Ht(ge){return ge<<1^ge>>31}function gi(ge,B){for(var M=ge.loadGeometry(),L=ge.type,G=0,H=0,te=M.length,ne=0;ne<te;ne++){var ie=M[ne],se=1;L===1&&(se=ie.length),B.writeVarint(vt(1,se));for(var pe=L===3?ie.length-1:ie.length,Ie=0;Ie<pe;Ie++){Ie===1&&L!==1&&B.writeVarint(vt(2,pe-1));var Se=ie[Ie].x-G,ke=ie[Ie].y-H;B.writeVarint(Ht(Se)),B.writeVarint(Ht(ke)),G+=Se,H+=ke}L===3&&B.writeVarint(vt(7,1))}}function ui(ge,B){var M=typeof ge;M==="string"?B.writeStringField(1,ge):M==="boolean"?B.writeBooleanField(7,ge):M==="number"&&(ge%1!=0?B.writeDoubleField(3,ge):ge<0?B.writeSVarintField(6,ge):B.writeVarintField(5,ge))}function Ci(ge,B,M,L,G,H){if(G-L<=M)return;const te=L+G>>1;fi(ge,B,te,L,G,H%2),Ci(ge,B,M,L,te-1,H+1),Ci(ge,B,M,te+1,G,H+1)}function fi(ge,B,M,L,G,H){for(;G>L;){if(G-L>600){const se=G-L+1,pe=M-L+1,Ie=Math.log(se),Se=.5*Math.exp(2*Ie/3),ke=.5*Math.sqrt(Ie*Se*(se-Se)/se)*(pe-se/2<0?-1:1);fi(ge,B,M,Math.max(L,Math.floor(M-pe*Se/se+ke)),Math.min(G,Math.floor(M+(se-pe)*Se/se+ke)),H)}const te=B[2*M+H];let ne=L,ie=G;for(ei(ge,B,L,M),B[2*G+H]>te&&ei(ge,B,L,G);ne<ie;){for(ei(ge,B,ne,ie),ne++,ie--;B[2*ne+H]<te;)ne++;for(;B[2*ie+H]>te;)ie--}B[2*L+H]===te?ei(ge,B,L,ie):(ie++,ei(ge,B,ie,G)),ie<=M&&(L=ie+1),M<=ie&&(G=ie-1)}}function ei(ge,B,M,L){_i(ge,M,L),_i(B,2*M,2*L),_i(B,2*M+1,2*L+1)}function _i(ge,B,M){const L=ge[B];ge[B]=ge[M],ge[M]=L}function $i(ge,B,M,L){const G=ge-M,H=B-L;return G*G+H*H}Xe.exports=Ze,Xe.exports.fromVectorTileJs=Ze,Xe.exports.fromGeojsonVt=function(ge,B){B=B||{};var M={};for(var L in ge)M[L]=new wt(ge[L].features,B),M[L].name=L,M[L].version=B.version,M[L].extent=B.extent;return Ze({layers:M})},Xe.exports.GeoJSONWrapper=wt;const lt=ge=>ge[0],$e=ge=>ge[1];class di{constructor(B,M=lt,L=$e,G=64,H=Float64Array){this.nodeSize=G,this.points=B;const te=B.length<65536?Uint16Array:Uint32Array,ne=this.ids=new te(B.length),ie=this.coords=new H(2*B.length);for(let se=0;se<B.length;se++)ne[se]=se,ie[2*se]=M(B[se]),ie[2*se+1]=L(B[se]);Ci(ne,ie,G,0,ne.length-1,0)}range(B,M,L,G){return function(H,te,ne,ie,se,pe,Ie){const Se=[0,H.length-1,0],ke=[];let st,he;for(;Se.length;){const qe=Se.pop(),ot=Se.pop(),Ut=Se.pop();if(ot-Ut<=Ie){for(let Vt=Ut;Vt<=ot;Vt++)st=te[2*Vt],he=te[2*Vt+1],st>=ne&&st<=se&&he>=ie&&he<=pe&&ke.push(H[Vt]);continue}const Lt=Math.floor((Ut+ot)/2);st=te[2*Lt],he=te[2*Lt+1],st>=ne&&st<=se&&he>=ie&&he<=pe&&ke.push(H[Lt]);const Et=(qe+1)%2;(qe===0?ne<=st:ie<=he)&&(Se.push(Ut),Se.push(Lt-1),Se.push(Et)),(qe===0?se>=st:pe>=he)&&(Se.push(Lt+1),Se.push(ot),Se.push(Et))}return ke}(this.ids,this.coords,B,M,L,G,this.nodeSize)}within(B,M,L){return function(G,H,te,ne,ie,se){const pe=[0,G.length-1,0],Ie=[],Se=ie*ie;for(;pe.length;){const ke=pe.pop(),st=pe.pop(),he=pe.pop();if(st-he<=se){for(let Et=he;Et<=st;Et++)$i(H[2*Et],H[2*Et+1],te,ne)<=Se&&Ie.push(G[Et]);continue}const qe=Math.floor((he+st)/2),ot=H[2*qe],Ut=H[2*qe+1];$i(ot,Ut,te,ne)<=Se&&Ie.push(G[qe]);const Lt=(ke+1)%2;(ke===0?te-ie<=ot:ne-ie<=Ut)&&(pe.push(he),pe.push(qe-1),pe.push(Lt)),(ke===0?te+ie>=ot:ne+ie>=Ut)&&(pe.push(qe+1),pe.push(st),pe.push(Lt))}return Ie}(this.ids,this.coords,B,M,L,this.nodeSize)}}const Ui={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},Mr=Math.fround||(Ai=new Float32Array(1),ge=>(Ai[0]=+ge,Ai[0]));var Ai;class gr{constructor(B){this.options=Hi(Object.create(Ui),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:M,minZoom:L,maxZoom:G,nodeSize:H}=this.options;M&&console.time("total time");const te=`prepare ${B.length} points`;M&&console.time(te),this.points=B;let ne=[];for(let ie=0;ie<B.length;ie++)B[ie].geometry&&ne.push(Er(B[ie],ie));this.trees[G+1]=new di(ne,Qt,tr,H,Float32Array),M&&console.timeEnd(te);for(let ie=G;ie>=L;ie--){const se=+Date.now();ne=this._cluster(ne,ie),this.trees[ie]=new di(ne,Qt,tr,H,Float32Array),M&&console.log("z%d: %d clusters in %dms",ie,ne.length,+Date.now()-se)}return M&&console.timeEnd("total time"),this}getClusters(B,M){let L=((B[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,B[1]));let H=B[2]===180?180:((B[2]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)L=-180,H=180;else if(L>H){const pe=this.getClusters([L,G,180,te],M),Ie=this.getClusters([-180,G,H,te],M);return pe.concat(Ie)}const ne=this.trees[this._limitZoom(M)],ie=ne.range(bi(L),br(te),bi(H),br(G)),se=[];for(const pe of ie){const Ie=ne.points[pe];se.push(Ie.numPoints?Dr(Ie):this.points[Ie.index])}return se}getChildren(B){const M=this._getOriginId(B),L=this._getOriginZoom(B),G="No cluster with the specified id.",H=this.trees[L];if(!H)throw new Error(G);const te=H.points[M];if(!te)throw new Error(G);const ne=this.options.radius/(this.options.extent*Math.pow(2,L-1)),ie=H.within(te.x,te.y,ne),se=[];for(const pe of ie){const Ie=H.points[pe];Ie.parentId===B&&se.push(Ie.numPoints?Dr(Ie):this.points[Ie.index])}if(se.length===0)throw new Error(G);return se}getLeaves(B,M,L){const G=[];return this._appendLeaves(G,B,M=M||10,L=L||0,0),G}getTile(B,M,L){const G=this.trees[this._limitZoom(B)],H=Math.pow(2,B),{extent:te,radius:ne}=this.options,ie=ne/te,se=(L-ie)/H,pe=(L+1+ie)/H,Ie={features:[]};return this._addTileFeatures(G.range((M-ie)/H,se,(M+1+ie)/H,pe),G.points,M,L,H,Ie),M===0&&this._addTileFeatures(G.range(1-ie/H,se,1,pe),G.points,H,L,H,Ie),M===H-1&&this._addTileFeatures(G.range(0,se,ie/H,pe),G.points,-1,L,H,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(B){let M=this._getOriginZoom(B)-1;for(;M<=this.options.maxZoom;){const L=this.getChildren(B);if(M++,L.length!==1)break;B=L[0].properties.cluster_id}return M}_appendLeaves(B,M,L,G,H){const te=this.getChildren(M);for(const ne of te){const ie=ne.properties;if(ie&&ie.cluster?H+ie.point_count<=G?H+=ie.point_count:H=this._appendLeaves(B,ie.cluster_id,L,G,H):H<G?H++:B.push(ne),B.length===L)break}return H}_addTileFeatures(B,M,L,G,H,te){for(const ne of B){const ie=M[ne],se=ie.numPoints;let pe,Ie,Se;if(se)pe=Jr(ie),Ie=ie.x,Se=ie.y;else{const he=this.points[ie.index];pe=he.properties,Ie=bi(he.geometry.coordinates[0]),Se=br(he.geometry.coordinates[1])}const ke={type:1,geometry:[[Math.round(this.options.extent*(Ie*H-L)),Math.round(this.options.extent*(Se*H-G))]],tags:pe};let st;se?st=ie.id:this.options.generateId?st=ie.index:this.points[ie.index].id&&(st=this.points[ie.index].id),st!==void 0&&(ke.id=st),te.features.push(ke)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,M){const L=[],{radius:G,extent:H,reduce:te,minPoints:ne}=this.options,ie=G/(H*Math.pow(2,M));for(let se=0;se<B.length;se++){const pe=B[se];if(pe.zoom<=M)continue;pe.zoom=M;const Ie=this.trees[M+1],Se=Ie.within(pe.x,pe.y,ie),ke=pe.numPoints||1;let st=ke;for(const he of Se){const qe=Ie.points[he];qe.zoom>M&&(st+=qe.numPoints||1)}if(st>ke&&st>=ne){let he=pe.x*ke,qe=pe.y*ke,ot=te&&ke>1?this._map(pe,!0):null;const Ut=(se<<5)+(M+1)+this.points.length;for(const Lt of Se){const Et=Ie.points[Lt];if(Et.zoom<=M)continue;Et.zoom=M;const Vt=Et.numPoints||1;he+=Et.x*Vt,qe+=Et.y*Vt,Et.parentId=Ut,te&&(ot||(ot=this._map(pe,!0)),te(ot,this._map(Et)))}pe.parentId=Ut,L.push(_r(he/st,qe/st,Ut,st,ot))}else if(L.push(pe),st>1)for(const he of Se){const qe=Ie.points[he];qe.zoom<=M||(qe.zoom=M,L.push(qe))}}return L}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,M){if(B.numPoints)return M?Hi({},B.properties):B.properties;const L=this.points[B.index].properties,G=this.options.map(L);return M&&G===L?Hi({},G):G}}function _r(ge,B,M,L,G){return{x:Mr(ge),y:Mr(B),zoom:1/0,id:M,parentId:-1,numPoints:L,properties:G}}function Er(ge,B){const[M,L]=ge.geometry.coordinates;return{x:Mr(bi(M)),y:Mr(br(L)),zoom:1/0,index:B,parentId:-1}}function Dr(ge){return{type:"Feature",id:ge.id,properties:Jr(ge),geometry:{type:"Point",coordinates:[(B=ge.x,360*(B-.5)),cr(ge.y)]}};var B}function Jr(ge){const B=ge.numPoints,M=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return Hi(Hi({},ge.properties),{cluster:!0,cluster_id:ge.id,point_count:B,point_count_abbreviated:M})}function bi(ge){return ge/360+.5}function br(ge){const B=Math.sin(ge*Math.PI/180),M=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return M<0?0:M>1?1:M}function cr(ge){const B=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Hi(ge,B){for(const M in B)ge[M]=B[M];return ge}function Qt(ge){return ge.x}function tr(ge){return ge.y}function Di(ge,B,M,L){for(var G,H=L,te=M-B>>1,ne=M-B,ie=ge[B],se=ge[B+1],pe=ge[M],Ie=ge[M+1],Se=B+3;Se<M;Se+=3){var ke=jt(ge[Se],ge[Se+1],ie,se,pe,Ie);if(ke>H)G=Se,H=ke;else if(ke===H){var st=Math.abs(Se-te);st<ne&&(G=Se,ne=st)}}H>L&&(G-B>3&&Di(ge,B,G,L),ge[G+2]=H,M-G>3&&Di(ge,G,M,L))}function jt(ge,B,M,L,G,H){var te=G-M,ne=H-L;if(te!==0||ne!==0){var ie=((ge-M)*te+(B-L)*ne)/(te*te+ne*ne);ie>1?(M=G,L=H):ie>0&&(M+=te*ie,L+=ne*ie)}return(te=ge-M)*te+(ne=B-L)*ne}function Vi(ge,B,M,L){var G={id:ge===void 0?null:ge,type:B,geometry:M,tags:L,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(H){var te=H.geometry,ne=H.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")ae(H,te);else if(ne==="Polygon"||ne==="MultiLineString")for(var ie=0;ie<te.length;ie++)ae(H,te[ie]);else if(ne==="MultiPolygon")for(ie=0;ie<te.length;ie++)for(var se=0;se<te[ie].length;se++)ae(H,te[ie][se])}(G),G}function ae(ge,B){for(var M=0;M<B.length;M+=3)ge.minX=Math.min(ge.minX,B[M]),ge.minY=Math.min(ge.minY,B[M+1]),ge.maxX=Math.max(ge.maxX,B[M]),ge.maxY=Math.max(ge.maxY,B[M+1])}function Ae(ge,B,M,L){if(B.geometry){var G=B.geometry.coordinates,H=B.geometry.type,te=Math.pow(M.tolerance/((1<<M.maxZoom)*M.extent),2),ne=[],ie=B.id;if(M.promoteId?ie=B.properties[M.promoteId]:M.generateId&&(ie=L||0),H==="Point")$r(G,ne);else if(H==="MultiPoint")for(var se=0;se<G.length;se++)$r(G[se],ne);else if(H==="LineString")yr(G,ne,te,!1);else if(H==="MultiLineString"){if(M.lineMetrics){for(se=0;se<G.length;se++)yr(G[se],ne=[],te,!1),ge.push(Vi(ie,"LineString",ne,B.properties));return}Gt(G,ne,te,!1)}else if(H==="Polygon")Gt(G,ne,te,!0);else{if(H!=="MultiPolygon"){if(H==="GeometryCollection"){for(se=0;se<B.geometry.geometries.length;se++)Ae(ge,{id:ie,geometry:B.geometry.geometries[se],properties:B.properties},M,L);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<G.length;se++){var pe=[];Gt(G[se],pe,te,!0),ne.push(pe)}}ge.push(Vi(ie,H,ne,B.properties))}}function $r(ge,B){B.push(hi(ge[0])),B.push(Ti(ge[1])),B.push(0)}function yr(ge,B,M,L){for(var G,H,te=0,ne=0;ne<ge.length;ne++){var ie=hi(ge[ne][0]),se=Ti(ge[ne][1]);B.push(ie),B.push(se),B.push(0),ne>0&&(te+=L?(G*se-ie*H)/2:Math.sqrt(Math.pow(ie-G,2)+Math.pow(se-H,2))),G=ie,H=se}var pe=B.length-3;B[2]=1,Di(B,0,pe,M),B[pe+2]=1,B.size=Math.abs(te),B.start=0,B.end=B.size}function Gt(ge,B,M,L){for(var G=0;G<ge.length;G++){var H=[];yr(ge[G],H,M,L),B.push(H)}}function hi(ge){return ge/360+.5}function Ti(ge){var B=Math.sin(ge*Math.PI/180),M=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return M<0?0:M>1?1:M}function xr(ge,B,M,L,G,H,te,ne){if(L/=B,H>=(M/=B)&&te<L)return ge;if(te<M||H>=L)return null;for(var ie=[],se=0;se<ge.length;se++){var pe=ge[se],Ie=pe.geometry,Se=pe.type,ke=G===0?pe.minX:pe.minY,st=G===0?pe.maxX:pe.maxY;if(ke>=M&&st<L)ie.push(pe);else if(!(st<M||ke>=L)){var he=[];if(Se==="Point"||Se==="MultiPoint")Mi(Ie,he,M,L,G);else if(Se==="LineString")Ve(Ie,he,M,L,G,!1,ne.lineMetrics);else if(Se==="MultiLineString")Pt(Ie,he,M,L,G,!1);else if(Se==="Polygon")Pt(Ie,he,M,L,G,!0);else if(Se==="MultiPolygon")for(var qe=0;qe<Ie.length;qe++){var ot=[];Pt(Ie[qe],ot,M,L,G,!0),ot.length&&he.push(ot)}if(he.length){if(ne.lineMetrics&&Se==="LineString"){for(qe=0;qe<he.length;qe++)ie.push(Vi(pe.id,Se,he[qe],pe.tags));continue}Se!=="LineString"&&Se!=="MultiLineString"||(he.length===1?(Se="LineString",he=he[0]):Se="MultiLineString"),Se!=="Point"&&Se!=="MultiPoint"||(Se=he.length===3?"Point":"MultiPoint"),ie.push(Vi(pe.id,Se,he,pe.tags))}}}return ie.length?ie:null}function Mi(ge,B,M,L,G){for(var H=0;H<ge.length;H+=3){var te=ge[H+G];te>=M&&te<=L&&(B.push(ge[H]),B.push(ge[H+1]),B.push(ge[H+2]))}}function Ve(ge,B,M,L,G,H,te){for(var ne,ie,se=Dt(ge),pe=G===0?Ar:Mt,Ie=ge.start,Se=0;Se<ge.length-3;Se+=3){var ke=ge[Se],st=ge[Se+1],he=ge[Se+2],qe=ge[Se+3],ot=ge[Se+4],Ut=G===0?ke:st,Lt=G===0?qe:ot,Et=!1;te&&(ne=Math.sqrt(Math.pow(ke-qe,2)+Math.pow(st-ot,2))),Ut<M?Lt>M&&(ie=pe(se,ke,st,qe,ot,M),te&&(se.start=Ie+ne*ie)):Ut>L?Lt<L&&(ie=pe(se,ke,st,qe,ot,L),te&&(se.start=Ie+ne*ie)):Ii(se,ke,st,he),Lt<M&&Ut>=M&&(ie=pe(se,ke,st,qe,ot,M),Et=!0),Lt>L&&Ut<=L&&(ie=pe(se,ke,st,qe,ot,L),Et=!0),!H&&Et&&(te&&(se.end=Ie+ne*ie),B.push(se),se=Dt(ge)),te&&(Ie+=ne)}var Vt=ge.length-3;ke=ge[Vt],st=ge[Vt+1],he=ge[Vt+2],(Ut=G===0?ke:st)>=M&&Ut<=L&&Ii(se,ke,st,he),Vt=se.length-3,H&&Vt>=3&&(se[Vt]!==se[0]||se[Vt+1]!==se[1])&&Ii(se,se[0],se[1],se[2]),se.length&&B.push(se)}function Dt(ge){var B=[];return B.size=ge.size,B.start=ge.start,B.end=ge.end,B}function Pt(ge,B,M,L,G,H){for(var te=0;te<ge.length;te++)Ve(ge[te],B,M,L,G,H,!1)}function Ii(ge,B,M,L){ge.push(B),ge.push(M),ge.push(L)}function Ar(ge,B,M,L,G,H){var te=(H-B)/(L-B);return ge.push(H),ge.push(M+(G-M)*te),ge.push(1),te}function Mt(ge,B,M,L,G,H){var te=(H-M)/(G-M);return ge.push(B+(L-B)*te),ge.push(H),ge.push(1),te}function kn(ge,B){for(var M=[],L=0;L<ge.length;L++){var G,H=ge[L],te=H.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")G=vr(H.geometry,B);else if(te==="MultiLineString"||te==="Polygon"){G=[];for(var ne=0;ne<H.geometry.length;ne++)G.push(vr(H.geometry[ne],B))}else if(te==="MultiPolygon")for(G=[],ne=0;ne<H.geometry.length;ne++){for(var ie=[],se=0;se<H.geometry[ne].length;se++)ie.push(vr(H.geometry[ne][se],B));G.push(ie)}M.push(Vi(H.id,te,G,H.tags))}return M}function vr(ge,B){var M=[];M.size=ge.size,ge.start!==void 0&&(M.start=ge.start,M.end=ge.end);for(var L=0;L<ge.length;L+=3)M.push(ge[L]+B,ge[L+1],ge[L+2]);return M}function bn(ge,B){if(ge.transformed)return ge;var M,L,G,H=1<<ge.z,te=ge.x,ne=ge.y;for(M=0;M<ge.features.length;M++){var ie=ge.features[M],se=ie.geometry,pe=ie.type;if(ie.geometry=[],pe===1)for(L=0;L<se.length;L+=2)ie.geometry.push(ki(se[L],se[L+1],B,H,te,ne));else for(L=0;L<se.length;L++){var Ie=[];for(G=0;G<se[L].length;G+=2)Ie.push(ki(se[L][G],se[L][G+1],B,H,te,ne));ie.geometry.push(Ie)}}return ge.transformed=!0,ge}function ki(ge,B,M,L,G,H){return[Math.round(M*(ge*L-G)),Math.round(M*(B*L-H))]}function pi(ge,B,M,L,G){for(var H=B===G.maxZoom?0:G.tolerance/((1<<B)*G.extent),te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:M,y:L,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ne=0;ne<ge.length;ne++){te.numFeatures++,hn(te,ge[ne],H,G);var ie=ge[ne].minX,se=ge[ne].minY,pe=ge[ne].maxX,Ie=ge[ne].maxY;ie<te.minX&&(te.minX=ie),se<te.minY&&(te.minY=se),pe>te.maxX&&(te.maxX=pe),Ie>te.maxY&&(te.maxY=Ie)}return te}function hn(ge,B,M,L){var G=B.geometry,H=B.type,te=[];if(H==="Point"||H==="MultiPoint")for(var ne=0;ne<G.length;ne+=3)te.push(G[ne]),te.push(G[ne+1]),ge.numPoints++,ge.numSimplified++;else if(H==="LineString")mn(te,G,ge,M,!1,!1);else if(H==="MultiLineString"||H==="Polygon")for(ne=0;ne<G.length;ne++)mn(te,G[ne],ge,M,H==="Polygon",ne===0);else if(H==="MultiPolygon")for(var ie=0;ie<G.length;ie++){var se=G[ie];for(ne=0;ne<se.length;ne++)mn(te,se[ne],ge,M,!0,ne===0)}if(te.length){var pe=B.tags||null;if(H==="LineString"&&L.lineMetrics){for(var Ie in pe={},B.tags)pe[Ie]=B.tags[Ie];pe.mapbox_clip_start=G.start/G.size,pe.mapbox_clip_end=G.end/G.size}var Se={geometry:te,type:H==="Polygon"||H==="MultiPolygon"?3:H==="LineString"||H==="MultiLineString"?2:1,tags:pe};B.id!==null&&(Se.id=B.id),ge.features.push(Se)}}function mn(ge,B,M,L,G,H){var te=L*L;if(L>0&&B.size<(G?te:L))M.numPoints+=B.length/3;else{for(var ne=[],ie=0;ie<B.length;ie+=3)(L===0||B[ie+2]>te)&&(M.numSimplified++,ne.push(B[ie]),ne.push(B[ie+1])),M.numPoints++;G&&function(se,pe){for(var Ie=0,Se=0,ke=se.length,st=ke-2;Se<ke;st=Se,Se+=2)Ie+=(se[Se]-se[st])*(se[Se+1]+se[st+1]);if(Ie>0===pe)for(Se=0,ke=se.length;Se<ke/2;Se+=2){var he=se[Se],qe=se[Se+1];se[Se]=se[ke-2-Se],se[Se+1]=se[ke-1-Se],se[ke-2-Se]=he,se[ke-1-Se]=qe}}(ne,H),ge.push(ne)}}function wr(ge,B){var M=(B=this.options=function(G,H){for(var te in H)G[te]=H[te];return G}(Object.create(this.options),B)).debug;if(M&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var L=function(G,H){var te=[];if(G.type==="FeatureCollection")for(var ne=0;ne<G.features.length;ne++)Ae(te,G.features[ne],H,ne);else Ae(te,G.type==="Feature"?G:{geometry:G},H);return te}(ge,B);this.tiles={},this.tileCoords=[],M&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),L=function(G,H){var te=H.buffer/H.extent,ne=G,ie=xr(G,1,-1-te,te,0,-1,2,H),se=xr(G,1,1-te,2+te,0,-1,2,H);return(ie||se)&&(ne=xr(G,1,-te,1+te,0,-1,2,H)||[],ie&&(ne=kn(ie,1).concat(ne)),se&&(ne=ne.concat(kn(se,-1)))),ne}(L,B),L.length&&this.splitTile(L,0,0,0),M&&(L.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function an(ge,B,M){return 32*((1<<ge)*M+B)+ge}function wn(ge,B){const M=ge.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const L=this._geoJSONIndex.getTile(M.z,M.x,M.y);if(!L)return B(null,null);const G=new ct(L.features);let H=Xe.exports(G);H.byteOffset===0&&H.byteLength===H.buffer.byteLength||(H=new Uint8Array(H)),B(null,{vectorTile:G,rawData:H.buffer})}wr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},wr.prototype.splitTile=function(ge,B,M,L,G,H,te){for(var ne=[ge,B,M,L],ie=this.options,se=ie.debug;ne.length;){L=ne.pop(),M=ne.pop(),B=ne.pop(),ge=ne.pop();var pe=1<<B,Ie=an(B,M,L),Se=this.tiles[Ie];if(!Se&&(se>1&&console.time("creation"),Se=this.tiles[Ie]=pi(ge,B,M,L,ie),this.tileCoords.push({z:B,x:M,y:L}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,M,L,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));var ke="z"+B;this.stats[ke]=(this.stats[ke]||0)+1,this.total++}if(Se.source=ge,G){if(B===ie.maxZoom||B===G)continue;var st=1<<G-B;if(M!==Math.floor(H/st)||L!==Math.floor(te/st))continue}else if(B===ie.indexMaxZoom||Se.numPoints<=ie.indexMaxPoints)continue;if(Se.source=null,ge.length!==0){se>1&&console.time("clipping");var he,qe,ot,Ut,Lt,Et,Vt=.5*ie.buffer/ie.extent,Kt=.5-Vt,Qi=.5+Vt,Ni=1+Vt;he=qe=ot=Ut=null,Lt=xr(ge,pe,M-Vt,M+Qi,0,Se.minX,Se.maxX,ie),Et=xr(ge,pe,M+Kt,M+Ni,0,Se.minX,Se.maxX,ie),ge=null,Lt&&(he=xr(Lt,pe,L-Vt,L+Qi,1,Se.minY,Se.maxY,ie),qe=xr(Lt,pe,L+Kt,L+Ni,1,Se.minY,Se.maxY,ie),Lt=null),Et&&(ot=xr(Et,pe,L-Vt,L+Qi,1,Se.minY,Se.maxY,ie),Ut=xr(Et,pe,L+Kt,L+Ni,1,Se.minY,Se.maxY,ie),Et=null),se>1&&console.timeEnd("clipping"),ne.push(he||[],B+1,2*M,2*L),ne.push(qe||[],B+1,2*M,2*L+1),ne.push(ot||[],B+1,2*M+1,2*L),ne.push(Ut||[],B+1,2*M+1,2*L+1)}}},wr.prototype.getTile=function(ge,B,M){var L=this.options,G=L.extent,H=L.debug;if(ge<0||ge>24)return null;var te=1<<ge,ne=an(ge,B=(B%te+te)%te,M);if(this.tiles[ne])return bn(this.tiles[ne],G);H>1&&console.log("drilling down to z%d-%d-%d",ge,B,M);for(var ie,se=ge,pe=B,Ie=M;!ie&&se>0;)se--,pe=Math.floor(pe/2),Ie=Math.floor(Ie/2),ie=this.tiles[an(se,pe,Ie)];return ie&&ie.source?(H>1&&console.log("found parent tile z%d-%d-%d",se,pe,Ie),H>1&&console.time("drilling down"),this.splitTile(ie.source,se,pe,Ie,ge,B,M),H>1&&console.timeEnd("drilling down"),this.tiles[ne]?bn(this.tiles[ne],G):null):null};class is extends Fe{constructor(B,M,L,G){super(B,M,L,wn),G&&(this.loadGeoJSON=G)}loadData(B,M){var L;(L=this._pendingRequest)===null||L===void 0||L.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const G=!!(B&&B.request&&B.request.collectResourceTiming)&&new l.RequestPerformance(B.request);this._pendingCallback=M,this._pendingRequest=this.loadGeoJSON(B,(H,te)=>{if(delete this._pendingCallback,delete this._pendingRequest,H||!te)return M(H);if(typeof te!="object")return M(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{zt(te,!0);try{if(B.filter){const ie=l.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));const se=te.features.filter(pe=>ie.value.evaluate({zoom:0},pe));te={type:"FeatureCollection",features:se}}this._geoJSONIndex=B.cluster?new gr(function({superclusterOptions:ie,clusterProperties:se}){if(!se||!ie)return ie;const pe={},Ie={},Se={accumulated:null,zoom:0},ke={properties:null},st=Object.keys(se);for(const he of st){const[qe,ot]=se[he],Ut=l.createExpression(ot),Lt=l.createExpression(typeof qe=="string"?[qe,["accumulated"],["get",he]]:qe);pe[he]=Ut.value,Ie[he]=Lt.value}return ie.map=he=>{ke.properties=he;const qe={};for(const ot of st)qe[ot]=pe[ot].evaluate(Se,ke);return qe},ie.reduce=(he,qe)=>{ke.properties=qe;for(const ot of st)Se.accumulated=he[ot],he[ot]=Ie[ot].evaluate(Se,ke)},ie}(B)).load(te.features):function(ie,se){return new wr(ie,se)}(te,B.geojsonVtOptions)}catch(ie){return M(ie)}this.loaded={};const ne={};if(G){const ie=G.finish();ie&&(ne.resourceTiming={},ne.resourceTiming[B.source]=JSON.parse(JSON.stringify(ie)))}M(null,ne)}})}reloadTile(B,M){const L=this.loaded;return L&&L[B.uid]?super.reloadTile(B,M):this.loadTile(B,M)}loadGeoJSON(B,M){if(B.request)return l.getJSON(B.request,M);if(typeof B.data=="string")try{M(null,JSON.parse(B.data))}catch{M(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}else M(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(B,M){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),M()}getClusterExpansionZoom(B,M){try{M(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(L){M(L)}}getClusterChildren(B,M){try{M(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(L){M(L)}}getClusterLeaves(B,M){try{M(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(L){M(L)}}}class Tn{constructor(B){this.self=B,this.actor=new l.Actor(B,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Fe,geojson:is},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(M,L)=>{if(this.workerSourceTypes[M])throw new Error(`Worker source with name "${M}" already registered.`);this.workerSourceTypes[M]=L},this.self.registerRTLTextPlugin=M=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=M.applyArabicShaping,l.plugin.processBidirectionalText=M.processBidirectionalText,l.plugin.processStyledBidirectionalText=M.processStyledBidirectionalText}}setReferrer(B,M){this.referrer=M}setImages(B,M,L){this.availableImages[B]=M;for(const G in this.workerSources[B]){const H=this.workerSources[B][G];for(const te in H)H[te].availableImages=M}L()}setLayers(B,M,L){this.getLayerIndex(B).replace(M),L()}updateLayers(B,M,L){this.getLayerIndex(B).update(M.layers,M.removedIds),L()}loadTile(B,M,L){this.getWorkerSource(B,M.type,M.source).loadTile(M,L)}loadDEMTile(B,M,L){this.getDEMWorkerSource(B,M.source).loadTile(M,L)}reloadTile(B,M,L){this.getWorkerSource(B,M.type,M.source).reloadTile(M,L)}abortTile(B,M,L){this.getWorkerSource(B,M.type,M.source).abortTile(M,L)}removeTile(B,M,L){this.getWorkerSource(B,M.type,M.source).removeTile(M,L)}removeDEMTile(B,M){this.getDEMWorkerSource(B,M.source).removeTile(M)}removeSource(B,M,L){if(!this.workerSources[B]||!this.workerSources[B][M.type]||!this.workerSources[B][M.type][M.source])return;const G=this.workerSources[B][M.type][M.source];delete this.workerSources[B][M.type][M.source],G.removeSource!==void 0?G.removeSource(M,L):L()}loadWorkerSource(B,M,L){try{this.self.importScripts(M.url),L()}catch(G){L(G.toString())}}syncRTLPluginState(B,M,L){try{l.plugin.setState(M);const G=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&G!=null){this.self.importScripts(G);const H=l.plugin.isParsed();L(H?void 0:new Error(`RTL Text Plugin failed to import scripts from ${G}`),H)}}catch(G){L(G.toString())}}getAvailableImages(B){let M=this.availableImages[B];return M||(M=[]),M}getLayerIndex(B){let M=this.layerIndexes[B];return M||(M=this.layerIndexes[B]=new ue),M}getWorkerSource(B,M,L){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][M]||(this.workerSources[B][M]={}),!this.workerSources[B][M][L]){const G={send:(H,te,ne)=>{this.actor.send(H,te,ne,B)}};this.workerSources[B][M][L]=new this.workerSourceTypes[M](G,this.getLayerIndex(B),this.getAvailableImages(B))}return this.workerSources[B][M][L]}getDEMWorkerSource(B,M){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][M]||(this.demWorkerSources[B][M]=new gt),this.demWorkerSources[B][M]}enforceCacheSizeLimit(B,M){l.enforceCacheSizeLimit(M)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Tn(self)),Tn}),O(["./shared"],function(l){var W=$;function $(r){return!function(e){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,d,g=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(g);try{d=new Worker(b),u=!0}catch{u=!1}return d&&d.terminate(),URL.revokeObjectURL(b),u}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var u=document.createElement("canvas");u.width=u.height=1;var d=u.getContext("2d");if(!d)return!1;var g=d.getImageData(0,0,1,1);return g&&g.width===u.width}()?(ue[s=e&&e.failIfMajorPerformanceCaveat]===void 0&&(ue[s]=function(u){var d,g=function(b){var I=document.createElement("canvas"),k=Object.create($.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=b,I.getContext("webgl",k)||I.getContext("experimental-webgl",k)}(u);if(!g)return!1;try{d=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!d||g.isContextLost())&&(g.shaderSource(d,"void main() {}"),g.compileShader(d),g.getShaderParameter(d,g.COMPILE_STATUS)===!0)}(s)),ue[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(r)}var ue={};function re(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let s=0;s<r.length;s++)if(!re(r[s],e[s]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const s in r)if(!re(r[s],e[s]))return!1;return!0}return r===e}$.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class Z{static testProp(e){if(!Z.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in Z.docStyle)return e[s];return e[0]}static create(e,s,u){const d=window.document.createElement(e);return s!==void 0&&(d.className=s),u&&u.appendChild(d),d}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){Z.docStyle&&Z.selectProp&&(Z.userSelect=Z.docStyle[Z.selectProp],Z.docStyle[Z.selectProp]="none")}static enableDrag(){Z.docStyle&&Z.selectProp&&(Z.docStyle[Z.selectProp]=Z.userSelect)}static setTransform(e,s){e.style[Z.transformProp]=s}static addEventListener(e,s,u,d={}){e.addEventListener(s,u,"passive"in d?d:d.capture)}static removeEventListener(e,s,u,d={}){e.removeEventListener(s,u,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Z.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Z.suppressClickInternal,!0)},0)}static mousePos(e,s){const u=e.getBoundingClientRect();return new l.pointGeometry(s.clientX-u.left-e.clientLeft,s.clientY-u.top-e.clientTop)}static touchPos(e,s){const u=e.getBoundingClientRect(),d=[];for(let g=0;g<s.length;g++)d.push(new l.pointGeometry(s[g].clientX-u.left-e.clientLeft,s[g].clientY-u.top-e.clientTop));return d}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}Z.docStyle=typeof window!="undefined"&&window.document&&window.document.documentElement.style,Z.selectProp=Z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Z.transformProp=Z.testProp(["transform","WebkitTransform"]);class me{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}normalizeSpriteURL(e,s,u){const d=function(g){const b=g.match(_e);if(!b)throw new Error(`Unable to parse URL "${g}"`);return{protocol:b[1],authority:b[2],path:b[3]||"/",params:b[4]?b[4].split("&"):[]}}(e);return d.path+=`${s}${u}`,function(g){const b=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${b}`}(d)}setTransformRequest(e){this._transformRequestFn=e}}const _e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class Fe{constructor(e,s,u,d){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(s,d)}update(e,s,u){const{width:d,height:g}=e,b=!(this.size&&this.size[0]===d&&this.size[1]===g||u),{context:I}=this,{gl:k}=I;if(this.useMipmap=Boolean(s&&s.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!s||s.premultiply!==!1)),b)this.size=[d,g],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.isImageBitmap(e)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,e):k.texImage2D(k.TEXTURE_2D,0,this.format,d,g,0,this.format,k.UNSIGNED_BYTE,e.data);else{const{x:D,y:F}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.isImageBitmap(e)?k.texSubImage2D(k.TEXTURE_2D,0,D,F,k.RGBA,k.UNSIGNED_BYTE,e):k.texSubImage2D(k.TEXTURE_2D,0,D,F,d,g,k.RGBA,k.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(e,s,u){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),u!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=g.LINEAR),e!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,u||e),this.filter=e),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function gt(r){const{userImage:e}=r;return!!(e&&e.render&&e.render())&&(r.data.replace(new Uint8Array(e.data.buffer)),!0)}class zt extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,callback:u}of this.requestors)this._notify(s,u);this.requestors=[]}}getImage(e){return this.images[e]}addImage(e,s){this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let u=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new l.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,s){if(!e)return!0;let u=0;for(const d of e){if(d[0]<u||d[1]<d[0]||s<d[1])return!1;u=d[1]}return!0}_validateContent(e,s){return!(e&&(e.length!==4||e[0]<0||s.data.width<e[0]||e[1]<0||s.data.height<e[1]||e[2]<0||s.data.width<e[2]||e[3]<0||s.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,s){s.version=this.images[e].version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,s){let u=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(u=!1);this.isLoaded()||u?this._notify(e,s):this.requestors.push({ids:e,callback:s})}_notify(e,s){const u={};for(const d of e){this.images[d]||this.fire(new l.Event("styleimagemissing",{id:d}));const g=this.images[d];g?u[d]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:l.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,u)}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],u=this.getImage(e);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},g=new l.ImagePosition(d,u);this.patterns[e]={bin:d,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Fe(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:s,h:u}=l.potpack(e),d=this.atlasImage;d.resize({width:s||1,height:u||1});for(const g in this.patterns){const{bin:b}=this.patterns[g],I=b.x+1,k=b.y+1,D=this.images[g].data,F=D.width,j=D.height;l.RGBAImage.copy(D,d,{x:0,y:0},{x:I,y:k},{width:F,height:j}),l.RGBAImage.copy(D,d,{x:0,y:j-1},{x:I,y:k-1},{width:F,height:1}),l.RGBAImage.copy(D,d,{x:0,y:0},{x:I,y:k+j},{width:F,height:1}),l.RGBAImage.copy(D,d,{x:F-1,y:0},{x:I-1,y:k},{width:1,height:j}),l.RGBAImage.copy(D,d,{x:0,y:0},{x:I+F,y:k},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.images[s];gt(u)&&this.updateImage(s,u)}}}const Ct=1e20;function it(r,e,s,u,d,g,b,I,k){for(let D=e;D<e+u;D++)je(r,s*g+D,g,d,b,I,k);for(let D=s;D<s+d;D++)je(r,D*g+e,1,u,b,I,k)}function je(r,e,s,u,d,g,b){g[0]=0,b[0]=-Ct,b[1]=Ct,d[0]=r[e];for(let I=1,k=0,D=0;I<u;I++){d[I]=r[e+I*s];const F=I*I;do{const j=g[k];D=(d[I]-d[j]+F-j*j)/(I-j)/2}while(D<=b[k]&&--k>-1);k++,g[k]=I,b[k]=D,b[k+1]=Ct}for(let I=0,k=0;I<u;I++){for(;b[k+1]<I;)k++;const D=g[k],F=I-D;r[e+I*s]=d[D]+F*F}}class nt{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e,s){const u=[];for(const d in e)for(const g of e[d])u.push({stack:d,id:g});l.asyncAll(u,({stack:d,id:g},b)=>{let I=this.entries[d];I||(I=this.entries[d]={glyphs:{},requests:{},ranges:{}});let k=I.glyphs[g];if(k!==void 0)return void b(null,{stack:d,id:g,glyph:k});if(k=this._tinySDF(I,d,g),k)return I.glyphs[g]=k,void b(null,{stack:d,id:g,glyph:k});const D=Math.floor(g/256);if(256*D>65535)return void b(new Error("glyphs > 65535 not supported"));if(I.ranges[D])return void b(null,{stack:d,id:g,glyph:k});let F=I.requests[D];F||(F=I.requests[D]=[],nt.loadGlyphRange(d,D,this.url,this.requestManager,(j,N)=>{if(N){for(const K in N)this._doesCharSupportLocalGlyph(+K)||(I.glyphs[+K]=N[+K]);I.ranges[D]=!0}for(const K of F)K(j,N);delete I.requests[D]})),F.push((j,N)=>{j?b(j):N&&b(null,{stack:d,id:g,glyph:N[g]||null})})},(d,g)=>{if(d)s(d);else if(g){const b={};for(const{stack:I,id:k,glyph:D}of g)(b[I]||(b[I]={}))[k]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};s(null,b)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](e)||l.unicodeBlockLookup["Hangul Syllables"](e)||l.unicodeBlockLookup.Hiragana(e)||l.unicodeBlockLookup.Katakana(e))}_tinySDF(e,s,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let g=e.tinySDF;if(!g){let I="400";/bold/i.test(s)?I="900":/medium/i.test(s)?I="500":/light/i.test(s)&&(I="200"),g=e.tinySDF=new nt.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:d,fontWeight:I})}const b=g.draw(String.fromCharCode(u));return{id:u,bitmap:new l.AlphaImage({width:b.width||30,height:b.height||30},b.data),metrics:{width:b.glyphWidth||24,height:b.glyphHeight||24,left:b.glyphLeft||0,top:b.glyphTop-27||-8,advance:b.glyphAdvance||24}}}}nt.loadGlyphRange=function(r,e,s,u,d){const g=256*e,b=g+255,I=u.transformRequest(s.replace("{fontstack}",r).replace("{range}",`${g}-${b}`),l.ResourceType.Glyphs);l.getArrayBuffer(I,(k,D)=>{if(k)d(k);else if(D){const F={};for(const j of l.parseGlyphPbf(D))F[j.id]=j;d(null,F)}})},nt.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:s=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:b="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=s;const I=this.size=r+4*e,k=this._createCanvas(I),D=this.ctx=k.getContext("2d",{willReadFrequently:!0});D.font=`${b} ${g} ${r}px ${d}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(r),b=Math.ceil(s),I=Math.min(this.size-this.buffer,Math.ceil(g-d)),k=Math.min(this.size-this.buffer,b+Math.ceil(u)),D=I+2*this.buffer,F=k+2*this.buffer,j=Math.max(D*F,0),N=new Uint8ClampedArray(j),K={data:N,width:D,height:F,glyphWidth:I,glyphHeight:k,glyphTop:b,glyphLeft:0,glyphAdvance:e};if(I===0||k===0)return K;const{ctx:J,buffer:ee,gridInner:le,gridOuter:ce}=this;J.clearRect(ee,ee,I,k),J.fillText(r,ee,ee+b);const ye=J.getImageData(ee,ee,I,k);ce.fill(Ct,0,j),le.fill(0,0,j);for(let oe=0;oe<k;oe++)for(let ve=0;ve<I;ve++){const be=ye.data[4*(oe*I+ve)+3]/255;if(be===0)continue;const ze=(oe+ee)*D+ve+ee;if(be===1)ce[ze]=0,le[ze]=Ct;else{const we=.5-be;ce[ze]=we>0?we*we:0,le[ze]=we<0?we*we:0}}it(ce,0,0,D,F,D,this.f,this.v,this.z),it(le,ee,ee,I,k,D,this.f,this.v,this.z);for(let oe=0;oe<j;oe++){const ve=Math.sqrt(ce[oe])-Math.sqrt(le[oe]);N[oe]=Math.round(255-255*(ve/this.radius+this.cutoff))}return K}};const ct=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(r,e){return l.sphericalToCartesian(r.expression.evaluate(e))}interpolate(r,e,s){return{x:l.number(r.x,e.x,s),y:l.number(r.y,e.y,s),z:l.number(r.z,e.z,s)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Xe="-transition";class at extends l.Evented{constructor(e){super(),this._transitionable=new l.Transitionable(ct),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(l.validateLight,e,s))for(const u in e){const d=e[u];u.endsWith(Xe)?this._transitionable.setTransition(u.slice(0,-Xe.length),d):this._transitionable.setValue(u,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u){return(!u||u.validate!==!1)&&l.emitValidationErrors(this,e.call(l.validateStyle,l.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class rt{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const u=e.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,s)),this.dashEntry[u]}getDashRanges(e,s,u){const d=[];let g=e.length%2==1?-e[e.length-1]*u:0,b=e[0]*u,I=!0;d.push({left:g,right:b,isDash:I,zeroLength:e[0]===0});let k=e[0];for(let D=1;D<e.length;D++){I=!I;const F=e[D];g=k*u,k+=F,b=k*u,d.push({left:g,right:b,isDash:I,zeroLength:F===0})}return d}addRoundDash(e,s,u){const d=s/2;for(let g=-u;g<=u;g++){const b=this.width*(this.nextRow+u+g);let I=0,k=e[I];for(let D=0;D<this.width;D++){D/k.right>1&&(k=e[++I]);const F=Math.abs(D-k.left),j=Math.abs(D-k.right),N=Math.min(F,j);let K;const J=g/u*(d+1);if(k.isDash){const ee=d-Math.abs(J);K=Math.sqrt(N*N+ee*ee)}else K=d-Math.sqrt(N*N+J*J);this.data[b+D]=Math.max(0,Math.min(255,K+128))}}}addRegularDash(e){for(let I=e.length-1;I>=0;--I){const k=e[I],D=e[I+1];k.zeroLength?e.splice(I,1):D&&D.isDash===k.isDash&&(D.left=k.left,e.splice(I,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const d=this.width*this.nextRow;let g=0,b=e[g];for(let I=0;I<this.width;I++){I/b.right>1&&(b=e[++g]);const k=Math.abs(I-b.left),D=Math.abs(I-b.right),F=Math.min(k,D);this.data[d+I]=Math.max(0,Math.min(255,(b.isDash?F:-F)+128))}}addDash(e,s){const u=s?7:0,d=2*u+1;if(this.nextRow+d>this.height)return l.warnOnce("LineAtlas out of space"),null;let g=0;for(let I=0;I<e.length;I++)g+=e[I];if(g!==0){const I=this.width/g,k=this.getDashRanges(e,this.width,I);s?this.addRoundDash(k,I,u):this.addRegularDash(k)}const b={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:g};return this.nextRow+=d,this.dirty=!0,b}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class Oe{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const u=this.workerPool.acquire(this.id);for(let d=0;d<u.length;d++){const g=new Oe.Actor(u[d],s,this.id);g.name=`Worker ${d}`,this.actors.push(g)}}broadcast(e,s,u){l.asyncAll(this.actors,(d,g)=>{d.send(e,s,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}function bt(r,e,s){const u=function(d,g){if(d)return s(d);if(g){const b=l.pick(l.extend(g,r),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(b.vectorLayers=g.vector_layers,b.vectorLayerIds=b.vectorLayers.map(I=>I.id)),s(null,b)}};return r.url?l.getJSON(e.transformRequest(r.url,l.ResourceType.Source),u):l.exported.frame(()=>u(null,r))}Oe.Actor=l.Actor;class We{constructor(e,s,u){this.bounds=l.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),u=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*s),d=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*s),g=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*s),b=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*s);return e.x>=u&&e.x<g&&e.y>=d&&e.y<b}}class ft extends l.Evented{constructor(e,s,u,d){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(s,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bt(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e?this.fire(new l.ErrorEvent(e)):s&&(l.extend(this,s),s.bounds&&(this.tileBounds=new We(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(e,s){const u=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(u,l.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(b,I){return delete e.request,e.aborted?s(null):b&&b.status!==404?s(b):(I&&I.resourceTiming&&(e.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&e.setExpiryData(I),e.loadVectorData(I,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}d.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired"?e.state==="loading"?e.reloadCallback=s:e.request=e.actor.send("reloadTile",d,g.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",d,g.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class wt extends l.Evented{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},s),l.extend(this,l.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bt(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new l.ErrorEvent(e)):s&&(l.extend(this,s),s.bounds&&(this.tileBounds=new We(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,s){const u=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=l.getImage(this.map._requestManager.transformRequest(u,l.ResourceType.Tile),(d,g,b)=>{if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(d)e.state="errored",s(d);else if(g){this.map._refreshExpiredTiles&&e.setExpiryData(b);const I=this.map.painter.context,k=I.gl;e.texture=this.map.painter.getTileTexture(g.width),e.texture?e.texture.update(g,{useMipmap:!0}):(e.texture=new Fe(I,g,k.RGBA,{useMipmap:!0}),e.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),I.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax)),e.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(e,s){e.request&&(e.request.cancel(),delete e.request),s()}unloadTile(e,s){e.texture&&this.map.painter.saveTileTexture(e.texture),s()}hasTransition(){return!1}}let Ze;class De extends wt{constructor(e,s,u,d){super(e,s,u,d),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(e,s){const u=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function d(g,b){g&&(e.state="errored",s(g)),b&&(e.dem=b,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",s(null))}e.request=l.getImage(this.map._requestManager.transformRequest(u,l.ResourceType.Tile),function(g,b){if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(g)e.state="errored",s(g);else if(b){this.map._refreshExpiredTiles&&e.setExpiryData(b),delete b.cacheControl,delete b.expires;const I=l.isImageBitmap(b)&&(Ze==null&&(Ze=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ze)?b:l.exported.getImageData(b,1),k={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:I,encoding:this.encoding};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",k,d.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)}_getNeighboringTiles(e){const s=e.canonical,u=Math.pow(2,s.z),d=(s.x-1+u)%u,g=s.x===0?e.wrap-1:e.wrap,b=(s.x+1+u)%u,I=s.x+1===u?e.wrap+1:e.wrap,k={};return k[new l.OverscaledTileID(e.overscaledZ,g,s.z,d,s.y).key]={backfilled:!1},k[new l.OverscaledTileID(e.overscaledZ,I,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(k[new l.OverscaledTileID(e.overscaledZ,g,s.z,d,s.y-1).key]={backfilled:!1},k[new l.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},k[new l.OverscaledTileID(e.overscaledZ,I,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<u&&(k[new l.OverscaledTileID(e.overscaledZ,g,s.z,d,s.y+1).key]={backfilled:!1},k[new l.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},k[new l.OverscaledTileID(e.overscaledZ,I,s.z,b,s.y+1).key]={backfilled:!1}),k}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class Wt extends l.Evented{constructor(e,s,u,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(d),this._data=s.data,this._options=l.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const g=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*g,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*g,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.EXTENT,radius:(s.clusterRadius||50)*g,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData("content"),this}getClusterExpansionZoom(e,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},s),this}getClusterChildren(e,s){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},s),this}getClusterLeaves(e,s,u,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:s,offset:u},d),this}_updateWorkerData(e){const s=l.extend({},this.workerOptions),u=this._data;typeof u=="string"?(s.request=this.map._requestManager.transformRequest(l.exported.resolveURL(u),l.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(u),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(d,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:e}));let b=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(b=g.resourceTiming[this.id].slice(0)),d)return void this.fire(new l.ErrorEvent(d));const I={dataType:"source",sourceDataType:e};this._collectResourceTiming&&b&&b.length>0&&l.extend(I,{resourceTiming:b}),this.fire(new l.Event("data",I))})}loaded(){return this._pendingLoads===0}loadTile(e,s){const u=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const d={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(u,d,(g,b)=>(delete e.request,e.unloadVectorData(),e.aborted?s(null):g?s(g):(e.loadVectorData(b,this.map.painter,u==="reloadTile"),s(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var si=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vt extends l.Evented{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s}load(e,s){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(u,d)=>{this._loaded=!0,u?this.fire(new l.ErrorEvent(u)):d&&(this.image=d,e&&(this.coordinates=e),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}setCoordinates(e){this.coordinates=e;const s=e.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(d){let g=1/0,b=1/0,I=-1/0,k=-1/0;for(const N of d)g=Math.min(g,N.x),b=Math.min(b,N.y),I=Math.max(I,N.x),k=Math.max(k,N.y);const D=Math.max(I-g,k-b),F=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),j=Math.pow(2,F);return new l.CanonicalTileID(F,Math.floor((g+I)/2*j),Math.floor((b+k)/2*j))}(s),this.minzoom=this.maxzoom=this.tileID.z;const u=s.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(u[2].x,u[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Fe(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ht extends vt{constructor(e,s,u,d){super(e,s,u,d),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,l.ResourceType.Source).url);l.getVideo(this.urls,(s,u)=>{this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):u&&(this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new Fe(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class gi extends vt{constructor(e,s,u,d){super(e,s,u,d),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(b=>typeof b!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,si.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Fe(s,this.canvas,u.RGBA,{premultiply:!0});for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ui={vector:ft,raster:wt,"raster-dem":De,geojson:Wt,video:Ht,image:vt,canvas:gi};function Ci(r,e){const s=l.create();return l.translate(s,s,[1,1,0]),l.scale(s,s,[.5*r.width,.5*r.height,1]),l.multiply(s,s,r.calculatePosMatrix(e.toUnwrapped()))}function fi(r,e,s,u,d,g){const b=function(j,N,K){if(j)for(const J of j){const ee=N[J];if(ee&&ee.source===K&&ee.type==="fill-extrusion")return!0}else for(const J in N){const ee=N[J];if(ee.source===K&&ee.type==="fill-extrusion")return!0}return!1}(d&&d.layers,e,r.id),I=g.maxPitchScaleFactor(),k=r.tilesIn(u,I,b);k.sort(ei);const D=[];for(const j of k)D.push({wrappedTileID:j.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(e,s,r._state,j.queryGeometry,j.cameraQueryGeometry,j.scale,d,g,I,Ci(r.transform,j.tileID))});const F=function(j){const N={},K={};for(const J of j){const ee=J.queryResults,le=J.wrappedTileID,ce=K[le]=K[le]||{};for(const ye in ee){const oe=ee[ye],ve=ce[ye]=ce[ye]||{},be=N[ye]=N[ye]||[];for(const ze of oe)ve[ze.featureIndex]||(ve[ze.featureIndex]=!0,be.push(ze))}}return N}(D);for(const j in F)F[j].forEach(N=>{const K=N.feature,J=r.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=J});return F}function ei(r,e){const s=r.tileID,u=e.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}class _i{constructor(e,s){this.tileID=e,this.uid=l.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<l.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.textures.forEach(s=>e.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(e,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,g){const b={};if(!g)return b;for(const I of d){const k=I.layerIds.map(D=>g.getLayer(D)).filter(Boolean);if(k.length!==0){I.layers=k,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(D=>k.filter(F=>F.id===D)[0]));for(const D of k)b[D.id]=I}}return b}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const g=this.buckets[d];if(g instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const g=this.buckets[d];if(g instanceof l.SymbolBucket&&g.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const d in this.buckets){const g=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Fe(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Fe(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,u,d,g,b,I,k,D,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:g,scale:b,tileSize:this.tileSize,pixelPosMatrix:F,transform:k,params:I,queryPadding:this.queryPadding*D},e,s,u):{}}querySourceFeatures(e,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),g=s?s.sourceLayer:"",b=d._geojsonTileLayer||d[g];if(!b)return;const I=l.createFilter(s&&s.filter),{z:k,x:D,y:F}=this.tileID.canonical,j={z:k,x:D,y:F};for(let N=0;N<b.length;N++){const K=b.feature(N);if(I.needGeometry){const le=l.toEvaluationFeature(K,!0);if(!I.filter(new l.EvaluationParameters(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!I.filter(new l.EvaluationParameters(this.tileID.overscaledZ),K))continue;const J=u.getId(K,g),ee=new l.GeoJSONFeature(K,k,D,F,J);ee.tile=j,e.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const u=l.parseCacheControl(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const g=this.expirationTime-s;g?this.expirationTime=u+Math.max(g,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!s.style.hasLayer(d))continue;const g=this.buckets[d],b=g.layers[0].sourceLayer||"_geojsonTileLayer",I=u[b],k=e[b];if(!I||!k||Object.keys(k).length===0)continue;g.update(k,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=s&&s.style&&s.style.getLayer(d);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=l.exported.now()+e}setDependencies(e,s){const u={};for(const d of s)u[d]=!0;this.dependencies[e]=u}hasDependency(e,s){for(const u of e){const d=this.dependencies[u];if(d){for(const g of s)if(d[g])return!0}}return!1}}class $i{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,u){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const g={value:s,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},u)),this.data[d].push(g),this.order.push(d),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const u=e.wrapped().key,d=s===void 0?0:this.data[u].indexOf(s),g=this.data[u][d];return this.data[u].splice(d,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const u in this.data)for(const d of this.data[u])e(d.value)||s.push(d);for(const u of s)this.remove(u.value.tileID,u)}}class lt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,u){const d=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},l.extend(this.stateChanges[e][d],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==d&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const g in this.state[e][d])u[g]||(this.deletedStates[e][d][g]=null)}else for(const g in u)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][g]===null&&delete this.deletedStates[e][d][g]}removeFeatureState(e,s,u){if(this.deletedStates[e]===null)return;const d=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&s!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][u]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(u in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][u]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,s){const u=String(s),d=l.extend({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][s];if(g===null)return{};for(const b in g)delete d[b]}return d}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const g={};for(const b in this.stateChanges[d])this.state[d][b]||(this.state[d][b]={}),l.extend(this.state[d][b],this.stateChanges[d][b]),g[b]=this.state[d][b];u[d]=g}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const g={};if(this.deletedStates[d]===null)for(const b in this.state[d])g[b]={},this.state[d][b]={};else for(const b in this.deletedStates[d]){if(this.deletedStates[d][b]===null)this.state[d][b]={};else for(const I of Object.keys(this.deletedStates[d][b]))delete this.state[d][b][I];g[b]=this.state[d][b]}u[d]=u[d]||{},l.extend(u[d],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in e)e[d].setFeatureState(u,s)}}class $e extends l.Evented{constructor(e,s,u){super(),this.id=e,this.dispatcher=u,this.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(d,g,b,I){const k=new ui[g.type](d,g,b,I);if(k.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${k.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],k),k}(e,s,u,this),this._tiles={},this._cache=new $i(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new lt}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s){return this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,()=>{}),this._source.fire(new l.Event("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(di).map(e=>e.key)}getRenderableIds(e){const s=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&s.push(this._tiles[u]);return e?s.sort((u,d)=>{const g=u.tileID,b=d.tileID,I=new l.pointGeometry(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),k=new l.pointGeometry(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-b.overscaledZ||k.y-I.y||k.x-I.x}).map(u=>u.tileID.key):s.map(u=>u.tileID).sort(di).map(u=>u.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=s),this._loadTile(u,this._tileLoaded.bind(this,u,e,s)))}_tileLoaded(e,s,u,d){if(d)return e.state="errored",void(d.status!==404?this._source.fire(new l.ErrorEvent(d,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=l.exported.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const g=s[d];if(e.neighboringTiles&&e.neighboringTiles[g]){const b=this.getTileByID(g);u(e,b),u(b,e)}}function u(d,g){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let b=g.tileID.canonical.x-d.tileID.canonical.x;const I=g.tileID.canonical.y-d.tileID.canonical.y,k=Math.pow(2,d.tileID.canonical.z),D=g.tileID.key;b===0&&I===0||Math.abs(I)>1||(Math.abs(b)>1&&(Math.abs(b+k)===1?b+=k:Math.abs(b-k)===1&&(b-=k)),g.dem&&d.dem&&(d.dem.backfillBorder(g.dem,b,I),d.neighboringTiles&&d.neighboringTiles[D]&&(d.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,u,d){for(const g in this._tiles){let b=this._tiles[g];if(d[g]||!b.hasData()||b.tileID.overscaledZ<=s||b.tileID.overscaledZ>u)continue;let I=b.tileID;for(;b&&b.tileID.overscaledZ>s+1;){const D=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[D.key],b&&b.hasData()&&(I=D)}let k=I;for(;k.overscaledZ>s;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]){d[I.key]=I;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=e.overscaledZ-1;u>=s;u--){const d=e.scaledTo(u),g=this._getLoadedTile(d);if(g)return g}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(s*u*5),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(g)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const u={};for(const d in this._tiles){const g=this._tiles[d];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),u[g.tileID.key]=g}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}update(e,s){if(this.transform=e,this.terrain=s,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new l.OverscaledTileID(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(u=u.filter(D=>this._source.hasTile(D)))):u=[];const d=e.coveringZoomLevel(this._source),g=Math.max(d-$e.maxOverzooming,this._source.minzoom),b=Math.max(d+$e.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const F of u)if(F.canonical.z>this._source.minzoom){const j=F.scaledTo(F.canonical.z-1);D[j.key]=j;const N=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));D[N.key]=N}u=u.concat(Object.values(D))}const I=this._updateRetainedTiles(u,d);if(Ui(this._source.type)){const D={},F={},j=Object.keys(I);for(const N of j){const K=I[N],J=this._tiles[N];if(!J||J.fadeEndTime&&J.fadeEndTime<=l.exported.now())continue;const ee=this.findLoadedParent(K,g);ee&&(this._addTile(ee.tileID),D[ee.tileID.key]=ee.tileID),F[N]=K}this._retainLoadedChildren(F,d,b,I);for(const N in D)I[N]||(this._coveredTiles[N]=!0,I[N]=D[N]);if(s){const N={},K={};for(const J of u)this._tiles[J.key].hasData()?N[J.key]=J:K[J.key]=J;for(const J in K){const ee=K[J].children(this._source.maxzoom);this._tiles[ee[0].key]&&this._tiles[ee[1].key]&&this._tiles[ee[2].key]&&this._tiles[ee[3].key]&&(N[ee[0].key]=I[ee[0].key]=ee[0],N[ee[1].key]=I[ee[1].key]=ee[1],N[ee[2].key]=I[ee[2].key]=ee[2],N[ee[3].key]=I[ee[3].key]=ee[3],delete K[J])}for(const J in K){const ee=this.findLoadedParent(K[J],this._source.minzoom);if(ee){N[ee.tileID.key]=I[ee.tileID.key]=ee.tileID;for(const le in N)N[le].isChildOf(ee.tileID)&&delete N[le]}}for(const J in this._tiles)N[J]||(this._coveredTiles[J]=!0)}}for(const D in I)this._tiles[D].clearFadeHold();const k=l.keysDifference(this._tiles,I);for(const D of k){const F=this._tiles[D];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){const u={},d={},g=Math.max(s-$e.maxOverzooming,this._source.minzoom),b=Math.max(s+$e.maxUnderzooming,this._source.minzoom),I={};for(const k of e){const D=this._addTile(k);u[k.key]=k,D.hasData()||s<this._source.maxzoom&&(I[k.key]=k)}this._retainLoadedChildren(I,s,b,u);for(const k of e){let D=this._tiles[k.key];if(D.hasData())continue;if(s+1>this._source.maxzoom){const j=k.children(this._source.maxzoom)[0],N=this.getTile(j);if(N&&N.hasData()){u[j.key]=j;continue}}else{const j=k.children(this._source.maxzoom);if(u[j[0].key]&&u[j[1].key]&&u[j[2].key]&&u[j[3].key])continue}let F=D.wasRequested();for(let j=k.overscaledZ-1;j>=g;--j){const N=k.scaledTo(j);if(d[N.key]||(d[N.key]=!0,D=this.getTile(N),!D&&F&&(D=this._addTile(N)),D&&(u[N.key]=N,F=D.wasRequested(),D.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let u,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}s.push(d.key);const g=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;d=g}for(const g of s)this._loadedParentTiles[g]=u}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const u=s;return s||(s=new _i(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))),s.uses++,this._tiles[e.key]=s,u||this._source.fire(new l.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=s.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,u){const d=[],g=this.transform;if(!g)return d;const b=u?g.getCameraQueryGeometry(e):e,I=e.map(J=>g.pointCoordinate(J,this.terrain)),k=b.map(J=>g.pointCoordinate(J,this.terrain)),D=this.getIds();let F=1/0,j=1/0,N=-1/0,K=-1/0;for(const J of k)F=Math.min(F,J.x),j=Math.min(j,J.y),N=Math.max(N,J.x),K=Math.max(K,J.y);for(let J=0;J<D.length;J++){const ee=this._tiles[D[J]];if(ee.holdingForFade())continue;const le=ee.tileID,ce=Math.pow(2,g.zoom-ee.tileID.overscaledZ),ye=s*ee.queryPadding*l.EXTENT/ee.tileSize/ce,oe=[le.getTilePoint(new l.MercatorCoordinate(F,j)),le.getTilePoint(new l.MercatorCoordinate(N,K))];if(oe[0].x-ye<l.EXTENT&&oe[0].y-ye<l.EXTENT&&oe[1].x+ye>=0&&oe[1].y+ye>=0){const ve=I.map(ze=>le.getTilePoint(ze)),be=k.map(ze=>le.getTilePoint(ze));d.push({tile:ee,tileID:le,queryGeometry:ve,cameraQueryGeometry:be,scale:ce})}}return d}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of s)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Ui(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(e,s,u){this._state.updateState(e=e||"_geojsonTileLayer",s,u)}removeFeatureState(e,s,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,u)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,u){const d=this._tiles[e];d&&d.setDependencies(s,u)}reloadTilesForDependencies(e,s){for(const u in this._tiles)this._tiles[u].hasDependency(e,s)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,s))}}function di(r,e){const s=Math.abs(2*r.wrap)-+(r.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||u-s||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function Ui(r){return r==="raster"||r==="image"||r==="video"}$e.maxOverzooming=10,$e.maxUnderzooming=3;const Mr="mapboxgl_preloaded_worker_pool";class Ai{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ai.workerCount;)this.workers.push(new Worker(a.workerUrl));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mr]}numActive(){return Object.keys(this.active).length}}const gr=Math.floor(l.exported.hardwareConcurrency/2);let _r;function Er(){return _r||(_r=new Ai),_r}function Dr(r,e){const s={};for(const u in r)u!=="ref"&&(s[u]=r[u]);return l.refProperties.forEach(u=>{u in e&&(s[u]=e[u])}),s}function Jr(r){r=r.slice();const e=Object.create(null);for(let s=0;s<r.length;s++)e[r[s].id]=r[s];for(let s=0;s<r.length;s++)"ref"in r[s]&&(r[s]=Dr(r[s],e[r[s].ref]));return r}Ai.workerCount=Math.max(Math.min(gr,6),1);const bi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function br(r,e,s){s.push({command:bi.addSource,args:[r,e[r]]})}function cr(r,e,s){e.push({command:bi.removeSource,args:[r]}),s[r]=!0}function Hi(r,e,s,u){cr(r,s,u),br(r,e,s)}function Qt(r,e,s){let u;for(u in r[s])if(Object.prototype.hasOwnProperty.call(r[s],u)&&u!=="data"&&!re(r[s][u],e[s][u]))return!1;for(u in e[s])if(Object.prototype.hasOwnProperty.call(e[s],u)&&u!=="data"&&!re(r[s][u],e[s][u]))return!1;return!0}function tr(r,e,s,u,d,g){let b;for(b in e=e||{},r=r||{})Object.prototype.hasOwnProperty.call(r,b)&&(re(r[b],e[b])||s.push({command:g,args:[u,b,e[b],d]}));for(b in e)Object.prototype.hasOwnProperty.call(e,b)&&!Object.prototype.hasOwnProperty.call(r,b)&&(re(r[b],e[b])||s.push({command:g,args:[u,b,e[b],d]}))}function Di(r){return r.id}function jt(r,e){return r[e.id]=e,r}class Vi{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.clamp(e,0,1);let s=1,u=this._distances[s];const d=e*this.paddedLength+this.padding;for(;u<d&&s<this._distances.length;)u=this._distances[++s];const g=s-1,b=this._distances[g],I=u-b,k=I>0?(d-b)/I:0;return this.points[g].mult(1-k).add(this.points[s].mult(k))}}function ae(r,e){let s=!0;return r==="always"||r!=="never"&&e!=="never"||(s=!1),s}class Ae{constructor(e,s,u){const d=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(s/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)d.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,u,d,g){this._forEachCell(s,u,d,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(g)}insertCircle(e,s,u,d){this._forEachCell(s-d,u-d,s+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(u),this.circles.push(d)}_insertBoxCell(e,s,u,d,g,b){this.boxCells[g].push(b)}_insertCircleCell(e,s,u,d,g,b){this.circleCells[g].push(b)}_query(e,s,u,d,g,b,I){if(u<0||e>this.width||d<0||s>this.height)return[];const k=[];if(e<=0&&s<=0&&this.width<=u&&this.height<=d){if(g)return[{key:null,x1:e,y1:s,x2:u,y2:d}];for(let D=0;D<this.boxKeys.length;D++)k.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const F=this.circles[3*D],j=this.circles[3*D+1],N=this.circles[3*D+2];k.push({key:this.circleKeys[D],x1:F-N,y1:j-N,x2:F+N,y2:j+N})}}else this._forEachCell(e,s,u,d,this._queryCell,k,{hitTest:g,overlapMode:b,seenUids:{box:{},circle:{}}},I);return k}query(e,s,u,d){return this._query(e,s,u,d,!1,null)}hitTest(e,s,u,d,g,b){return this._query(e,s,u,d,!0,g,b).length>0}hitTestCircle(e,s,u,d,g){const b=e-u,I=e+u,k=s-u,D=s+u;if(I<0||b>this.width||D<0||k>this.height)return!1;const F=[];return this._forEachCell(b,k,I,D,this._queryCellCircle,F,{hitTest:!0,overlapMode:d,circle:{x:e,y:s,radius:u},seenUids:{box:{},circle:{}}},g),F.length>0}_queryCell(e,s,u,d,g,b,I,k){const{seenUids:D,hitTest:F,overlapMode:j}=I,N=this.boxCells[g];if(N!==null){const J=this.bboxes;for(const ee of N)if(!D.box[ee]){D.box[ee]=!0;const le=4*ee,ce=this.boxKeys[ee];if(e<=J[le+2]&&s<=J[le+3]&&u>=J[le+0]&&d>=J[le+1]&&(!k||k(ce))&&(!F||!ae(j,ce.overlapMode))&&(b.push({key:ce,x1:J[le],y1:J[le+1],x2:J[le+2],y2:J[le+3]}),F))return!0}}const K=this.circleCells[g];if(K!==null){const J=this.circles;for(const ee of K)if(!D.circle[ee]){D.circle[ee]=!0;const le=3*ee,ce=this.circleKeys[ee];if(this._circleAndRectCollide(J[le],J[le+1],J[le+2],e,s,u,d)&&(!k||k(ce))&&(!F||!ae(j,ce.overlapMode))){const ye=J[le],oe=J[le+1],ve=J[le+2];if(b.push({key:ce,x1:ye-ve,y1:oe-ve,x2:ye+ve,y2:oe+ve}),F)return!0}}}return!1}_queryCellCircle(e,s,u,d,g,b,I,k){const{circle:D,seenUids:F,overlapMode:j}=I,N=this.boxCells[g];if(N!==null){const J=this.bboxes;for(const ee of N)if(!F.box[ee]){F.box[ee]=!0;const le=4*ee,ce=this.boxKeys[ee];if(this._circleAndRectCollide(D.x,D.y,D.radius,J[le+0],J[le+1],J[le+2],J[le+3])&&(!k||k(ce))&&!ae(j,ce.overlapMode))return b.push(!0),!0}}const K=this.circleCells[g];if(K!==null){const J=this.circles;for(const ee of K)if(!F.circle[ee]){F.circle[ee]=!0;const le=3*ee,ce=this.circleKeys[ee];if(this._circlesCollide(J[le],J[le+1],J[le+2],D.x,D.y,D.radius)&&(!k||k(ce))&&!ae(j,ce.overlapMode))return b.push(!0),!0}}}_forEachCell(e,s,u,d,g,b,I,k){const D=this._convertToXCellCoord(e),F=this._convertToYCellCoord(s),j=this._convertToXCellCoord(u),N=this._convertToYCellCoord(d);for(let K=D;K<=j;K++)for(let J=F;J<=N;J++)if(g.call(this,e,s,u,d,this.xCellCount*J+K,b,I,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,u,d,g,b){const I=d-e,k=g-s,D=u+b;return D*D>I*I+k*k}_circleAndRectCollide(e,s,u,d,g,b,I){const k=(b-d)/2,D=Math.abs(e-(d+k));if(D>k+u)return!1;const F=(I-g)/2,j=Math.abs(s-(g+F));if(j>F+u)return!1;if(D<=k||j<=F)return!0;const N=D-k,K=j-F;return N*N+K*K<=u*u}}function $r(r,e,s,u,d){const g=l.create();return e?(l.scale(g,g,[1/d,1/d,1]),s||l.rotateZ(g,g,u.angle)):l.multiply(g,u.labelPlaneMatrix,r),g}function yr(r,e,s,u,d){if(e){const g=l.clone(r);return l.scale(g,g,[d,d,1]),s||l.rotateZ(g,g,-u.angle),g}return u.glCoordMatrix}function Gt(r,e,s){let u;s?(u=[r.x,r.y,s(r.x,r.y),1],l.transformMat4(u,u,e)):(u=[r.x,r.y,0,1],kn(u,u,e));const d=u[3];return{point:new l.pointGeometry(u[0]/d,u[1]/d),signedDistanceFromCamera:d}}function hi(r,e){return .5+r/e*.5}function Ti(r,e){const s=r[0]/r[3],u=r[1]/r[3];return s>=-e[0]&&s<=e[0]&&u>=-e[1]&&u<=e[1]}function xr(r,e,s,u,d,g,b,I,k,D){const F=u?r.textSizeData:r.iconSizeData,j=l.evaluateSizeForZoom(F,s.transform.zoom),N=[256/s.width*2+1,256/s.height*2+1],K=u?r.text.dynamicLayoutVertexArray:r.icon.dynamicLayoutVertexArray;K.clear();const J=r.lineVertexArray,ee=u?r.text.placedSymbolArray:r.icon.placedSymbolArray,le=s.transform.width/s.transform.height;let ce=!1;for(let ye=0;ye<ee.length;ye++){const oe=ee.get(ye);if(oe.hidden||oe.writingMode===l.WritingMode.vertical&&!ce){Mt(oe.numGlyphs,K);continue}let ve;if(ce=!1,D?(ve=[oe.anchorX,oe.anchorY,D(oe.anchorX,oe.anchorY),1],l.transformMat4(ve,ve,e)):(ve=[oe.anchorX,oe.anchorY,0,1],kn(ve,ve,e)),!Ti(ve,N)){Mt(oe.numGlyphs,K);continue}const be=hi(s.transform.cameraToCenterDistance,ve[3]),ze=l.evaluateSizeForFeature(F,j,oe),we=b?ze/be:ze*be,Ne=new l.pointGeometry(oe.anchorX,oe.anchorY),Ce=Gt(Ne,d,D).point,ut={},yt=Dt(oe,we,!1,I,e,d,g,r.glyphOffsetArray,J,K,Ce,Ne,ut,le,k,D);ce=yt.useVertical,(yt.notEnoughRoom||ce||yt.needsFlipping&&Dt(oe,we,!0,I,e,d,g,r.glyphOffsetArray,J,K,Ce,Ne,ut,le,k,D).notEnoughRoom)&&Mt(oe.numGlyphs,K)}u?r.text.dynamicLayoutVertexBuffer.updateData(K):r.icon.dynamicLayoutVertexBuffer.updateData(K)}function Mi(r,e,s,u,d,g,b,I,k,D,F,j,N){const K=I.glyphStartIndex+I.numGlyphs,J=I.lineStartIndex,ee=I.lineStartIndex+I.lineLength,le=e.getoffsetX(I.glyphStartIndex),ce=e.getoffsetX(K-1),ye=Ii(r*le,s,u,d,g,b,I.segment,J,ee,k,D,F,j,N);if(!ye)return null;const oe=Ii(r*ce,s,u,d,g,b,I.segment,J,ee,k,D,F,j,N);return oe?{first:ye,last:oe}:null}function Ve(r,e,s,u){return r===l.WritingMode.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*u?{useVertical:!0}:(r===l.WritingMode.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function Dt(r,e,s,u,d,g,b,I,k,D,F,j,N,K,J,ee){const le=e/24,ce=r.lineOffsetX*le,ye=r.lineOffsetY*le;let oe;if(r.numGlyphs>1){const ve=r.glyphStartIndex+r.numGlyphs,be=r.lineStartIndex,ze=r.lineStartIndex+r.lineLength,we=Mi(le,I,ce,ye,s,F,j,r,k,g,N,J,ee);if(!we)return{notEnoughRoom:!0};const Ne=Gt(we.first.point,b,ee).point,Ce=Gt(we.last.point,b,ee).point;if(u&&!s){const ut=Ve(r.writingMode,Ne,Ce,K);if(ut)return ut}oe=[we.first];for(let ut=r.glyphStartIndex+1;ut<ve-1;ut++)oe.push(Ii(le*I.getoffsetX(ut),ce,ye,s,F,j,r.segment,be,ze,k,g,N,J,ee));oe.push(we.last)}else{if(u&&!s){const be=Gt(j,d,ee).point,ze=r.lineStartIndex+r.segment+1,we=new l.pointGeometry(k.getx(ze),k.gety(ze)),Ne=Gt(we,d,ee),Ce=Ne.signedDistanceFromCamera>0?Ne.point:Pt(j,we,be,1,d,ee),ut=Ve(r.writingMode,be,Ce,K);if(ut)return ut}const ve=Ii(le*I.getoffsetX(r.glyphStartIndex),ce,ye,s,F,j,r.segment,r.lineStartIndex,r.lineStartIndex+r.lineLength,k,g,N,J,ee);if(!ve)return{notEnoughRoom:!0};oe=[ve]}for(const ve of oe)l.addDynamicAttributes(D,ve.point,ve.angle);return{}}function Pt(r,e,s,u,d,g){const b=Gt(r.add(r.sub(e)._unit()),d,g).point,I=s.sub(b);return s.add(I._mult(u/I.mag()))}function Ii(r,e,s,u,d,g,b,I,k,D,F,j,N,K){const J=u?r-e:r+e;let ee=J>0?1:-1,le=0;u&&(ee*=-1,le=Math.PI),ee<0&&(le+=Math.PI);let ce=ee>0?I+b:I+b+1,ye=d,oe=d,ve=0,be=0;const ze=Math.abs(J),we=[];for(;ve+be<=ze;){if(ce+=ee,ce<I||ce>=k)return null;if(oe=ye,we.push(ye),ye=j[ce],ye===void 0){const xt=new l.pointGeometry(D.getx(ce),D.gety(ce)),Ft=Gt(xt,F,K);if(Ft.signedDistanceFromCamera>0)ye=j[ce]=Ft.point;else{const ti=ce-ee;ye=Pt(ve===0?g:new l.pointGeometry(D.getx(ti),D.gety(ti)),xt,oe,ze-ve+1,F,K)}}ve+=be,be=oe.dist(ye)}const Ne=(ze-ve)/be,Ce=ye.sub(oe),ut=Ce.mult(Ne)._add(oe);ut._add(Ce._unit()._perp()._mult(s*ee));const yt=le+Math.atan2(ye.y-oe.y,ye.x-oe.x);return we.push(ut),{point:ut,angle:N?yt:0,path:we}}const Ar=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Mt(r,e){for(let s=0;s<r;s++){const u=e.length;e.resize(u+4),e.float32.set(Ar,3*u)}}function kn(r,e,s){const u=e[0],d=e[1];return r[0]=s[0]*u+s[4]*d+s[12],r[1]=s[1]*u+s[5]*d+s[13],r[3]=s[3]*u+s[7]*d+s[15],r}const vr=100;class bn{constructor(e,s=new Ae(e.width+200,e.height+200,25),u=new Ae(e.width+200,e.height+200,25)){this.transform=e,this.grid=s,this.ignoredGrid=u,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+vr,this.screenBottomBoundary=e.height+vr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,u,d,g,b){const I=this.projectAndGetPerspectiveRatio(d,e.anchorPointX,e.anchorPointY,b),k=u*I.perspectiveRatio,D=e.x1*k+I.point.x,F=e.y1*k+I.point.y,j=e.x2*k+I.point.x,N=e.y2*k+I.point.y;return!this.isInsideGrid(D,F,j,N)||s!=="always"&&this.grid.hitTest(D,F,j,N,s,g)||I.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[D,F,j,N],offscreen:this.isOffscreen(D,F,j,N)}}placeCollisionCircles(e,s,u,d,g,b,I,k,D,F,j,N,K,J){const ee=[],le=new l.pointGeometry(s.anchorX,s.anchorY),ce=Gt(le,b,J),ye=hi(this.transform.cameraToCenterDistance,ce.signedDistanceFromCamera),oe=(F?g/ye:g*ye)/l.ONE_EM,ve=Gt(le,I,J).point,be=Mi(oe,d,s.lineOffsetX*oe,s.lineOffsetY*oe,!1,ve,le,s,u,I,{},!1,J);let ze=!1,we=!1,Ne=!0;if(be){const Ce=.5*N*ye+K,ut=new l.pointGeometry(-100,-100),yt=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),xt=new Vi,Ft=be.first,ti=be.last;let It=[];for(let xi=Ft.path.length-1;xi>=1;xi--)It.push(Ft.path[xi]);for(let xi=1;xi<ti.path.length;xi++)It.push(ti.path[xi]);const ii=2.5*Ce;if(k){const xi=It.map(vi=>Gt(vi,k,J));It=xi.some(vi=>vi.signedDistanceFromCamera<=0)?[]:xi.map(vi=>vi.point)}let oi=[];if(It.length>0){const xi=It[0].clone(),vi=It[0].clone();for(let Gi=1;Gi<It.length;Gi++)xi.x=Math.min(xi.x,It[Gi].x),xi.y=Math.min(xi.y,It[Gi].y),vi.x=Math.max(vi.x,It[Gi].x),vi.y=Math.max(vi.y,It[Gi].y);oi=xi.x>=ut.x&&vi.x<=yt.x&&xi.y>=ut.y&&vi.y<=yt.y?[It]:vi.x<ut.x||xi.x>yt.x||vi.y<ut.y||xi.y>yt.y?[]:l.clipLine([It],ut.x,ut.y,yt.x,yt.y)}for(const xi of oi){xt.reset(xi,.25*Ce);let vi=0;vi=xt.length<=.5*Ce?1:Math.ceil(xt.paddedLength/ii)+1;for(let Gi=0;Gi<vi;Gi++){const Yr=Gi/Math.max(vi-1,1),Pn=xt.lerp(Yr),qr=Pn.x+vr,_n=Pn.y+vr;ee.push(qr,_n,Ce,0);const Sn=qr-Ce,Or=_n-Ce,Ri=qr+Ce,Yi=_n+Ce;if(Ne=Ne&&this.isOffscreen(Sn,Or,Ri,Yi),we=we||this.isInsideGrid(Sn,Or,Ri,Yi),e!=="always"&&this.grid.hitTestCircle(qr,_n,Ce,e,j)&&(ze=!0,!D))return{circles:[],offscreen:!1,collisionDetected:ze}}}}return{circles:!D&&ze||!we||ye<this.perspectiveRatioCutoff?[]:ee,offscreen:Ne,collisionDetected:ze}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,d=1/0,g=-1/0,b=-1/0;for(const F of e){const j=new l.pointGeometry(F.x+vr,F.y+vr);u=Math.min(u,j.x),d=Math.min(d,j.y),g=Math.max(g,j.x),b=Math.max(b,j.y),s.push(j)}const I=this.grid.query(u,d,g,b).concat(this.ignoredGrid.query(u,d,g,b)),k={},D={};for(const F of I){const j=F.key;if(k[j.bucketInstanceId]===void 0&&(k[j.bucketInstanceId]={}),k[j.bucketInstanceId][j.featureIndex])continue;const N=[new l.pointGeometry(F.x1,F.y1),new l.pointGeometry(F.x2,F.y1),new l.pointGeometry(F.x2,F.y2),new l.pointGeometry(F.x1,F.y2)];l.polygonIntersectsPolygon(s,N)&&(k[j.bucketInstanceId][j.featureIndex]=!0,D[j.bucketInstanceId]===void 0&&(D[j.bucketInstanceId]=[]),D[j.bucketInstanceId].push(j.featureIndex))}return D}insertCollisionBox(e,s,u,d,g,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:b,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,u,d,g,b){const I=u?this.ignoredGrid:this.grid,k={bucketInstanceId:d,featureIndex:g,collisionGroupID:b,overlapMode:s};for(let D=0;D<e.length;D+=4)I.insertCircle(k,e[D],e[D+1],e[D+2])}projectAndGetPerspectiveRatio(e,s,u,d){let g;return d?(g=[s,u,d(s,u),1],l.transformMat4(g,g,e)):(g=[s,u,0,1],kn(g,g,e)),{point:new l.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+vr,(-g[1]/g[3]+1)/2*this.transform.height+vr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(e,s,u,d){return u<vr||e>=this.screenRightBoundary||d<vr||s>this.screenBottomBoundary}isInsideGrid(e,s,u,d){return u>=0&&e<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=l.identity([]);return l.translate(e,e,[-100,-100,0]),e}}function ki(r,e,s){return e*(l.EXTENT/(r.tileSize*Math.pow(2,s-r.tileID.overscaledZ)))}class pi{constructor(e,s,u,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class hn{constructor(e,s,u,d,g){this.text=new pi(e?e.text:null,s,u,g),this.icon=new pi(e?e.icon:null,s,d,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class mn{constructor(e,s,u){this.text=e,this.icon=s,this.skipFade=u}}class wr{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class an{constructor(e,s,u,d,g){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=g}}class wn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[e]}}function is(r,e,s,u,d){const{horizontalAlign:g,verticalAlign:b}=l.getAnchorAlignment(r),I=-(g-.5)*e,k=-(b-.5)*s,D=l.evaluateVariableOffset(r,u);return new l.pointGeometry(I+D[0]*d,k+D[1]*d)}function Tn(r,e,s,u,d,g){const{x1:b,x2:I,y1:k,y2:D,anchorPointX:F,anchorPointY:j}=r,N=new l.pointGeometry(e,s);return u&&N._rotate(d?g:-g),{x1:b+N.x,y1:k+N.y,x2:I+N.x,y2:D+N.y,anchorPointX:F,anchorPointY:j}}class ge{constructor(e,s,u,d,g){this.transform=e.clone(),this.terrain=s,this.collisionIndex=new bn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new wn(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,s,u,d){const g=u.getBucket(s),b=u.latestFeatureIndex;if(!g||!b||s.id!==g.layerIds[0])return;const I=u.collisionBoxArray,k=g.layers[0].layout,D=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),F=u.tileSize/l.EXTENT,j=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),N=k.get("text-pitch-alignment")==="map",K=k.get("text-rotation-alignment")==="map",J=ki(u,1,this.transform.zoom),ee=$r(j,N,K,this.transform,J);let le=null;if(N){const ye=yr(j,N,K,this.transform,J);le=l.multiply([],this.transform.labelPlaneMatrix,ye)}this.retainedQueryData[g.bucketInstanceId]=new an(g.bucketInstanceId,b,g.sourceLayerIndex,g.index,u.tileID);const ce={bucket:g,layout:k,posMatrix:j,textLabelPlaneMatrix:ee,labelToScreenMatrix:le,scale:D,textPixelRatio:F,holdingForFade:u.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(d)for(const ye of g.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:ve,symbolInstanceEnd:be}=ye;e.push({sortKey:oe,symbolInstanceStart:ve,symbolInstanceEnd:be,parameters:ce})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(e,s,u,d,g,b,I,k,D,F,j,N,K,J,ee,le){const ce=[N.textOffset0,N.textOffset1],ye=is(e,u,d,ce,g),oe=this.collisionIndex.placeCollisionBox(Tn(s,ye.x,ye.y,b,I,this.transform.angle),j,k,D,F.predicate,le);if((!ee||this.collisionIndex.placeCollisionBox(Tn(ee,ye.x,ye.y,b,I,this.transform.angle),j,k,D,F.predicate,le).box.length!==0)&&oe.box.length>0){let ve;return this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(ve=this.prevPlacement.variableOffsets[N.crossTileID].anchor),this.variableOffsets[N.crossTileID]={textOffset:ce,width:u,height:d,anchor:e,textBoxScale:g,prevAnchor:ve},this.markUsedJustification(K,e,N,J),K.allowVerticalPlacement&&(this.markUsedOrientation(K,J,N),this.placedOrientations[N.crossTileID]=J),{shift:ye,placedGlyphBoxes:oe}}}placeLayerBucketPart(e,s,u){const{bucket:d,layout:g,posMatrix:b,textLabelPlaneMatrix:I,labelToScreenMatrix:k,textPixelRatio:D,holdingForFade:F,collisionBoxArray:j,partiallyEvaluatedTextSize:N,collisionGroup:K}=e.parameters,J=g.get("text-optional"),ee=g.get("icon-optional"),le=l.getOverlapMode(g,"text-overlap","text-allow-overlap"),ce=le==="always",ye=l.getOverlapMode(g,"icon-overlap","icon-allow-overlap"),oe=ye==="always",ve=g.get("text-rotation-alignment")==="map",be=g.get("text-pitch-alignment")==="map",ze=g.get("icon-text-fit")!=="none",we=g.get("symbol-z-order")==="viewport-y",Ne=ce&&(oe||!d.hasIconData()||ee),Ce=oe&&(ce||!d.hasTextData()||J);!d.collisionArrays&&j&&d.deserializeCollisionBoxes(j);const ut=(yt,xt)=>{if(s[yt.crossTileID])return;if(F)return void(this.placements[yt.crossTileID]=new mn(!1,!1,!1));let Ft=!1,ti=!1,It=!0,ii=null,oi={box:null,offscreen:null},xi={box:null,offscreen:null},vi=null,Gi=null,Yr=null,Pn=0,qr=0,_n=0;xt.textFeatureIndex?Pn=xt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(Pn=yt.featureIndex),xt.verticalTextFeatureIndex&&(qr=xt.verticalTextFeatureIndex);const Sn=this.retainedQueryData[d.bucketInstanceId].tileID,Or=this.terrain?(rr,wi)=>this.terrain.getElevation(Sn,rr,wi):null;for(const rr of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const wi=xt[rr];wi&&(wi.elevation=Or?Or(wi.anchorPointX,wi.anchorPointY):0)}const Ri=xt.textBox;if(Ri){const rr=Fi=>{let Gr=l.WritingMode.horizontal;if(d.allowVerticalPlacement&&!Fi&&this.prevPlacement){const Mn=this.prevPlacement.placedOrientations[yt.crossTileID];Mn&&(this.placedOrientations[yt.crossTileID]=Mn,Gr=Mn,this.markUsedOrientation(d,Gr,yt))}return Gr},wi=(Fi,Gr)=>{if(d.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&xt.verticalTextBox){for(const Mn of d.writingModes)if(Mn===l.WritingMode.vertical?(oi=Gr(),xi=oi):oi=Fi(),oi&&oi.box&&oi.box.length)break}else oi=Fi()};if(g.get("text-variable-anchor")){let Fi=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[yt.crossTileID]){const Lr=this.prevPlacement.variableOffsets[yt.crossTileID];Fi.indexOf(Lr.anchor)>0&&(Fi=Fi.filter(Un=>Un!==Lr.anchor),Fi.unshift(Lr.anchor))}const Gr=(Lr,Un,vs)=>{const bs=Lr.x2-Lr.x1,Js=Lr.y2-Lr.y1,Wn=yt.textBoxScale,Jn=ze&&ye==="never"?Un:null;let uo={box:[],offscreen:!1};const bc=le!=="never"?2*Fi.length:Fi.length;for(let yl=0;yl<bc;++yl){const xl=this.attemptAnchorPlacement(Fi[yl%Fi.length],Lr,bs,Js,Wn,ve,be,D,b,K,yl>=Fi.length?le:"never",yt,d,vs,Jn,Or);if(xl&&(uo=xl.placedGlyphBoxes,uo&&uo.box&&uo.box.length)){Ft=!0,ii=xl.shift;break}}return uo};wi(()=>Gr(Ri,xt.iconBox,l.WritingMode.horizontal),()=>{const Lr=xt.verticalTextBox;return d.allowVerticalPlacement&&!(oi&&oi.box&&oi.box.length)&&yt.numVerticalGlyphVertices>0&&Lr?Gr(Lr,xt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),oi&&(Ft=oi.box,It=oi.offscreen);const Mn=rr(oi&&oi.box);if(!Ft&&this.prevPlacement){const Lr=this.prevPlacement.variableOffsets[yt.crossTileID];Lr&&(this.variableOffsets[yt.crossTileID]=Lr,this.markUsedJustification(d,Lr.anchor,yt,Mn))}}else{const Fi=(Gr,Mn)=>{const Lr=this.collisionIndex.placeCollisionBox(Gr,le,D,b,K.predicate,Or);return Lr&&Lr.box&&Lr.box.length&&(this.markUsedOrientation(d,Mn,yt),this.placedOrientations[yt.crossTileID]=Mn),Lr};wi(()=>Fi(Ri,l.WritingMode.horizontal),()=>{const Gr=xt.verticalTextBox;return d.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Gr?Fi(Gr,l.WritingMode.vertical):{box:null,offscreen:null}}),rr(oi&&oi.box&&oi.box.length)}}if(vi=oi,Ft=vi&&vi.box&&vi.box.length>0,It=vi&&vi.offscreen,yt.useRuntimeCollisionCircles){const rr=d.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),wi=l.evaluateSizeForFeature(d.textSizeData,N,rr),Fi=g.get("text-padding");Gi=this.collisionIndex.placeCollisionCircles(le,rr,d.lineVertexArray,d.glyphOffsetArray,wi,b,I,k,u,be,K.predicate,yt.collisionCircleDiameter,Fi,Or),Ft=ce||Gi.circles.length>0&&!Gi.collisionDetected,It=It&&Gi.offscreen}if(xt.iconFeatureIndex&&(_n=xt.iconFeatureIndex),xt.iconBox){const rr=wi=>{const Fi=ze&&ii?Tn(wi,ii.x,ii.y,ve,be,this.transform.angle):wi;return this.collisionIndex.placeCollisionBox(Fi,ye,D,b,K.predicate,Or)};xi&&xi.box&&xi.box.length&&xt.verticalIconBox?(Yr=rr(xt.verticalIconBox),ti=Yr.box.length>0):(Yr=rr(xt.iconBox),ti=Yr.box.length>0),It=It&&Yr.offscreen}const Yi=J||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,Zi=ee||yt.numIconVertices===0;if(Yi||Zi?Zi?Yi||(ti=ti&&Ft):Ft=ti&&Ft:ti=Ft=ti&&Ft,Ft&&vi&&vi.box&&this.collisionIndex.insertCollisionBox(vi.box,le,g.get("text-ignore-placement"),d.bucketInstanceId,xi&&xi.box&&qr?qr:Pn,K.ID),ti&&Yr&&this.collisionIndex.insertCollisionBox(Yr.box,ye,g.get("icon-ignore-placement"),d.bucketInstanceId,_n,K.ID),Gi&&(Ft&&this.collisionIndex.insertCollisionCircles(Gi.circles,le,g.get("text-ignore-placement"),d.bucketInstanceId,Pn,K.ID),u)){const rr=d.bucketInstanceId;let wi=this.collisionCircleArrays[rr];wi===void 0&&(wi=this.collisionCircleArrays[rr]=new wr);for(let Fi=0;Fi<Gi.circles.length;Fi+=4)wi.circles.push(Gi.circles[Fi+0]),wi.circles.push(Gi.circles[Fi+1]),wi.circles.push(Gi.circles[Fi+2]),wi.circles.push(Gi.collisionDetected?1:0)}this.placements[yt.crossTileID]=new mn(Ft||Ne,ti||Ce,It||d.justReloaded),s[yt.crossTileID]=!0};if(we){const yt=d.getSortedSymbolIndexes(this.transform.angle);for(let xt=yt.length-1;xt>=0;--xt){const Ft=yt[xt];ut(d.symbolInstances.get(Ft),d.collisionArrays[Ft])}}else for(let yt=e.symbolInstanceStart;yt<e.symbolInstanceEnd;yt++)ut(d.symbolInstances.get(yt),d.collisionArrays[yt]);if(u&&d.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[d.bucketInstanceId];l.invert(yt.invProjMatrix,b),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(e,s,u,d){let g;g=d===l.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(s)];const b=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const I of b)I>=0&&(e.text.placedSymbolArray.get(I).crossTileID=g>=0&&I!==g?0:u.crossTileID)}markUsedOrientation(e,s,u){const d=s===l.WritingMode.horizontal||s===l.WritingMode.horizontalOnly?s:0,g=s===l.WritingMode.vertical?s:0,b=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const I of b)e.text.placedSymbolArray.get(I).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const d=s?s.symbolFadeChange(e):1,g=s?s.opacities:{},b=s?s.variableOffsets:{},I=s?s.placedOrientations:{};for(const k in this.placements){const D=this.placements[k],F=g[k];F?(this.opacities[k]=new hn(F,d,D.text,D.icon),u=u||D.text!==F.text.placed||D.icon!==F.icon.placed):(this.opacities[k]=new hn(null,d,D.text,D.icon,D.skipFade),u=u||D.text||D.icon)}for(const k in g){const D=g[k];if(!this.opacities[k]){const F=new hn(D,d,!1,!1);F.isHidden()||(this.opacities[k]=F,u=u||D.text.placed||D.icon.placed)}}for(const k in b)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=b[k]);for(const k in I)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=I[k]);u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const u={};for(const d of s){const g=d.getBucket(e);g&&d.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,u,d.collisionBoxArray)}}updateBucketOpacities(e,s,u){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0].layout,g=new hn(null,0,!1,!1,!0),b=d.get("text-allow-overlap"),I=d.get("icon-allow-overlap"),k=d.get("text-variable-anchor"),D=d.get("text-rotation-alignment")==="map",F=d.get("text-pitch-alignment")==="map",j=d.get("icon-text-fit")!=="none",N=new hn(null,0,b&&(I||!e.hasIconData()||d.get("icon-optional")),I&&(b||!e.hasTextData()||d.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const K=(J,ee,le)=>{for(let ce=0;ce<ee/4;ce++)J.opacityVertexArray.emplaceBack(le)};for(let J=0;J<e.symbolInstances.length;J++){const ee=e.symbolInstances.get(J),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:ce,crossTileID:ye}=ee;let oe=this.opacities[ye];s[ye]?oe=g:oe||(oe=N,this.opacities[ye]=oe),s[ye]=!0;const ve=ee.numIconVertices>0,be=this.placedOrientations[ee.crossTileID],ze=be===l.WritingMode.vertical,we=be===l.WritingMode.horizontal||be===l.WritingMode.horizontalOnly;if(le>0||ce>0){const Ne=se(oe.text);K(e.text,le,ze?pe:Ne),K(e.text,ce,we?pe:Ne);const Ce=oe.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(xt=>{xt>=0&&(e.text.placedSymbolArray.get(xt).hidden=Ce||ze?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Ce||we?1:0);const ut=this.variableOffsets[ee.crossTileID];ut&&this.markUsedJustification(e,ut.anchor,ee,be);const yt=this.placedOrientations[ee.crossTileID];yt&&(this.markUsedJustification(e,"left",ee,yt),this.markUsedOrientation(e,yt,ee))}if(ve){const Ne=se(oe.icon),Ce=!(j&&ee.verticalPlacedIconSymbolIndex&&ze);ee.placedIconSymbolIndex>=0&&(K(e.icon,ee.numIconVertices,Ce?Ne:pe),e.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=oe.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,ee.numVerticalIconVertices,Ce?pe:Ne),e.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=oe.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ne=e.collisionArrays[J];if(Ne){let Ce=new l.pointGeometry(0,0);if(Ne.textBox||Ne.verticalTextBox){let yt=!0;if(k){const xt=this.variableOffsets[ye];xt?(Ce=is(xt.anchor,xt.width,xt.height,xt.textOffset,xt.textBoxScale),D&&Ce._rotate(F?this.transform.angle:-this.transform.angle)):yt=!1}Ne.textBox&&B(e.textCollisionBox.collisionVertexArray,oe.text.placed,!yt||ze,Ce.x,Ce.y),Ne.verticalTextBox&&B(e.textCollisionBox.collisionVertexArray,oe.text.placed,!yt||we,Ce.x,Ce.y)}const ut=Boolean(!we&&Ne.verticalIconBox);Ne.iconBox&&B(e.iconCollisionBox.collisionVertexArray,oe.icon.placed,ut,j?Ce.x:0,j?Ce.y:0),Ne.verticalIconBox&&B(e.iconCollisionBox.collisionVertexArray,oe.icon.placed,!ut,j?Ce.x:0,j?Ce.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=J.invProjMatrix,e.placementViewportMatrix=J.viewportMatrix,e.collisionCircleArray=J.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function B(r,e,s,u,d){r.emplaceBack(e?1:0,s?1:0,u||0,d||0),r.emplaceBack(e?1:0,s?1:0,u||0,d||0),r.emplaceBack(e?1:0,s?1:0,u||0,d||0),r.emplaceBack(e?1:0,s?1:0,u||0,d||0)}const M=Math.pow(2,25),L=Math.pow(2,24),G=Math.pow(2,17),H=Math.pow(2,16),te=Math.pow(2,9),ne=Math.pow(2,8),ie=Math.pow(2,1);function se(r){if(r.opacity===0&&!r.placed)return 0;if(r.opacity===1&&r.placed)return 4294967295;const e=r.placed?1:0,s=Math.floor(127*r.opacity);return s*M+e*L+s*G+e*H+s*te+e*ne+s*ie+e}const pe=0;class Ie{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,u,d,g){const b=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(b,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((I,k)=>I.sortKey-k.sortKey));this._currentPartIndex<b.length;)if(s.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,g())return!0;return!1}}class Se{constructor(e,s,u,d,g,b,I,k){this.placement=new ge(e,s,b,I,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,s,u){const d=l.exported.now(),g=()=>{const b=l.exported.now()-d;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=s[e[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=I)&&(!b.maxzoom||b.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Ie(b)),this._inProgressLayer.continuePlacement(u[b.source],this.placement,this._showCollisionBoxes,b,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ke=512/l.EXTENT/2;class st{constructor(e,s,u){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(let d=0;d<s.length;d++){const g=s.get(d),b=g.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,e)})}}getScaledCoordinates(e,s){const u=ke/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*l.EXTENT+e.anchorX)*u),y:Math.floor((s.canonical.y*l.EXTENT+e.anchorY)*u)}}findMatches(e,s,u){const d=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let g=0;g<e.length;g++){const b=e.get(g);if(b.crossTileID)continue;const I=this.indexedSymbolInstances[b.key];if(!I)continue;const k=this.getScaledCoordinates(b,s);for(const D of I)if(Math.abs(D.coord.x-k.x)<=d&&Math.abs(D.coord.y-k.y)<=d&&!u[D.crossTileID]){u[D.crossTileID]=!0,b.crossTileID=D.crossTileID;break}}}}class he{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qe{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const u in this.indexes){const d=this.indexes[u],g={};for(const b in d){const I=d[b];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+s),g[I.tileID.key]=I}this.indexes[u]=g}this.lng=e}addBucket(e,s,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const b=this.indexes[g];if(Number(g)>e.overscaledZ)for(const I in b){const k=b[I];k.tileID.isChildOf(e)&&k.findMatches(s.symbolInstances,e,d)}else{const I=b[e.scaledTo(Number(g)).key];I&&I.findMatches(s.symbolInstances,e,d)}}for(let g=0;g<s.symbolInstances.length;g++){const b=s.symbolInstances.get(g);b.crossTileID||(b.crossTileID=u.generate(),d[b.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new st(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const u in s.indexedSymbolInstances)for(const d of s.indexedSymbolInstances[u])delete this.usedCrossTileIDs[e][d.crossTileID]}removeStaleBuckets(e){let s=!1;for(const u in this.indexes){const d=this.indexes[u];for(const g in d)e[d[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[g]),delete d[g],s=!0)}return s}}class ot{constructor(){this.layerIndexes={},this.crossTileIDs=new he,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,u){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new qe);let g=!1;const b={};d.handleWrapJump(u);for(const I of s){const k=I.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(I.tileID,k,this.crossTileIDs)&&(g=!0),b[k.bucketInstanceId]=!0)}return d.removeStaleBuckets(b)&&(g=!0),g}pruneUnusedLayers(e){const s={};e.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}var Ut=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Lt extends l.Evented{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=e._cache.max,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const e in this._tiles){const s=this._tiles[e];s.textures.forEach(u=>u.destroy()),s.textures=[]}}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),l.ortho(u.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[u.key]=new _i(u,this.tileSize))}removeOutdated(e){const s={};this.renderHistory=this.renderHistory.filter((u,d)=>this.renderHistory.indexOf(u)===d).slice(0,this.renderHistorySize);for(const u of this._renderableTilesKeys)s[u]=!0;for(const u of this.renderHistory)s[u]=!0;for(const u in this._tiles)s[u]||(this._tiles[u].clearTextures(e),delete this._tiles[u])}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID;if(d.canonical.equals(e.canonical)){const g=e.clone();g.posMatrix=new Float64Array(16),l.ortho(g.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),s[u]=g}else if(d.canonical.isChildOf(e.canonical)){const g=e.clone();g.posMatrix=new Float64Array(16);const b=d.canonical.z-e.canonical.z,I=d.canonical.x-(d.canonical.x>>b<<b),k=d.canonical.y-(d.canonical.y>>b<<b),D=l.EXTENT>>b;l.ortho(g.posMatrix,0,D,0,D,0,1),l.translate(g.posMatrix,g.posMatrix,[-I*D,-k*D,0]),s[u]=g}else if(e.canonical.isChildOf(d.canonical)){const g=e.clone();g.posMatrix=new Float64Array(16);const b=e.canonical.z-d.canonical.z,I=e.canonical.x-(e.canonical.x>>b<<b),k=e.canonical.y-(e.canonical.y>>b<<b),D=l.EXTENT>>b;l.ortho(g.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(g.posMatrix,g.posMatrix,[I*D,k*D,0]),l.scale(g.posMatrix,g.posMatrix,[1/2**b,1/2**b,0]),s[u]=g}}return s}getSourceTile(e,s){const u=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&s)for(;d>=u.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(d--).key);return g}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=e)}}class Et{constructor(e,s,u){this.style=e,this.sourceCache=new Lt(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.elevationOffset=typeof u.elevationOffset=="number"?u.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(e,s,u,d=l.EXTENT){if(!(s>=0&&s<d&&u>=0&&u<d))return this.elevationOffset;let g=0;const b=this.getTerrainData(e);if(b.tile&&b.tile.dem){const I=l.transformMat4$1([],[s/d*l.EXTENT,u/d*l.EXTENT],b.u_terrain_matrix),k=[I[0]*b.tile.dem.dim,I[1]*b.tile.dem.dim],D=[Math.floor(k[0]),Math.floor(k[1])],F=b.tile.dem.get(D[0],D[1]),j=b.tile.dem.get(D[0],D[1]+1),N=b.tile.dem.get(D[0]+1,D[1]),K=b.tile.dem.get(D[0]+1,D[1]+1);g=l.number(l.number(F,j,k[0]-D[0]),l.number(N,K,k[0]-D[0]),k[1]-D[1])}return g}rememberForRerender(e,s){for(const u in this.sourceCache._tiles){const d=this.sourceCache._tiles[u];(d.tileID.equals(s)||d.tileID.isChildOf(s))&&(e===this.sourceCache.sourceCache.id&&(d.timeLoaded=Date.now()),this._rerender[e]=this._rerender[e]||{},this._rerender[e][d.tileID.key]=!0)}}needsRerender(e,s){return this._rerender[e]&&this._rerender[e][s.key]}clearRerenderCache(){this._rerender={}}getElevation(e,s,u,d=l.EXTENT){return(this.getDEMElevation(e,s,u,d)+this.elevationOffset)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.style.map.painter.context,g=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Fe(d,g,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Fe(d,new l.RGBAImage({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const d=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new Fe(d,s.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),s.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s+s.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?g=e.canonical.z-d:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=e.canonical.x-(e.canonical.x>>g<<g),I=e.canonical.y-(e.canonical.y>>g<<g),k=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<g),1/(l.EXTENT<<g),0]);l.translate(k,k,[b*l.EXTENT,I*l.EXTENT,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const e=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=e.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(e.context.createRenderbuffer(e.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(e){const s=this.style.map.painter,u=s.width/devicePixelRatio,d=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Fe(s.context,{width:u,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Fe(s.context,{width:u,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,d,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,b=0;g<this._coordsTextureSize;g++)for(let I=0;I<this._coordsTextureSize;I++,b+=4)s[b+0]=255&I,s[b+1]=255&g,s[b+2]=I>>8<<4|g>>8,s[b+3]=0;const u=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),d=new Fe(e,u,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){const s=new Uint8Array(4),u=this.style.map.painter,d=u.context,g=d.gl;d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(e.x,u.height/devicePixelRatio-e.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,s),d.bindFramebuffer.set(null);const b=s[0]+(s[2]>>4<<8),I=s[1]+((15&s[2])<<8),k=this.coordsIndex[255-s[3]],D=k&&this.sourceCache.getTileByID(k);if(!D)return null;const F=this._coordsTextureSize,j=(1<<D.tileID.canonical.z)*F;return new l.MercatorCoordinate((D.tileID.canonical.x*F+b)/j,(D.tileID.canonical.y*F+I)/j,this.getElevation(D.tileID,b,I,F))}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.style.map.painter.context,s=new l.PosArray,u=new l.TriangleIndexArray,d=this.meshSize,g=l.EXTENT/d,b=d*d;for(let I=0;I<=d;I++)for(let k=0;k<=d;k++)s.emplaceBack(k*g,I*g);for(let I=0;I<b;I+=d+1)for(let k=0;k<d;k++)u.emplaceBack(k+I,d+k+I+1,d+k+I+2),u.emplaceBack(k+I,d+k+I+2,k+I+1);return this._mesh={indexBuffer:e.createIndexBuffer(u),vertexBuffer:e.createVertexBuffer(s,Ut.members),segments:l.SegmentVector.simpleSegment(0,0,s.length,u.length)},this._mesh}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,u.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),u}}const Vt=(r,e)=>l.emitValidationErrors(r,e&&e.filter(s=>s.identifier!=="source.canvas")),Kt=l.pick(bi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Qi=l.pick(bi,["setCenter","setZoom","setBearing","setPitch"]),Ni=function(){const r={},e=l.spec.$version;for(const s in l.spec.$root){const u=l.spec.$root[s];if(u.required){let d=null;d=s==="version"?e:u.type==="array"?[]:{},d!=null&&(r[s]=d)}}return r}();class fr extends l.Evented{constructor(e,s={}){super(),this.map=e,this.dispatcher=new Oe(Er(),this),this.imageManager=new zt,this.imageManager.setEventedParent(this),this.glyphManager=new nt(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new rt(256,512),this.crossTileSymbolIndex=new ot,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const u=this;this._rtlTextPluginCallback=fr.registerForPluginStateChange(d=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(g,b)=>{if(l.triggerPluginCompletionEvent(g),b&&b.every(I=>I))for(const I in u.sourceCaches)u.sourceCaches[I].reload()})}),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const g=this.sourceCaches[d.sourceId];if(!g)return;const b=g.getSource();if(b&&b.vectorLayerIds)for(const I in this._layers){const k=this._layers[I];k.source===b.id&&this._validateLayer(k)}})}loadURL(e,s={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const u=typeof s.validate!="boolean"||s.validate,d=this.map._requestManager.transformRequest(e,l.ResourceType.Style);this._request=l.getJSON(d,(g,b)=>{this._request=null,g?this.fire(new l.ErrorEvent(g)):b&&this._load(b,u)})}loadJSON(e,s={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(e,s.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Ni,!1)}_load(e,s){if(s&&Vt(this,l.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e;for(const d in e.sources)this.addSource(d,e.sources[d],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);const u=Jr(this.stylesheet.layers);this._order=u.map(d=>d.id),this._layers={},this._serializedLayers={};for(let d of u)d=l.createStyleLayer(d),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new at(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(e){this._spriteRequest=function(s,u,d,g){let b,I,k;const D=d>1?"@2x":"";let F=l.getJSON(u.transformRequest(u.normalizeSpriteURL(s,D,".json"),l.ResourceType.SpriteJSON),(K,J)=>{F=null,k||(k=K,b=J,N())}),j=l.getImage(u.transformRequest(u.normalizeSpriteURL(s,D,".png"),l.ResourceType.SpriteImage),(K,J)=>{j=null,k||(k=K,I=J,N())});function N(){if(k)g(k);else if(b&&I){const K=l.exported.getImageData(I),J={};for(const ee in b){const{width:le,height:ce,x:ye,y:oe,sdf:ve,pixelRatio:be,stretchX:ze,stretchY:we,content:Ne}=b[ee],Ce=new l.RGBAImage({width:le,height:ce});l.RGBAImage.copy(K,Ce,{x:ye,y:oe},{x:0,y:0},{width:le,height:ce}),J[ee]={data:Ce,pixelRatio:be,sdf:ve,stretchX:ze,stretchY:we,content:Ne}}g(null,J)}}return{cancel(){F&&(F.cancel(),F=null),j&&(j.cancel(),j=null)}}}(e,this.map._requestManager,this.map.getPixelRatio(),(s,u)=>{if(this._spriteRequest=null,s)this.fire(new l.ErrorEvent(s));else if(u)for(const d in u)this.imageManager.addImage(d,u[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const u=e.sourceLayer;if(!u)return;const d=s.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const s=[];for(const u of e){const d=this._layers[u];d.type!=="custom"&&s.push(d.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(d.length||g.length)&&this._updateWorkerLayers(d,g);for(const b in this._updatedSources){const I=this._updatedSources[b];I==="reload"?this._reloadSource(b):I==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const g=this.sourceCaches[d];u[d]=g.used,g.used=!1}for(const d of this._order){const g=this._layers[d];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const d in u){const g=this.sourceCaches[d];u[d]!==g.used&&g.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,s&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(e){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),e){const s=this.sourceCaches[e.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);this.terrain=new Et(this,s,e),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=u=>{u.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=u=>{u.tile&&(u.sourceId===e.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(u.sourceId,u.tile.tileID)):u.source.type==="geojson"&&this.terrain.rememberForRerender(u.sourceId,u.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:e}))}setState(e){if(this._checkLoaded(),Vt(this,l.validateStyle(e)))return!1;(e=l.clone$1(e)).layers=Jr(e.layers);const s=function(d,g){if(!d)return[{command:bi.setStyle,args:[g]}];let b=[];try{if(!re(d.version,g.version))return[{command:bi.setStyle,args:[g]}];re(d.center,g.center)||b.push({command:bi.setCenter,args:[g.center]}),re(d.zoom,g.zoom)||b.push({command:bi.setZoom,args:[g.zoom]}),re(d.bearing,g.bearing)||b.push({command:bi.setBearing,args:[g.bearing]}),re(d.pitch,g.pitch)||b.push({command:bi.setPitch,args:[g.pitch]}),re(d.sprite,g.sprite)||b.push({command:bi.setSprite,args:[g.sprite]}),re(d.glyphs,g.glyphs)||b.push({command:bi.setGlyphs,args:[g.glyphs]}),re(d.transition,g.transition)||b.push({command:bi.setTransition,args:[g.transition]}),re(d.light,g.light)||b.push({command:bi.setLight,args:[g.light]});const I={},k=[];(function(F,j,N,K){let J;for(J in j=j||{},F=F||{})Object.prototype.hasOwnProperty.call(F,J)&&(Object.prototype.hasOwnProperty.call(j,J)||cr(J,N,K));for(J in j)Object.prototype.hasOwnProperty.call(j,J)&&(Object.prototype.hasOwnProperty.call(F,J)?re(F[J],j[J])||(F[J].type==="geojson"&&j[J].type==="geojson"&&Qt(F,j,J)?N.push({command:bi.setGeoJSONSourceData,args:[J,j[J].data]}):Hi(J,j,N,K)):br(J,j,N))})(d.sources,g.sources,k,I);const D=[];d.layers&&d.layers.forEach(F=>{I[F.source]?b.push({command:bi.removeLayer,args:[F.id]}):D.push(F)}),b=b.concat(k),function(F,j,N){j=j||[];const K=(F=F||[]).map(Di),J=j.map(Di),ee=F.reduce(jt,{}),le=j.reduce(jt,{}),ce=K.slice(),ye=Object.create(null);let oe,ve,be,ze,we,Ne,Ce;for(oe=0,ve=0;oe<K.length;oe++)be=K[oe],Object.prototype.hasOwnProperty.call(le,be)?ve++:(N.push({command:bi.removeLayer,args:[be]}),ce.splice(ce.indexOf(be,ve),1));for(oe=0,ve=0;oe<J.length;oe++)be=J[J.length-1-oe],ce[ce.length-1-oe]!==be&&(Object.prototype.hasOwnProperty.call(ee,be)?(N.push({command:bi.removeLayer,args:[be]}),ce.splice(ce.lastIndexOf(be,ce.length-ve),1)):ve++,Ne=ce[ce.length-oe],N.push({command:bi.addLayer,args:[le[be],Ne]}),ce.splice(ce.length-oe,0,be),ye[be]=!0);for(oe=0;oe<J.length;oe++)if(be=J[oe],ze=ee[be],we=le[be],!ye[be]&&!re(ze,we))if(re(ze.source,we.source)&&re(ze["source-layer"],we["source-layer"])&&re(ze.type,we.type)){for(Ce in tr(ze.layout,we.layout,N,be,null,bi.setLayoutProperty),tr(ze.paint,we.paint,N,be,null,bi.setPaintProperty),re(ze.filter,we.filter)||N.push({command:bi.setFilter,args:[be,we.filter]}),re(ze.minzoom,we.minzoom)&&re(ze.maxzoom,we.maxzoom)||N.push({command:bi.setLayerZoomRange,args:[be,we.minzoom,we.maxzoom]}),ze)Object.prototype.hasOwnProperty.call(ze,Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?tr(ze[Ce],we[Ce],N,be,Ce.slice(6),bi.setPaintProperty):re(ze[Ce],we[Ce])||N.push({command:bi.setLayerProperty,args:[be,Ce,we[Ce]]}));for(Ce in we)Object.prototype.hasOwnProperty.call(we,Ce)&&!Object.prototype.hasOwnProperty.call(ze,Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?tr(ze[Ce],we[Ce],N,be,Ce.slice(6),bi.setPaintProperty):re(ze[Ce],we[Ce])||N.push({command:bi.setLayerProperty,args:[be,Ce,we[Ce]]}))}else N.push({command:bi.removeLayer,args:[be]}),Ne=ce[ce.lastIndexOf(be)+1],N.push({command:bi.addLayer,args:[we,Ne]})}(D,g.layers,b)}catch(I){console.warn("Unable to compute style diff:",I),b=[{command:bi.setStyle,args:[g]}]}return b}(this.serialize(),e).filter(d=>!(d.command in Qi));if(s.length===0)return!1;const u=s.filter(d=>!(d.command in Kt));if(u.length>0)throw new Error(`Unimplemented: ${u.map(d=>d.command).join(", ")}.`);return s.forEach(d=>{d.command!=="setTransition"&&this[d.command].apply(this,d.args)}),this.stylesheet=e,!0}addImage(e,s){if(this.getImage(e))return this.fire(new l.ErrorEvent(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.ErrorEvent(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.validateStyle.source,`sources.${e}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const d=this.sourceCaches[e]=new $e(e,s,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new l.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){this._checkLoaded(),this.sourceCaches[e].getSource().setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,u={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new l.ErrorEvent(new Error(`Layer "${d}" already exists on this map.`)));let g;if(e.type==="custom"){if(Vt(this,l.validateCustomStyleLayer(e)))return;g=l.createStyleLayer(e)}else{if(typeof e.source=="object"&&(this.addSource(d,e.source),e=l.clone$1(e),e=l.extend(e,{source:d})),this._validate(l.validateStyle.layer,`layers.${d}`,e,{arrayIndex:-1},u))return;g=l.createStyleLayer(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[g.id]=g.serialize()}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${d}" before non-existing layer "${s}".`)));else{if(this._order.splice(b,0,d),this._layerOrderChanged=!0,this._layers[d]=g,this._removedLayers[d]&&g.source&&g.type!=="custom"){const I=this._removedLayers[d];delete this._removedLayers[d],I.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const u=this._order.indexOf(e);this._order.splice(u,1);const d=s?this._order.indexOf(s):this._order.length;s&&d===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,u){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===s&&d.maxzoom===u||(s!=null&&(d.minzoom=s),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,u={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!re(d.filter,s))return s==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(l.validateStyle.filter,`layers.${d.id}.filter`,s,null,u)||(d.filter=l.clone$1(s),this._updateLayer(d)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.clone$1(this.getLayer(e).filter)}setLayoutProperty(e,s,u,d={}){this._checkLoaded();const g=this.getLayer(e);g?re(g.getLayoutProperty(s),u)||(g.setLayoutProperty(s,u,d),this._updateLayer(g)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const u=this.getLayer(e);if(u)return u.getLayoutProperty(s);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,u,d={}){this._checkLoaded();const g=this.getLayer(e);g?re(g.getPaintProperty(s),u)||(g.setPaintProperty(s,u,d)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const u=e.source,d=e.sourceLayer,g=this.sourceCaches[u];if(g===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const b=g.getSource().type;b==="geojson"&&d?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||d?(e.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),g.setFeatureState(d,e.id,s)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const u=e.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const g=d.getSource().type,b=g==="vector"?e.sourceLayer:void 0;g!=="vector"||b?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(b,e.id,s):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,u=e.sourceLayer,d=this.sourceCaches[s];if(d!==void 0)return d.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,e.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,e=>e.serialize()),layers:this._serializeLayers(this._order)},e=>e!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=b=>this._layers[b].type==="fill-extrusion",u={},d=[];for(let b=this._order.length-1;b>=0;b--){const I=this._order[b];if(s(I)){u[I]=b;for(const k of e){const D=k[I];if(D)for(const F of D)d.push(F)}}}d.sort((b,I)=>I.intersectionZ-b.intersectionZ);const g=[];for(let b=this._order.length-1;b>=0;b--){const I=this._order[b];if(s(I))for(let k=d.length-1;k>=0;k--){const D=d[k].feature;if(u[D.layer.id]<b)break;g.push(D),d.pop()}else for(const k of e){const D=k[I];if(D)for(const F of D)g.push(F.feature)}}return g}queryRenderedFeatures(e,s,u){s&&s.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const d={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const b of s.layers){const I=this._layers[b];if(!I)return this.fire(new l.ErrorEvent(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];d[I.source]=!0}}const g=[];s.availableImages=this._availableImages;for(const b in this.sourceCaches)s.layers&&!d[b]||g.push(fi(this.sourceCaches[b],this._layers,this._serializedLayers,e,s,u));return this.placement&&g.push(function(b,I,k,D,F,j,N){const K={},J=j.queryRenderedSymbols(D),ee=[];for(const le of Object.keys(J).map(Number))ee.push(N[le]);ee.sort(ei);for(const le of ee){const ce=le.featureIndex.lookupSymbolFeatures(J[le.bucketInstanceId],I,le.bucketIndex,le.sourceLayerIndex,F.filter,F.layers,F.availableImages,b);for(const ye in ce){const oe=K[ye]=K[ye]||[],ve=ce[ye];ve.sort((be,ze)=>{const we=le.featureSortOrder;if(we){const Ne=we.indexOf(be.featureIndex);return we.indexOf(ze.featureIndex)-Ne}return ze.featureIndex-be.featureIndex});for(const be of ve)oe.push(be)}}for(const le in K)K[le].forEach(ce=>{const ye=ce.feature,oe=k[b[le].source].getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=oe});return K}(this._layers,this._serializedLayers,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,s){s&&s.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.sourceCaches[e];return u?function(d,g){const b=d.getRenderableIds().map(D=>d.getTileByID(D)),I=[],k={};for(let D=0;D<b.length;D++){const F=b[D],j=F.tileID.canonical.key;k[j]||(k[j]=!0,F.querySourceFeatures(I,g))}return I}(u,s):[]}addSourceType(e,s,u){return fr.getSourceType(e)?u(new Error(`A source type called "${e}" already exists.`)):(fr.setSourceType(e,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:s.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const b in e)if(!re(e[b],u[b])){d=!0;break}if(!d)return;const g={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(g)}_validate(e,s,u,d,g={}){return(!g||g.validate!==!1)&&Vt(this,e.call(l.validateStyle,l.extend({key:s,style:this.serialize(),value:u,styleSpec:l.spec},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const s=this.sourceCaches[e];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,u,d,g=!1){let b=!1,I=!1;const k={};for(const D of this._order){const F=this._layers[D];if(F.type!=="symbol")continue;if(!k[F.source]){const N=this.sourceCaches[F.source];k[F.source]=N.getRenderableIds(!0).map(K=>N.getTileByID(K)).sort((K,J)=>J.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(J.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(F,k[F.source],e.center.lng);b=b||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),e.zoom))&&(this.pauseablePlacement=new Se(e,this.terrain,this._order,g,s,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),I=!0),b&&this.pauseablePlacement.placement.setStale()),I||b)for(const D of this._order){const F=this._layers[D];F.type==="symbol"&&this.placement.updateLayerOpacities(F,k[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s,u){this.imageManager.getImages(s.icons,u),this._updateTilesForChangedImages();const d=this.sourceCaches[s.source];d&&d.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(e,s,u){this.glyphManager.getGlyphs(s.stacks,u)}getResource(e,s,u){return l.makeRequest(s,u)}}fr.getSourceType=function(r){return ui[r]},fr.setSourceType=function(r,e){ui[r]=e},fr.registerForPluginStateChange=l.registerForPluginStateChange;var gn="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Es={prelude:mr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:mr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:mr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:mr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:mr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:mr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:mr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:mr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:mr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:mr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",gn),terrainDepth:mr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",gn),terrainCoords:mr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",gn)};function mr(r,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),d=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=g?g.concat(d):d,I={};return{fragmentSource:r=r.replace(s,(k,D,F,j,N)=>(I[N]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${F} ${j} ${N};
#else
uniform ${F} ${j} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${F} ${j} ${N} = u_${N};
#endif
`)),vertexSource:e=e.replace(s,(k,D,F,j,N)=>{const K=j==="float"?"vec2":"vec4",J=N.match(/color/)?"color":K;return I[N]?D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${F} ${K} a_${N};
varying ${F} ${j} ${N};
#else
uniform ${F} ${j} u_${N};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${F} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${J}(a_${N}, u_${N}_t);
#else
    ${F} ${j} ${N} = u_${N};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${F} ${K} a_${N};
#else
uniform ${F} ${j} u_${N};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${F} ${j} ${N} = a_${N};
#else
    ${F} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${F} ${j} ${N} = unpack_mix_${J}(a_${N}, u_${N}_t);
#else
    ${F} ${j} ${N} = u_${N};
#endif
`}),staticAttributes:u,staticUniforms:b}}class Tr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,u,d,g,b,I,k,D){this.context=e;let F=this.boundPaintVertexBuffers.length!==d.length;for(let j=0;!F&&j<d.length;j++)this.boundPaintVertexBuffers[j]!==d[j]&&(F=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===u&&!F&&this.boundIndexBuffer===g&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===k&&this.boundDynamicVertexBuffer3===D?(e.bindVertexArrayOES.set(this.vao),I&&I.bind(),g&&g.dynamicDraw&&g.bind(),k&&k.bind(),D&&D.bind()):this.freshBind(s,u,d,g,b,I,k,D)}freshBind(e,s,u,d,g,b,I,k){let D;const F=e.numAttributes,j=this.context,N=j.gl;if(j.extVertexArrayObject)this.vao&&this.destroy(),this.vao=j.extVertexArrayObject.createVertexArrayOES(),j.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=k;else{D=j.currentNumAttributes||0;for(let K=F;K<D;K++)N.disableVertexAttribArray(K)}s.enableAttributes(N,e);for(const K of u)K.enableAttributes(N,e);b&&b.enableAttributes(N,e),I&&I.enableAttributes(N,e),k&&k.enableAttributes(N,e),s.bind(),s.setVertexAttribPointers(N,e,g);for(const K of u)K.bind(),K.setVertexAttribPointers(N,e,g);b&&(b.bind(),b.setVertexAttribPointers(N,e,g)),d&&d.bind(),I&&(I.bind(),I.setVertexAttribPointers(N,e,g)),k&&(k.bind(),k.setVertexAttribPointers(N,e,g)),j.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function il(r){const e=[];for(let s=0;s<r.length;s++){if(r[s]===null)continue;const u=r[s].split(" ");e.push(u.pop())}return e}class Ta{constructor(e,s,u,d,g,b,I){const k=e.gl;this.program=k.createProgram();const D=il(u.staticAttributes),F=d?d.getBinderAttributes():[],j=D.concat(F),N=Es.prelude.staticUniforms?il(Es.prelude.staticUniforms):[],K=u.staticUniforms?il(u.staticUniforms):[],J=d?d.getBinderUniforms():[],ee=N.concat(K).concat(J),le=[];for(const we of ee)le.indexOf(we)<0&&le.push(we);const ce=d?d.defines():[];b&&ce.push("#define OVERDRAW_INSPECTOR;"),I&&ce.push("#define TERRAIN3D;");const ye=ce.concat(Es.prelude.fragmentSource,u.fragmentSource).join(`
`),oe=ce.concat(Es.prelude.vertexSource,u.vertexSource).join(`
`),ve=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(ve,ye),k.compileShader(ve),k.attachShader(this.program,ve);const be=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(be,oe),k.compileShader(be),k.attachShader(this.program,be),this.attributes={};const ze={};this.numAttributes=j.length;for(let we=0;we<this.numAttributes;we++)j[we]&&(k.bindAttribLocation(this.program,we,j[we]),this.attributes[j[we]]=we);k.linkProgram(this.program),k.deleteShader(be),k.deleteShader(ve);for(let we=0;we<le.length;we++){const Ne=le[we];if(Ne&&!ze[Ne]){const Ce=k.getUniformLocation(this.program,Ne);Ce&&(ze[Ne]=Ce)}}this.fixedUniforms=g(e,ze),this.terrainUniforms=((we,Ne)=>({u_depth:new l.Uniform1i(we,Ne.u_depth),u_terrain:new l.Uniform1i(we,Ne.u_terrain),u_terrain_dim:new l.Uniform1f(we,Ne.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(we,Ne.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(we,Ne.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(we,Ne.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(we,Ne.u_terrain_exaggeration)}))(e,ze),this.binderUniforms=d?d.getUniforms(e,ze):[]}draw(e,s,u,d,g,b,I,k,D,F,j,N,K,J,ee,le,ce,ye){const oe=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(d),e.setColorMode(g),e.setCullFace(b),k){e.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,k.depthTexture),e.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,k.texture);for(const be in this.terrainUniforms)this.terrainUniforms[be].set(k[be])}for(const be in this.fixedUniforms)this.fixedUniforms[be].set(I[be]);ee&&ee.setUniforms(e,this.binderUniforms,K,{zoom:J});const ve={[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[s];for(const be of N.get()){const ze=be.vaos||(be.vaos={});(ze[D]||(ze[D]=new Tr)).bind(e,this,F,ee?ee.getPaintVertexBuffers():[],j,be.vertexOffset,le,ce,ye),oe.drawElements(s,be.primitiveLength*ve,oe.UNSIGNED_SHORT,be.primitiveOffset*ve*2)}}}function Pl(r,e,s){const u=1/ki(s,1,e.transform.tileZoom),d=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,e.transform.tileZoom)/d,b=g*(s.tileID.canonical.x+s.tileID.wrap*d),I=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,r.fromScale,r.toScale],u_fade:r.t,u_pixel_coord_upper:[b>>16,I>>16],u_pixel_coord_lower:[65535&b,65535&I]}}const fo=(r,e,s,u)=>{const d=e.style.light,g=d.properties.get("position"),b=[g.x,g.y,g.z],I=l.create$1();d.properties.get("anchor")==="viewport"&&l.fromRotation(I,-e.transform.angle),l.transformMat3(b,b,I);const k=d.properties.get("color");return{u_matrix:r,u_lightpos:b,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+s,u_opacity:u}},rl=(r,e,s,u,d,g,b)=>l.extend(fo(r,e,s,u),Pl(g,e,b),{u_height_factor:-Math.pow(2,d.overscaledZ)/b.tileSize/8}),Go=r=>({u_matrix:r}),Zo=(r,e,s,u)=>l.extend(Go(r),Pl(s,e,u)),Ia=(r,e)=>({u_matrix:r,u_world:e}),qs=(r,e,s,u,d)=>l.extend(Zo(r,e,s,u),{u_world:d}),Xo=(r,e,s,u)=>{const d=r.transform;let g,b;if(u.paint.get("circle-pitch-alignment")==="map"){const I=ki(s,1,d.zoom);g=!0,b=[I,I]}else g=!1,b=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:r.translatePosMatrix(e.posMatrix,s,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:r.pixelRatio,u_extrude_scale:b}},rs=(r,e,s)=>{const u=ki(s,1,e.zoom),d=Math.pow(2,e.zoom-s.tileID.overscaledZ),g=s.tileID.overscaleFactor();return{u_matrix:r,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[e.pixelsToGLUnits[0]/(u*d),e.pixelsToGLUnits[1]/(u*d)],u_overscale_factor:g}},Gs=(r,e,s=1)=>({u_matrix:r,u_color:e,u_overlay:0,u_overlay_scale:s}),fs=r=>({u_matrix:r}),Zs=(r,e,s,u)=>({u_matrix:r,u_extrude_scale:ki(e,1,s),u_intensity:u});function mo(r,e){const s=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new l.MercatorCoordinate(0,u/s).toLngLat().lat,new l.MercatorCoordinate(0,(u+1)/s).toLngLat().lat]}const As=(r,e,s,u)=>{const d=r.transform;return{u_matrix:Qs(r,e,s,u),u_ratio:1/ki(e,1,d.zoom),u_device_pixel_ratio:r.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ks=(r,e,s,u,d)=>l.extend(As(r,e,s,d),{u_image:0,u_image_height:u}),Qr=(r,e,s,u,d)=>{const g=r.transform,b=rn(e,g);return{u_matrix:Qs(r,e,s,d),u_texsize:e.imageAtlasTexture.size,u_ratio:1/ki(e,1,g.zoom),u_device_pixel_ratio:r.pixelRatio,u_image:0,u_scale:[b,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Xs=(r,e,s,u,d,g)=>{const b=r.lineAtlas,I=rn(e,r.transform),k=s.layout.get("line-cap")==="round",D=b.getDash(u.from,k),F=b.getDash(u.to,k),j=D.width*d.fromScale,N=F.width*d.toScale;return l.extend(As(r,e,s,g),{u_patternscale_a:[I/j,-D.height/2],u_patternscale_b:[I/N,-F.height/2],u_sdfgamma:b.width/(256*Math.min(j,N)*r.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:F.y,u_mix:d.t})};function rn(r,e){return 1/ki(r,1,e.tileZoom)}function Qs(r,e,s,u){return r.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Sa=(r,e,s,u,d)=>{return{u_matrix:r,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(b=d.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(g=d.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Ea(d.paint.get("raster-hue-rotate"))};var g,b};function Ea(r){r*=Math.PI/180;const e=Math.sin(r),s=Math.cos(r);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const Aa=(r,e,s,u,d,g,b,I,k,D)=>{const F=d.transform;return{u_is_size_zoom_constant:+(r==="constant"||r==="source"),u_is_size_feature_constant:+(r==="constant"||r==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:F.width/F.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:b,u_coord_matrix:I,u_is_text:+k,u_pitch_with_map:+u,u_texsize:D,u_texture:0}},Wo=(r,e,s,u,d,g,b,I,k,D,F)=>{const j=d.transform;return l.extend(Aa(r,e,s,u,d,g,b,I,k,D),{u_gamma_scale:u?Math.cos(j._pitch)*j.cameraToCenterDistance:1,u_device_pixel_ratio:d.pixelRatio,u_is_halo:+F})},nl=(r,e,s,u,d,g,b,I,k,D)=>l.extend(Wo(r,e,s,u,d,g,b,I,!0,k,!0),{u_texsize_icon:D,u_texture_icon:1}),sl=(r,e,s)=>({u_matrix:r,u_opacity:e,u_color:s}),ol=(r,e,s,u,d,g)=>l.extend(function(b,I,k,D){const F=k.imageManager.getPattern(b.from.toString()),j=k.imageManager.getPattern(b.to.toString()),{width:N,height:K}=k.imageManager.getPixelSize(),J=Math.pow(2,D.tileID.overscaledZ),ee=D.tileSize*Math.pow(2,k.transform.tileZoom)/J,le=ee*(D.tileID.canonical.x+D.tileID.wrap*J),ce=ee*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[N,K],u_mix:I.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/ki(D,1,k.transform.tileZoom),u_pixel_coord_upper:[le>>16,ce>>16],u_pixel_coord_lower:[65535&le,65535&ce]}}(u,g,s,d),{u_matrix:r,u_opacity:e}),Ho={fillExtrusion:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_lightpos:new l.Uniform3f(r,e.u_lightpos),u_lightintensity:new l.Uniform1f(r,e.u_lightintensity),u_lightcolor:new l.Uniform3f(r,e.u_lightcolor),u_vertical_gradient:new l.Uniform1f(r,e.u_vertical_gradient),u_opacity:new l.Uniform1f(r,e.u_opacity)}),fillExtrusionPattern:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_lightpos:new l.Uniform3f(r,e.u_lightpos),u_lightintensity:new l.Uniform1f(r,e.u_lightintensity),u_lightcolor:new l.Uniform3f(r,e.u_lightcolor),u_vertical_gradient:new l.Uniform1f(r,e.u_vertical_gradient),u_height_factor:new l.Uniform1f(r,e.u_height_factor),u_image:new l.Uniform1i(r,e.u_image),u_texsize:new l.Uniform2f(r,e.u_texsize),u_pixel_coord_upper:new l.Uniform2f(r,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(r,e.u_pixel_coord_lower),u_scale:new l.Uniform3f(r,e.u_scale),u_fade:new l.Uniform1f(r,e.u_fade),u_opacity:new l.Uniform1f(r,e.u_opacity)}),fill:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix)}),fillPattern:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_image:new l.Uniform1i(r,e.u_image),u_texsize:new l.Uniform2f(r,e.u_texsize),u_pixel_coord_upper:new l.Uniform2f(r,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(r,e.u_pixel_coord_lower),u_scale:new l.Uniform3f(r,e.u_scale),u_fade:new l.Uniform1f(r,e.u_fade)}),fillOutline:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_world:new l.Uniform2f(r,e.u_world)}),fillOutlinePattern:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_world:new l.Uniform2f(r,e.u_world),u_image:new l.Uniform1i(r,e.u_image),u_texsize:new l.Uniform2f(r,e.u_texsize),u_pixel_coord_upper:new l.Uniform2f(r,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(r,e.u_pixel_coord_lower),u_scale:new l.Uniform3f(r,e.u_scale),u_fade:new l.Uniform1f(r,e.u_fade)}),circle:(r,e)=>({u_camera_to_center_distance:new l.Uniform1f(r,e.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(r,e.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(r,e.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(r,e.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(r,e.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(r,e.u_matrix)}),collisionBox:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_camera_to_center_distance:new l.Uniform1f(r,e.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(r,e.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(r,e.u_extrude_scale),u_overscale_factor:new l.Uniform1f(r,e.u_overscale_factor)}),collisionCircle:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_inv_matrix:new l.UniformMatrix4f(r,e.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(r,e.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(r,e.u_viewport_size)}),debug:(r,e)=>({u_color:new l.UniformColor(r,e.u_color),u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_overlay:new l.Uniform1i(r,e.u_overlay),u_overlay_scale:new l.Uniform1f(r,e.u_overlay_scale)}),clippingMask:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix)}),heatmap:(r,e)=>({u_extrude_scale:new l.Uniform1f(r,e.u_extrude_scale),u_intensity:new l.Uniform1f(r,e.u_intensity),u_matrix:new l.UniformMatrix4f(r,e.u_matrix)}),heatmapTexture:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_world:new l.Uniform2f(r,e.u_world),u_image:new l.Uniform1i(r,e.u_image),u_color_ramp:new l.Uniform1i(r,e.u_color_ramp),u_opacity:new l.Uniform1f(r,e.u_opacity)}),hillshade:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_image:new l.Uniform1i(r,e.u_image),u_latrange:new l.Uniform2f(r,e.u_latrange),u_light:new l.Uniform2f(r,e.u_light),u_shadow:new l.UniformColor(r,e.u_shadow),u_highlight:new l.UniformColor(r,e.u_highlight),u_accent:new l.UniformColor(r,e.u_accent)}),hillshadePrepare:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_image:new l.Uniform1i(r,e.u_image),u_dimension:new l.Uniform2f(r,e.u_dimension),u_zoom:new l.Uniform1f(r,e.u_zoom),u_unpack:new l.Uniform4f(r,e.u_unpack)}),line:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_ratio:new l.Uniform1f(r,e.u_ratio),u_device_pixel_ratio:new l.Uniform1f(r,e.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(r,e.u_units_to_pixels)}),lineGradient:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_ratio:new l.Uniform1f(r,e.u_ratio),u_device_pixel_ratio:new l.Uniform1f(r,e.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(r,e.u_units_to_pixels),u_image:new l.Uniform1i(r,e.u_image),u_image_height:new l.Uniform1f(r,e.u_image_height)}),linePattern:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_texsize:new l.Uniform2f(r,e.u_texsize),u_ratio:new l.Uniform1f(r,e.u_ratio),u_device_pixel_ratio:new l.Uniform1f(r,e.u_device_pixel_ratio),u_image:new l.Uniform1i(r,e.u_image),u_units_to_pixels:new l.Uniform2f(r,e.u_units_to_pixels),u_scale:new l.Uniform3f(r,e.u_scale),u_fade:new l.Uniform1f(r,e.u_fade)}),lineSDF:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_ratio:new l.Uniform1f(r,e.u_ratio),u_device_pixel_ratio:new l.Uniform1f(r,e.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(r,e.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(r,e.u_patternscale_a),u_patternscale_b:new l.Uniform2f(r,e.u_patternscale_b),u_sdfgamma:new l.Uniform1f(r,e.u_sdfgamma),u_image:new l.Uniform1i(r,e.u_image),u_tex_y_a:new l.Uniform1f(r,e.u_tex_y_a),u_tex_y_b:new l.Uniform1f(r,e.u_tex_y_b),u_mix:new l.Uniform1f(r,e.u_mix)}),raster:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_tl_parent:new l.Uniform2f(r,e.u_tl_parent),u_scale_parent:new l.Uniform1f(r,e.u_scale_parent),u_buffer_scale:new l.Uniform1f(r,e.u_buffer_scale),u_fade_t:new l.Uniform1f(r,e.u_fade_t),u_opacity:new l.Uniform1f(r,e.u_opacity),u_image0:new l.Uniform1i(r,e.u_image0),u_image1:new l.Uniform1i(r,e.u_image1),u_brightness_low:new l.Uniform1f(r,e.u_brightness_low),u_brightness_high:new l.Uniform1f(r,e.u_brightness_high),u_saturation_factor:new l.Uniform1f(r,e.u_saturation_factor),u_contrast_factor:new l.Uniform1f(r,e.u_contrast_factor),u_spin_weights:new l.Uniform3f(r,e.u_spin_weights)}),symbolIcon:(r,e)=>({u_is_size_zoom_constant:new l.Uniform1i(r,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(r,e.u_is_size_feature_constant),u_size_t:new l.Uniform1f(r,e.u_size_t),u_size:new l.Uniform1f(r,e.u_size),u_camera_to_center_distance:new l.Uniform1f(r,e.u_camera_to_center_distance),u_pitch:new l.Uniform1f(r,e.u_pitch),u_rotate_symbol:new l.Uniform1i(r,e.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(r,e.u_aspect_ratio),u_fade_change:new l.Uniform1f(r,e.u_fade_change),u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(r,e.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(r,e.u_coord_matrix),u_is_text:new l.Uniform1i(r,e.u_is_text),u_pitch_with_map:new l.Uniform1i(r,e.u_pitch_with_map),u_texsize:new l.Uniform2f(r,e.u_texsize),u_texture:new l.Uniform1i(r,e.u_texture)}),symbolSDF:(r,e)=>({u_is_size_zoom_constant:new l.Uniform1i(r,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(r,e.u_is_size_feature_constant),u_size_t:new l.Uniform1f(r,e.u_size_t),u_size:new l.Uniform1f(r,e.u_size),u_camera_to_center_distance:new l.Uniform1f(r,e.u_camera_to_center_distance),u_pitch:new l.Uniform1f(r,e.u_pitch),u_rotate_symbol:new l.Uniform1i(r,e.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(r,e.u_aspect_ratio),u_fade_change:new l.Uniform1f(r,e.u_fade_change),u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(r,e.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(r,e.u_coord_matrix),u_is_text:new l.Uniform1i(r,e.u_is_text),u_pitch_with_map:new l.Uniform1i(r,e.u_pitch_with_map),u_texsize:new l.Uniform2f(r,e.u_texsize),u_texture:new l.Uniform1i(r,e.u_texture),u_gamma_scale:new l.Uniform1f(r,e.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(r,e.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(r,e.u_is_halo)}),symbolTextAndIcon:(r,e)=>({u_is_size_zoom_constant:new l.Uniform1i(r,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(r,e.u_is_size_feature_constant),u_size_t:new l.Uniform1f(r,e.u_size_t),u_size:new l.Uniform1f(r,e.u_size),u_camera_to_center_distance:new l.Uniform1f(r,e.u_camera_to_center_distance),u_pitch:new l.Uniform1f(r,e.u_pitch),u_rotate_symbol:new l.Uniform1i(r,e.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(r,e.u_aspect_ratio),u_fade_change:new l.Uniform1f(r,e.u_fade_change),u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(r,e.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(r,e.u_coord_matrix),u_is_text:new l.Uniform1i(r,e.u_is_text),u_pitch_with_map:new l.Uniform1i(r,e.u_pitch_with_map),u_texsize:new l.Uniform2f(r,e.u_texsize),u_texsize_icon:new l.Uniform2f(r,e.u_texsize_icon),u_texture:new l.Uniform1i(r,e.u_texture),u_texture_icon:new l.Uniform1i(r,e.u_texture_icon),u_gamma_scale:new l.Uniform1f(r,e.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(r,e.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(r,e.u_is_halo)}),background:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_opacity:new l.Uniform1f(r,e.u_opacity),u_color:new l.UniformColor(r,e.u_color)}),backgroundPattern:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_opacity:new l.Uniform1f(r,e.u_opacity),u_image:new l.Uniform1i(r,e.u_image),u_pattern_tl_a:new l.Uniform2f(r,e.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(r,e.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(r,e.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(r,e.u_pattern_br_b),u_texsize:new l.Uniform2f(r,e.u_texsize),u_mix:new l.Uniform1f(r,e.u_mix),u_pattern_size_a:new l.Uniform2f(r,e.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(r,e.u_pattern_size_b),u_scale_a:new l.Uniform1f(r,e.u_scale_a),u_scale_b:new l.Uniform1f(r,e.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(r,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(r,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(r,e.u_tile_units_to_pixels)}),terrain:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_texture:new l.Uniform1i(r,e.u_texture)}),terrainDepth:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix)}),terrainCoords:(r,e)=>({u_matrix:new l.UniformMatrix4f(r,e.u_matrix),u_texture:new l.Uniform1i(r,e.u_texture),u_terrain_coords_id:new l.Uniform1f(r,e.u_terrain_coords_id)})};class Ko{constructor(e,s,u){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ka={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class za{constructor(e,s,u,d){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=d,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let u=0;u<this.attributes.length;u++){const d=s.attributes[this.attributes[u].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,s,u){for(let d=0;d<this.attributes.length;d++){const g=this.attributes[d],b=s.attributes[g.name];b!==void 0&&e.vertexAttribPointer(b,g.components,e[ka[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class sr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class er extends sr{getDefault(){return l.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Yo extends sr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class go extends sr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class zn extends sr{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ca extends sr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ln extends sr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class _o extends sr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class yo extends sr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class xo extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class vo extends sr{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Jo extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class bo extends sr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class wo extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class Pa extends sr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class $o extends sr{getDefault(){return l.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class eo extends sr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ml extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class To extends sr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class dc extends sr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class fc extends sr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class mc extends sr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class gc extends sr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class al extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Ma extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Qo extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ea extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ns extends sr{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ll extends sr{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class cl extends sr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ta extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class jn extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Da extends sr{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class Kn extends Da{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ss extends Da{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ul{constructor(e,s,u,d){this.context=e,this.width=s,this.height=u;const g=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new Kn(e,g),d&&(this.depthAttachment=new ss(e,g))}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class Vr{constructor(e,s,u){this.blendFunction=e,this.blendColor=s,this.mask=u}}Vr.Replace=[1,0],Vr.disabled=new Vr(Vr.Replace,l.Color.transparent,[!1,!1,!1,!1]),Vr.unblended=new Vr(Vr.Replace,l.Color.transparent,[!0,!0,!0,!0]),Vr.alphaBlended=new Vr([1,771],l.Color.transparent,[!0,!0,!0,!0]);class qt{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new er(this),this.clearDepth=new Yo(this),this.clearStencil=new go(this),this.colorMask=new zn(this),this.depthMask=new Ca(this),this.stencilMask=new Ln(this),this.stencilFunc=new _o(this),this.stencilOp=new yo(this),this.stencilTest=new xo(this),this.depthRange=new vo(this),this.depthTest=new Jo(this),this.depthFunc=new bo(this),this.blend=new wo(this),this.blendFunc=new Pa(this),this.blendColor=new $o(this),this.blendEquation=new eo(this),this.cullFace=new Ml(this),this.cullFaceSide=new To(this),this.frontFace=new dc(this),this.program=new fc(this),this.activeTexture=new mc(this),this.viewport=new gc(this),this.bindFramebuffer=new al(this),this.bindRenderbuffer=new Ma(this),this.bindTexture=new Qo(this),this.bindVertexBuffer=new ea(this),this.bindElementBuffer=new ns(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ll(this),this.pixelStoreUnpack=new cl(this),this.pixelStoreUnpackPremultiplyAlpha=new ta(this),this.pixelStoreUnpackFlipY=new jn(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Ko(this,e,s)}createVertexBuffer(e,s,u){return new za(this,e,s,u)}createRenderbuffer(e,s,u){const d=this.gl,g=d.createRenderbuffer();return this.bindRenderbuffer.set(g),d.renderbufferStorage(d.RENDERBUFFER,e,s,u),this.bindRenderbuffer.set(null),g}createFramebuffer(e,s,u){return new ul(this,e,s,u)}clear({color:e,depth:s}){const u=this.gl;let d=0;e&&(d|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(d|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){re(e.blendFunction,Vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Li{constructor(e,s,u){this.func=e,this.mask=s,this.range=u}}Li.ReadOnly=!1,Li.ReadWrite=!0,Li.disabled=new Li(519,Li.ReadOnly,[0,1]);const or=7680;class kr{constructor(e,s,u,d,g,b){this.test=e,this.ref=s,this.mask=u,this.fail=d,this.depthFail=g,this.pass=b}}kr.disabled=new kr({func:519,mask:0},0,0,or,or,or);class yi{constructor(e,s,u){this.enable=e,this.mode=s,this.frontFace=u}}let Nr;function ia(r,e,s,u,d,g,b){const I=r.context,k=I.gl,D=r.useProgram("collisionBox"),F=[];let j=0,N=0;for(let oe=0;oe<u.length;oe++){const ve=u[oe],be=e.getTile(ve),ze=be.getBucket(s);if(!ze)continue;let we=ve.posMatrix;d[0]===0&&d[1]===0||(we=r.translatePosMatrix(ve.posMatrix,be,d,g));const Ne=b?ze.textCollisionBox:ze.iconCollisionBox,Ce=ze.collisionCircleArray;if(Ce.length>0){const ut=l.create(),yt=we;l.mul(ut,ze.placementInvProjMatrix,r.transform.glCoordMatrix),l.mul(ut,ut,ze.placementViewportMatrix),F.push({circleArray:Ce,circleOffset:N,transform:yt,invTransform:ut,coord:ve}),j+=Ce.length/4,N=j}Ne&&D.draw(I,k.LINES,Li.disabled,kr.disabled,r.colorModeForRenderPass(),yi.disabled,rs(we,r.transform,be),r.style.terrain&&r.style.terrain.getTerrainData(ve),s.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,r.transform.zoom,null,null,Ne.collisionVertexBuffer)}if(!b||!F.length)return;const K=r.useProgram("collisionCircle"),J=new l.CollisionCircleLayoutArray;J.resize(4*j),J._trim();let ee=0;for(const oe of F)for(let ve=0;ve<oe.circleArray.length/4;ve++){const be=4*ve,ze=oe.circleArray[be+0],we=oe.circleArray[be+1],Ne=oe.circleArray[be+2],Ce=oe.circleArray[be+3];J.emplace(ee++,ze,we,Ne,Ce,0),J.emplace(ee++,ze,we,Ne,Ce,1),J.emplace(ee++,ze,we,Ne,Ce,2),J.emplace(ee++,ze,we,Ne,Ce,3)}(!Nr||Nr.length<2*j)&&(Nr=function(oe){const ve=2*oe,be=new l.QuadTriangleArray;be.resize(ve),be._trim();for(let ze=0;ze<ve;ze++){const we=6*ze;be.uint16[we+0]=4*ze+0,be.uint16[we+1]=4*ze+1,be.uint16[we+2]=4*ze+2,be.uint16[we+3]=4*ze+2,be.uint16[we+4]=4*ze+3,be.uint16[we+5]=4*ze+0}return be}(j));const le=I.createIndexBuffer(Nr,!0),ce=I.createVertexBuffer(J,l.collisionCircleLayout.members,!0);for(const oe of F){const ve={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(ye=r.transform).cameraToCenterDistance,u_viewport_size:[ye.width,ye.height]};K.draw(I,k.TRIANGLES,Li.disabled,kr.disabled,r.colorModeForRenderPass(),yi.disabled,ve,r.style.terrain&&r.style.terrain.getTerrainData(oe.coord),s.id,ce,le,l.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,r.transform.zoom,null,null,null)}var ye;ce.destroy(),le.destroy()}yi.disabled=new yi(!1,1029,2305),yi.backCCW=new yi(!0,1029,2305);const La=l.identity(new Float32Array(16));function _c(r,e,s,u,d,g){const{horizontalAlign:b,verticalAlign:I}=l.getAnchorAlignment(r),k=-(b-.5)*e,D=-(I-.5)*s,F=l.evaluateVariableOffset(r,u);return new l.pointGeometry((k/d+F[0])*g,(D/d+F[1])*g)}function ra(r,e,s,u,d,g,b,I,k,D,F){const j=r.text.placedSymbolArray,N=r.text.dynamicLayoutVertexArray,K=r.icon.dynamicLayoutVertexArray,J={};N.clear();for(let ee=0;ee<j.length;ee++){const le=j.get(ee),ce=r.allowVerticalPlacement&&!le.placedOrientation,ye=le.hidden||!le.crossTileID||ce?null:u[le.crossTileID];if(ye){const oe=new l.pointGeometry(le.anchorX,le.anchorY),ve=Gt(oe,s?b:g,F),be=hi(d.cameraToCenterDistance,ve.signedDistanceFromCamera);let ze=l.evaluateSizeForFeature(r.textSizeData,k,le)*be/l.ONE_EM;s&&(ze*=r.tilePixelRatio/I);const{width:we,height:Ne,anchor:Ce,textOffset:ut,textBoxScale:yt}=ye,xt=_c(Ce,we,Ne,ut,yt,ze),Ft=s?Gt(oe.add(xt),g,F).point:ve.point.add(e?xt.rotate(-d.angle):xt),ti=r.allowVerticalPlacement&&le.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let It=0;It<le.numGlyphs;It++)l.addDynamicAttributes(N,Ft,ti);D&&le.associatedIconIndex>=0&&(J[le.associatedIconIndex]={shiftedAnchor:Ft,angle:ti})}else Mt(le.numGlyphs,N)}if(D){K.clear();const ee=r.icon.placedSymbolArray;for(let le=0;le<ee.length;le++){const ce=ee.get(le);if(ce.hidden)Mt(ce.numGlyphs,K);else{const ye=J[le];if(ye)for(let oe=0;oe<ce.numGlyphs;oe++)l.addDynamicAttributes(K,ye.shiftedAnchor,ye.angle);else Mt(ce.numGlyphs,K)}}r.icon.dynamicLayoutVertexBuffer.updateData(K)}r.text.dynamicLayoutVertexBuffer.updateData(N)}function to(r,e,s){return s.iconsInText&&e?"symbolTextAndIcon":r?"symbolSDF":"symbolIcon"}function Ws(r,e,s,u,d,g,b,I,k,D,F,j){const N=r.context,K=N.gl,J=r.transform,ee=I==="map",le=k==="map",ce=I!=="viewport"&&s.layout.get("symbol-placement")!=="point",ye=ee&&!le&&!ce,oe=!s.layout.get("symbol-sort-key").isConstant();let ve=!1;const be=r.depthModeForSublayer(0,Li.ReadOnly),ze=s.layout.get("text-variable-anchor"),we=[];for(const Ne of u){const Ce=e.getTile(Ne),ut=Ce.getBucket(s);if(!ut)continue;const yt=d?ut.text:ut.icon;if(!yt||!yt.segments.get().length)continue;const xt=yt.programConfigurations.get(s.id),Ft=d||ut.sdfIcons,ti=d?ut.textSizeData:ut.iconSizeData,It=le||J.pitch!==0,ii=r.useProgram(to(Ft,d,ut),xt),oi=l.evaluateSizeForZoom(ti,J.zoom),xi=r.style.terrain&&r.style.terrain.getTerrainData(Ne);let vi,Gi,Yr,Pn,qr=[0,0],_n=null;if(d){if(Gi=Ce.glyphAtlasTexture,Yr=K.LINEAR,vi=Ce.glyphAtlasTexture.size,ut.iconsInText){qr=Ce.imageAtlasTexture.size,_n=Ce.imageAtlasTexture;const Un=ti.kind==="composite"||ti.kind==="camera";Pn=It||r.options.rotating||r.options.zooming||Un?K.LINEAR:K.NEAREST}}else{const Un=s.layout.get("icon-size").constantOr(0)!==1||ut.iconsNeedLinear;Gi=Ce.imageAtlasTexture,Yr=Ft||r.options.rotating||r.options.zooming||Un||It?K.LINEAR:K.NEAREST,vi=Ce.imageAtlasTexture.size}const Sn=ki(Ce,1,r.transform.zoom),Or=$r(Ne.posMatrix,le,ee,r.transform,Sn),Ri=yr(Ne.posMatrix,le,ee,r.transform,Sn),Yi=ze&&ut.hasTextData(),Zi=s.layout.get("icon-text-fit")!=="none"&&Yi&&ut.hasIconData();if(ce){const Un=r.style.terrain?(bs,Js)=>r.style.terrain.getElevation(Ne,bs,Js):null,vs=s.layout.get("text-rotation-alignment")==="map";xr(ut,Ne.posMatrix,r,d,Or,Ri,le,D,vs,Un)}const rr=r.translatePosMatrix(Ne.posMatrix,Ce,g,b),wi=ce||d&&ze||Zi?La:Or,Fi=r.translatePosMatrix(Ri,Ce,g,b,!0),Gr=Ft&&s.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mn;Mn=Ft?ut.iconsInText?nl(ti.kind,oi,ye,le,r,rr,wi,Fi,vi,qr):Wo(ti.kind,oi,ye,le,r,rr,wi,Fi,d,vi,!0):Aa(ti.kind,oi,ye,le,r,rr,wi,Fi,d,vi);const Lr={program:ii,buffers:yt,uniformValues:Mn,atlasTexture:Gi,atlasTextureIcon:_n,atlasInterpolation:Yr,atlasInterpolationIcon:Pn,isSDF:Ft,hasHalo:Gr};if(oe&&ut.canOverlap){ve=!0;const Un=yt.segments.get();for(const vs of Un)we.push({segments:new l.SegmentVector([vs]),sortKey:vs.sortKey,state:Lr,terrainData:xi})}else we.push({segments:yt.segments,sortKey:0,state:Lr,terrainData:xi})}ve&&we.sort((Ne,Ce)=>Ne.sortKey-Ce.sortKey);for(const Ne of we){const Ce=Ne.state;if(N.activeTexture.set(K.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,K.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(N.activeTexture.set(K.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Ce.isSDF){const ut=Ce.uniformValues;Ce.hasHalo&&(ut.u_is_halo=1,io(Ce.buffers,Ne.segments,s,r,Ce.program,be,F,j,ut,Ne.terrainData)),ut.u_is_halo=0}io(Ce.buffers,Ne.segments,s,r,Ce.program,be,F,j,Ce.uniformValues,Ne.terrainData)}}function io(r,e,s,u,d,g,b,I,k,D){const F=u.context;d.draw(F,F.gl.TRIANGLES,g,b,I,yi.disabled,k,D,s.id,r.layoutVertexBuffer,r.indexBuffer,e,s.paint,u.transform.zoom,r.programConfigurations.get(s.id),r.dynamicLayoutVertexBuffer,r.opacityVertexBuffer)}function ro(r,e,s,u,d,g,b){const I=r.context.gl,k=s.paint.get("fill-pattern"),D=k&&k.constantOr(1),F=s.getCrossfadeParameters();let j,N,K,J,ee;b?(N=D&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=I.LINES):(N=D?"fillPattern":"fill",j=I.TRIANGLES);for(const le of u){const ce=e.getTile(le);if(D&&!ce.patternsLoaded())continue;const ye=ce.getBucket(s);if(!ye)continue;const oe=ye.programConfigurations.get(s.id),ve=r.useProgram(N,oe),be=r.style.terrain&&r.style.terrain.getTerrainData(le);D&&(r.context.activeTexture.set(I.TEXTURE0),ce.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),oe.updatePaintBuffers(F));const ze=k.constantOr(null);if(ze&&ce.imageAtlas){const Ce=ce.imageAtlas,ut=Ce.patternPositions[ze.to.toString()],yt=Ce.patternPositions[ze.from.toString()];ut&&yt&&oe.setConstantPatternPositions(ut,yt)}const we=be?le:null,Ne=r.translatePosMatrix(we?we.posMatrix:le.posMatrix,ce,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(b){J=ye.indexBuffer2,ee=ye.segments2;const Ce=[I.drawingBufferWidth,I.drawingBufferHeight];K=N==="fillOutlinePattern"&&D?qs(Ne,r,F,ce,Ce):Ia(Ne,Ce)}else J=ye.indexBuffer,ee=ye.segments,K=D?Zo(Ne,r,F,ce):Go(Ne);ve.draw(r.context,j,d,r.stencilModeForClipping(le),g,yi.disabled,K,be,s.id,ye.layoutVertexBuffer,J,ee,s.paint,r.transform.zoom,oe)}}function Io(r,e,s,u,d,g,b){const I=r.context,k=I.gl,D=s.paint.get("fill-extrusion-pattern"),F=D.constantOr(1),j=s.getCrossfadeParameters(),N=s.paint.get("fill-extrusion-opacity");for(const K of u){const J=e.getTile(K),ee=J.getBucket(s);if(!ee)continue;const le=r.style.terrain&&r.style.terrain.getTerrainData(K),ce=ee.programConfigurations.get(s.id),ye=r.useProgram(F?"fillExtrusionPattern":"fillExtrusion",ce);F&&(r.context.activeTexture.set(k.TEXTURE0),J.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ce.updatePaintBuffers(j));const oe=D.constantOr(null);if(oe&&J.imageAtlas){const we=J.imageAtlas,Ne=we.patternPositions[oe.to.toString()],Ce=we.patternPositions[oe.from.toString()];Ne&&Ce&&ce.setConstantPatternPositions(Ne,Ce)}const ve=r.translatePosMatrix(K.posMatrix,J,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),be=s.paint.get("fill-extrusion-vertical-gradient"),ze=F?rl(ve,r,be,N,K,j,J):fo(ve,r,be,N);ye.draw(I,I.gl.TRIANGLES,d,g,b,yi.backCCW,ze,le,s.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,s.paint,r.transform.zoom,ce,r.style.terrain&&ee.centroidVertexBuffer)}}function zs(r,e,s,u,d,g,b){const I=r.context,k=I.gl,D=s.fbo;if(!D)return;const F=r.useProgram("hillshade"),j=r.style.terrain&&r.style.terrain.getTerrainData(e);I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,D.colorAttachment.get()),F.draw(I,k.TRIANGLES,d,g,b,yi.disabled,((N,K,J,ee)=>{const le=J.paint.get("hillshade-shadow-color"),ce=J.paint.get("hillshade-highlight-color"),ye=J.paint.get("hillshade-accent-color");let oe=J.paint.get("hillshade-illumination-direction")*(Math.PI/180);J.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=N.transform.angle);const ve=!N.options.moving;return{u_matrix:ee?ee.posMatrix:N.transform.calculatePosMatrix(K.tileID.toUnwrapped(),ve),u_image:0,u_latrange:mo(0,K.tileID),u_light:[J.paint.get("hillshade-exaggeration"),oe],u_shadow:le,u_highlight:ce,u_accent:ye}})(r,s,u,j?e:null),j,u.id,r.rasterBoundsBuffer,r.quadTriangleIndexBuffer,r.rasterBoundsSegments)}function no(r,e,s,u,d,g){const b=r.context,I=b.gl,k=e.dem;if(k&&k.data){const D=k.dim,F=k.stride,j=k.getPixels();if(b.activeTexture.set(I.TEXTURE1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||r.getTileTexture(F),e.demTexture){const K=e.demTexture;K.update(j,{premultiply:!1}),K.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else e.demTexture=new Fe(b,j,I.RGBA,{premultiply:!1}),e.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);b.activeTexture.set(I.TEXTURE0);let N=e.fbo;if(!N){const K=new Fe(b,{width:D,height:D,data:null},I.RGBA);K.bind(I.LINEAR,I.CLAMP_TO_EDGE),N=e.fbo=b.createFramebuffer(D,D,!0),N.colorAttachment.set(K.texture)}b.bindFramebuffer.set(N.framebuffer),b.viewport.set([0,0,D,D]),r.useProgram("hillshadePrepare").draw(b,I.TRIANGLES,u,d,g,yi.disabled,((K,J)=>{const ee=J.stride,le=l.create();return l.ortho(le,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(le,le,[0,-l.EXTENT,0]),{u_matrix:le,u_image:1,u_dimension:[ee,ee],u_zoom:K.overscaledZ,u_unpack:J.getUnpackVector()}})(e.tileID,k),null,s.id,r.rasterBoundsBuffer,r.quadTriangleIndexBuffer,r.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function ln(r,e,s,u,d,g){const b=u.paint.get("raster-fade-duration");if(!g&&b>0){const I=l.exported.now(),k=(I-r.timeAdded)/b,D=e?(I-e.timeAdded)/b:-1,F=s.getSource(),j=d.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),N=!e||Math.abs(e.tileID.overscaledZ-j)>Math.abs(r.tileID.overscaledZ-j),K=N&&r.refreshedUponExpiration?1:l.clamp(N?k:1-D,0,1);return r.refreshedUponExpiration&&k>=1&&(r.refreshedUponExpiration=!1),e?{opacity:1,mix:1-K}:{opacity:K,mix:0}}return{opacity:1,mix:0}}const hl=new l.Color(1,0,0,1),pl=new l.Color(0,1,0,1),dl=new l.Color(0,0,1,1),os=new l.Color(1,0,1,1),so=new l.Color(0,1,1,1);function So(r,e,s,u){Cs(r,0,e+s/2,r.transform.width,s,u)}function fl(r,e,s,u){Cs(r,e-s/2,0,s,r.transform.height,u)}function Cs(r,e,s,u,d,g){const b=r.context,I=b.gl;I.enable(I.SCISSOR_TEST),I.scissor(e*r.pixelRatio,s*r.pixelRatio,u*r.pixelRatio,d*r.pixelRatio),b.clear({color:g}),I.disable(I.SCISSOR_TEST)}function Ba(r,e,s){const u=r.context,d=u.gl,g=s.posMatrix,b=r.useProgram("debug"),I=Li.disabled,k=kr.disabled,D=r.colorModeForRenderPass(),F="$debug",j=r.style.terrain&&r.style.terrain.getTerrainData(s);u.activeTexture.set(d.TEXTURE0),r.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE);const N=e.getTileByID(s.key).latestRawTileData,K=Math.floor((N&&N.byteLength||0)/1024),J=e.getTile(s).tileSize,ee=512/Math.min(J,512)*(s.overscaledZ/r.transform.zoom)*.5;let le=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(le+=` => ${s.overscaledZ}`),function(ce,ye){ce.initDebugOverlayCanvas();const oe=ce.debugOverlayCanvas,ve=ce.context.gl,be=ce.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,oe.width,oe.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(ye,5,5),be.strokeText(ye,5,5),ce.debugOverlayTexture.update(oe),ce.debugOverlayTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}(r,`${le} ${K}kB`),b.draw(u,d.TRIANGLES,I,k,Vr.alphaBlended,yi.disabled,Gs(g,l.Color.transparent,ee),null,F,r.debugBuffer,r.quadTriangleIndexBuffer,r.debugSegments),b.draw(u,d.LINE_STRIP,I,k,D,yi.disabled,Gs(g,l.Color.red),j,F,r.debugBuffer,r.tileBorderIndexBuffer,r.debugSegments)}function Ra(r,e,s){const u=r.context,d=u.gl,g=r.colorModeForRenderPass(),b=new Li(d.LEQUAL,Li.ReadWrite,r.depthRangeFor3D),I=r.useProgram("terrain"),k=e.getTerrainMesh(),D=e.getTerrainData(s.tileID);u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),u.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,e.getRTTFramebuffer().colorAttachment.get());const F=r.transform.calculatePosMatrix(s.tileID.toUnwrapped());I.draw(u,d.TRIANGLES,b,kr.disabled,g,yi.backCCW,{u_matrix:F,u_texture:0},D,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}function Ps(r,e,s,u){const d=r.context,g=s.tileSize*e.qualityFactor;s.textures[u]||(s.textures[u]=r.getTileTexture(g)||new Fe(d,{width:g,height:g,data:null},d.gl.RGBA),s.textures[u].bind(d.gl.LINEAR,d.gl.CLAMP_TO_EDGE),u===0&&e.sourceCache.renderHistory.unshift(s.tileID.key));const b=e.getRTTFramebuffer();b.colorAttachment.set(s.textures[u].texture),d.bindFramebuffer.set(b.framebuffer),d.viewport.set([0,0,g,g])}class na{constructor(e){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=e,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=e.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const e=this.painter.style,s=e.terrain;for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const d=e.sourceCaches[u].getVisibleCoordinates();for(const g of d){const b=s.sourceCache.getTerrainCoords(g);for(const I in b)this._coordsDescendingInv[u][I]||(this._coordsDescendingInv[u][I]=[]),this._coordsDescendingInv[u][I].push(b[I])}}for(const u of e._order){const d=e._layers[u],g=d.source;if(this._renderToTexture[d.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const b in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][b]=this._coordsDescendingInv[g][b].map(I=>I.key).sort().join()}}return this._renderableTiles.forEach(u=>{for(const d in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[d][u.tileID.key];g&&g!==u.textureCoords[d]&&u.clearTextures(this.painter),s.needsRerender(d,u.tileID)&&u.clearTextures(this.painter)}this._rerender[u.tileID.key]=!u.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(e){const s=e.type,u=this.painter,d=u.style._order,g=u.currentLayer,b=g+1===d.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(d[g]),!b))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&b){this._prevType=s;const I=this._stacks.length-1,k=this._stacks[I]||[];for(const D of this._renderableTiles){if(Ps(u,u.style.terrain,D,I),this._rerender[D.tileID.key]){u.context.clear({color:l.Color.transparent});for(let F=0;F<k.length;F++){const j=u.style._layers[k[F]],N=j.source?this._coordsDescendingInv[j.source][D.tileID.key]:[D.tileID];u._renderTileClippingMasks(j,N),u.renderLayer(u,u.style.sourceCaches[j.source],j,N),j.source&&(D.textureCoords[j.source]=this._coordsDescendingInvStr[j.source][D.tileID.key])}}Ra(u,u.style.terrain,D)}if(s==="hillshade"){this._stacks.push([d[g]]);for(const D of this._renderableTiles){const F=this._coordsDescendingInv[e.source][D.tileID.key];Ps(u,u.style.terrain,D,this._stacks.length-1),u.context.clear({color:l.Color.transparent}),u._renderTileClippingMasks(e,F),u.renderLayer(u,u.style.sourceCaches[e.source],e,F),Ra(u,u.style.terrain,D)}return!0}return this._renderToTexture[s]}return!1}}const Eo={symbol:function(r,e,s,u,d){if(r.renderPass!=="translucent")return;const g=kr.disabled,b=r.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(I,k,D,F,j,N,K){const J=k.transform,ee=j==="map",le=N==="map";for(const ce of I){const ye=F.getTile(ce),oe=ye.getBucket(D);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const ve=l.evaluateSizeForZoom(oe.textSizeData,J.zoom),be=ki(ye,1,k.transform.zoom),ze=$r(ce.posMatrix,le,ee,k.transform,be),we=D.layout.get("icon-text-fit")!=="none"&&oe.hasIconData();if(ve){const Ne=Math.pow(2,J.zoom-ye.tileID.overscaledZ);ra(oe,ee,le,K,J,ze,ce.posMatrix,Ne,ve,we,k.style.terrain?(Ce,ut)=>k.style.terrain.getElevation(ce,Ce,ut):null)}}}(u,r,s,e,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),d),s.paint.get("icon-opacity").constantOr(1)!==0&&Ws(r,e,s,u,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),g,b),s.paint.get("text-opacity").constantOr(1)!==0&&Ws(r,e,s,u,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),g,b),e.map.showCollisionBoxes&&(ia(r,e,s,u,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),ia(r,e,s,u,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(r,e,s,u){if(r.renderPass!=="translucent")return;const d=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),b=s.paint.get("circle-stroke-opacity"),I=!s.layout.get("circle-sort-key").isConstant();if(d.constantOr(1)===0&&(g.constantOr(1)===0||b.constantOr(1)===0))return;const k=r.context,D=k.gl,F=r.depthModeForSublayer(0,Li.ReadOnly),j=kr.disabled,N=r.colorModeForRenderPass(),K=[];for(let J=0;J<u.length;J++){const ee=u[J],le=e.getTile(ee),ce=le.getBucket(s);if(!ce)continue;const ye=ce.programConfigurations.get(s.id),oe=r.useProgram("circle",ye),ve=ce.layoutVertexBuffer,be=ce.indexBuffer,ze=r.style.terrain&&r.style.terrain.getTerrainData(ee),we={programConfiguration:ye,program:oe,layoutVertexBuffer:ve,indexBuffer:be,uniformValues:Xo(r,ee,le,s),terrainData:ze};if(I){const Ne=ce.segments.get();for(const Ce of Ne)K.push({segments:new l.SegmentVector([Ce]),sortKey:Ce.sortKey,state:we})}else K.push({segments:ce.segments,sortKey:0,state:we})}I&&K.sort((J,ee)=>J.sortKey-ee.sortKey);for(const J of K){const{programConfiguration:ee,program:le,layoutVertexBuffer:ce,indexBuffer:ye,uniformValues:oe,terrainData:ve}=J.state;le.draw(k,D.TRIANGLES,F,j,N,yi.disabled,oe,ve,s.id,ce,ye,J.segments,s.paint,r.transform.zoom,ee)}},heatmap:function(r,e,s,u){if(s.paint.get("heatmap-opacity")!==0)if(r.renderPass==="offscreen"){const d=r.context,g=d.gl,b=kr.disabled,I=new Vr([g.ONE,g.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(k,D,F){const j=k.gl;k.activeTexture.set(j.TEXTURE1),k.viewport.set([0,0,D.width/4,D.height/4]);let N=F.heatmapFbo;if(N)j.bindTexture(j.TEXTURE_2D,N.colorAttachment.get()),k.bindFramebuffer.set(N.framebuffer);else{const K=j.createTexture();j.bindTexture(j.TEXTURE_2D,K),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),N=F.heatmapFbo=k.createFramebuffer(D.width/4,D.height/4,!1),function(J,ee,le,ce){const ye=J.gl;ye.texImage2D(ye.TEXTURE_2D,0,ye.RGBA,ee.width/4,ee.height/4,0,ye.RGBA,J.extRenderToTextureHalfFloat?J.extTextureHalfFloat.HALF_FLOAT_OES:ye.UNSIGNED_BYTE,null),ce.colorAttachment.set(le)}(k,D,K,N)}})(d,r,s),d.clear({color:l.Color.transparent});for(let k=0;k<u.length;k++){const D=u[k];if(e.hasRenderableParent(D))continue;const F=e.getTile(D),j=F.getBucket(s);if(!j)continue;const N=j.programConfigurations.get(s.id),K=r.useProgram("heatmap",N),{zoom:J}=r.transform;K.draw(d,g.TRIANGLES,Li.disabled,b,I,yi.disabled,Zs(D.posMatrix,F,J,s.paint.get("heatmap-intensity")),null,s.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,s.paint,r.transform.zoom,N)}d.viewport.set([0,0,r.width,r.height])}else r.renderPass==="translucent"&&(r.context.setColorMode(r.colorModeForRenderPass()),function(d,g){const b=d.context,I=b.gl,k=g.heatmapFbo;if(!k)return;b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get()),b.activeTexture.set(I.TEXTURE1);let D=g.colorRampTexture;D||(D=g.colorRampTexture=new Fe(b,g.colorRamp,I.RGBA)),D.bind(I.LINEAR,I.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(b,I.TRIANGLES,Li.disabled,kr.disabled,d.colorModeForRenderPass(),yi.disabled,((F,j,N,K)=>{const J=l.create();l.ortho(J,0,F.width,F.height,0,0,1);const ee=F.context.gl;return{u_matrix:J,u_world:[ee.drawingBufferWidth,ee.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}})(d,g),null,g.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,g.paint,d.transform.zoom)}(r,s))},line:function(r,e,s,u){if(r.renderPass!=="translucent")return;const d=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(d.constantOr(1)===0||g.constantOr(1)===0)return;const b=r.depthModeForSublayer(0,Li.ReadOnly),I=r.colorModeForRenderPass(),k=s.paint.get("line-dasharray"),D=s.paint.get("line-pattern"),F=D.constantOr(1),j=s.paint.get("line-gradient"),N=s.getCrossfadeParameters(),K=F?"linePattern":k?"lineSDF":j?"lineGradient":"line",J=r.context,ee=J.gl;let le=!0;for(const ce of u){const ye=e.getTile(ce);if(F&&!ye.patternsLoaded())continue;const oe=ye.getBucket(s);if(!oe)continue;const ve=oe.programConfigurations.get(s.id),be=r.context.program.get(),ze=r.useProgram(K,ve),we=le||ze.program!==be,Ne=r.style.terrain&&r.style.terrain.getTerrainData(ce),Ce=D.constantOr(null);if(Ce&&ye.imageAtlas){const xt=ye.imageAtlas,Ft=xt.patternPositions[Ce.to.toString()],ti=xt.patternPositions[Ce.from.toString()];Ft&&ti&&ve.setConstantPatternPositions(Ft,ti)}const ut=Ne?ce:null,yt=F?Qr(r,ye,s,N,ut):k?Xs(r,ye,s,k,N,ut):j?ks(r,ye,s,oe.lineClipsArray.length,ut):As(r,ye,s,ut);if(F)J.activeTexture.set(ee.TEXTURE0),ye.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ve.updatePaintBuffers(N);else if(k&&(we||r.lineAtlas.dirty))J.activeTexture.set(ee.TEXTURE0),r.lineAtlas.bind(J);else if(j){const xt=oe.gradients[s.id];let Ft=xt.texture;if(s.gradientVersion!==xt.version){let ti=256;if(s.stepInterpolant){const It=e.getSource().maxzoom,ii=ce.canonical.z===It?Math.ceil(1<<r.transform.maxZoom-ce.canonical.z):1;ti=l.clamp(l.nextPowerOfTwo(oe.maxLineLength/l.EXTENT*1024*ii),256,J.maxTextureSize)}xt.gradient=l.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:ti,image:xt.gradient||void 0,clips:oe.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new Fe(J,xt.gradient,ee.RGBA),xt.version=s.gradientVersion,Ft=xt.texture}J.activeTexture.set(ee.TEXTURE0),Ft.bind(s.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}ze.draw(J,ee.TRIANGLES,b,r.stencilModeForClipping(ce),I,yi.disabled,yt,Ne,s.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,s.paint,r.transform.zoom,ve,oe.layoutVertexBuffer2),le=!1}},fill:function(r,e,s,u){const d=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const b=r.colorModeForRenderPass(),I=s.paint.get("fill-pattern"),k=r.opaquePassEnabledForLayer()&&!I.constantOr(1)&&d.constantOr(l.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(r.renderPass===k){const D=r.depthModeForSublayer(1,r.renderPass==="opaque"?Li.ReadWrite:Li.ReadOnly);ro(r,e,s,u,D,b,!1)}if(r.renderPass==="translucent"&&s.paint.get("fill-antialias")){const D=r.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Li.ReadOnly);ro(r,e,s,u,D,b,!0)}},"fill-extrusion":function(r,e,s,u){const d=s.paint.get("fill-extrusion-opacity");if(d!==0&&r.renderPass==="translucent"){const g=new Li(r.context.gl.LEQUAL,Li.ReadWrite,r.depthRangeFor3D);if(d!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Io(r,e,s,u,g,kr.disabled,Vr.disabled),Io(r,e,s,u,g,r.stencilModeFor3D(),r.colorModeForRenderPass());else{const b=r.colorModeForRenderPass();Io(r,e,s,u,g,kr.disabled,b)}}},hillshade:function(r,e,s,u){if(r.renderPass!=="offscreen"&&r.renderPass!=="translucent")return;const d=r.context,g=r.depthModeForSublayer(0,Li.ReadOnly),b=r.colorModeForRenderPass(),[I,k]=r.renderPass==="translucent"?r.stencilConfigForOverlap(u):[{},u];for(const D of k){const F=e.getTile(D);F.needsHillshadePrepare!==void 0&&F.needsHillshadePrepare&&r.renderPass==="offscreen"?no(r,F,s,g,kr.disabled,b):r.renderPass==="translucent"&&zs(r,D,F,s,g,I[D.overscaledZ],b)}d.viewport.set([0,0,r.width,r.height])},raster:function(r,e,s,u){if(r.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!u.length)return;const d=r.context,g=d.gl,b=e.getSource(),I=r.useProgram("raster"),k=r.colorModeForRenderPass(),[D,F]=b instanceof vt?[{},u]:r.stencilConfigForOverlap(u),j=F[F.length-1].overscaledZ,N=!r.options.moving;for(const K of F){const J=r.depthModeForSublayer(K.overscaledZ-j,s.paint.get("raster-opacity")===1?Li.ReadWrite:Li.ReadOnly,g.LESS),ee=e.getTile(K);ee.registerFadeDuration(s.paint.get("raster-fade-duration"));const le=e.findLoadedParent(K,0),ce=ln(ee,le,e,s,r.transform,r.style.terrain);let ye,oe;const ve=s.paint.get("raster-resampling")==="nearest"?g.NEAREST:g.LINEAR;d.activeTexture.set(g.TEXTURE0),ee.texture.bind(ve,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),d.activeTexture.set(g.TEXTURE1),le?(le.texture.bind(ve,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),ye=Math.pow(2,le.tileID.overscaledZ-ee.tileID.overscaledZ),oe=[ee.tileID.canonical.x*ye%1,ee.tileID.canonical.y*ye%1]):ee.texture.bind(ve,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const be=r.style.terrain&&r.style.terrain.getTerrainData(K),ze=be?K:null,we=ze?ze.posMatrix:r.transform.calculatePosMatrix(K.toUnwrapped(),N),Ne=Sa(we,oe||[0,0],ye||1,ce,s);b instanceof vt?I.draw(d,g.TRIANGLES,J,kr.disabled,k,yi.disabled,Ne,be,s.id,b.boundsBuffer,r.quadTriangleIndexBuffer,b.boundsSegments):I.draw(d,g.TRIANGLES,J,D[K.overscaledZ],k,yi.disabled,Ne,be,s.id,r.rasterBoundsBuffer,r.quadTriangleIndexBuffer,r.rasterBoundsSegments)}},background:function(r,e,s,u){const d=s.paint.get("background-color"),g=s.paint.get("background-opacity");if(g===0)return;const b=r.context,I=b.gl,k=r.transform,D=k.tileSize,F=s.paint.get("background-pattern");if(r.isPatternMissing(F))return;const j=!F&&d.a===1&&g===1&&r.opaquePassEnabledForLayer()?"opaque":"translucent";if(r.renderPass!==j)return;const N=kr.disabled,K=r.depthModeForSublayer(0,j==="opaque"?Li.ReadWrite:Li.ReadOnly),J=r.colorModeForRenderPass(),ee=r.useProgram(F?"backgroundPattern":"background"),le=u||k.coveringTiles({tileSize:D,terrain:r.style.terrain});F&&(b.activeTexture.set(I.TEXTURE0),r.imageManager.bind(r.context));const ce=s.getCrossfadeParameters();for(const ye of le){const oe=u?ye.posMatrix:r.transform.calculatePosMatrix(ye.toUnwrapped()),ve=F?ol(oe,g,r,F,{tileID:ye,tileSize:D},ce):sl(oe,g,d),be=r.style.terrain&&r.style.terrain.getTerrainData(ye);ee.draw(b,I.TRIANGLES,K,N,J,yi.disabled,ve,be,s.id,r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}},debug:function(r,e,s){for(let u=0;u<s.length;u++)Ba(r,e,s[u])},custom:function(r,e,s){const u=r.context,d=s.implementation;if(r.renderPass==="offscreen"){const g=d.prerender;g&&(r.setCustomLayerDefaults(),u.setColorMode(r.colorModeForRenderPass()),g.call(d,u.gl,r.transform.customLayerMatrix()),u.setDirty(),r.setBaseState())}else if(r.renderPass==="translucent"){r.setCustomLayerDefaults(),u.setColorMode(r.colorModeForRenderPass()),u.setStencilMode(kr.disabled);const g=d.renderingMode==="3d"?new Li(r.context.gl.LEQUAL,Li.ReadWrite,r.depthRangeFor3D):r.depthModeForSublayer(0,Li.ReadOnly);u.setDepthMode(g),d.render(u.gl,r.transform.customLayerMatrix()),u.setDirty(),r.setBaseState(),u.bindFramebuffer.set(null)}}};class sa{constructor(e,s){this.context=new qt(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=$e.maxUnderzooming+$e.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ot,this.gpuTimers={}}resize(e,s,u){if(this.width=e*u,this.height=s*u,this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,s=new l.PosArray;s.emplaceBack(0,0),s.emplaceBack(l.EXTENT,0),s.emplaceBack(0,l.EXTENT),s.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(s,Ut.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const u=new l.PosArray;u.emplaceBack(0,0),u.emplaceBack(l.EXTENT,0),u.emplaceBack(0,l.EXTENT),u.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=e.createVertexBuffer(u,Ut.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const d=new l.RasterBoundsArray;d.emplaceBack(0,0,0,0),d.emplaceBack(l.EXTENT,0,l.EXTENT,0),d.emplaceBack(0,l.EXTENT,0,l.EXTENT),d.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(d,si.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const g=new l.PosArray;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(g,Ut.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const b=new l.LineStripIndexArray;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const I=new l.TriangleIndexArray;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(I),this.emptyTexture=new Fe(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);const k=this.context.gl;this.stencilClearMode=new kr({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=l.create();l.ortho(u,0,this.width,this.height,0,0,1),l.scale(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,Li.disabled,this.stencilClearMode,Vr.disabled,yi.disabled,fs(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const u=this.context,d=u.gl;this.nextStencilID+s.length>256&&this.clearStencil(),u.setColorMode(Vr.disabled),u.setDepthMode(Li.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of s){const I=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,k=this.style.terrain&&this.style.terrain.getTerrainData(b);g.draw(u,d.TRIANGLES,Li.disabled,new kr({func:d.ALWAYS,mask:0},I,255,d.KEEP,d.KEEP,d.REPLACE),Vr.disabled,yi.disabled,fs(b.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new kr({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new kr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,u=e.sort((b,I)=>I.overscaledZ-b.overscaledZ),d=u[u.length-1].overscaledZ,g=u[0].overscaledZ-d+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const b={};for(let I=0;I<g;I++)b[I+d]=new kr({func:s.GEQUAL,mask:255},I+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[b,u]}return[{[d]:kr.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Vr([e.CONSTANT_COLOR,e.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vr.unblended:Vr.alphaBlended}depthModeForSublayer(e,s,u){if(!this.opaquePassEnabledForLayer())return Li.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Li(u||this.context.gl.LEQUAL,s,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const u=this.style._order,d=this.style.sourceCaches,g=this.style.terrain&&new na(this);for(const D in d){const F=d[D];F.used&&F.prepare(this.context)}const b={},I={},k={};for(const D in d){const F=d[D];b[D]=F.getVisibleCoordinates(),I[D]=b[D].slice().reverse(),k[D]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<u.length;D++)if(this.style._layers[u[D]].is3D()){this.opaquePassCutoff=D;break}if(g){this.opaquePassCutoff=0;const D=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||D.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,j){const N=F.context,K=N.gl,J=Vr.unblended,ee=new Li(K.LEQUAL,Li.ReadWrite,[0,1]),le=j.getTerrainMesh(),ce=j.sourceCache.getRenderableTiles(),ye=F.useProgram("terrainDepth");N.bindFramebuffer.set(j.getFramebuffer("depth").framebuffer),N.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),N.clear({color:l.Color.transparent,depth:1});for(const oe of ce){const ve=j.getTerrainData(oe.tileID),be=F.transform.calculatePosMatrix(oe.tileID.toUnwrapped());ye.draw(N,K.TRIANGLES,ee,kr.disabled,J,yi.backCCW,{u_matrix:be},ve,"terrain",le.vertexBuffer,le.indexBuffer,le.segments)}N.bindFramebuffer.set(null),N.viewport.set([0,0,F.width,F.height])}(this,this.style.terrain),function(F,j){const N=F.context,K=N.gl,J=Vr.unblended,ee=new Li(K.LEQUAL,Li.ReadWrite,[0,1]),le=j.getTerrainMesh(),ce=j.getCoordsTexture(),ye=j.sourceCache.getRenderableTiles(),oe=F.useProgram("terrainCoords");N.bindFramebuffer.set(j.getFramebuffer("coords").framebuffer),N.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),N.clear({color:l.Color.transparent,depth:1}),j.coordsIndex=[];for(const ve of ye){const be=j.getTerrainData(ve.tileID);N.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,ce.texture);const ze=F.transform.calculatePosMatrix(ve.tileID.toUnwrapped());oe.draw(N,K.TRIANGLES,ee,kr.disabled,J,yi.backCCW,{u_matrix:ze,u_terrain_coords_id:(255-j.coordsIndex.length)/255,u_texture:0},be,"terrain",le.vertexBuffer,le.indexBuffer,le.segments),j.coordsIndex.push(ve.tileID.key)}N.bindFramebuffer.set(null),N.viewport.set([0,0,F.width,F.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const D of u){const F=this.style._layers[D];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const j=I[F.source];(F.type==="custom"||j.length)&&this.renderLayer(this,d[F.source],F,j)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!g)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[u[this.currentLayer]],F=d[D.source],j=b[D.source];this._renderTileClippingMasks(D,j),this.renderLayer(this,F,D,j)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const D=this.style._layers[u[this.currentLayer]],F=d[D.source];if(g&&g.renderLayer(D))continue;const j=(D.type==="symbol"?k:I)[D.source];this._renderTileClippingMasks(D,b[D.source]),this.renderLayer(this,F,D,j)}if(this.options.showTileBoundaries){let D,F;Object.values(this.style._layers).forEach(j=>{j.source&&!j.isHidden(this.transform.zoom)&&(j.source!==(F&&F.id)&&(F=this.style.sourceCaches[j.source]),(!D||D.getSource().maxzoom<F.getSource().maxzoom)&&(D=F))}),D&&Eo.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const F=D.transform.padding;So(D,D.transform.height-(F.top||0),3,hl),So(D,F.bottom||0,3,pl),fl(D,F.left||0,3,dl),fl(D,D.transform.width-(F.right||0),3,os);const j=D.transform.centerPoint;(function(N,K,J,ee){Cs(N,K-1,J-10,2,20,ee),Cs(N,K-10,J-1,20,2,ee)})(D,j.x,D.transform.height-j.y,so)}(this),this.context.setDefault()}renderLayer(e,s,u,d){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(d||[]).length)&&(this.id=u.id,this.gpuTimingStart(u),Eo[u.type](e,s,u,d,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let u=this.gpuTimers[e.id];u||(u=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),u.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,u.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}queryGpuTimers(e){const s={};for(const u in e){const d=e[u],g=this.context.extTimerQuery,b=g.getQueryObjectEXT(d.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(d.query),s[u]=b}return s}translatePosMatrix(e,s,u,d,g){if(!u[0]&&!u[1])return e;const b=g?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(b){const D=Math.sin(b),F=Math.cos(b);u=[u[0]*F-u[1]*D,u[0]*D+u[1]*F]}const I=[g?u[0]:ki(s,u[0],this.transform.zoom),g?u[1]:ki(s,u[1],this.transform.zoom),0],k=new Float32Array(16);return l.translate(k,e,I),k}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!s||!u}useProgram(e,s){this.cache=this.cache||{};const u=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new Ta(this.context,e,Es[e],s,Ho[e],this._showOverdrawInspector,this.style.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Fe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class as{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,u){const d=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const k=1/(I=l.transformMat4([],I,e))[3]/s*d;return l.mul$1(I,I,[k,k,1/I[3],k])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const k=l.sub([],g[I[0]],g[I[1]]),D=l.sub([],g[I[2]],g[I[1]]),F=l.normalize([],l.cross([],k,D)),j=-l.dot(F,g[I[1]]);return F.concat(j)});return new as(g,b)}}class ms{constructor(e,s){this.min=e,this.max=s,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],u=l.clone$2(this.min),d=l.clone$2(this.max);for(let g=0;g<s.length;g++)u[g]=s[g]?this.min[g]:this.center[g],d[g]=s[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new ms(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let d=0;d<e.planes.length;d++){const g=e.planes[d];let b=0;for(let I=0;I<s.length;I++)l.dot$1(g,s[I])>=0&&b++;if(b===0)return 0;b!==s.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let g=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let I=0;I<e.points.length;I++){const k=e.points[I][d]-this.min[d];g=Math.min(g,k),b=Math.max(b,k)}if(b<0||g>this.max[d]-this.min[d])return 0}return 1}}class oa{constructor(e=0,s=0,u=0,d=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=u,this.right=d}interpolate(e,s,u){return s.top!=null&&e.top!=null&&(this.top=l.number(e.top,s.top,u)),s.bottom!=null&&e.bottom!=null&&(this.bottom=l.number(e.bottom,s.bottom,u)),s.left!=null&&e.left!=null&&(this.left=l.number(e.left,s.left,u)),s.right!=null&&e.right!=null&&(this.right=l.number(e.right,s.right,u)),this}getCenter(e,s){const u=l.clamp((this.left+e-this.right)/2,0,e),d=l.clamp((this.top+s-this.bottom)/2,0,s);return new l.pointGeometry(u,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new oa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Hs{constructor(e,s,u,d,g){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=g===void 0||!!g,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=u==null?0:u,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new oa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const e=new Hs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e._elevation=this._elevation,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._calcMatrices(),e}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-l.wrap(e,-180,180)*Math.PI/180;var u;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(u=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),function(d,g,b){var I=g[0],k=g[1],D=g[2],F=g[3],j=Math.sin(b),N=Math.cos(b);d[0]=I*N+D*j,d[1]=k*N+F*j,d[2]=I*-j+D*N,d[3]=k*-j+F*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=l.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,u){this._unmodified=!1,this._edgeInsets.interpolate(e,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new l.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new l.pointGeometry(0,0)),d=this.pointCoordinate(new l.pointGeometry(this.width,0)),g=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new l.pointGeometry(0,this.height)),I=Math.floor(Math.min(u.x,d.x,g.x,b.x)),k=Math.floor(Math.max(u.x,d.x,g.x,b.x)),D=1;for(let F=I-D;F<=k+D;F++)F!==0&&s.push(new l.UnwrappedTileID(F,e))}return s}coveringTiles(e){var s,u;let d=this.coveringZoomLevel(e);const g=d;if(e.minzoom!==void 0&&d<e.minzoom)return[];e.maxzoom!==void 0&&d>e.maxzoom&&(d=e.maxzoom);const b=this.pointCoordinate(this.getCameraPoint()),I=l.MercatorCoordinate.fromLngLat(this.center),k=Math.pow(2,d),D=[k*b.x,k*b.y,0],F=[k*I.x,k*I.y,0],j=as.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d);let N=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=d);const K=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,J=oe=>({aabb:new ms([oe*k,0,0],[(oe+1)*k,k,0]),zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),ee=[],le=[],ce=d,ye=e.reparseOverscaled?g:d;if(this._renderWorldCopies)for(let oe=1;oe<=3;oe++)ee.push(J(-oe)),ee.push(J(oe));for(ee.push(J(0));ee.length>0;){const oe=ee.pop(),ve=oe.x,be=oe.y;let ze=oe.fullyVisible;if(!ze){const xt=oe.aabb.intersects(j);if(xt===0)continue;ze=xt===2}const we=e.terrain?D:F,Ne=oe.aabb.distanceX(we),Ce=oe.aabb.distanceY(we),ut=Math.max(Math.abs(Ne),Math.abs(Ce)),yt=K+(1<<ce-oe.zoom)-2;if(oe.zoom===ce||ut>yt&&oe.zoom>=N){const xt=ce-oe.zoom,Ft=D[0]-.5-(ve<<xt),ti=D[1]-.5-(be<<xt);le.push({tileID:new l.OverscaledTileID(oe.zoom===ce?ye:oe.zoom,oe.wrap,oe.zoom,ve,be),distanceSq:l.sqrLen([F[0]-.5-ve,F[1]-.5-be]),tileDistanceToCamera:Math.sqrt(Ft*Ft+ti*ti)})}else for(let xt=0;xt<4;xt++){const Ft=(ve<<1)+xt%2,ti=(be<<1)+(xt>>1),It=oe.zoom+1;let ii=oe.aabb.quadrant(xt);if(e.terrain){const oi=new l.OverscaledTileID(It,oe.wrap,It,Ft,ti),xi=e.terrain.getMinMaxElevation(oi),vi=(s=xi.minElevation)!==null&&s!==void 0?s:this.elevation,Gi=(u=xi.maxElevation)!==null&&u!==void 0?u:this.elevation;ii=new ms([ii.min[0],ii.min[1],vi],[ii.max[0],ii.max[1],Gi])}ee.push({aabb:ii,zoom:It,x:Ft,y:ti,wrap:oe.wrap,fullyVisible:ze})}}return le.sort((oe,ve)=>oe.distanceSq-ve.distanceSq).map(oe=>oe.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=l.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(e.lng)*this.worldSize,l.mercatorYfromLat(s)*this.worldSize)}unproject(e){return new l.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(e){this.freezeElevation||(this.elevation=e?this.getElevation(this._center,e):0)}getElevation(e,s){const u=l.MercatorCoordinate.fromLngLat(e),d=(1<<this.tileZoom)*l.EXTENT,g=u.x*d,b=u.y*d,I=Math.floor(g/l.EXTENT),k=Math.floor(b/l.EXTENT),D=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,I,k);return s.getElevation(D,g%l.EXTENT,b%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.pointLocation(this.centerPoint,e),u=this.getElevation(s,e);if(!(this.elevation-u))return;const d=this.getCameraPosition(),g=l.MercatorCoordinate.fromLngLat(d.lngLat,d.altitude),b=l.MercatorCoordinate.fromLngLat(s,u),I=g.x-b.x,k=g.y-b.y,D=g.z-b.z,F=Math.sqrt(I*I+k*k+D*D),j=this.scaleZoom(this.cameraToCenterDistance/F/this.tileSize);this._elevation=u,this._center=s,this.zoom=j}setLocationAtPoint(e,s){const u=this.pointCoordinate(s),d=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(e),b=new l.MercatorCoordinate(g.x-(u.x-d.x),g.y-(u.y-d.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),this.getElevation(e,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return l.MercatorCoordinate.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const N=s.pointCoordinate(e);if(N!=null)return N}const u=[e.x,e.y,0,1],d=[e.x,e.y,1,1];l.transformMat4(u,u,this.pixelMatrixInverse),l.transformMat4(d,d,this.pixelMatrixInverse);const g=u[3],b=d[3],I=u[1]/g,k=d[1]/b,D=u[2]/g,F=d[2]/b,j=D===F?0:(0-D)/(F-D);return new l.MercatorCoordinate(l.number(u[0]/g,d[0]/b,j)/this.worldSize,l.number(I,k,j)/this.worldSize)}coordinatePoint(e,s=0,u=this.pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,s,1];return l.transformMat4(d,d,u),new l.pointGeometry(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,e))).extend(this.pointLocation(new l.pointGeometry(this.width,e))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,s=!1){const u=e.key,d=s?this._alignedPosMatrixCache:this._posMatrixCache;if(d[u])return d[u];const g=e.canonical,b=this.worldSize/this.zoomScale(g.z),I=g.x+Math.pow(2,g.z)*e.wrap,k=l.identity(new Float64Array(16));return l.translate(k,k,[I*b,g.y*b,0]),l.scale(k,k,[b/l.EXTENT,b/l.EXTENT,1]),l.multiply(k,s?this.alignedProjMatrix:this.projMatrix,k),d[u]=new Float32Array(k),d[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,s,u,d,g=-90,b=90,I=-180,k=180;const D=this.size,F=this._unmodified;if(this.latRange){const K=this.latRange;g=l.mercatorYfromLat(K[1])*this.worldSize,b=l.mercatorYfromLat(K[0])*this.worldSize,e=b-g<D.y?D.y/(b-g):0}if(this.lngRange){const K=this.lngRange;I=l.wrap(l.mercatorXfromLng(K[0])*this.worldSize,0,this.worldSize),k=l.wrap(l.mercatorXfromLng(K[1])*this.worldSize,0,this.worldSize),k<I&&(k+=this.worldSize),s=k-I<D.x?D.x/(k-I):0}const j=this.point,N=Math.max(s||0,e||0);if(N)return this.center=this.unproject(new l.pointGeometry(s?(k+I)/2:j.x,e?(b+g)/2:j.y)),this.zoom+=this.scaleZoom(N),this._unmodified=F,void(this._constraining=!1);if(this.latRange){const K=j.y,J=D.y/2;K-J<g&&(d=g+J),K+J>b&&(d=b-J)}if(this.lngRange){const K=(I+k)/2,J=l.wrap(j.x,K-this.worldSize/2,K+this.worldSize/2),ee=D.x/2;J-ee<I&&(u=I+ee),J+ee>k&&(u=k-ee)}u===void 0&&d===void 0||(this.center=this.unproject(new l.pointGeometry(u!==void 0?u:j.x,d!==void 0?d:j.y)).wrap()),this._unmodified=F,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let d=l.identity(new Float64Array(16));l.scale(d,d,[this.width/2,-this.height/2,1]),l.translate(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=l.identity(new Float64Array(16)),l.scale(d,d,[1,-1,1]),l.translate(d,d,[-1,-1,0]),l.scale(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const g=Math.PI/2+this._pitch,b=this._fov*(.5+e.y/this.height),I=Math.sin(b)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-g-b,.01,Math.PI-.01)),k=this.getHorizon(),D=2*Math.atan(k/this.cameraToCenterDistance)*(.5+e.y/(2*k)),F=Math.sin(D)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-g-D,.01,Math.PI-.01)),j=Math.cos(Math.PI/2-this._pitch)*I+this.cameraToSeaLevelDistance,N=Math.cos(Math.PI/2-this._pitch)*F+this.cameraToSeaLevelDistance,K=1.01*Math.min(j,N),J=this.height/50;d=new Float64Array(16),l.perspective(d,this._fov,this.width/this.height,J,K),d[8]=2*-e.x/this.width,d[9]=2*e.y/this.height,l.scale(d,d,[1,-1,1]),l.translate(d,d,[0,0,-this.cameraToCenterDistance]),l.rotateX(d,d,this._pitch),l.rotateZ(d,d,this.angle),l.translate(d,d,[-s,-u,0]),this.mercatorMatrix=l.scale([],d,[this.worldSize,this.worldSize,this.worldSize]),l.scale(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,d),l.translate(d,d,[0,0,-this.elevation]),this.projMatrix=d,this.invProjMatrix=l.invert([],d),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,d);const ee=this.width%2/2,le=this.height%2/2,ce=Math.cos(this.angle),ye=Math.sin(this.angle),oe=s-Math.round(s)+ce*ee+ye*le,ve=u-Math.round(u)+ce*le+ye*ee,be=new Float64Array(d);if(l.translate(be,be,[oe>.5?oe-1:oe,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=be,d=l.invert(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new l.pointGeometry(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let u=s.x,d=s.y,g=s.x,b=s.y;for(const I of e)u=Math.min(u,I.x),d=Math.min(d,I.y),g=Math.max(g,I.x),b=Math.max(b,I.y);return[new l.pointGeometry(u,d),new l.pointGeometry(g,d),new l.pointGeometry(g,b),new l.pointGeometry(u,b),new l.pointGeometry(u,d)]}}}class ml{constructor(e){this._hashName=e&&encodeURIComponent(e),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,u){let d=!1,g=null;const b=()=>{g=null,d&&(s(),g=setTimeout(b,300),d=!1)};return()=>(d=!0,g||b(),g)}(this._updateHashUnthrottled.bind(this))}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,d),b=Math.round(s.lng*g)/g,I=Math.round(s.lat*g)/g,k=this._map.getBearing(),D=this._map.getPitch();let F="";if(F+=e?`/${b}/${I}/${u}`:`${u}/${I}/${b}`,(k||D)&&(F+="/"+Math.round(10*k)/10),D&&(F+=`/${Math.round(D)}`),this._hashName){const j=this._hashName;let N=!1;const K=window.location.hash.slice(1).split("&").map(J=>{const ee=J.split("=")[0];return ee===j?(N=!0,`${ee}=${F}`):J}).filter(J=>J);return N||K.push(`${j}=${F}`),`#${K.join("&")}`}return`#${F}`}_getCurrentHash(){const e=window.location.hash.replace("#","");if(this._hashName){let s;return e.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(s=u)}),(s&&s[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._getCurrentHash();if(e.length>=3&&!e.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:s,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,e)}catch{}}}const Ao={linearity:.3,easing:l.bezier(0,0,.3,1)},gl=l.extend({deceleration:2500,maxSpeed:1400},Ao),ls=l.extend({deceleration:20,maxSpeed:1400},Ao),_l=l.extend({deceleration:1e3,maxSpeed:360},Ao),ko=l.extend({deceleration:1e3,maxSpeed:90},Ao);class zo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=l.exported.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(s.pan.mag()){const g=In(s.pan.mag(),u,l.extend({},gl,e||{}));d.offset=s.pan.mult(g.amount/s.pan.mag()),d.center=this._map.transform.center,Cn(d,g)}if(s.zoom){const g=In(s.zoom,u,ls);d.zoom=this._map.transform.zoom+g.amount,Cn(d,g)}if(s.bearing){const g=In(s.bearing,u,_l);d.bearing=this._map.transform.bearing+l.clamp(g.amount,-179,179),Cn(d,g)}if(s.pitch){const g=In(s.pitch,u,ko);d.pitch=this._map.transform.pitch+g.amount,Cn(d,g)}if(d.zoom||d.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;d.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),l.extend(d,{noMoveStart:!0})}}function Cn(r,e){(!r.duration||r.duration<e.duration)&&(r.duration=e.duration,r.easing=e.easing)}function In(r,e,s){const{maxSpeed:u,linearity:d,deceleration:g}=s,b=l.clamp(r*d/(e/1e3),-u,u),I=Math.abs(b)/(g*d);return{easing:s.easing,duration:1e3*I,amount:b*(I/2)}}class en extends l.Event{constructor(e,s,u,d={}){const g=Z.mousePos(s.getCanvasContainer(),u),b=s.unproject(g);super(e,l.extend({point:g,lngLat:b,originalEvent:u},d)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class gs extends l.Event{constructor(e,s,u){const d=e==="touchend"?u.changedTouches:u.touches,g=Z.touchPos(s.getCanvasContainer(),d),b=g.map(k=>s.unproject(k)),I=g.reduce((k,D,F,j)=>k.add(D.div(j.length)),new l.pointGeometry(0,0));super(e,{points:g,point:I,lngLats:b,lngLat:s.unproject(I),originalEvent:u}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ms extends l.Event{constructor(e,s,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class oo{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ms(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new en(e.type,this._map,e))}mouseup(e){this._map.fire(new en(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new en(e.type,this._map,e))}dblclick(e){return this._firePreventable(new en(e.type,this._map,e))}mouseover(e){this._map.fire(new en(e.type,this._map,e))}mouseout(e){this._map.fire(new en(e.type,this._map,e))}touchstart(e){return this._firePreventable(new gs(e.type,this._map,e))}touchmove(e){this._map.fire(new gs(e.type,this._map,e))}touchend(e){this._map.fire(new gs(e.type,this._map,e))}touchcancel(e){this._map.fire(new gs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(e){this._map.fire(new en(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new en("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new en(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class aa{constructor(e,s){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=Z.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(d.x,u.x),b=Math.max(d.x,u.x),I=Math.min(d.y,u.y),k=Math.max(d.y,u.y);Z.setTransform(this._box,`translate(${g}px,${I}px)`),this._box.style.width=b-g+"px",this._box.style.height=k-I+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const u=this._startPos,d=s;if(this.reset(),Z.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(u,d,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new l.Event(e,{originalEvent:s}))}}function la(r,e){const s={};for(let u=0;u<r.length;u++)s[r[u].identifier]=e[u];return s}class yc{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const g=new l.pointGeometry(0,0);for(const b of d)g._add(b);return g.div(d.length)}(s),this.touches=la(u,s)))}touchmove(e,s,u){if(this.aborted||!this.centroid)return;const d=la(u,s);for(const g in this.touches){const b=this.touches[g],I=d[g];(!I||I.dist(b)>30)&&(this.aborted=!0)}}touchend(e,s,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Fa{constructor(e){this.singleTap=new yc(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,u){this.singleTap.touchstart(e,s,u)}touchmove(e,s,u){this.singleTap.touchmove(e,s,u)}touchend(e,s,u){const d=this.singleTap.touchend(e,s,u);if(d){const g=e.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(d)<30;if(g&&b||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Ks{constructor(){this._zoomIn=new Fa({numTouches:1,numTaps:2}),this._zoomOut=new Fa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,u){this._zoomIn.touchstart(e,s,u),this._zoomOut.touchstart(e,s,u)}touchmove(e,s,u){this._zoomIn.touchmove(e,s,u),this._zoomOut.touchmove(e,s,u)}touchend(e,s,u){const d=this._zoomIn.touchend(e,s,u),g=this._zoomOut.touchend(e,s,u);return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(d)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _s={0:1,2:2};class Nt{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(e,s){return!1}_move(e,s){return{}}mousedown(e,s){if(this._lastPoint)return;const u=Z.mouseButton(e);this._correctButton(e,u)&&(this._lastPoint=s,this._eventButton=u)}mousemoveWindow(e,s){const u=this._lastPoint;if(u){if(e.preventDefault(),function(d,g){const b=_s[g];return d.buttons===void 0||(d.buttons&b)!==b}(e,this._eventButton))this.reset();else if(this._moved||!(s.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(u,s)}}mouseupWindow(e){this._lastPoint&&Z.mouseButton(e)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zt extends Nt{mousedown(e,s){super.mousedown(e,s),this._lastPoint&&(this._active=!0)}_correctButton(e,s){return s===0&&!e.ctrlKey}_move(e,s){return{around:s,panDelta:s.sub(e)}}}class ao extends Nt{_correctButton(e,s){return s===0&&e.ctrlKey||s===2}_move(e,s){const u=.8*(s.x-e.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(e){e.preventDefault()}}class Yn extends Nt{_correctButton(e,s){return s===0&&e.ctrlKey||s===2}_move(e,s){const u=-.5*(s.y-e.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(e){e.preventDefault()}}class Ds{constructor(e){this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(e,s,u){return this._calculateTransform(e,s,u)}touchmove(e,s,u){if(this._active&&!(u.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,s,u)}touchend(e,s,u){this._calculateTransform(e,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,u){u.length>0&&(this._active=!0);const d=la(u,s),g=new l.pointGeometry(0,0),b=new l.pointGeometry(0,0);let I=0;for(const D in d){const F=d[D],j=this._touches[D];j&&(g._add(F),b._add(F.sub(j)),I++,d[D]=F)}if(this._touches=d,I<this._minTouches||!b.mag())return;const k=b.div(I);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(I),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(e){}_move(e,s,u){return{}}touchstart(e,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,u){if(!this._firstTwoTouches)return;e.preventDefault();const[d,g]=this._firstTwoTouches,b=Bt(u,s,d),I=Bt(u,s,g);if(!b||!I)return;const k=this._aroundCenter?null:b.add(I).div(2);return this._move([b,I],k,e)}touchend(e,s,u){if(!this._firstTwoTouches)return;const[d,g]=this._firstTwoTouches,b=Bt(u,s,d),I=Bt(u,s,g);b&&I||(this._active&&Z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Bt(r,e,s){for(let u=0;u<r.length;u++)if(r[u].identifier===s)return e[u]}function ca(r,e){return Math.log(r/e)/Math.LN2}class xc extends Rt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ca(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ca(this._distance,u),pinchAround:s}}}function Co(r,e){return 180*r.angleWith(e)/Math.PI}class Oa extends Rt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Co(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,u=Co(e,this._startVector);return Math.abs(u)<s}}function ua(r){return Math.abs(r.y)>Math.abs(r.x)}class Dl extends Rt{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(e){this._lastPoints=e,ua(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,u){const d=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(d,g,u.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+g.y)/2*-.5}}gestureBeginsVertically(e,s,u){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,g=s.mag()>=2;if(!d&&!g)return;if(!d||!g)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const b=e.y>0==s.y>0;return ua(e)&&ua(s)&&b}}const vc={panStep:100,bearingStep:15,pitchStep:10};class Ua{constructor(){const e=vc;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,u=0,d=0,g=0,b=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),b=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:I=>{const k=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:ha,zoom:s?Math.round(k)+s*(e.shiftKey?2:1):k,bearing:I.getBearing()+u*this._bearingStep,pitch:I.getPitch()+d*this._pitchStep,offset:[-g*this._panStep,-b*this._panStep],center:I.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ha(r){return r*(2-r)}const Po=4.000244140625;class pa{constructor(e,s){this._map=e,this._el=e.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=l.exported.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Po==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Z.mousePos(this._el,e);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Po?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&k!==0&&(k=1/k);const D=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(D*k))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,d=this._easing;let g,b=!1;if(this._type==="wheel"&&u&&d){const I=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),k=d(I);g=l.number(u,s,k),I<1?this._frameId||(this._frameId=!0):b=!0}else g=s,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=l.ease;if(this._prevEase){const u=this._prevEase,d=(l.exported.now()-u.start)/u.duration,g=u.easing(d+.01)-u.easing(d),b=.27/Math.sqrt(g*g+1e-4)*.01,I=Math.sqrt(.0729-b*b);s=l.bezier(b,I,.25,1)}return this._prevEase={start:l.exported.now(),duration:e,easing:s},s}reset(){this._active=!1}}class Bn{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cn{constructor(){this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(e.shiftKey?-1:1),around:u.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ls{constructor(){this._tap=new Fa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(e,s,u){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=s[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(e,s,u))}touchmove(e,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=s[0],g=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,s,u)}touchend(e,s,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(e,s,u)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Va{constructor(e,s,u){this._el=e,this._mousePan=s,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ys{constructor(e,s,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class da{constructor(e,s,u,d){this._el=e,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Bs=r=>r.zoom||r.drag||r.pitch||r.rotate;class Gn extends l.Event{}function Ki(r){return r.panDelta&&r.panDelta.mag()||r.zoomDelta||r.bearingDelta||r.pitchDelta}class zr{constructor(e,s){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zo(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),l.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,g,b]of this._listeners)Z.addEventListener(d,g,d===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[e,s,u]of this._listeners)Z.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new oo(s,e));const d=s.boxZoom=new aa(s,e);this._add("boxZoom",d);const g=new Ks,b=new cn;s.doubleClickZoom=new Bn(b,g),this._add("tapZoom",g),this._add("clickZoom",b);const I=new Ls;this._add("tapDragZoom",I);const k=s.touchPitch=new Dl;this._add("touchPitch",k);const D=new ao(e),F=new Yn(e);s.dragRotate=new Ys(e,D,F),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const j=new Zt(e),N=new Ds(e);s.dragPan=new Va(u,j,N),this._add("mousePan",j),this._add("touchPan",N,["touchZoom","touchRotate"]);const K=new Oa,J=new xc;s.touchZoomRotate=new da(u,J,K,I),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]);const ee=s.scrollZoom=new pa(s,this);this._add("scrollZoom",ee,["mousePan"]);const le=s.keyboard=new Ua;this._add("keyboard",le),this._add("blockableMapEvent",new qn(s));for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[ce]&&s[ce].enable(e[ce])}_add(e,s,u){this._handlers.push({handlerName:e,handler:s,allowed:u}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Bs(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,s,u){for(const d in e)if(d!==u&&(!s||s.indexOf(d)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const s=[];for(const u of e)this._el.contains(u.target)&&s.push(u);return s}handleEvent(e,s){if(e.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const u=e.type==="renderFrame"?void 0:e,d={needsRenderFrame:!1},g={},b={},I=e.touches,k=I?this._getMapTouches(I):void 0,D=k?Z.touchPos(this._el,k):Z.mousePos(this._el,e);for(const{handlerName:N,handler:K,allowed:J}of this._handlers){if(!K.isEnabled())continue;let ee;this._blockedByActive(b,J,N)?K.reset():K[s||e.type]&&(ee=K[s||e.type](e,D,k),this.mergeHandlerResult(d,g,ee,N,u),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||K.isActive())&&(b[N]=K)}const F={};for(const N in this._previousActiveHandlers)b[N]||(F[N]=u);this._previousActiveHandlers=b,(Object.keys(F).length||Ki(d))&&(this._changes.push([d,g,F]),this._triggerRenderFrame()),(Object.keys(b).length||Ki(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=d;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(e,s,u,d,g){if(!u)return;l.extend(e,u);const b={handlerName:d,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(s.zoom=b),u.panDelta!==void 0&&(s.drag=b),u.pitchDelta!==void 0&&(s.pitch=b),u.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const e={},s={},u={};for(const[d,g,b]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new l.pointGeometry(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),l.extend(s,g),l.extend(u,b);this._updateMapTransform(e,s,u),this._changes=[]}_updateMapTransform(e,s,u){const d=this._map,g=d.transform,b=d.style&&d.style.terrain;if(!(Ki(e)||b&&this._drag))return this._fireEvents(s,u,!0);let{panDelta:I,zoomDelta:k,bearingDelta:D,pitchDelta:F,around:j,pinchAround:N}=e;N!==void 0&&(j=N),d._stop(!0),j=j||d.transform.centerPoint;const K=g.pointLocation(I?j.sub(I):j);D&&(g.bearing+=D),F&&(g.pitch+=F),k&&(g.zoom+=k),b?s.drag&&!this._drag?(this._drag={center:g.centerPoint,lngLat:g.pointLocation(j),point:j,handlerName:s.drag.handlerName},d.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&u[this._drag.handlerName]?(d.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(g.center=g.pointLocation(g.centerPoint.sub(I))):g.setLocationAtPoint(K,j),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,u,!0)}_fireEvents(e,s,u){const d=Bs(this._eventsInProgress),g=Bs(e),b={};for(const F in e){const{originalEvent:j}=e[F];this._eventsInProgress[F]||(b[`${F}start`]=j),this._eventsInProgress[F]=e[F]}!d&&g&&this._fireEvent("movestart",g.originalEvent);for(const F in b)this._fireEvent(F,b[F]);g&&this._fireEvent("move",g.originalEvent);for(const F in e){const{originalEvent:j}=e[F];this._fireEvent(F,j)}const I={};let k;for(const F in this._eventsInProgress){const{handlerName:j,originalEvent:N}=this._eventsInProgress[F];this._handlersById[j].isActive()||(delete this._eventsInProgress[F],k=s[j]||N,I[`${F}end`]=k)}for(const F in I)this._fireEvent(F,I[F]);const D=Bs(this._eventsInProgress);if(u&&(d||g)&&!D){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;F?(j(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:k})):(this._map.fire(new l.Event("moveend",{originalEvent:k})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new l.Event(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Gn("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const lo={extend:(r,...e)=>l.extend(r,...e),run(r){r()},logToElement(r,e=!1,s="log"){const u=window.document.getElementById(s);u&&(e&&(u.innerHTML=""),u.innerHTML+=`<br>${r}`)}};class fa extends l.Evented{constructor(e,s){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,u){return e=l.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,l.extend({offset:e},s),u)}panTo(e,s,u){return this.easeTo(l.extend({center:e},s),u)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,u){return this.easeTo(l.extend({zoom:e},s),u)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,u){return this.easeTo(l.extend({bearing:e},s),u)}resetNorth(e,s){return this.rotateTo(0,l.extend({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=l.LngLatBounds.convert(e);const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,s)}_cameraForBoxAndBearing(e,s,u,d){const g={top:0,bottom:0,right:0,left:0};if(typeof(d=l.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const be=d.padding;d.padding={top:be,bottom:be,right:be,left:be}}d.padding=l.extend(g,d.padding);const b=this.transform,I=b.padding,k=b.project(l.LngLat.convert(e)),D=b.project(l.LngLat.convert(s)),F=k.rotate(-u*Math.PI/180),j=D.rotate(-u*Math.PI/180),N=new l.pointGeometry(Math.max(F.x,j.x),Math.max(F.y,j.y)),K=new l.pointGeometry(Math.min(F.x,j.x),Math.min(F.y,j.y)),J=N.sub(K),ee=(b.width-(I.left+I.right+d.padding.left+d.padding.right))/J.x,le=(b.height-(I.top+I.bottom+d.padding.top+d.padding.bottom))/J.y;if(le<0||ee<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ce=Math.min(b.scaleZoom(b.scale*Math.min(ee,le)),d.maxZoom),ye=l.pointGeometry.convert(d.offset),oe=new l.pointGeometry((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(u*Math.PI/180),ve=ye.add(oe).mult(b.scale/b.zoomScale(ce));return{center:b.unproject(k.add(D).div(2).sub(ve)),zoom:ce,bearing:u}}fitBounds(e,s,u){return this._fitInternal(this.cameraForBounds(e,s),s,u)}fitScreenCoordinates(e,s,u,d,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(e)),this.transform.pointLocation(l.pointGeometry.convert(s)),u,d),d,g)}_fitInternal(e,s,u){return e?(delete(s=l.extend(e,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(e,s){this.stop();const u=this.transform;let d=!1,g=!1,b=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(d=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=l.LngLat.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(g=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(b=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this.fire(new l.Event("movestart",s)).fire(new l.Event("move",s)),d&&this.fire(new l.Event("zoomstart",s)).fire(new l.Event("zoom",s)).fire(new l.Event("zoomend",s)),g&&this.fire(new l.Event("rotatestart",s)).fire(new l.Event("rotate",s)).fire(new l.Event("rotateend",s)),b&&this.fire(new l.Event("pitchstart",s)).fire(new l.Event("pitch",s)).fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}easeTo(e,s){this._stop(!1,e.easeId),((e=l.extend({offset:[0,0],duration:500,easing:l.ease},e)).animate===!1||!e.essential&&l.exported.prefersReducedMotion)&&(e.duration=0);const u=this.transform,d=this.getZoom(),g=this.getBearing(),b=this.getPitch(),I=this.getPadding(),k="zoom"in e?+e.zoom:d,D="bearing"in e?this._normalizeBearing(e.bearing,g):g,F="pitch"in e?+e.pitch:b,j="padding"in e?e.padding:u.padding,N=l.pointGeometry.convert(e.offset);let K=u.centerPoint.add(N);const J=u.pointLocation(K),ee=l.LngLat.convert(e.center||J);this._normalizeCenter(ee);const le=u.project(J),ce=u.project(ee).sub(le),ye=u.zoomScale(k-d);let oe,ve;e.around&&(oe=l.LngLat.convert(e.around),ve=u.locationPoint(oe));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==d,this._rotating=this._rotating||g!==D,this._pitching=this._pitching||F!==b,this._padding=!u.isPaddingEqual(j),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,be),this._ease(ze=>{if(this._zooming&&(u.zoom=l.number(d,k,ze)),this._rotating&&(u.bearing=l.number(g,D,ze)),this._pitching&&(u.pitch=l.number(b,F,ze)),this._padding&&(u.interpolatePadding(I,j,ze),K=u.centerPoint.add(N)),oe)u.setLocationAtPoint(oe,ve);else{const we=u.zoomScale(u.zoom-d),Ne=k>d?Math.min(2,ye):Math.max(.5,ye),Ce=Math.pow(Ne,1-ze),ut=u.unproject(le.add(ce.mult(ze*Ce)).mult(we));u.setLocationAtPoint(u.renderWorldCopies?ut.wrap():ut,K)}this._fireMoveEvents(s)},ze=>{this._afterEase(s,ze)},e),this}_prepareEase(e,s,u={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),s||u.moving||this.fire(new l.Event("movestart",e)),this._zooming&&!u.zooming&&this.fire(new l.Event("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new l.Event("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new l.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new l.Event("move",e)),this._zooming&&this.fire(new l.Event("zoom",e)),this._rotating&&this.fire(new l.Event("rotate",e)),this._pitching&&this.fire(new l.Event("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const u=this._zooming,d=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new l.Event("zoomend",e)),d&&this.fire(new l.Event("rotateend",e)),g&&this.fire(new l.Event("pitchend",e)),this.fire(new l.Event("moveend",e))}flyTo(e,s){if(!e.essential&&l.exported.prefersReducedMotion){const It=l.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(It,s)}this.stop(),e=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},e);const u=this.transform,d=this.getZoom(),g=this.getBearing(),b=this.getPitch(),I=this.getPadding(),k="zoom"in e?l.clamp(+e.zoom,u.minZoom,u.maxZoom):d,D="bearing"in e?this._normalizeBearing(e.bearing,g):g,F="pitch"in e?+e.pitch:b,j="padding"in e?e.padding:u.padding,N=u.zoomScale(k-d),K=l.pointGeometry.convert(e.offset);let J=u.centerPoint.add(K);const ee=u.pointLocation(J),le=l.LngLat.convert(e.center||ee);this._normalizeCenter(le);const ce=u.project(ee),ye=u.project(le).sub(ce);let oe=e.curve;const ve=Math.max(u.width,u.height),be=ve/N,ze=ye.mag();if("minZoom"in e){const It=l.clamp(Math.min(e.minZoom,d,k),u.minZoom,u.maxZoom),ii=ve/u.zoomScale(It-d);oe=Math.sqrt(ii/ze*2)}const we=oe*oe;function Ne(It){const ii=(be*be-ve*ve+(It?-1:1)*we*we*ze*ze)/(2*(It?be:ve)*we*ze);return Math.log(Math.sqrt(ii*ii+1)-ii)}function Ce(It){return(Math.exp(It)-Math.exp(-It))/2}function ut(It){return(Math.exp(It)+Math.exp(-It))/2}const yt=Ne(0);let xt=function(It){return ut(yt)/ut(yt+oe*It)},Ft=function(It){return ve*((ut(yt)*(Ce(ii=yt+oe*It)/ut(ii))-Ce(yt))/we)/ze;var ii},ti=(Ne(1)-yt)/oe;if(Math.abs(ze)<1e-6||!isFinite(ti)){if(Math.abs(ve-be)<1e-6)return this.easeTo(e,s);const It=be<ve?-1:1;ti=Math.abs(Math.log(be/ve))/oe,Ft=function(){return 0},xt=function(ii){return Math.exp(It*oe*ii)}}return e.duration="duration"in e?+e.duration:1e3*ti/("screenSpeed"in e?+e.screenSpeed/oe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=g!==D,this._pitching=F!==b,this._padding=!u.isPaddingEqual(j),this._prepareEase(s,!1),this._ease(It=>{const ii=It*ti,oi=1/xt(ii);u.zoom=It===1?k:d+u.scaleZoom(oi),this._rotating&&(u.bearing=l.number(g,D,It)),this._pitching&&(u.pitch=l.number(b,F,It)),this._padding&&(u.interpolatePadding(I,j,It),J=u.centerPoint.add(K));const xi=It===1?le:u.unproject(ce.add(ye.mult(Ft(ii))).mult(oi));u.setLocationAtPoint(u.renderWorldCopies?xi.wrap():xi,J),this._fireMoveEvents(s)},()=>this._afterEase(s),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}if(!e){const u=this.handlers;u&&u.stop(!1)}return this}_ease(e,s,u){u.animate===!1||u.duration===0?(e(1),s()):(this._easeStart=l.exported.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,s){e=l.wrap(e,-180,180);const u=Math.abs(e-s);return Math.abs(e-360-s)<u&&(e-=360),Math.abs(e+360-s)<u&&(e+=360),e}_normalizeCenter(e){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const u=e.lng-s.center.lng;e.lng+=u>180?-360:u<-180?360:0}}class Na{constructor(e={}){this.options=e,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=Z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const u=this._map._getUIString(`AttributionControl.${s}`);e.title=u,e.setAttribute("aria-label",u)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const s=this._map.style.sourceCaches;for(const d in s){const g=s[d];if(g.used){const b=g.getSource();b.attribution&&e.indexOf(b.attribution)<0&&e.push(b.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,g)=>d.length-g.length),e=e.filter((d,g)=>{for(let b=g+1;b<e.length;b++)if(e[b].indexOf(d)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ja{constructor(e={}){this.options=e,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Z.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=Z.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const e=this._container.children;if(e.length){const s=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Ll{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const d of u)if(d.id===e)return void(d.cancelled=!0)}run(e=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ys={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Zn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Yt={showCompass:!0,showZoom:!0,visualizePitch:!1};class _t{constructor(e,s,u=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new ao({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,u&&(this.mousePitch=new Yn({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(s,"mousedown",this.mousedown),Z.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(s,"touchmove",this.touchmove),Z.addEventListener(s,"touchend",this.touchend),Z.addEventListener(s,"touchcancel",this.reset)}down(e,s){this.mouseRotate.mousedown(e,s),this.mousePitch&&this.mousePitch.mousedown(e,s),Z.disableDrag()}move(e,s){const u=this.map,d=this.mouseRotate.mousemoveWindow(e,s);if(d&&d.bearingDelta&&u.setBearing(u.getBearing()+d.bearingDelta),this.mousePitch){const g=this.mousePitch.mousemoveWindow(e,s);g&&g.pitchDelta&&u.setPitch(u.getPitch()+g.pitchDelta)}}off(){const e=this.element;Z.removeEventListener(e,"mousedown",this.mousedown),Z.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(e,"touchmove",this.touchmove),Z.removeEventListener(e,"touchend",this.touchend),Z.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Z.enableDrag(),Z.removeEventListener(window,"mousemove",this.mousemove),Z.removeEventListener(window,"mouseup",this.mouseup)}mousedown(e){this.down(l.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),Z.mousePos(this.element,e)),Z.addEventListener(window,"mousemove",this.mousemove),Z.addEventListener(window,"mouseup",this.mouseup)}mousemove(e){this.move(e,Z.mousePos(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ri(r,e,s){if(r=new l.LngLat(r.lng,r.lat),e){const u=new l.LngLat(r.lng-360,r.lat),d=new l.LngLat(r.lng+360,r.lat),g=s.locationPoint(r).distSqr(e);s.locationPoint(u).distSqr(e)<g?r=u:s.locationPoint(d).distSqr(e)<g&&(r=d)}for(;Math.abs(r.lng-s.center.lng)>180;){const u=s.locationPoint(r);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;r.lng>s.center.lng?r.lng-=360:r.lng+=360}return r}const xs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Mo(r,e,s){const u=r.classList;for(const d in xs)u.remove(`maplibregl-${s}-anchor-${d}`,`mapboxgl-${s}-anchor-${d}`);u.add(`maplibregl-${s}-anchor-${e}`,`mapboxgl-${s}-anchor-${e}`)}class tn extends l.Evented{constructor(e,s){if(super(),(e instanceof HTMLElement||s)&&(e=l.extend({element:e},s)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=l.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");const u=Z.createNS("http://www.w3.org/2000/svg","svg"),d=41,g=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${d}px`),u.setAttributeNS(null,"width",`${g}px`),u.setAttributeNS(null,"viewBox",`0 0 ${g} ${d}`);const b=Z.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const I=Z.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const k=Z.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ye of D){const oe=Z.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",ye.rx),oe.setAttributeNS(null,"ry",ye.ry),k.appendChild(oe)}const F=Z.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const j=Z.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(j);const N=Z.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const K=Z.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(K);const J=Z.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(6.0, 7.0)"),J.setAttributeNS(null,"fill","#FFFFFF");const ee=Z.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=Z.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const ce=Z.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#FFFFFF"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962"),ee.appendChild(le),ee.appendChild(ce),I.appendChild(k),I.appendChild(F),I.appendChild(N),I.appendChild(J),I.appendChild(ee),u.appendChild(I),u.setAttributeNS(null,"height",d*this._scale+"px"),u.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(u),this._offset=l.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),Mo(this._element,this._anchor,"marker"),this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(e){const s=e.code,u=e.charCode||e.keyCode;s!=="Space"&&s!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(e){const s=e.originalEvent.target,u=this._element;this._popup&&(s===u||u.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}_update(e){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ri(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let u="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?u="rotateX(0deg)":this._pitchAlignment==="map"&&(u=`rotateX(${this._map.getPitch()}deg)`),e&&e.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,`${xs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${u} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const d=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=d.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(e){return this._offset=l.pointGeometry.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const pn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let nn,Xn=0,Rs=!1;const Ir={maxWidth:100,unit:"metric"};function Oi(r,e,s){const u=s&&s.maxWidth||100,d=r._container.clientHeight/2,g=r.unproject([0,d]),b=r.unproject([u,d]),I=g.distanceTo(b);if(s&&s.unit==="imperial"){const k=3.2808*I;k>5280?jr(e,u,k/5280,r._getUIString("ScaleControl.Miles")):jr(e,u,k,r._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?jr(e,u,I/1852,r._getUIString("ScaleControl.NauticalMiles")):I>=1e3?jr(e,u,I/1e3,r._getUIString("ScaleControl.Kilometers")):jr(e,u,I,r._getUIString("ScaleControl.Meters"))}function jr(r,e,s,u){const d=function(g){const b=Math.pow(10,`${Math.floor(g)}`.length-1);let I=g/b;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(k){const D=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*D)/D}(I),b*I}(s);r.style.width=e*(d/s)+"px",r.innerHTML=`${d}&nbsp;${u}`}const co={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Fs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function w(r){if(r){if(typeof r=="number"){const e=Math.round(Math.sqrt(.5*Math.pow(r,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,r),"top-left":new l.pointGeometry(e,e),"top-right":new l.pointGeometry(-e,e),bottom:new l.pointGeometry(0,-r),"bottom-left":new l.pointGeometry(e,-e),"bottom-right":new l.pointGeometry(-e,-e),left:new l.pointGeometry(r,0),right:new l.pointGeometry(-r,0)}}if(r instanceof l.pointGeometry||Array.isArray(r)){const e=l.pointGeometry.convert(r);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.pointGeometry.convert(r.center||[0,0]),top:l.pointGeometry.convert(r.top||[0,0]),"top-left":l.pointGeometry.convert(r["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(r["top-right"]||[0,0]),bottom:l.pointGeometry.convert(r.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(r["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(r["bottom-right"]||[0,0]),left:l.pointGeometry.convert(r.left||[0,0]),right:l.pointGeometry.convert(r.right||[0,0])}}return w(new l.pointGeometry(0,0))}const a={supported:W,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends fa{constructor(r){var e;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(r=l.extend({},Zn,r)).minZoom!=null&&r.maxZoom!=null&&r.minZoom>r.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(r.minPitch!=null&&r.maxPitch!=null&&r.minPitch>r.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(r.minPitch!=null&&r.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(r.maxPitch!=null&&r.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Hs(r.minZoom,r.maxZoom,r.minPitch,r.maxPitch,r.renderWorldCopies),{bearingSnap:r.bearingSnap}),this._interactive=r.interactive,this._maxTileCacheSize=r.maxTileCacheSize,this._failIfMajorPerformanceCaveat=r.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=r.preserveDrawingBuffer,this._antialias=r.antialias,this._trackResize=r.trackResize,this._bearingSnap=r.bearingSnap,this._refreshExpiredTiles=r.refreshExpiredTiles,this._fadeDuration=r.fadeDuration,this._crossSourceCollisions=r.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=r.collectResourceTiming,this._renderTaskQueue=new Ll,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},ys,r.locale),this._clickTolerance=r.clickTolerance,this._pixelRatio=(e=r.pixelRatio)!==null&&e!==void 0?e:devicePixelRatio,this._requestManager=new me(r.transformRequest),typeof r.container=="string"){if(this._container=document.getElementById(r.container),!this._container)throw new Error(`Container '${r.container}' not found.`)}else{if(!(r.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=r.container}if(r.maxBounds&&this.setMaxBounds(r.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window!="undefined"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new zr(this,r),this._hash=r.hash&&new ml(typeof r.hash=="string"&&r.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch}),r.bounds&&(this.resize(),this.fitBounds(r.bounds,l.extend({},r.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=r.localIdeographFontFamily,r.style&&this.setStyle(r.style,{localIdeographFontFamily:r.localIdeographFontFamily}),r.attributionControl&&this.addControl(new Na({customAttribution:r.customAttribution})),r.maplibreLogo&&this.addControl(new ja,r.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new l.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new l.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new l.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(r,e){if(e===void 0&&(e=r.getDefaultPosition?r.getDefaultPosition():"top-right"),!r||!r.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=r.onAdd(this);this._controls.push(r);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(r){if(!r||!r.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(r);return e>-1&&this._controls.splice(e,1),r.onRemove(this),this}hasControl(r){return this._controls.indexOf(r)>-1}resize(r){const e=this._containerDimensions(),s=e[0],u=e[1];this._resizeCanvas(s,u,this.getPixelRatio()),this.transform.resize(s,u),this.painter.resize(s,u,this.getPixelRatio());const d=!this._moving;return d&&(this.stop(),this.fire(new l.Event("movestart",r)).fire(new l.Event("move",r))),this.fire(new l.Event("resize",r)),d&&this.fire(new l.Event("moveend",r)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(r){const[e,s]=this._containerDimensions();this._pixelRatio=r,this._resizeCanvas(e,s,r),this.painter.resize(e,s,r)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(r){return this.transform.setMaxBounds(l.LngLatBounds.convert(r)),this._update()}setMinZoom(r){if((r=r==null?-2:r)>=-2&&r<=this.transform.maxZoom)return this.transform.minZoom=r,this._update(),this.getZoom()<r&&this.setZoom(r),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(r){if((r=r==null?22:r)>=this.transform.minZoom)return this.transform.maxZoom=r,this._update(),this.getZoom()>r&&this.setZoom(r),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(r){if((r=r==null?0:r)<0)throw new Error("minPitch must be greater than or equal to 0");if(r>=0&&r<=this.transform.maxPitch)return this.transform.minPitch=r,this._update(),this.getPitch()<r&&this.setPitch(r),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(r){if((r=r==null?60:r)>85)throw new Error("maxPitch must be less than or equal to 85");if(r>=this.transform.minPitch)return this.transform.maxPitch=r,this._update(),this.getPitch()>r&&this.setPitch(r),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(r){return this.transform.renderWorldCopies=r,this._update()}project(r){return this.transform.locationPoint(l.LngLat.convert(r),this.style&&this.style.terrain)}unproject(r){return this.transform.pointLocation(l.pointGeometry.convert(r),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(r,e,s){if(r==="mouseenter"||r==="mouseover"){let u=!1;return{layer:e,listener:s,delegates:{mousemove:g=>{const b=this.getLayer(e)?this.queryRenderedFeatures(g.point,{layers:[e]}):[];b.length?u||(u=!0,s.call(this,new en(r,this,g.originalEvent,{features:b}))):u=!1},mouseout:()=>{u=!1}}}}if(r==="mouseleave"||r==="mouseout"){let u=!1;return{layer:e,listener:s,delegates:{mousemove:b=>{(this.getLayer(e)?this.queryRenderedFeatures(b.point,{layers:[e]}):[]).length?u=!0:u&&(u=!1,s.call(this,new en(r,this,b.originalEvent)))},mouseout:b=>{u&&(u=!1,s.call(this,new en(r,this,b.originalEvent)))}}}}{const u=d=>{const g=this.getLayer(e)?this.queryRenderedFeatures(d.point,{layers:[e]}):[];g.length&&(d.features=g,s.call(this,d),delete d.features)};return{layer:e,listener:s,delegates:{[r]:u}}}}on(r,e,s){if(s===void 0)return super.on(r,e);const u=this._createDelegatedListener(r,e,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[r]=this._delegatedListeners[r]||[],this._delegatedListeners[r].push(u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(r,e,s){if(s===void 0)return super.once(r,e);const u=this._createDelegatedListener(r,e,s);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(r,e,s){return s===void 0?super.off(r,e):(this._delegatedListeners&&this._delegatedListeners[r]&&(u=>{const d=this._delegatedListeners[r];for(let g=0;g<d.length;g++){const b=d[g];if(b.layer===e&&b.listener===s){for(const I in b.delegates)this.off(I,b.delegates[I]);return d.splice(g,1),this}}})(),this)}queryRenderedFeatures(r,e){if(!this.style)return[];let s;if(e!==void 0||r===void 0||r instanceof l.pointGeometry||Array.isArray(r)||(e=r,r=void 0),e=e||{},(r=r||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof r[0]=="number")s=[l.pointGeometry.convert(r)];else{const u=l.pointGeometry.convert(r[0]),d=l.pointGeometry.convert(r[1]);s=[u,new l.pointGeometry(d.x,u.y),d,new l.pointGeometry(u.x,d.y),u]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(r,e){return this.style.querySourceFeatures(r,e)}setStyle(r,e){return(e=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&r?(this._diffStyle(r,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(r,e))}setTransformRequest(r){return this._requestManager.setTransformRequest(r),this}_getUIString(r){const e=this._locale[r];if(e==null)throw new Error(`Missing UI string '${r}'`);return e}_updateStyle(r,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),r?(this.style=new fr(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof r=="string"?this.style.loadURL(r):this.style.loadJSON(r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new fr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(r,e){if(typeof r=="string"){const s=this._requestManager.transformRequest(r,l.ResourceType.Style);l.getJSON(s,(u,d)=>{u?this.fire(new l.ErrorEvent(u)):d&&this._updateDiff(d,e)})}else typeof r=="object"&&this._updateDiff(r,e)}_updateDiff(r,e){try{this.style.setState(r)&&this._update(!0)}catch(s){l.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(r,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(r,e){return this._lazyInitEmptyStyle(),this.style.addSource(r,e),this._update(!0)}isSourceLoaded(r){const e=this.style&&this.style.sourceCaches[r];if(e!==void 0)return e.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${r}'`)))}setTerrain(r){return this.style.setTerrain(r),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const r=this.style&&this.style.sourceCaches;for(const e in r){const s=r[e]._tiles;for(const u in s){const d=s[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}addSourceType(r,e,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(r,e,s)}removeSource(r){return this.style.removeSource(r),this._update(!0)}getSource(r){return this.style.getSource(r)}addImage(r,e,{pixelRatio:s=1,sdf:u=!1,stretchX:d,stretchY:g,content:b}={}){if(this._lazyInitEmptyStyle(),e instanceof HTMLImageElement||l.isImageBitmap(e)){const{width:I,height:k,data:D}=l.exported.getImageData(e);this.style.addImage(r,{data:new l.RGBAImage({width:I,height:k},D),pixelRatio:s,stretchX:d,stretchY:g,content:b,sdf:u,version:0})}else{if(e.width===void 0||e.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:k,data:D}=e,F=e;this.style.addImage(r,{data:new l.RGBAImage({width:I,height:k},new Uint8Array(D)),pixelRatio:s,stretchX:d,stretchY:g,content:b,sdf:u,version:0,userImage:F}),F.onAdd&&F.onAdd(this,r)}}}updateImage(r,e){const s=this.style.getImage(r);if(!s)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||l.isImageBitmap(e)?l.exported.getImageData(e):e,{width:d,height:g,data:b}=u;if(d===void 0||g===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==s.data.width||g!==s.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(e instanceof HTMLImageElement||l.isImageBitmap(e));s.data.replace(b,I),this.style.updateImage(r,s)}hasImage(r){return r?!!this.style.getImage(r):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(r){this.style.removeImage(r)}loadImage(r,e){l.getImage(this._requestManager.transformRequest(r,l.ResourceType.Image),e)}listImages(){return this.style.listImages()}addLayer(r,e){return this._lazyInitEmptyStyle(),this.style.addLayer(r,e),this._update(!0)}moveLayer(r,e){return this.style.moveLayer(r,e),this._update(!0)}removeLayer(r){return this.style.removeLayer(r),this._update(!0)}getLayer(r){return this.style.getLayer(r)}setLayerZoomRange(r,e,s){return this.style.setLayerZoomRange(r,e,s),this._update(!0)}setFilter(r,e,s={}){return this.style.setFilter(r,e,s),this._update(!0)}getFilter(r){return this.style.getFilter(r)}setPaintProperty(r,e,s,u={}){return this.style.setPaintProperty(r,e,s,u),this._update(!0)}getPaintProperty(r,e){return this.style.getPaintProperty(r,e)}setLayoutProperty(r,e,s,u={}){return this.style.setLayoutProperty(r,e,s,u),this._update(!0)}getLayoutProperty(r,e){return this.style.getLayoutProperty(r,e)}setLight(r,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(r,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(r,e){return this.style.setFeatureState(r,e),this._update()}removeFeatureState(r,e){return this.style.removeFeatureState(r,e),this._update()}getFeatureState(r){return this.style.getFeatureState(r)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let r=0,e=0;return this._container&&(r=this._container.clientWidth||400,e=this._container.clientHeight||300),[r,e]}_setupContainer(){const r=this._container;r.classList.add("maplibregl-map","mapboxgl-map");const e=this._canvasContainer=Z.create("div","maplibregl-canvas-container mapboxgl-canvas-container",r);this._interactive&&e.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=Z.create("canvas","maplibregl-canvas mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const u=this._controlContainer=Z.create("div","maplibregl-control-container mapboxgl-control-container",r),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{d[g]=Z.create("div",`maplibregl-ctrl-${g} mapboxgl-ctrl-${g}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(r,e,s){this._canvas.width=s*r,this._canvas.height=s*e,this._canvas.style.width=`${r}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const r=l.extend({},W.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);e?(this.painter=new sa(e,this.transform),l.exported$1.testSupport(e)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(r){r.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:r}))}_contextRestored(r){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:r}))}_onMapScroll(r){if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(r){return this.style?(this._styleDirty=this._styleDirty||r,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(r){return this._update(),this._renderTaskQueue.add(r)}_cancelRenderFrame(r){this._renderTaskQueue.remove(r)}_render(r){let e,s=0;const u=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(e=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,e),s=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(r),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,I=l.exported.now();this.style.zoomHistory.update(b,I);const k=new l.EvaluationParameters(b,{now:I,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=k.crossFadingFactor();D===1&&D===this._crossFadingFactor||(d=!0,this._crossFadingFactor=D),this.style.update(k)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const b=l.exported.now()-s;u.endQueryEXT(u.TIME_ELAPSED_EXT,e),setTimeout(()=>{const I=u.getQueryObjectEXT(e,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(e),this.fire(new l.Event("gpu-timing-frame",{cpuTime:b,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const b=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(b);this.fire(new l.Event("gpu-timing-layer",{layerTimes:I}))},50)}const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window!="undefined"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Z.remove(this._canvasContainer),Z.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(r=>{l.PerformanceUtils.frame(r),this._frame=null,this._render(r)}))}_onWindowOnline(){this._update()}_onWindowResize(r){this._trackResize&&this.resize({originalEvent:r})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(r){this._showTileBoundaries!==r&&(this._showTileBoundaries=r,this._update())}get showPadding(){return!!this._showPadding}set showPadding(r){this._showPadding!==r&&(this._showPadding=r,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(r){this._showCollisionBoxes!==r&&(this._showCollisionBoxes=r,r?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(r){this._showOverdrawInspector!==r&&(this._showOverdrawInspector=r,this._update())}get repaint(){return!!this._repaint}set repaint(r){this._repaint!==r&&(this._repaint=r,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(r){this._vertices=r,this._update()}_setCacheLimits(r,e){l.setCacheLimits(r,e)}},NavigationControl:class{constructor(r){this.options=l.extend({},Yt,r),this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const r=this._map.getZoom(),e=r===this._map.getMaxZoom(),s=r===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r}onAdd(r){return this._map=r,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _t(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(r,e){const s=Z.create("button",r,this._container);return s.type="button",s.addEventListener("click",e),s}_setButtonTitle(r,e){const s=this._map._getUIString(`NavigationControl.${e}`);r.title=s,r.setAttribute("aria-label",s)}},GeolocateControl:class extends l.Evented{constructor(r){super(),this.options=l.extend({},pn,r),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(r){var e;return this._map=r,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),e=this._setupUI,nn!==void 0?e(nn):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{nn=s.state!=="denied",e(nn)}):(nn=!!window.navigator.geolocation,e(nn)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Xn=0,Rs=!1}_isOutOfMapMaxBounds(r){const e=this._map.getMaxBounds(),s=r.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(r){if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",r)),this._finish()}}_updateCamera(r){const e=new l.LngLat(r.coords.longitude,r.coords.latitude),s=r.coords.accuracy,u=this._map.getBearing(),d=l.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(s),d,{geolocateSource:!0})}_updateMarker(r){if(r){const e=new l.LngLat(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const r=this._map._container.clientHeight/2,e=this._map.unproject([0,r]),s=this._map.unproject([1,r]),u=e.distanceTo(s),d=Math.ceil(2*this._accuracy/u);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(r){if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&Rs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",r)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(r){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Z.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new tn(this._dotElement),this._circleElement=Z.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new tn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xn--,Rs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let r;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Xn++,Xn>1?(r={maximumAge:6e5,timeout:0},Rs=!0):(r=this.options.positionOptions,Rs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,r)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Na,LogoControl:ja,ScaleControl:class{constructor(r){this.options=l.extend({},Ir,r),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Oi(this._map,this._container,this.options)}onAdd(r){return this._map=r,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",r.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(r){this.options.unit=r,Oi(this._map,this._container,this.options)}},FullscreenControl:class{constructor(r){this._fullscreen=!1,r&&r.container&&(r.container instanceof HTMLElement?this._container=r.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(r){return this._map=r,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const r=this._fullscreenButton=Z.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",r).setAttribute("aria-hidden","true"),r.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const r=this._getTitle();this._fullscreenButton.setAttribute("aria-label",r),this._fullscreenButton.title=r}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(r){this.options=r,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(r){return this._map=r,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=Z.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(r){super(),this.options=l.extend(Object.create(co),r),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(r){return this._map&&this.remove(),this._map=r,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=l.LngLat.convert(r),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(r){return this.setDOMContent(document.createTextNode(r))}setHTML(r){const e=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=r;u=s.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(r){return this.options.maxWidth=r,this._update(),this}setDOMContent(r){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(r),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(r){this._container&&this._container.classList.add(r)}removeClassName(r){this._container&&this._container.classList.remove(r)}setOffset(r){return this.options.offset=r,this._update(),this}toggleClassName(r){if(this._container)return this._container.classList.toggle(r)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Z.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(r){this._update(r.point)}_onMouseMove(r){this._update(r.point)}_onDrag(r){this._update(r.point)}_update(r){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=Z.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(g=>this._container.classList.add(g)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ri(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!r))return;const e=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);let s=this.options.anchor;const u=w(this.options.offset);if(!s){const g=this._container.offsetWidth,b=this._container.offsetHeight;let I;I=e.y+u.bottom.y<b?["top"]:e.y>this._map.transform.height-b?["bottom"]:[],e.x<g/2?I.push("left"):e.x>this._map.transform.width-g/2&&I.push("right"),s=I.length===0?"bottom":I.join("-")}const d=e.add(u[s]).round();Z.setTransform(this._container,`${xs[s]} translate(${d.x}px,${d.y}px)`),Mo(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const r=this._container.querySelector(Fs);r&&r.focus()}_onClose(){this.remove()}},Marker:tn,Style:fr,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:gi,GeoJSONSource:Wt,ImageSource:vt,RasterDEMTileSource:De,RasterTileSource:wt,VectorTileSource:ft,VideoSource:Ht,prewarm:function(){Er().acquire(Mr)},clearPrewarmedResources:function(){const r=_r;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Mr),_r=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return Ai.workerCount},set workerCount(r){Ai.workerCount=r},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(r){l.config.MAX_PARALLEL_IMAGE_REQUESTS=r},clearStorage(r){l.clearTileCache(r)},workerUrl:"",addProtocol(r,e){l.config.REGISTERED_PROTOCOLS[r]=e},removeProtocol(r){delete l.config.REGISTERED_PROTOCOLS[r]}};return lo.extend(a,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),a});var U=P;return U})})(im);var Md=im.exports;const Cm=8,Pm="https://cdn.jsdelivr.net/gh/bothness/basemaps/fonts/{fontstack}/{range}.pbf",Mm={},Dm=[{id:"basemap-div",type:"background",paint:{"background-opacity":0}},{id:"overlays-div",type:"background",paint:{"background-opacity":0}},{id:"places-div",type:"background",paint:{"background-opacity":0}}];var Lm={version:Cm,glyphs:Pm,sources:Mm,layers:Dm},nm={exports:{}};(function(C,y){(function(T,A){C.exports=A()})(tm,function(){var T,A,P;function O(l,W){if(!T)T=W;else if(!A)A=W;else{var $="var sharedChunk = {}; ("+T+")(sharedChunk); ("+A+")(sharedChunk);",ue={};T(ue),P=W(ue),typeof window!="undefined"&&(P.workerUrl=window.URL.createObjectURL(new Blob([$],{type:"text/javascript"})))}}O(["exports"],function(l){var W=$;function $(c,n,h,m){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(m-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=n,this.p2x=h,this.p2y=m}function ue(c,n,h,m){const v=new W(c,n,h,m);return function(S){return v.solve(S)}}$.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,n){if(n===void 0&&(n=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,m=0;m<8;m++){var v=this.sampleCurveX(h)-c;if(Math.abs(v)<n)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var i=0,t=1;for(h=c,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-c)<n));m++)c>v?i=h:t=h,h=.5*(t-i)+i;return h},solve:function(c,n){return this.sampleCurveY(this.solveCurveX(c,n))}};const re=ue(.25,.1,.25,1);function Z(c,n,h){return Math.min(h,Math.max(n,c))}function me(c,n,h){const m=h-n,v=((c-n)%m+m)%m+n;return v===n?h:v}function _e(c,...n){for(const h of n)for(const m in h)c[m]=h[m];return c}let Fe=1;function gt(c,n){c.forEach(h=>{n[h]&&(n[h]=n[h].bind(n))})}function zt(c,n,h){const m={};for(const v in c)m[v]=n.call(h||this,c[v],v,c);return m}function Ct(c,n,h){const m={};for(const v in c)n.call(h||this,c[v],v,c)&&(m[v]=c[v]);return m}function it(c){return Array.isArray(c)?c.map(it):typeof c=="object"&&c?zt(c,it):c}const je={};function nt(c){je[c]||(typeof console!="undefined"&&console.warn(c),je[c]=!0)}function ct(c,n,h){return(h.y-c.y)*(n.x-c.x)>(n.y-c.y)*(h.x-c.x)}function Xe(c){let n=0;for(let h,m,v=0,S=c.length,i=S-1;v<S;i=v++)h=c[v],m=c[i],n+=(m.x-h.x)*(h.y+m.y);return n}function at(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function rt(c){const n={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,v,S)=>{const i=v||S;return n[m]=!i||i.toLowerCase(),""}),n["max-age"]){const h=parseInt(n["max-age"],10);isNaN(h)?delete n["max-age"]:n["max-age"]=h}return n}let Oe,bt,We=null;function ft(c){if(We==null){const n=c.navigator?c.navigator.userAgent:null;We=!!c.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return We}function wt(c){return typeof ImageBitmap!="undefined"&&c instanceof ImageBitmap}const Ze={now:typeof performance!="undefined"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(c){const n=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(c,n=0){const h=window.document.createElement("canvas"),m=h.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return h.width=c.width,h.height=c.height,m.drawImage(c,0,0,c.width,c.height),m.getImageData(-n,-n,c.width+2*n,c.height+2*n)},resolveURL:c=>(Oe||(Oe=document.createElement("a")),Oe.href=c,Oe.href),hardwareConcurrency:typeof navigator!="undefined"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(bt==null&&(bt=matchMedia("(prefers-reduced-motion: reduce)")),bt.matches)}};var De=Wt;function Wt(c,n){this.x=c,this.y=n}Wt.prototype={clone:function(){return new Wt(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,n){return this.clone()._rotateAround(c,n)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var n=c.x-this.x,h=c.y-this.y;return n*n+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,n){return Math.atan2(this.x*n-this.y*c,this.x*c+this.y*n)},_matMult:function(c){var n=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=n,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var n=Math.cos(c),h=Math.sin(c),m=h*this.x+n*this.y;return this.x=n*this.x-h*this.y,this.y=m,this},_rotateAround:function(c,n){var h=Math.cos(c),m=Math.sin(c),v=n.y+m*(this.x-n.x)+h*(this.y-n.y);return this.x=n.x+h*(this.x-n.x)-m*(this.y-n.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Wt.convert=function(c){return c instanceof Wt?c:Array.isArray(c)?new Wt(c[0],c[1]):c};const si={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},vt="mapbox-tiles";let Ht,gi,ui=500,Ci=50;function fi(){typeof caches=="undefined"||Ht||(Ht=caches.open(vt))}let ei=1/0;const _i={supported:!1,testSupport:function(c){!$e&&lt&&(di?Ui(c):$i=c)}};let $i,lt,$e=!1,di=!1;function Ui(c){const n=c.createTexture();c.bindTexture(c.TEXTURE_2D,n);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,lt),c.isContextLost())return;_i.supported=!0}catch{}c.deleteTexture(n),$e=!0}typeof document!="undefined"&&(lt=document.createElement("img"),lt.onload=function(){$i&&Ui($i),$i=null,di=!0},lt.onerror=function(){$e=!0,$i=null},lt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Mr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Mr);class Ai extends Error{constructor(n,h,m,v){super(`AJAXError: ${h} (${n}): ${m}`),this.status=n,this.statusText=h,this.url=m,this.body=v}}const gr=at()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function _r(c,n){const h=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:gr(),signal:h.signal});let v=!1,S=!1;return c.type==="json"&&m.headers.set("Accept","application/json"),((i,t,o)=>{if(S)return;const p=Date.now();fetch(m).then(f=>f.ok?((_,x,E)=>{(c.type==="arrayBuffer"?_.arrayBuffer():c.type==="json"?_.json():_.text()).then(z=>{S||(x&&E&&function(R,V,q){if(fi(),!Ht)return;const X={status:V.status,statusText:V.statusText,headers:new Headers};V.headers.forEach((Q,fe)=>X.headers.set(fe,Q));const Y=rt(V.headers.get("Cache-Control")||"");Y["no-store"]||(Y["max-age"]&&X.headers.set("Expires",new Date(q+1e3*Y["max-age"]).toUTCString()),new Date(X.headers.get("Expires")).getTime()-q<42e4||function(Q,fe){if(gi===void 0)try{new Response(new ReadableStream),gi=!0}catch{gi=!1}gi?fe(Q.body):Q.blob().then(fe)}(V,Q=>{const fe=new Response(Q,X);fi(),Ht&&Ht.then(de=>de.put(function(Te){const Pe=Te.indexOf("?");return Pe<0?Te:Te.slice(0,Pe)}(R.url),fe)).catch(de=>nt(de.message))}))}(m,x,E),v=!0,n(null,z,_.headers.get("Cache-Control"),_.headers.get("Expires")))}).catch(z=>{S||n(new Error(z.message))})})(f,null,p):f.blob().then(_=>n(new Ai(f.status,f.statusText,c.url,_)))).catch(f=>{f.code!==20&&n(new Error(f.message))})})(),{cancel:()=>{S=!0,v||h.abort()}}}const Er=function(c,n){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){if(at()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,n);if(!at()){const m=c.url.substring(0,c.url.indexOf("://"));return(si.REGISTERED_PROTOCOLS[m]||_r)(c,n)}}if(!(/^file:/.test(h=c.url)||/^file:/.test(gr())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return _r(c,n);if(at()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,n,void 0,!0)}var h;return function(m,v){const S=new XMLHttpRequest;S.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(S.responseType="arraybuffer");for(const i in m.headers)S.setRequestHeader(i,m.headers[i]);return m.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=m.credentials==="include",S.onerror=()=>{v(new Error(S.statusText))},S.onload=()=>{if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let i=S.response;if(m.type==="json")try{i=JSON.parse(S.response)}catch(t){return v(t)}v(null,i,S.getResponseHeader("Cache-Control"),S.getResponseHeader("Expires"))}else{const i=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});v(new Ai(S.status,S.statusText,m.url,i))}},S.send(m.body),{cancel:()=>S.abort()}}(c,n)},Dr=function(c,n){return Er(_e(c,{type:"arrayBuffer"}),n)};function Jr(c){const n=window.document.createElement("a");return n.href=c,n.protocol===window.document.location.protocol&&n.host===window.document.location.host}const bi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let br,cr;br=[],cr=0;const Hi=function(c,n){if(_i.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),cr>=si.MAX_PARALLEL_IMAGE_REQUESTS){const S={requestParameters:c,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return br.push(S),S}cr++;let h=!1;const m=()=>{if(!h)for(h=!0,cr--;br.length&&cr<si.MAX_PARALLEL_IMAGE_REQUESTS;){const S=br.shift(),{requestParameters:i,callback:t,cancelled:o}=S;o||(S.cancel=Hi(i,t).cancel)}},v=Dr(c,(S,i,t,o)=>{m(),S?n(S):i&&function(p,f){typeof createImageBitmap=="function"?function(_,x){const E=new Blob([new Uint8Array(_)],{type:"image/png"});createImageBitmap(E).then(z=>{x(null,z)}).catch(z=>{x(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,f):function(_,x){const E=new Image;E.onload=()=>{x(null,E),URL.revokeObjectURL(E.src),E.onload=null,window.requestAnimationFrame(()=>{E.src=bi})},E.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Blob([new Uint8Array(_)],{type:"image/png"});E.src=_.byteLength?URL.createObjectURL(z):bi}(p,f)}(i,(p,f)=>{p!=null?n(p):f!=null&&n(null,f,{cacheControl:t,expires:o})})});return{cancel:()=>{v.cancel(),m()}}};function Qt(c,n,h){h[c]&&h[c].indexOf(n)!==-1||(h[c]=h[c]||[],h[c].push(n))}function tr(c,n,h){if(h&&h[c]){const m=h[c].indexOf(n);m!==-1&&h[c].splice(m,1)}}class Di{constructor(n,h={}){_e(this,h),this.type=n}}class jt extends Di{constructor(n,h={}){super("error",_e({error:n},h))}}class Vi{on(n,h){return this._listeners=this._listeners||{},Qt(n,h,this._listeners),this}off(n,h){return tr(n,h,this._listeners),tr(n,h,this._oneTimeListeners),this}once(n,h){return this._oneTimeListeners=this._oneTimeListeners||{},Qt(n,h,this._oneTimeListeners),this}fire(n,h){typeof n=="string"&&(n=new Di(n,h||{}));const m=n.type;if(this.listens(m)){n.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const t of v)t.call(this,n);const S=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const t of S)tr(m,t,this._oneTimeListeners),t.call(this,n);const i=this._eventedParent;i&&(_e(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),i.fire(n))}else n instanceof jt&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,h){return this._eventedParent=n,this._eventedParentData=h,this}}var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ae{constructor(n,h,m,v){this.message=(n?`${n}: `:"")+m,v&&(this.identifier=v),h!=null&&h.__line__&&(this.line=h.__line__)}}function $r(c){const n=c.value;return n?[new Ae(c.key,n,"constants have been deprecated as of v8")]:[]}function yr(c,...n){for(const h of n)for(const m in h)c[m]=h[m];return c}function Gt(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function hi(c){if(Array.isArray(c))return c.map(hi);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const n={};for(const h in c)n[h]=hi(c[h]);return n}return Gt(c)}class Ti extends Error{constructor(n,h){super(h),this.message=h,this.key=n}}class xr{constructor(n,h=[]){this.parent=n,this.bindings={};for(const[m,v]of h)this.bindings[m]=v}concat(n){return new xr(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Mi={kind:"null"},Ve={kind:"number"},Dt={kind:"string"},Pt={kind:"boolean"},Ii={kind:"color"},Ar={kind:"object"},Mt={kind:"value"},kn={kind:"collator"},vr={kind:"formatted"},bn={kind:"resolvedImage"};function ki(c,n){return{kind:"array",itemType:c,N:n}}function pi(c){if(c.kind==="array"){const n=pi(c.itemType);return typeof c.N=="number"?`array<${n}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${n}>`}return c.kind}const hn=[Mi,Ve,Dt,Pt,Ii,vr,Ar,ki(Mt),bn];function mn(c,n){if(n.kind==="error")return null;if(c.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!mn(c.itemType,n.itemType))&&(typeof c.N!="number"||c.N===n.N))return null}else{if(c.kind===n.kind)return null;if(c.kind==="value"){for(const h of hn)if(!mn(h,n))return null}}return`Expected ${pi(c)} but found ${pi(n)} instead.`}function wr(c,n){return n.some(h=>h.kind===c.kind)}function an(c,n){return n.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}var wn,is={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Tn(c){return(c=Math.round(c))<0?0:c>255?255:c}function ge(c){return Tn(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function B(c){return(n=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:n>1?1:n;var n}function M(c,n,h){return h<0?h+=1:h>1&&(h-=1),6*h<1?c+(n-c)*h*6:2*h<1?n:3*h<2?c+(n-c)*(2/3-h)*6:c}try{wn={}.parseCSSColor=function(c){var n,h=c.replace(/ /g,"").toLowerCase();if(h in is)return is[h].slice();if(h[0]==="#")return h.length===4?(n=parseInt(h.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:h.length===7&&(n=parseInt(h.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var m=h.indexOf("("),v=h.indexOf(")");if(m!==-1&&v+1===h.length){var S=h.substr(0,m),i=h.substr(m+1,v-(m+1)).split(","),t=1;switch(S){case"rgba":if(i.length!==4)return null;t=B(i.pop());case"rgb":return i.length!==3?null:[ge(i[0]),ge(i[1]),ge(i[2]),t];case"hsla":if(i.length!==4)return null;t=B(i.pop());case"hsl":if(i.length!==3)return null;var o=(parseFloat(i[0])%360+360)%360/360,p=B(i[1]),f=B(i[2]),_=f<=.5?f*(p+1):f+p-f*p,x=2*f-_;return[Tn(255*M(x,_,o+1/3)),Tn(255*M(x,_,o)),Tn(255*M(x,_,o-1/3)),t];default:return null}}return null}}catch{}class L{constructor(n,h,m,v=1){this.r=n,this.g=h,this.b=m,this.a=v}static parse(n){if(!n)return;if(n instanceof L)return n;if(typeof n!="string")return;const h=wn(n);return h?new L(h[0]/255*h[3],h[1]/255*h[3],h[2]/255*h[3],h[3]):void 0}toString(){const[n,h,m,v]=this.toArray();return`rgba(${Math.round(n)},${Math.round(h)},${Math.round(m)},${v})`}toArray(){const{r:n,g:h,b:m,a:v}=this;return v===0?[0,0,0,0]:[255*n/v,255*h/v,255*m/v,v]}}L.black=new L(0,0,0,1),L.white=new L(1,1,1,1),L.transparent=new L(0,0,0,0),L.red=new L(1,0,0,1);class G{constructor(n,h,m){this.sensitivity=n?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,h){return this.collator.compare(n,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class H{constructor(n,h,m,v,S){this.text=n,this.image=h,this.scale=m,this.fontStack=v,this.textColor=S}}class te{constructor(n){this.sections=n}static fromString(n){return new te([new H(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof te?n:te.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const h of this.sections){if(h.image){n.push(["image",h.image.name]);continue}n.push(h.text);const m={};h.fontStack&&(m["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(m["font-scale"]=h.scale),h.textColor&&(m["text-color"]=["rgba"].concat(h.textColor.toArray())),n.push(m)}return n}}class ne{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new ne({name:n,available:!1}):null}serialize(){return["image",this.name]}}function ie(c,n,h,m){return typeof c=="number"&&c>=0&&c<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,n,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,n,h,m]:[c,n,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function se(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof L||c instanceof G||c instanceof te||c instanceof ne)return!0;if(Array.isArray(c)){for(const n of c)if(!se(n))return!1;return!0}if(typeof c=="object"){for(const n in c)if(!se(c[n]))return!1;return!0}return!1}function pe(c){if(c===null)return Mi;if(typeof c=="string")return Dt;if(typeof c=="boolean")return Pt;if(typeof c=="number")return Ve;if(c instanceof L)return Ii;if(c instanceof G)return kn;if(c instanceof te)return vr;if(c instanceof ne)return bn;if(Array.isArray(c)){const n=c.length;let h;for(const m of c){const v=pe(m);if(h){if(h===v)continue;h=Mt;break}h=v}return ki(h||Mt,n)}return Ar}function Ie(c){const n=typeof c;return c===null?"":n==="string"||n==="number"||n==="boolean"?String(c):c instanceof L||c instanceof te||c instanceof ne?c.toString():JSON.stringify(c)}class Se{constructor(n,h){this.type=n,this.value=h}static parse(n,h){if(n.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!se(n[1]))return h.error("invalid value");const m=n[1];let v=pe(m);const S=h.expectedType;return v.kind!=="array"||v.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(v=S),new Se(v,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof L?["rgba"].concat(this.value.toArray()):this.value instanceof te?this.value.serialize():this.value}}class ke{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const st={string:Dt,number:Ve,boolean:Pt,object:Ar};class he{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");let m,v=1;const S=n[0];if(S==="array"){let t,o;if(n.length>2){const p=n[1];if(typeof p!="string"||!(p in st)||p==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);t=st[p],v++}else t=Mt;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return h.error('The length argument to "array" must be a positive integer literal',2);o=n[2],v++}m=ki(t,o)}else m=st[S];const i=[];for(;v<n.length;v++){const t=h.parse(n[v],v,Mt);if(!t)return null;i.push(t)}return new he(m,i)}evaluate(n){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(n);if(!mn(this.type,pe(m)))return m;if(h===this.args.length-1)throw new ke(`Expected value to be of type ${pi(this.type)}, but found ${pi(pe(m))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,h=[n.kind];if(n.kind==="array"){const m=n.itemType;if(m.kind==="string"||m.kind==="number"||m.kind==="boolean"){h.push(m.kind);const v=n.N;(typeof v=="number"||this.args.length>1)&&h.push(v)}}return h.concat(this.args.map(m=>m.serialize()))}}class qe{constructor(n){this.type=vr,this.sections=n}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");const m=n[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const v=[];let S=!1;for(let i=1;i<=n.length-1;++i){const t=n[i];if(S&&typeof t=="object"&&!Array.isArray(t)){S=!1;let o=null;if(t["font-scale"]&&(o=h.parse(t["font-scale"],1,Ve),!o))return null;let p=null;if(t["text-font"]&&(p=h.parse(t["text-font"],1,ki(Dt)),!p))return null;let f=null;if(t["text-color"]&&(f=h.parse(t["text-color"],1,Ii),!f))return null;const _=v[v.length-1];_.scale=o,_.font=p,_.textColor=f}else{const o=h.parse(n[i],1,Mt);if(!o)return null;const p=o.type.kind;if(p!=="string"&&p!=="value"&&p!=="null"&&p!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,v.push({content:o,scale:null,font:null,textColor:null})}}return new qe(v)}evaluate(n){return new te(this.sections.map(h=>{const m=h.content.evaluate(n);return pe(m)===bn?new H("",m,null,null,null):new H(Ie(m),null,h.scale?h.scale.evaluate(n):null,h.font?h.font.evaluate(n).join(","):null,h.textColor?h.textColor.evaluate(n):null)}))}eachChild(n){for(const h of this.sections)n(h.content),h.scale&&n(h.scale),h.font&&n(h.font),h.textColor&&n(h.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const h of this.sections){n.push(h.content.serialize());const m={};h.scale&&(m["font-scale"]=h.scale.serialize()),h.font&&(m["text-font"]=h.font.serialize()),h.textColor&&(m["text-color"]=h.textColor.serialize()),n.push(m)}return n}}class ot{constructor(n){this.type=bn,this.input=n}static parse(n,h){if(n.length!==2)return h.error("Expected two arguments.");const m=h.parse(n[1],1,Dt);return m?new ot(m):h.error("No image name provided.")}evaluate(n){const h=this.input.evaluate(n),m=ne.fromString(h);return m&&n.availableImages&&(m.available=n.availableImages.indexOf(h)>-1),m}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ut={"to-boolean":Pt,"to-color":Ii,"to-number":Ve,"to-string":Dt};class Lt{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");const m=n[0];if((m==="to-boolean"||m==="to-string")&&n.length!==2)return h.error("Expected one argument.");const v=Ut[m],S=[];for(let i=1;i<n.length;i++){const t=h.parse(n[i],i,Mt);if(!t)return null;S.push(t)}return new Lt(v,S)}evaluate(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){let h,m;for(const v of this.args){if(h=v.evaluate(n),m=null,h instanceof L)return h;if(typeof h=="string"){const S=n.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:ie(h[0],h[1],h[2],h[3]),!m))return new L(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new ke(m||`Could not parse color from value '${typeof h=="string"?h:String(JSON.stringify(h))}'`)}if(this.type.kind==="number"){let h=null;for(const m of this.args){if(h=m.evaluate(n),h===null)return 0;const v=Number(h);if(!isNaN(v))return v}throw new ke(`Could not convert ${JSON.stringify(h)} to number.`)}return this.type.kind==="formatted"?te.fromString(Ie(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?ne.fromString(Ie(this.args[0].evaluate(n))):Ie(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new qe([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ot(this.args[0]).serialize();const n=[`to-${this.type.kind}`];return this.eachChild(h=>{n.push(h.serialize())}),n}}const Et=["Unknown","Point","LineString","Polygon"];class Vt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Et[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let h=this._parseColorCache[n];return h||(h=this._parseColorCache[n]=L.parse(n)),h}}class Kt{constructor(n,h,m,v){this.name=n,this.type=h,this._evaluate=m,this.args=v}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,h){const m=n[0],v=Kt.definitions[m];if(!v)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(v)?v[0]:v.type,i=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,t=i.filter(([p])=>!Array.isArray(p)||p.length===n.length-1);let o=null;for(const[p,f]of t){o=new As(h.registry,h.path,null,h.scope);const _=[];let x=!1;for(let E=1;E<n.length;E++){const z=n[E],R=Array.isArray(p)?p[E-1]:p.type,V=o.parse(z,1+_.length,R);if(!V){x=!0;break}_.push(V)}if(!x)if(Array.isArray(p)&&p.length!==_.length)o.error(`Expected ${p.length} arguments, but found ${_.length} instead.`);else{for(let E=0;E<_.length;E++){const z=Array.isArray(p)?p[E]:p.type,R=_[E];o.concat(E+1).checkSubtype(z,R.type)}if(o.errors.length===0)return new Kt(m,S,f,_)}}if(t.length===1)h.errors.push(...o.errors);else{const p=(t.length?t:i).map(([_])=>{return x=_,Array.isArray(x)?`(${x.map(pi).join(", ")})`:`(${pi(x.type)}...)`;var x}).join(" | "),f=[];for(let _=1;_<n.length;_++){const x=h.parse(n[_],1+f.length);if(!x)return null;f.push(pi(x.type))}h.error(`Expected arguments of type ${p}, but found (${f.join(", ")}) instead.`)}return null}static register(n,h){Kt.definitions=h;for(const m in h)n[m]=Kt}}class Qi{constructor(n,h,m){this.type=kn,this.locale=m,this.caseSensitive=n,this.diacriticSensitive=h}static parse(n,h){if(n.length!==2)return h.error("Expected one argument.");const m=n[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const v=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,Pt);if(!v)return null;const S=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,Pt);if(!S)return null;let i=null;return m.locale&&(i=h.parse(m.locale,1,Dt),!i)?null:new Qi(v,S,i)}evaluate(n){return new G(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}const Ni=8192;function fr(c,n){c[0]=Math.min(c[0],n[0]),c[1]=Math.min(c[1],n[1]),c[2]=Math.max(c[2],n[0]),c[3]=Math.max(c[3],n[1])}function gn(c,n){return!(c[0]<=n[0]||c[2]>=n[2]||c[1]<=n[1]||c[3]>=n[3])}function Es(c,n){const h=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,v=Math.pow(2,n.z);return[Math.round(h*v*Ni),Math.round(m*v*Ni)]}function mr(c,n,h){const m=c[0]-n[0],v=c[1]-n[1],S=c[0]-h[0],i=c[1]-h[1];return m*i-S*v==0&&m*S<=0&&v*i<=0}function Tr(c,n){let h=!1;for(let i=0,t=n.length;i<t;i++){const o=n[i];for(let p=0,f=o.length;p<f-1;p++){if(mr(c,o[p],o[p+1]))return!1;(v=o[p])[1]>(m=c)[1]!=(S=o[p+1])[1]>m[1]&&m[0]<(S[0]-v[0])*(m[1]-v[1])/(S[1]-v[1])+v[0]&&(h=!h)}}var m,v,S;return h}function il(c,n){for(let h=0;h<n.length;h++)if(Tr(c,n[h]))return!0;return!1}function Ta(c,n,h,m){const v=m[0]-h[0],S=m[1]-h[1],i=(c[0]-h[0])*S-v*(c[1]-h[1]),t=(n[0]-h[0])*S-v*(n[1]-h[1]);return i>0&&t<0||i<0&&t>0}function Pl(c,n,h){for(const p of h)for(let f=0;f<p.length-1;++f)if((t=[(i=p[f+1])[0]-(S=p[f])[0],i[1]-S[1]])[0]*(o=[(v=n)[0]-(m=c)[0],v[1]-m[1]])[1]-t[1]*o[0]!=0&&Ta(m,v,S,i)&&Ta(S,i,m,v))return!0;var m,v,S,i,t,o;return!1}function fo(c,n){for(let h=0;h<c.length;++h)if(!Tr(c[h],n))return!1;for(let h=0;h<c.length-1;++h)if(Pl(c[h],c[h+1],n))return!1;return!0}function rl(c,n){for(let h=0;h<n.length;h++)if(fo(c,n[h]))return!0;return!1}function Go(c,n,h){const m=[];for(let v=0;v<c.length;v++){const S=[];for(let i=0;i<c[v].length;i++){const t=Es(c[v][i],h);fr(n,t),S.push(t)}m.push(S)}return m}function Zo(c,n,h){const m=[];for(let v=0;v<c.length;v++){const S=Go(c[v],n,h);m.push(S)}return m}function Ia(c,n,h,m){if(c[0]<h[0]||c[0]>h[2]){const v=.5*m;let S=c[0]-h[0]>v?-m:h[0]-c[0]>v?m:0;S===0&&(S=c[0]-h[2]>v?-m:h[2]-c[0]>v?m:0),c[0]+=S}fr(n,c)}function qs(c,n,h,m){const v=Math.pow(2,m.z)*Ni,S=[m.x*Ni,m.y*Ni],i=[];for(const t of c)for(const o of t){const p=[o.x+S[0],o.y+S[1]];Ia(p,n,h,v),i.push(p)}return i}function Xo(c,n,h,m){const v=Math.pow(2,m.z)*Ni,S=[m.x*Ni,m.y*Ni],i=[];for(const o of c){const p=[];for(const f of o){const _=[f.x+S[0],f.y+S[1]];fr(n,_),p.push(_)}i.push(p)}if(n[2]-n[0]<=v/2){(t=n)[0]=t[1]=1/0,t[2]=t[3]=-1/0;for(const o of i)for(const p of o)Ia(p,n,h,v)}var t;return i}class rs{constructor(n,h){this.type=Pt,this.geojson=n,this.geometries=h}static parse(n,h){if(n.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(se(n[1])){const m=n[1];if(m.type==="FeatureCollection")for(let v=0;v<m.features.length;++v){const S=m.features[v].geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new rs(m,m.features[v].geometry)}else if(m.type==="Feature"){const v=m.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new rs(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new rs(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],i=h.canonicalID();if(m.type==="Polygon"){const t=Go(m.coordinates,S,i),o=qs(h.geometry(),v,S,i);if(!gn(v,S))return!1;for(const p of o)if(!Tr(p,t))return!1}if(m.type==="MultiPolygon"){const t=Zo(m.coordinates,S,i),o=qs(h.geometry(),v,S,i);if(!gn(v,S))return!1;for(const p of o)if(!il(p,t))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],i=h.canonicalID();if(m.type==="Polygon"){const t=Go(m.coordinates,S,i),o=Xo(h.geometry(),v,S,i);if(!gn(v,S))return!1;for(const p of o)if(!fo(p,t))return!1}if(m.type==="MultiPolygon"){const t=Zo(m.coordinates,S,i),o=Xo(h.geometry(),v,S,i);if(!gn(v,S))return!1;for(const p of o)if(!rl(p,t))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Gs(c){if(c instanceof Kt&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof rs)return!1;let n=!0;return c.eachChild(h=>{n&&!Gs(h)&&(n=!1)}),n}function fs(c){if(c instanceof Kt&&c.name==="feature-state")return!1;let n=!0;return c.eachChild(h=>{n&&!fs(h)&&(n=!1)}),n}function Zs(c,n){if(c instanceof Kt&&n.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(m=>{h&&!Zs(m,n)&&(h=!1)}),h}class mo{constructor(n,h){this.type=h.type,this.name=n,this.boundExpression=h}static parse(n,h){if(n.length!==2||typeof n[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=n[1];return h.scope.has(m)?new mo(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class As{constructor(n,h=[],m,v=new xr,S=[]){this.registry=n,this.path=h,this.key=h.map(i=>`[${i}]`).join(""),this.scope=v,this.errors=S,this.expectedType=m}parse(n,h,m,v,S={}){return h?this.concat(h,m,v)._parse(n,S):this._parse(n,S)}_parse(n,h){function m(v,S,i){return i==="assert"?new he(S,[v]):i==="coerce"?new Lt(S,[v]):v}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=n[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[v];if(S){let i=S.parse(n,this);if(!i)return null;if(this.expectedType){const t=this.expectedType,o=i.type;if(t.kind!=="string"&&t.kind!=="number"&&t.kind!=="boolean"&&t.kind!=="object"&&t.kind!=="array"||o.kind!=="value")if(t.kind!=="color"&&t.kind!=="formatted"&&t.kind!=="resolvedImage"||o.kind!=="value"&&o.kind!=="string"){if(this.checkSubtype(t,o))return null}else i=m(i,t,h.typeAnnotation||"coerce");else i=m(i,t,h.typeAnnotation||"assert")}if(!(i instanceof Se)&&i.type.kind!=="resolvedImage"&&ks(i)){const t=new Vt;try{i=new Se(i.type,i.evaluate(t))}catch(o){return this.error(o.message),null}}return i}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,h,m){const v=typeof n=="number"?this.path.concat(n):this.path,S=m?this.scope.concat(m):this.scope;return new As(this.registry,v,h||null,S,this.errors)}error(n,...h){const m=`${this.key}${h.map(v=>`[${v}]`).join("")}`;this.errors.push(new Ti(m,n))}checkSubtype(n,h){const m=mn(n,h);return m&&this.error(m),m}}function ks(c){if(c instanceof mo)return ks(c.boundExpression);if(c instanceof Kt&&c.name==="error"||c instanceof Qi||c instanceof rs)return!1;const n=c instanceof Lt||c instanceof he;let h=!0;return c.eachChild(m=>{h=n?h&&ks(m):h&&m instanceof Se}),!!h&&Gs(c)&&Zs(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Qr(c,n){const h=c.length-1;let m,v,S=0,i=h,t=0;for(;S<=i;)if(t=Math.floor((S+i)/2),m=c[t],v=c[t+1],m<=n){if(t===h||n<v)return t;S=t+1}else{if(!(m>n))throw new ke("Input is not a number.");i=t-1}return 0}class Xs{constructor(n,h,m){this.type=n,this.input=h,this.labels=[],this.outputs=[];for(const[v,S]of m)this.labels.push(v),this.outputs.push(S)}static parse(n,h){if(n.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(n[1],1,Ve);if(!m)return null;const v=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let i=1;i<n.length;i+=2){const t=i===1?-1/0:n[i],o=n[i+1],p=i,f=i+1;if(typeof t!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(v.length&&v[v.length-1][0]>=t)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',p);const _=h.parse(o,f,S);if(!_)return null;S=S||_.type,v.push([t,_])}return new Xs(S,m,v)}evaluate(n){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(n);const v=this.input.evaluate(n);if(v<=h[0])return m[0].evaluate(n);const S=h.length;return v>=h[S-1]?m[S-1].evaluate(n):m[Qr(h,v)].evaluate(n)}eachChild(n){n(this.input);for(const h of this.outputs)n(h)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let h=0;h<this.labels.length;h++)h>0&&n.push(this.labels[h]),n.push(this.outputs[h].serialize());return n}}function rn(c,n,h){return c*(1-h)+n*h}var Qs=Object.freeze({__proto__:null,number:rn,color:function(c,n,h){return new L(rn(c.r,n.r,h),rn(c.g,n.g,h),rn(c.b,n.b,h),rn(c.a,n.a,h))},array:function(c,n,h){return c.map((m,v)=>rn(m,n[v],h))}});const Sa=.95047,Ea=1.08883,Aa=4/29,Wo=6/29,nl=3*Wo*Wo,sl=Math.PI/180,ol=180/Math.PI;function Ho(c){return c>.008856451679035631?Math.pow(c,1/3):c/nl+Aa}function Ko(c){return c>Wo?c*c*c:nl*(c-Aa)}function ka(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function za(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function sr(c){const n=za(c.r),h=za(c.g),m=za(c.b),v=Ho((.4124564*n+.3575761*h+.1804375*m)/Sa),S=Ho((.2126729*n+.7151522*h+.072175*m)/1);return{l:116*S-16,a:500*(v-S),b:200*(S-Ho((.0193339*n+.119192*h+.9503041*m)/Ea)),alpha:c.a}}function er(c){let n=(c.l+16)/116,h=isNaN(c.a)?n:n+c.a/500,m=isNaN(c.b)?n:n-c.b/200;return n=1*Ko(n),h=Sa*Ko(h),m=Ea*Ko(m),new L(ka(3.2404542*h-1.5371385*n-.4985314*m),ka(-.969266*h+1.8760108*n+.041556*m),ka(.0556434*h-.2040259*n+1.0572252*m),c.alpha)}function Yo(c,n,h){const m=n-c;return c+h*(m>180||m<-180?m-360*Math.round(m/360):m)}const go={forward:sr,reverse:er,interpolate:function(c,n,h){return{l:rn(c.l,n.l,h),a:rn(c.a,n.a,h),b:rn(c.b,n.b,h),alpha:rn(c.alpha,n.alpha,h)}}},zn={forward:function(c){const{l:n,a:h,b:m}=sr(c),v=Math.atan2(m,h)*ol;return{h:v<0?v+360:v,c:Math.sqrt(h*h+m*m),l:n,alpha:c.a}},reverse:function(c){const n=c.h*sl,h=c.c;return er({l:c.l,a:Math.cos(n)*h,b:Math.sin(n)*h,alpha:c.alpha})},interpolate:function(c,n,h){return{h:Yo(c.h,n.h,h),c:rn(c.c,n.c,h),l:rn(c.l,n.l,h),alpha:rn(c.alpha,n.alpha,h)}}};var Ca=Object.freeze({__proto__:null,lab:go,hcl:zn});class Ln{constructor(n,h,m,v,S){this.type=n,this.operator=h,this.interpolation=m,this.input=v,this.labels=[],this.outputs=[];for(const[i,t]of S)this.labels.push(i),this.outputs.push(t)}static interpolationFactor(n,h,m,v){let S=0;if(n.name==="exponential")S=_o(h,n.base,m,v);else if(n.name==="linear")S=_o(h,1,m,v);else if(n.name==="cubic-bezier"){const i=n.controlPoints;S=new W(i[0],i[1],i[2],i[3]).solve(_o(h,1,m,v))}return S}static parse(n,h){let[m,v,S,...i]=n;if(!Array.isArray(v)||v.length===0)return h.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const p=v[1];if(typeof p!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:p}}else{if(v[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const p=v.slice(1);if(p.length!==4||p.some(f=>typeof f!="number"||f<0||f>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:p}}}if(n.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,Ve),!S)return null;const t=[];let o=null;m==="interpolate-hcl"||m==="interpolate-lab"?o=Ii:h.expectedType&&h.expectedType.kind!=="value"&&(o=h.expectedType);for(let p=0;p<i.length;p+=2){const f=i[p],_=i[p+1],x=p+3,E=p+4;if(typeof f!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(t.length&&t[t.length-1][0]>=f)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',x);const z=h.parse(_,E,o);if(!z)return null;o=o||z.type,t.push([f,z])}return o.kind==="number"||o.kind==="color"||o.kind==="array"&&o.itemType.kind==="number"&&typeof o.N=="number"?new Ln(o,m,v,S,t):h.error(`Type ${pi(o)} is not interpolatable.`)}evaluate(n){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(n);const v=this.input.evaluate(n);if(v<=h[0])return m[0].evaluate(n);const S=h.length;if(v>=h[S-1])return m[S-1].evaluate(n);const i=Qr(h,v),t=Ln.interpolationFactor(this.interpolation,v,h[i],h[i+1]),o=m[i].evaluate(n),p=m[i+1].evaluate(n);return this.operator==="interpolate"?Qs[this.type.kind.toLowerCase()](o,p,t):this.operator==="interpolate-hcl"?zn.reverse(zn.interpolate(zn.forward(o),zn.forward(p),t)):go.reverse(go.interpolate(go.forward(o),go.forward(p),t))}eachChild(n){n(this.input);for(const h of this.outputs)n(h)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const h=[this.operator,n,this.input.serialize()];for(let m=0;m<this.labels.length;m++)h.push(this.labels[m],this.outputs[m].serialize());return h}}function _o(c,n,h,m){const v=m-h,S=c-h;return v===0?0:n===1?S/v:(Math.pow(n,S)-1)/(Math.pow(n,v)-1)}class yo{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expectected at least one argument.");let m=null;const v=h.expectedType;v&&v.kind!=="value"&&(m=v);const S=[];for(const t of n.slice(1)){const o=h.parse(t,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!o)return null;m=m||o.type,S.push(o)}const i=v&&S.some(t=>mn(v,t.type));return new yo(i?Mt:m,S)}evaluate(n){let h,m=null,v=0;for(const S of this.args)if(v++,m=S.evaluate(n),m&&m instanceof ne&&!m.available&&(h||(h=m.name),m=null,v===this.args.length&&(m=h)),m!==null)break;return m}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(h=>{n.push(h.serialize())}),n}}class xo{constructor(n,h){this.type=h.type,this.bindings=[].concat(n),this.result=h}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const h of this.bindings)n(h[1]);n(this.result)}static parse(n,h){if(n.length<4)return h.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const m=[];for(let S=1;S<n.length-1;S+=2){const i=n[S];if(typeof i!="string")return h.error(`Expected string, but found ${typeof i} instead.`,S);if(/[^a-zA-Z0-9_]/.test(i))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const t=h.parse(n[S+1],S+1);if(!t)return null;m.push([i,t])}const v=h.parse(n[n.length-1],n.length-1,h.expectedType,m);return v?new xo(m,v):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[h,m]of this.bindings)n.push(h,m.serialize());return n.push(this.result.serialize()),n}}class vo{constructor(n,h,m){this.type=n,this.index=h,this.input=m}static parse(n,h){if(n.length!==3)return h.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const m=h.parse(n[1],1,Ve),v=h.parse(n[2],2,ki(h.expectedType||Mt));return m&&v?new vo(v.type.itemType,m,v):null}evaluate(n){const h=this.index.evaluate(n),m=this.input.evaluate(n);if(h<0)throw new ke(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new ke(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new ke(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Jo{constructor(n,h){this.type=Pt,this.needle=n,this.haystack=h}static parse(n,h){if(n.length!==3)return h.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const m=h.parse(n[1],1,Mt),v=h.parse(n[2],2,Mt);return m&&v?wr(m.type,[Pt,Dt,Ve,Mi,Mt])?new Jo(m,v):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(m.type)} instead`):null}evaluate(n){const h=this.needle.evaluate(n),m=this.haystack.evaluate(n);if(!m)return!1;if(!an(h,["boolean","string","number","null"]))throw new ke(`Expected first argument to be of type boolean, string, number or null, but found ${pi(pe(h))} instead.`);if(!an(m,["string","array"]))throw new ke(`Expected second argument to be of type array or string, but found ${pi(pe(m))} instead.`);return m.indexOf(h)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class bo{constructor(n,h,m){this.type=Ve,this.needle=n,this.haystack=h,this.fromIndex=m}static parse(n,h){if(n.length<=2||n.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const m=h.parse(n[1],1,Mt),v=h.parse(n[2],2,Mt);if(!m||!v)return null;if(!wr(m.type,[Pt,Dt,Ve,Mi,Mt]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(m.type)} instead`);if(n.length===4){const S=h.parse(n[3],3,Ve);return S?new bo(m,v,S):null}return new bo(m,v)}evaluate(n){const h=this.needle.evaluate(n),m=this.haystack.evaluate(n);if(!an(h,["boolean","string","number","null"]))throw new ke(`Expected first argument to be of type boolean, string, number or null, but found ${pi(pe(h))} instead.`);if(!an(m,["string","array"]))throw new ke(`Expected second argument to be of type array or string, but found ${pi(pe(m))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(n);return m.indexOf(h,v)}return m.indexOf(h)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class wo{constructor(n,h,m,v,S,i){this.inputType=n,this.type=h,this.input=m,this.cases=v,this.outputs=S,this.otherwise=i}static parse(n,h){if(n.length<5)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return h.error("Expected an even number of arguments.");let m,v;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);const S={},i=[];for(let p=2;p<n.length-1;p+=2){let f=n[p];const _=n[p+1];Array.isArray(f)||(f=[f]);const x=h.concat(p);if(f.length===0)return x.error("Expected at least one branch label.");for(const z of f){if(typeof z!="number"&&typeof z!="string")return x.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return x.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return x.error("Numeric branch labels must be integer values.");if(m){if(x.checkSubtype(m,pe(z)))return null}else m=pe(z);if(S[String(z)]!==void 0)return x.error("Branch labels must be unique.");S[String(z)]=i.length}const E=h.parse(_,p,v);if(!E)return null;v=v||E.type,i.push(E)}const t=h.parse(n[1],1,Mt);if(!t)return null;const o=h.parse(n[n.length-1],n.length-1,v);return o?t.type.kind!=="value"&&h.concat(1).checkSubtype(m,t.type)?null:new wo(m,v,t,S,i,o):null}evaluate(n){const h=this.input.evaluate(n);return(pe(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],h=Object.keys(this.cases).sort(),m=[],v={};for(const i of h){const t=v[this.cases[i]];t===void 0?(v[this.cases[i]]=m.length,m.push([this.cases[i],[i]])):m[t][1].push(i)}const S=i=>this.inputType.kind==="number"?Number(i):i;for(const[i,t]of m)n.push(t.length===1?S(t[0]):t.map(S)),n.push(this.outputs[i].serialize());return n.push(this.otherwise.serialize()),n}}class Pa{constructor(n,h,m){this.type=n,this.branches=h,this.otherwise=m}static parse(n,h){if(n.length<4)return h.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const v=[];for(let i=1;i<n.length-1;i+=2){const t=h.parse(n[i],i,Pt);if(!t)return null;const o=h.parse(n[i+1],i+1,m);if(!o)return null;v.push([t,o]),m=m||o.type}const S=h.parse(n[n.length-1],n.length-1,m);return S?new Pa(m,v,S):null}evaluate(n){for(const[h,m]of this.branches)if(h.evaluate(n))return m.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[h,m]of this.branches)n(h),n(m);n(this.otherwise)}outputDefined(){return this.branches.every(([n,h])=>h.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(h=>{n.push(h.serialize())}),n}}class $o{constructor(n,h,m,v){this.type=n,this.input=h,this.beginIndex=m,this.endIndex=v}static parse(n,h){if(n.length<=2||n.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const m=h.parse(n[1],1,Mt),v=h.parse(n[2],2,Ve);if(!m||!v)return null;if(!wr(m.type,[ki(Mt),Dt,Mt]))return h.error(`Expected first argument to be of type array or string, but found ${pi(m.type)} instead`);if(n.length===4){const S=h.parse(n[3],3,Ve);return S?new $o(m.type,m,v,S):null}return new $o(m.type,m,v)}evaluate(n){const h=this.input.evaluate(n),m=this.beginIndex.evaluate(n);if(!an(h,["string","array"]))throw new ke(`Expected first argument to be of type array or string, but found ${pi(pe(h))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(n);return h.slice(m,v)}return h.slice(m)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function eo(c,n){return c==="=="||c==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Ml(c,n,h,m){return m.compare(n,h)===0}function To(c,n,h){const m=c!=="=="&&c!=="!=";return class sm{constructor(S,i,t){this.type=Pt,this.lhs=S,this.rhs=i,this.collator=t,this.hasUntypedArgument=S.type.kind==="value"||i.type.kind==="value"}static parse(S,i){if(S.length!==3&&S.length!==4)return i.error("Expected two or three arguments.");const t=S[0];let o=i.parse(S[1],1,Mt);if(!o)return null;if(!eo(t,o.type))return i.concat(1).error(`"${t}" comparisons are not supported for type '${pi(o.type)}'.`);let p=i.parse(S[2],2,Mt);if(!p)return null;if(!eo(t,p.type))return i.concat(2).error(`"${t}" comparisons are not supported for type '${pi(p.type)}'.`);if(o.type.kind!==p.type.kind&&o.type.kind!=="value"&&p.type.kind!=="value")return i.error(`Cannot compare types '${pi(o.type)}' and '${pi(p.type)}'.`);m&&(o.type.kind==="value"&&p.type.kind!=="value"?o=new he(p.type,[o]):o.type.kind!=="value"&&p.type.kind==="value"&&(p=new he(o.type,[p])));let f=null;if(S.length===4){if(o.type.kind!=="string"&&p.type.kind!=="string"&&o.type.kind!=="value"&&p.type.kind!=="value")return i.error("Cannot use collator to compare non-string types.");if(f=i.parse(S[3],3,kn),!f)return null}return new sm(o,p,f)}evaluate(S){const i=this.lhs.evaluate(S),t=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const o=pe(i),p=pe(t);if(o.kind!==p.kind||o.kind!=="string"&&o.kind!=="number")throw new ke(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${o.kind}, ${p.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const o=pe(i),p=pe(t);if(o.kind!=="string"||p.kind!=="string")return n(S,i,t)}return this.collator?h(S,i,t,this.collator.evaluate(S)):n(S,i,t)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}serialize(){const S=[c];return this.eachChild(i=>{S.push(i.serialize())}),S}}}const dc=To("==",function(c,n,h){return n===h},Ml),fc=To("!=",function(c,n,h){return n!==h},function(c,n,h,m){return!Ml(0,n,h,m)}),mc=To("<",function(c,n,h){return n<h},function(c,n,h,m){return m.compare(n,h)<0}),gc=To(">",function(c,n,h){return n>h},function(c,n,h,m){return m.compare(n,h)>0}),al=To("<=",function(c,n,h){return n<=h},function(c,n,h,m){return m.compare(n,h)<=0}),Ma=To(">=",function(c,n,h){return n>=h},function(c,n,h,m){return m.compare(n,h)>=0});class Qo{constructor(n,h,m,v,S){this.type=Dt,this.number=n,this.locale=h,this.currency=m,this.minFractionDigits=v,this.maxFractionDigits=S}static parse(n,h){if(n.length!==3)return h.error("Expected two arguments.");const m=h.parse(n[1],1,Ve);if(!m)return null;const v=n[2];if(typeof v!="object"||Array.isArray(v))return h.error("NumberFormat options argument must be an object.");let S=null;if(v.locale&&(S=h.parse(v.locale,1,Dt),!S))return null;let i=null;if(v.currency&&(i=h.parse(v.currency,1,Dt),!i))return null;let t=null;if(v["min-fraction-digits"]&&(t=h.parse(v["min-fraction-digits"],1,Ve),!t))return null;let o=null;return v["max-fraction-digits"]&&(o=h.parse(v["max-fraction-digits"],1,Ve),!o)?null:new Qo(m,S,i,t,o)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class ea{constructor(n){this.type=Ve,this.input=n}static parse(n,h){if(n.length!==2)return h.error(`Expected 1 argument, but found ${n.length-1} instead.`);const m=h.parse(n[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${pi(m.type)} instead.`):new ea(m):null}evaluate(n){const h=this.input.evaluate(n);if(typeof h=="string"||Array.isArray(h))return h.length;throw new ke(`Expected value to be of type string or array, but found ${pi(pe(h))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(h=>{n.push(h.serialize())}),n}}const ns={"==":dc,"!=":fc,">":gc,"<":mc,">=":Ma,"<=":al,array:he,at:vo,boolean:he,case:Pa,coalesce:yo,collator:Qi,format:qe,image:ot,in:Jo,"index-of":bo,interpolate:Ln,"interpolate-hcl":Ln,"interpolate-lab":Ln,length:ea,let:xo,literal:Se,match:wo,number:he,"number-format":Qo,object:he,slice:$o,step:Xs,string:he,"to-boolean":Lt,"to-color":Lt,"to-number":Lt,"to-string":Lt,var:mo,within:rs};function ll(c,[n,h,m,v]){n=n.evaluate(c),h=h.evaluate(c),m=m.evaluate(c);const S=v?v.evaluate(c):1,i=ie(n,h,m,S);if(i)throw new ke(i);return new L(n/255*S,h/255*S,m/255*S,S)}function cl(c,n){return c in n}function ta(c,n){const h=n[c];return h===void 0?null:h}function jn(c){return{type:c}}function Da(c){return{result:"success",value:c}}function Kn(c){return{result:"error",value:c}}function ss(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function ul(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Vr(c){return!!c.expression&&c.expression.interpolated}function qt(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Li(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function or(c){return c}function kr(c,n){const h=n.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",v=m||!(m||c.property!==void 0),S=c.type||(Vr(n)?"exponential":"interval");if(h&&((c=yr({},c)).stops&&(c.stops=c.stops.map(p=>[p[0],L.parse(p[1])])),c.default=L.parse(c.default?c.default:n.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!Ca[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let i,t,o;if(S==="exponential")i=La;else if(S==="interval")i=ia;else if(S==="categorical"){i=Nr,t=Object.create(null);for(const p of c.stops)t[p[0]]=p[1];o=typeof c.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);i=_c}if(m){const p={},f=[];for(let E=0;E<c.stops.length;E++){const z=c.stops[E],R=z[0].zoom;p[R]===void 0&&(p[R]={zoom:R,type:c.type,property:c.property,default:c.default,stops:[]},f.push(R)),p[R].stops.push([z[0].value,z[1]])}const _=[];for(const E of f)_.push([p[E].zoom,kr(p[E],n)]);const x={name:"linear"};return{kind:"composite",interpolationType:x,interpolationFactor:Ln.interpolationFactor.bind(void 0,x),zoomStops:_.map(E=>E[0]),evaluate:({zoom:E},z)=>La({stops:_,base:c.base},n,E).evaluate(E,z)}}if(v){const p=S==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:p,interpolationFactor:Ln.interpolationFactor.bind(void 0,p),zoomStops:c.stops.map(f=>f[0]),evaluate:({zoom:f})=>i(c,n,f,t,o)}}return{kind:"source",evaluate(p,f){const _=f&&f.properties?f.properties[c.property]:void 0;return _===void 0?yi(c.default,n.default):i(c,n,_,t,o)}}}function yi(c,n,h){return c!==void 0?c:n!==void 0?n:h!==void 0?h:void 0}function Nr(c,n,h,m,v){return yi(typeof h===v?m[h]:void 0,c.default,n.default)}function ia(c,n,h){if(qt(h)!=="number")return yi(c.default,n.default);const m=c.stops.length;if(m===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[m-1][0])return c.stops[m-1][1];const v=Qr(c.stops.map(S=>S[0]),h);return c.stops[v][1]}function La(c,n,h){const m=c.base!==void 0?c.base:1;if(qt(h)!=="number")return yi(c.default,n.default);const v=c.stops.length;if(v===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[v-1][0])return c.stops[v-1][1];const S=Qr(c.stops.map(f=>f[0]),h),i=function(f,_,x,E){const z=E-x,R=f-x;return z===0?0:_===1?R/z:(Math.pow(_,R)-1)/(Math.pow(_,z)-1)}(h,m,c.stops[S][0],c.stops[S+1][0]),t=c.stops[S][1],o=c.stops[S+1][1];let p=Qs[n.type]||or;if(c.colorSpace&&c.colorSpace!=="rgb"){const f=Ca[c.colorSpace];p=(_,x)=>f.reverse(f.interpolate(f.forward(_),f.forward(x),i))}return typeof t.evaluate=="function"?{evaluate(...f){const _=t.evaluate.apply(void 0,f),x=o.evaluate.apply(void 0,f);if(_!==void 0&&x!==void 0)return p(_,x,i)}}:p(t,o,i)}function _c(c,n,h){return n.type==="color"?h=L.parse(h):n.type==="formatted"?h=te.fromString(h.toString()):n.type==="resolvedImage"?h=ne.fromString(h.toString()):qt(h)===n.type||n.type==="enum"&&n.values[h]||(h=void 0),yi(h,c.default,n.default)}Kt.register(ns,{error:[{kind:"error"},[Dt],(c,[n])=>{throw new ke(n.evaluate(c))}],typeof:[Dt,[Mt],(c,[n])=>pi(pe(n.evaluate(c)))],"to-rgba":[ki(Ve,4),[Ii],(c,[n])=>n.evaluate(c).toArray()],rgb:[Ii,[Ve,Ve,Ve],ll],rgba:[Ii,[Ve,Ve,Ve,Ve],ll],has:{type:Pt,overloads:[[[Dt],(c,[n])=>cl(n.evaluate(c),c.properties())],[[Dt,Ar],(c,[n,h])=>cl(n.evaluate(c),h.evaluate(c))]]},get:{type:Mt,overloads:[[[Dt],(c,[n])=>ta(n.evaluate(c),c.properties())],[[Dt,Ar],(c,[n,h])=>ta(n.evaluate(c),h.evaluate(c))]]},"feature-state":[Mt,[Dt],(c,[n])=>ta(n.evaluate(c),c.featureState||{})],properties:[Ar,[],c=>c.properties()],"geometry-type":[Dt,[],c=>c.geometryType()],id:[Mt,[],c=>c.id()],zoom:[Ve,[],c=>c.globals.zoom],"heatmap-density":[Ve,[],c=>c.globals.heatmapDensity||0],"line-progress":[Ve,[],c=>c.globals.lineProgress||0],accumulated:[Mt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Ve,jn(Ve),(c,n)=>{let h=0;for(const m of n)h+=m.evaluate(c);return h}],"*":[Ve,jn(Ve),(c,n)=>{let h=1;for(const m of n)h*=m.evaluate(c);return h}],"-":{type:Ve,overloads:[[[Ve,Ve],(c,[n,h])=>n.evaluate(c)-h.evaluate(c)],[[Ve],(c,[n])=>-n.evaluate(c)]]},"/":[Ve,[Ve,Ve],(c,[n,h])=>n.evaluate(c)/h.evaluate(c)],"%":[Ve,[Ve,Ve],(c,[n,h])=>n.evaluate(c)%h.evaluate(c)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(c,[n,h])=>Math.pow(n.evaluate(c),h.evaluate(c))],sqrt:[Ve,[Ve],(c,[n])=>Math.sqrt(n.evaluate(c))],log10:[Ve,[Ve],(c,[n])=>Math.log(n.evaluate(c))/Math.LN10],ln:[Ve,[Ve],(c,[n])=>Math.log(n.evaluate(c))],log2:[Ve,[Ve],(c,[n])=>Math.log(n.evaluate(c))/Math.LN2],sin:[Ve,[Ve],(c,[n])=>Math.sin(n.evaluate(c))],cos:[Ve,[Ve],(c,[n])=>Math.cos(n.evaluate(c))],tan:[Ve,[Ve],(c,[n])=>Math.tan(n.evaluate(c))],asin:[Ve,[Ve],(c,[n])=>Math.asin(n.evaluate(c))],acos:[Ve,[Ve],(c,[n])=>Math.acos(n.evaluate(c))],atan:[Ve,[Ve],(c,[n])=>Math.atan(n.evaluate(c))],min:[Ve,jn(Ve),(c,n)=>Math.min(...n.map(h=>h.evaluate(c)))],max:[Ve,jn(Ve),(c,n)=>Math.max(...n.map(h=>h.evaluate(c)))],abs:[Ve,[Ve],(c,[n])=>Math.abs(n.evaluate(c))],round:[Ve,[Ve],(c,[n])=>{const h=n.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[Ve,[Ve],(c,[n])=>Math.floor(n.evaluate(c))],ceil:[Ve,[Ve],(c,[n])=>Math.ceil(n.evaluate(c))],"filter-==":[Pt,[Dt,Mt],(c,[n,h])=>c.properties()[n.value]===h.value],"filter-id-==":[Pt,[Mt],(c,[n])=>c.id()===n.value],"filter-type-==":[Pt,[Dt],(c,[n])=>c.geometryType()===n.value],"filter-<":[Pt,[Dt,Mt],(c,[n,h])=>{const m=c.properties()[n.value],v=h.value;return typeof m==typeof v&&m<v}],"filter-id-<":[Pt,[Mt],(c,[n])=>{const h=c.id(),m=n.value;return typeof h==typeof m&&h<m}],"filter->":[Pt,[Dt,Mt],(c,[n,h])=>{const m=c.properties()[n.value],v=h.value;return typeof m==typeof v&&m>v}],"filter-id->":[Pt,[Mt],(c,[n])=>{const h=c.id(),m=n.value;return typeof h==typeof m&&h>m}],"filter-<=":[Pt,[Dt,Mt],(c,[n,h])=>{const m=c.properties()[n.value],v=h.value;return typeof m==typeof v&&m<=v}],"filter-id-<=":[Pt,[Mt],(c,[n])=>{const h=c.id(),m=n.value;return typeof h==typeof m&&h<=m}],"filter->=":[Pt,[Dt,Mt],(c,[n,h])=>{const m=c.properties()[n.value],v=h.value;return typeof m==typeof v&&m>=v}],"filter-id->=":[Pt,[Mt],(c,[n])=>{const h=c.id(),m=n.value;return typeof h==typeof m&&h>=m}],"filter-has":[Pt,[Mt],(c,[n])=>n.value in c.properties()],"filter-has-id":[Pt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Pt,[ki(Dt)],(c,[n])=>n.value.indexOf(c.geometryType())>=0],"filter-id-in":[Pt,[ki(Mt)],(c,[n])=>n.value.indexOf(c.id())>=0],"filter-in-small":[Pt,[Dt,ki(Mt)],(c,[n,h])=>h.value.indexOf(c.properties()[n.value])>=0],"filter-in-large":[Pt,[Dt,ki(Mt)],(c,[n,h])=>function(m,v,S,i){for(;S<=i;){const t=S+i>>1;if(v[t]===m)return!0;v[t]>m?i=t-1:S=t+1}return!1}(c.properties()[n.value],h.value,0,h.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(c,[n,h])=>n.evaluate(c)&&h.evaluate(c)],[jn(Pt),(c,n)=>{for(const h of n)if(!h.evaluate(c))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(c,[n,h])=>n.evaluate(c)||h.evaluate(c)],[jn(Pt),(c,n)=>{for(const h of n)if(h.evaluate(c))return!0;return!1}]]},"!":[Pt,[Pt],(c,[n])=>!n.evaluate(c)],"is-supported-script":[Pt,[Dt],(c,[n])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(n.evaluate(c))}],upcase:[Dt,[Dt],(c,[n])=>n.evaluate(c).toUpperCase()],downcase:[Dt,[Dt],(c,[n])=>n.evaluate(c).toLowerCase()],concat:[Dt,jn(Mt),(c,n)=>n.map(h=>Ie(h.evaluate(c))).join("")],"resolved-locale":[Dt,[kn],(c,[n])=>n.evaluate(c).resolvedLocale()]});class ra{constructor(n,h){this.expression=n,this._warningHistory={},this._evaluator=new Vt,this._defaultValue=h?function(m){return m.type==="color"&&Li(m.default)?new L(0,0,0,0):m.type==="color"?L.parse(m.default)||null:m.default===void 0?null:m.default}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(n,h,m,v,S,i){return this._evaluator.globals=n,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=i,this.expression.evaluate(this._evaluator)}evaluate(n,h,m,v,S,i){this._evaluator.globals=n,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=i||null;try{const t=this.expression.evaluate(this._evaluator);if(t==null||typeof t=="number"&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new ke(`Expected value to be one of ${Object.keys(this._enumValues).map(o=>JSON.stringify(o)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,typeof console!="undefined"&&console.warn(t.message)),this._defaultValue}}}function to(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in ns}function Ws(c,n){const h=new As(ns,[],n?function(v){const S={color:Ii,string:Dt,number:Ve,enum:Dt,boolean:Pt,formatted:vr,resolvedImage:bn};return v.type==="array"?ki(S[v.value]||Mt,v.length):S[v.type]}(n):void 0),m=h.parse(c,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Da(new ra(m,n)):Kn(h.errors)}class io{constructor(n,h){this.kind=n,this._styleExpression=h,this.isStateDependent=n!=="constant"&&!fs(h.expression)}evaluateWithoutErrorHandling(n,h,m,v,S,i){return this._styleExpression.evaluateWithoutErrorHandling(n,h,m,v,S,i)}evaluate(n,h,m,v,S,i){return this._styleExpression.evaluate(n,h,m,v,S,i)}}class ro{constructor(n,h,m,v){this.kind=n,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=n!=="camera"&&!fs(h.expression),this.interpolationType=v}evaluateWithoutErrorHandling(n,h,m,v,S,i){return this._styleExpression.evaluateWithoutErrorHandling(n,h,m,v,S,i)}evaluate(n,h,m,v,S,i){return this._styleExpression.evaluate(n,h,m,v,S,i)}interpolationFactor(n,h,m){return this.interpolationType?Ln.interpolationFactor(this.interpolationType,n,h,m):0}}function Io(c,n){const h=Ws(c,n);if(h.result==="error")return h;const m=h.value.expression,v=Gs(m);if(!v&&!ss(n))return Kn([new Ti("","data expressions not supported")]);const S=Zs(m,["zoom"]);if(!S&&!ul(n))return Kn([new Ti("","zoom expressions not supported")]);const i=no(m);return i||S?i instanceof Ti?Kn([i]):i instanceof Ln&&!Vr(n)?Kn([new Ti("",'"interpolate" expressions cannot be used with this property')]):Da(i?new ro(v?"camera":"composite",h.value,i.labels,i instanceof Ln?i.interpolation:void 0):new io(v?"constant":"source",h.value)):Kn([new Ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zs{constructor(n,h){this._parameters=n,this._specification=h,yr(this,kr(this._parameters,this._specification))}static deserialize(n){return new zs(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function no(c){let n=null;if(c instanceof xo)n=no(c.result);else if(c instanceof yo){for(const h of c.args)if(n=no(h),n)break}else(c instanceof Xs||c instanceof Ln)&&c.input instanceof Kt&&c.input.name==="zoom"&&(n=c);return n instanceof Ti||c.eachChild(h=>{const m=no(h);m instanceof Ti?n=m:!n&&m?n=new Ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&m&&n!==m&&(n=new Ti("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function ln(c){const n=c.key,h=c.value,m=c.valueSpec||{},v=c.objectElementValidators||{},S=c.style,i=c.styleSpec;let t=[];const o=qt(h);if(o!=="object")return[new Ae(n,h,`object expected, ${o} found`)];for(const p in h){const f=p.split(".")[0],_=m[f]||m["*"];let x;if(v[f])x=v[f];else if(m[f])x=In;else if(v["*"])x=v["*"];else{if(!m["*"]){t.push(new Ae(n,h[p],`unknown property "${p}"`));continue}x=In}t=t.concat(x({key:(n&&`${n}.`)+p,value:h[p],valueSpec:_,style:S,styleSpec:i,object:h,objectKey:p},h))}for(const p in m)v[p]||m[p].required&&m[p].default===void 0&&h[p]===void 0&&t.push(new Ae(n,h,`missing required property "${p}"`));return t}function hl(c){const n=c.value,h=c.valueSpec,m=c.style,v=c.styleSpec,S=c.key,i=c.arrayElementValidator||In;if(qt(n)!=="array")return[new Ae(S,n,`array expected, ${qt(n)} found`)];if(h.length&&n.length!==h.length)return[new Ae(S,n,`array length ${h.length} expected, length ${n.length} found`)];if(h["min-length"]&&n.length<h["min-length"])return[new Ae(S,n,`array length at least ${h["min-length"]} expected, length ${n.length} found`)];let t={type:h.value,values:h.values};v.$version<7&&(t.function=h.function),qt(h.value)==="object"&&(t=h.value);let o=[];for(let p=0;p<n.length;p++)o=o.concat(i({array:n,arrayIndex:p,value:n[p],valueSpec:t,style:m,styleSpec:v,key:`${S}[${p}]`}));return o}function pl(c){const n=c.key,h=c.value,m=c.valueSpec;let v=qt(h);return v==="number"&&h!=h&&(v="NaN"),v!=="number"?[new Ae(n,h,`number expected, ${v} found`)]:"minimum"in m&&h<m.minimum?[new Ae(n,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new Ae(n,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function dl(c){const n=c.valueSpec,h=Gt(c.value.type);let m,v,S,i={};const t=h!=="categorical"&&c.value.property===void 0,o=!t,p=qt(c.value.stops)==="array"&&qt(c.value.stops[0])==="array"&&qt(c.value.stops[0][0])==="object",f=ln({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(E){if(h==="identity")return[new Ae(E.key,E.value,'identity function may not have a "stops" property')];let z=[];const R=E.value;return z=z.concat(hl({key:E.key,value:R,valueSpec:E.valueSpec,style:E.style,styleSpec:E.styleSpec,arrayElementValidator:_})),qt(R)==="array"&&R.length===0&&z.push(new Ae(E.key,R,"array must have at least one stop")),z},default:function(E){return In({key:E.key,value:E.value,valueSpec:n,style:E.style,styleSpec:E.styleSpec})}}});return h==="identity"&&t&&f.push(new Ae(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||f.push(new Ae(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!Vr(c.valueSpec)&&f.push(new Ae(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(o&&!ss(c.valueSpec)?f.push(new Ae(c.key,c.value,"property functions not supported")):t&&!ul(c.valueSpec)&&f.push(new Ae(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!p||c.value.property!==void 0||f.push(new Ae(c.key,c.value,'"property" property is required')),f;function _(E){let z=[];const R=E.value,V=E.key;if(qt(R)!=="array")return[new Ae(V,R,`array expected, ${qt(R)} found`)];if(R.length!==2)return[new Ae(V,R,`array length 2 expected, length ${R.length} found`)];if(p){if(qt(R[0])!=="object")return[new Ae(V,R,`object expected, ${qt(R[0])} found`)];if(R[0].zoom===void 0)return[new Ae(V,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new Ae(V,R,"object stop key must have value")];if(S&&S>Gt(R[0].zoom))return[new Ae(V,R[0].zoom,"stop zoom values must appear in ascending order")];Gt(R[0].zoom)!==S&&(S=Gt(R[0].zoom),v=void 0,i={}),z=z.concat(ln({key:`${V}[0]`,value:R[0],valueSpec:{zoom:{}},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{zoom:pl,value:x}}))}else z=z.concat(x({key:`${V}[0]`,value:R[0],valueSpec:{},style:E.style,styleSpec:E.styleSpec},R));return to(hi(R[1]))?z.concat([new Ae(`${V}[1]`,R[1],"expressions are not allowed in function stops.")]):z.concat(In({key:`${V}[1]`,value:R[1],valueSpec:n,style:E.style,styleSpec:E.styleSpec}))}function x(E,z){const R=qt(E.value),V=Gt(E.value),q=E.value!==null?E.value:z;if(m){if(R!==m)return[new Ae(E.key,q,`${R} stop domain type must match previous stop domain type ${m}`)]}else m=R;if(R!=="number"&&R!=="string"&&R!=="boolean")return[new Ae(E.key,q,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&h!=="categorical"){let X=`number expected, ${R} found`;return ss(n)&&h===void 0&&(X+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ae(E.key,q,X)]}return h!=="categorical"||R!=="number"||isFinite(V)&&Math.floor(V)===V?h!=="categorical"&&R==="number"&&v!==void 0&&V<v?[new Ae(E.key,q,"stop domain values must appear in ascending order")]:(v=V,h==="categorical"&&V in i?[new Ae(E.key,q,"stop domain values must be unique")]:(i[V]=!0,[])):[new Ae(E.key,q,`integer expected, found ${V}`)]}}function os(c){const n=(c.expressionContext==="property"?Io:Ws)(hi(c.value),c.valueSpec);if(n.result==="error")return n.value.map(m=>new Ae(`${c.key}${m.key}`,c.value,m.message));const h=n.value.expression||n.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new Ae(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!fs(h))return[new Ae(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!fs(h))return[new Ae(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Zs(h,["zoom","feature-state"]))return[new Ae(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Gs(h))return[new Ae(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function so(c){const n=c.key,h=c.value,m=c.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(Gt(h))===-1&&v.push(new Ae(n,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(Gt(h))===-1&&v.push(new Ae(n,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function So(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const n of c.slice(1))if(!So(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const fl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cs(c){if(c==null)return{filter:()=>!0,needGeometry:!1};So(c)||(c=Ps(c));const n=Ws(c,fl);if(n.result==="error")throw new Error(n.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,v)=>n.value.evaluate(h,m,{},v),needGeometry:Ra(c)}}function Ba(c,n){return c<n?-1:c>n?1:0}function Ra(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let n=1;n<c.length;n++)if(Ra(c[n]))return!0;return!1}function Ps(c){if(!c)return!0;const n=c[0];return c.length<=1?n!=="any":n==="=="?na(c[1],c[2],"=="):n==="!="?as(na(c[1],c[2],"==")):n==="<"||n===">"||n==="<="||n===">="?na(c[1],c[2],n):n==="any"?(h=c.slice(1),["any"].concat(h.map(Ps))):n==="all"?["all"].concat(c.slice(1).map(Ps)):n==="none"?["all"].concat(c.slice(1).map(Ps).map(as)):n==="in"?Eo(c[1],c.slice(2)):n==="!in"?as(Eo(c[1],c.slice(2))):n==="has"?sa(c[1]):n==="!has"?as(sa(c[1])):n!=="within"||c;var h}function na(c,n,h){switch(c){case"$type":return[`filter-type-${h}`,n];case"$id":return[`filter-id-${h}`,n];default:return[`filter-${h}`,c,n]}}function Eo(c,n){if(n.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(h=>typeof h!=typeof n[0])?["filter-in-large",c,["literal",n.sort(Ba)]]:["filter-in-small",c,["literal",n]]}}function sa(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function as(c){return["!",c]}function ms(c){return So(hi(c.value))?os(yr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):oa(c)}function oa(c){const n=c.value,h=c.key;if(qt(n)!=="array")return[new Ae(h,n,`array expected, ${qt(n)} found`)];const m=c.styleSpec;let v,S=[];if(n.length<1)return[new Ae(h,n,"filter array must have at least 1 element")];switch(S=S.concat(so({key:`${h}[0]`,value:n[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),Gt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Gt(n[1])==="$type"&&S.push(new Ae(h,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&S.push(new Ae(h,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(v=qt(n[1]),v!=="string"&&S.push(new Ae(`${h}[1]`,n[1],`string expected, ${v} found`)));for(let i=2;i<n.length;i++)v=qt(n[i]),Gt(n[1])==="$type"?S=S.concat(so({key:`${h}[${i}]`,value:n[i],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&S.push(new Ae(`${h}[${i}]`,n[i],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let i=1;i<n.length;i++)S=S.concat(oa({key:`${h}[${i}]`,value:n[i],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":v=qt(n[1]),n.length!==2?S.push(new Ae(h,n,`filter array for "${n[0]}" operator must have 2 elements`)):v!=="string"&&S.push(new Ae(`${h}[1]`,n[1],`string expected, ${v} found`));break;case"within":v=qt(n[1]),n.length!==2?S.push(new Ae(h,n,`filter array for "${n[0]}" operator must have 2 elements`)):v!=="object"&&S.push(new Ae(`${h}[1]`,n[1],`object expected, ${v} found`))}return S}function Hs(c,n){const h=c.key,m=c.style,v=c.styleSpec,S=c.value,i=c.objectKey,t=v[`${n}_${c.layerType}`];if(!t)return[];const o=i.match(/^(.*)-transition$/);if(n==="paint"&&o&&t[o[1]]&&t[o[1]].transition)return In({key:h,value:S,valueSpec:v.transition,style:m,styleSpec:v});const p=c.valueSpec||t[i];if(!p)return[new Ae(h,S,`unknown property "${i}"`)];let f;if(qt(S)==="string"&&ss(p)&&!p.tokens&&(f=/^{([^}]+)}$/.exec(S)))return[new Ae(h,S,`"${i}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(f[1])} }\`.`)];const _=[];return c.layerType==="symbol"&&(i==="text-field"&&m&&!m.glyphs&&_.push(new Ae(h,S,'use of "text-field" requires a style "glyphs" property')),i==="text-font"&&Li(hi(S))&&Gt(S.type)==="identity"&&_.push(new Ae(h,S,'"text-font" does not support identity functions'))),_.concat(In({key:c.key,value:S,valueSpec:p,style:m,styleSpec:v,expressionContext:"property",propertyType:n,propertyKey:i}))}function ml(c){return Hs(c,"paint")}function Ao(c){return Hs(c,"layout")}function gl(c){let n=[];const h=c.value,m=c.key,v=c.style,S=c.styleSpec;h.type||h.ref||n.push(new Ae(m,h,'either "type" or "ref" is required'));let i=Gt(h.type);const t=Gt(h.ref);if(h.id){const o=Gt(h.id);for(let p=0;p<c.arrayIndex;p++){const f=v.layers[p];Gt(f.id)===o&&n.push(new Ae(m,h.id,`duplicate layer id "${h.id}", previously used at line ${f.id.__line__}`))}}if("ref"in h){let o;["type","source","source-layer","filter","layout"].forEach(p=>{p in h&&n.push(new Ae(m,h[p],`"${p}" is prohibited for ref layers`))}),v.layers.forEach(p=>{Gt(p.id)===t&&(o=p)}),o?o.ref?n.push(new Ae(m,h.ref,"ref cannot reference another ref layer")):i=Gt(o.type):n.push(new Ae(m,h.ref,`ref layer "${t}" not found`))}else if(i!=="background")if(h.source){const o=v.sources&&v.sources[h.source],p=o&&Gt(o.type);o?p==="vector"&&i==="raster"?n.push(new Ae(m,h.source,`layer "${h.id}" requires a raster source`)):p==="raster"&&i!=="raster"?n.push(new Ae(m,h.source,`layer "${h.id}" requires a vector source`)):p!=="vector"||h["source-layer"]?p==="raster-dem"&&i!=="hillshade"?n.push(new Ae(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):i!=="line"||!h.paint||!h.paint["line-gradient"]||p==="geojson"&&o.lineMetrics||n.push(new Ae(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Ae(m,h,`layer "${h.id}" must specify a "source-layer"`)):n.push(new Ae(m,h.source,`source "${h.source}" not found`))}else n.push(new Ae(m,h,'missing required property "source"'));return n=n.concat(ln({key:m,value:h,valueSpec:S.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>In({key:`${m}.type`,value:h.type,valueSpec:S.layer.type,style:c.style,styleSpec:c.styleSpec,object:h,objectKey:"type"}),filter:ms,layout:o=>ln({layer:h,key:o.key,value:o.value,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":p=>Ao(yr({layerType:i},p))}}),paint:o=>ln({layer:h,key:o.key,value:o.value,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":p=>ml(yr({layerType:i},p))}})}})),n}function ls(c){const n=c.value,h=c.key,m=qt(n);return m!=="string"?[new Ae(h,n,`string expected, ${m} found`)]:[]}const _l={promoteId:function({key:c,value:n}){if(qt(n)==="string")return ls({key:c,value:n});{const h=[];for(const m in n)h.push(...ls({key:`${c}.${m}`,value:n[m]}));return h}}};function ko(c){const n=c.value,h=c.key,m=c.styleSpec,v=c.style;if(!n.type)return[new Ae(h,n,'"type" is required')];const S=Gt(n.type);let i;switch(S){case"vector":case"raster":case"raster-dem":return i=ln({key:h,value:n,valueSpec:m[`source_${S.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:_l}),i;case"geojson":if(i=ln({key:h,value:n,valueSpec:m.source_geojson,style:v,styleSpec:m,objectElementValidators:_l}),n.cluster)for(const t in n.clusterProperties){const[o,p]=n.clusterProperties[t],f=typeof o=="string"?[o,["accumulated"],["get",t]]:o;i.push(...os({key:`${h}.${t}.map`,value:p,expressionContext:"cluster-map"})),i.push(...os({key:`${h}.${t}.reduce`,value:f,expressionContext:"cluster-reduce"}))}return i;case"video":return ln({key:h,value:n,valueSpec:m.source_video,style:v,styleSpec:m});case"image":return ln({key:h,value:n,valueSpec:m.source_image,style:v,styleSpec:m});case"canvas":return[new Ae(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return so({key:`${h}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:m})}}function zo(c){const n=c.value,h=c.styleSpec,m=h.light,v=c.style;let S=[];const i=qt(n);if(n===void 0)return S;if(i!=="object")return S=S.concat([new Ae("light",n,`object expected, ${i} found`)]),S;for(const t in n){const o=t.match(/^(.*)-transition$/);S=S.concat(o&&m[o[1]]&&m[o[1]].transition?In({key:t,value:n[t],valueSpec:h.transition,style:v,styleSpec:h}):m[t]?In({key:t,value:n[t],valueSpec:m[t],style:v,styleSpec:h}):[new Ae(t,n[t],`unknown property "${t}"`)])}return S}const Cn={"*":()=>[],array:hl,boolean:function(c){const n=c.value,h=c.key,m=qt(n);return m!=="boolean"?[new Ae(h,n,`boolean expected, ${m} found`)]:[]},number:pl,color:function(c){const n=c.key,h=c.value,m=qt(h);return m!=="string"?[new Ae(n,h,`color expected, ${m} found`)]:wn(h)===null?[new Ae(n,h,`color expected, "${h}" found`)]:[]},constants:$r,enum:so,filter:ms,function:dl,layer:gl,object:ln,source:ko,light:zo,string:ls,formatted:function(c){return ls(c).length===0?[]:os(c)},resolvedImage:function(c){return ls(c).length===0?[]:os(c)}};function In(c){const n=c.value,h=c.valueSpec,m=c.styleSpec;return h.expression&&Li(Gt(n))?dl(c):h.expression&&to(hi(n))?os(c):h.type&&Cn[h.type]?Cn[h.type](c):ln(yr({},c,{valueSpec:h.type?m[h.type]:h}))}function en(c){const n=c.value,h=c.key,m=ls(c);return m.length||(n.indexOf("{fontstack}")===-1&&m.push(new Ae(h,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&m.push(new Ae(h,n,'"glyphs" url must include a "{range}" token'))),m}function gs(c,n=ae){let h=[];return h=h.concat(In({key:"",value:c,valueSpec:n.$root,styleSpec:n,style:c,objectElementValidators:{glyphs:en,"*":()=>[]}})),c.constants&&(h=h.concat($r({key:"constants",value:c.constants,style:c,styleSpec:n}))),Ms(h)}function Ms(c){return[].concat(c).sort((n,h)=>n.line-h.line)}function oo(c){return function(...n){return Ms(c.apply(this,n))}}gs.source=oo(ko),gs.light=oo(zo),gs.layer=oo(gl),gs.filter=oo(ms),gs.paintProperty=oo(ml),gs.layoutProperty=oo(Ao);const qn=gs,aa=qn.light,la=qn.paintProperty,yc=qn.layoutProperty;function Fa(c,n){let h=!1;if(n&&n.length)for(const m of n)c.fire(new jt(new Error(m.message))),h=!0;return h}class Ks{constructor(n,h,m){const v=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const i=new Int32Array(this.arrayBuffer);n=i[0],this.d=(h=i[1])+2*(m=i[2]);for(let o=0;o<this.d*this.d;o++){const p=i[3+o],f=i[3+o+1];v.push(p===f?null:i.subarray(p,f))}const t=i[3+v.length+1];this.keys=i.subarray(i[3+v.length],t),this.bboxes=i.subarray(t),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let i=0;i<this.d*this.d;i++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=n,this.padding=m,this.scale=h/n,this.uid=0;const S=m/h*n;this.min=-S,this.max=n+S}insert(n,h,m,v,S){this._forEachCell(h,m,v,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,h,m,v,S,i){this.cells[S].push(i)}query(n,h,m,v,S){const i=this.min,t=this.max;if(n<=i&&h<=i&&t<=m&&t<=v&&!S)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(n,h,m,v,this._queryCell,o,{},S),o}}_queryCell(n,h,m,v,S,i,t,o){const p=this.cells[S];if(p!==null){const f=this.keys,_=this.bboxes;for(let x=0;x<p.length;x++){const E=p[x];if(t[E]===void 0){const z=4*E;(o?o(_[z+0],_[z+1],_[z+2],_[z+3]):n<=_[z+2]&&h<=_[z+3]&&m>=_[z+0]&&v>=_[z+1])?(t[E]=!0,i.push(f[E])):t[E]=!1}}}}_forEachCell(n,h,m,v,S,i,t,o){const p=this._convertToCellCoord(n),f=this._convertToCellCoord(h),_=this._convertToCellCoord(m),x=this._convertToCellCoord(v);for(let E=p;E<=_;E++)for(let z=f;z<=x;z++){const R=this.d*z+E;if((!o||o(this._convertFromCellCoord(E),this._convertFromCellCoord(z),this._convertFromCellCoord(E+1),this._convertFromCellCoord(z+1)))&&S.call(this,n,h,m,v,R,i,t,o))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,h=3+this.cells.length+1+1;let m=0;for(let i=0;i<this.cells.length;i++)m+=this.cells[i].length;const v=new Int32Array(h+m+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let S=h;for(let i=0;i<n.length;i++){const t=n[i];v[3+i]=S,v.set(t,S),S+=t.length}return v[3+n.length]=S,v.set(this.keys,S),S+=this.keys.length,v[3+n.length+1]=S,v.set(this.bboxes,S),S+=this.bboxes.length,v.buffer}static serialize(n,h){const m=n.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(n){return new Ks(n.buffer)}}const _s={};function Nt(c,n,h={}){Object.defineProperty(n,"_classRegistryKey",{value:c,writeable:!1}),_s[c]={klass:n,omit:h.omit||[],shallow:h.shallow||[]}}Nt("Object",Object),Nt("TransferableGridIndex",Ks),Nt("Color",L),Nt("Error",Error),Nt("AJAXError",Ai),Nt("ResolvedImage",ne),Nt("StylePropertyFunction",zs),Nt("StyleExpression",ra,{omit:["_evaluator"]}),Nt("ZoomDependentExpression",ro),Nt("ZoomConstantExpression",io),Nt("CompoundExpression",Kt,{omit:["_evaluate"]});for(const c in ns)ns[c]._classRegistryKey||Nt(`Expression_${c}`,ns[c]);function Zt(c){return c&&typeof ArrayBuffer!="undefined"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ao(c,n){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob)return c;if(Zt(c)||wt(c))return n&&n.push(c),c;if(ArrayBuffer.isView(c)){const h=c;return n&&n.push(h.buffer),h}if(c instanceof ImageData)return n&&n.push(c.data.buffer),c;if(Array.isArray(c)){const h=[];for(const m of c)h.push(ao(m,n));return h}if(typeof c=="object"){const h=c.constructor,m=h._classRegistryKey;if(!m)throw new Error("can't serialize object of unregistered class");const v=h.serialize?h.serialize(c,n):{};if(!h.serialize){for(const S in c){if(!c.hasOwnProperty(S)||_s[m].omit.indexOf(S)>=0)continue;const i=c[S];v[S]=_s[m].shallow.indexOf(S)>=0?i:ao(i,n)}c instanceof Error&&(v.message=c.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(v.$name=m),v}throw new Error("can't serialize object of type "+typeof c)}function Yn(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||Zt(c)||wt(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Yn);if(typeof c=="object"){const n=c.$name||"Object";if(!_s[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:h}=_s[n];if(!h)throw new Error(`can't deserialize unregistered class ${n}`);if(h.deserialize)return h.deserialize(c);const m=Object.create(h.prototype);for(const v of Object.keys(c)){if(v==="$name")continue;const S=c[v];m[v]=_s[n].shallow.indexOf(v)>=0?S:Yn(S)}return m}throw new Error("can't deserialize object of type "+typeof c)}class Ds{constructor(){this.first=!0}update(n,h){const m=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=m,!0))}}const Rt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Bt(c){for(const n of c)if(Co(n.charCodeAt(0)))return!0;return!1}function ca(c){for(const n of c)if(!xc(n.charCodeAt(0)))return!1;return!0}function xc(c){return!(Rt.Arabic(c)||Rt["Arabic Supplement"](c)||Rt["Arabic Extended-A"](c)||Rt["Arabic Presentation Forms-A"](c)||Rt["Arabic Presentation Forms-B"](c))}function Co(c){return!(c!==746&&c!==747&&(c<4352||!(Rt["Bopomofo Extended"](c)||Rt.Bopomofo(c)||Rt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Rt["CJK Compatibility Ideographs"](c)||Rt["CJK Compatibility"](c)||Rt["CJK Radicals Supplement"](c)||Rt["CJK Strokes"](c)||!(!Rt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Rt["CJK Unified Ideographs Extension A"](c)||Rt["CJK Unified Ideographs"](c)||Rt["Enclosed CJK Letters and Months"](c)||Rt["Hangul Compatibility Jamo"](c)||Rt["Hangul Jamo Extended-A"](c)||Rt["Hangul Jamo Extended-B"](c)||Rt["Hangul Jamo"](c)||Rt["Hangul Syllables"](c)||Rt.Hiragana(c)||Rt["Ideographic Description Characters"](c)||Rt.Kanbun(c)||Rt["Kangxi Radicals"](c)||Rt["Katakana Phonetic Extensions"](c)||Rt.Katakana(c)&&c!==12540||!(!Rt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Rt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Rt["Unified Canadian Aboriginal Syllabics"](c)||Rt["Unified Canadian Aboriginal Syllabics Extended"](c)||Rt["Vertical Forms"](c)||Rt["Yijing Hexagram Symbols"](c)||Rt["Yi Syllables"](c)||Rt["Yi Radicals"](c))))}function Oa(c){return!(Co(c)||function(n){return!!(Rt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Rt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Rt["Letterlike Symbols"](n)||Rt["Number Forms"](n)||Rt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Rt["Control Pictures"](n)&&n!==9251||Rt["Optical Character Recognition"](n)||Rt["Enclosed Alphanumerics"](n)||Rt["Geometric Shapes"](n)||Rt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Rt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Rt["CJK Symbols and Punctuation"](n)||Rt.Katakana(n)||Rt["Private Use Area"](n)||Rt["CJK Compatibility Forms"](n)||Rt["Small Form Variants"](n)||Rt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(c))}function ua(c){return c>=1424&&c<=2303||Rt["Arabic Presentation Forms-A"](c)||Rt["Arabic Presentation Forms-B"](c)}function Dl(c,n){return!(!n&&ua(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Rt.Khmer(c))}function vc(c){for(const n of c)if(ua(n.charCodeAt(0)))return!0;return!1}const Ua="deferred",ha="loading",Po="loaded";let pa=null,Bn="unavailable",cn=null;const Ls=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Bn="error"),pa&&pa(c)};function Va(){Ys.fire(new Di("pluginStateChange",{pluginStatus:Bn,pluginURL:cn}))}const Ys=new Vi,da=function(){return Bn},Bs=function(){if(Bn!==Ua||!cn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bn=ha,Va(),cn&&Dr({url:cn},c=>{c?Ls(c):(Bn=Po,Va())})},Gn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Bn===Po||Gn.applyArabicShaping!=null,isLoading:()=>Bn===ha,setState(c){Bn=c.pluginStatus,cn=c.pluginURL},isParsed:()=>Gn.applyArabicShaping!=null&&Gn.processBidirectionalText!=null&&Gn.processStyledBidirectionalText!=null,getPluginURL:()=>cn};class Ki{constructor(n,h){this.zoom=n,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ds,this.transition={})}isSupportedScript(n){return function(h,m){for(const v of h)if(!Dl(v.charCodeAt(0),m))return!1;return!0}(n,Gn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,h=n-Math.floor(n),m=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class zr{constructor(n,h){this.property=n,this.value=h,this.expression=function(m,v){if(Li(m))return new zs(m,v);if(to(m)){const S=Io(m,v);if(S.result==="error")throw new Error(S.value.map(i=>`${i.key}: ${i.message}`).join(", "));return S.value}{let S=m;return typeof m=="string"&&v.type==="color"&&(S=L.parse(m)),{kind:"constant",evaluate:()=>S}}}(h===void 0?n.specification.default:h,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,h,m){return this.property.possiblyEvaluate(this,n,h,m)}}class lo{constructor(n){this.property=n,this.value=new zr(n,void 0)}transitioned(n,h){return new Na(this.property,this.value,h,_e({},n.transition,this.transition),n.now)}untransitioned(){return new Na(this.property,this.value,null,{},0)}}class fa{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return it(this._values[n].value.value)}setValue(n,h){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new lo(this._values[n].property)),this._values[n].value=new zr(this._values[n].property,h===null?void 0:it(h))}getTransition(n){return it(this._values[n].transition)}setTransition(n,h){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new lo(this._values[n].property)),this._values[n].transition=it(h)||void 0}serialize(){const n={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(n[h]=m);const v=this.getTransition(h);v!==void 0&&(n[`${h}-transition`]=v)}return n}transitioned(n,h){const m=new ja(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].transitioned(n,h._values[v]);return m}untransitioned(){const n=new ja(this._properties);for(const h of Object.keys(this._values))n._values[h]=this._values[h].untransitioned();return n}}class Na{constructor(n,h,m,v,S){this.property=n,this.value=h,this.begin=S+v.delay||0,this.end=this.begin+v.duration||0,n.specification.transition&&(v.delay||v.duration)&&(this.prior=m)}possiblyEvaluate(n,h,m){const v=n.now||0,S=this.value.possiblyEvaluate(n,h,m),i=this.prior;if(i){if(v>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(v<this.begin)return i.possiblyEvaluate(n,h,m);{const t=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(i.possiblyEvaluate(n,h,m),S,function(o){if(o<=0)return 0;if(o>=1)return 1;const p=o*o,f=p*o;return 4*(o<.5?f:3*(o-p)+f-.75)}(t))}}return S}}class ja{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,h,m){const v=new Zn(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(n,h,m);return v}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Ll{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return it(this._values[n].value)}setValue(n,h){this._values[n]=new zr(this._values[n].property,h===null?void 0:it(h))}serialize(){const n={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(n[h]=m)}return n}possiblyEvaluate(n,h,m){const v=new Zn(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(n,h,m);return v}}class ys{constructor(n,h,m){this.property=n,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,h,m,v){return this.property.evaluate(this.value,this.parameters,n,h,m,v)}}class Zn{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Yt{constructor(n){this.specification=n}possiblyEvaluate(n,h){return n.expression.evaluate(h)}interpolate(n,h,m){const v=Qs[this.specification.type];return v?v(n,h,m):n}}class _t{constructor(n,h){this.specification=n,this.overrides=h}possiblyEvaluate(n,h,m,v){return new ys(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(h,null,{},m,v)}:n.expression,h)}interpolate(n,h,m){if(n.value.kind!=="constant"||h.value.kind!=="constant")return n;if(n.value.value===void 0||h.value.value===void 0)return new ys(this,{kind:"constant",value:void 0},n.parameters);const v=Qs[this.specification.type];return v?new ys(this,{kind:"constant",value:v(n.value.value,h.value.value,m)},n.parameters):n}evaluate(n,h,m,v,S,i){return n.kind==="constant"?n.value:n.evaluate(h,m,v,S,i)}}class ri extends _t{possiblyEvaluate(n,h,m,v){if(n.value===void 0)return new ys(this,{kind:"constant",value:void 0},h);if(n.expression.kind==="constant"){const S=n.expression.evaluate(h,null,{},m,v),i=n.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,t=this._calculate(i,i,i,h);return new ys(this,{kind:"constant",value:t},h)}if(n.expression.kind==="camera"){const S=this._calculate(n.expression.evaluate({zoom:h.zoom-1}),n.expression.evaluate({zoom:h.zoom}),n.expression.evaluate({zoom:h.zoom+1}),h);return new ys(this,{kind:"constant",value:S},h)}return new ys(this,n.expression,h)}evaluate(n,h,m,v,S,i){if(n.kind==="source"){const t=n.evaluate(h,m,v,S,i);return this._calculate(t,t,t,h)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(h.zoom)-1},m,v),n.evaluate({zoom:Math.floor(h.zoom)},m,v),n.evaluate({zoom:Math.floor(h.zoom)+1},m,v),h):n.value}_calculate(n,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:n,to:h}:{from:m,to:h}}interpolate(n){return n}}class xs{constructor(n){this.specification=n}possiblyEvaluate(n,h,m,v){if(n.value!==void 0){if(n.expression.kind==="constant"){const S=n.expression.evaluate(h,null,{},m,v);return this._calculate(S,S,S,h)}return this._calculate(n.expression.evaluate(new Ki(Math.floor(h.zoom-1),h)),n.expression.evaluate(new Ki(Math.floor(h.zoom),h)),n.expression.evaluate(new Ki(Math.floor(h.zoom+1),h)),h)}}_calculate(n,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:n,to:h}:{from:m,to:h}}interpolate(n){return n}}class Mo{constructor(n){this.specification=n}possiblyEvaluate(n,h,m,v){return!!n.expression.evaluate(h,null,{},m,v)}interpolate(){return!1}}class tn{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in n){const m=n[h];m.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new zr(m,void 0),S=this.defaultTransitionablePropertyValues[h]=new lo(m);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate({})}}}Nt("DataDrivenProperty",_t),Nt("DataConstantProperty",Yt),Nt("CrossFadedDataDrivenProperty",ri),Nt("CrossFadedProperty",xs),Nt("ColorRampProperty",Mo);const pn="-transition";class nn extends Vi{constructor(n,h){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=(n=n).metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),h.layout&&(this._unevaluatedLayout=new Ll(h.layout)),h.paint)){this._transitionablePaint=new fa(h.paint);for(const m in n.paint)this.setPaintProperty(m,n.paint[m],{validate:!1});for(const m in n.layout)this.setLayoutProperty(m,n.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zn(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,h,m={}){h!=null&&this._validate(yc,`layers.${this.id}.layout.${n}`,n,h,m)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,h):this.visibility=h)}getPaintProperty(n){return n.endsWith(pn)?this._transitionablePaint.getTransition(n.slice(0,-pn.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,h,m={}){if(h!=null&&this._validate(la,`layers.${this.id}.paint.${n}`,n,h,m))return!1;if(n.endsWith(pn))return this._transitionablePaint.setTransition(n.slice(0,-pn.length),h||void 0),!1;{const v=this._transitionablePaint._values[n],S=v.property.specification["property-type"]==="cross-faded-data-driven",i=v.value.isDataDriven(),t=v.value;this._transitionablePaint.setValue(n,h),this._handleSpecialPaintPropertyUpdate(n);const o=this._transitionablePaint._values[n].value;return o.isDataDriven()||i||S||this._handleOverridablePaintPropertyUpdate(n,t,o)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,h,m){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,h){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,h)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Ct(n,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}_validate(n,h,m,v,S={}){return(!S||S.validate!==!1)&&Fa(this,n.call(qn,{key:h,layerType:this.type,objectKey:m,value:v,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const h=this.paint.get(n);if(h instanceof ys&&ss(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const Xn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rs{constructor(n,h){this._structArray=n,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ir{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,h){return n._trim(),h&&(n.isTransferred=!0,h.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const h=Object.create(this.prototype);return h.arrayBuffer=n.arrayBuffer,h.length=n.length,h.capacity=n.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Oi(c,n=1){let h=0,m=0;return{members:c.map(v=>{const S=Xn[v.type].BYTES_PER_ELEMENT,i=h=jr(h,Math.max(n,S)),t=v.components||1;return m=Math.max(m,S),h+=S*t,{name:v.name,type:v.type,components:t,offset:i}}),size:jr(h,Math.max(m,n)),alignment:n}}function jr(c,n){return Math.ceil(c/n)*n}class co extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h){const m=this.length;return this.resize(m+1),this.emplace(m,n,h)}emplace(n,h,m){const v=2*n;return this.int16[v+0]=h,this.int16[v+1]=m,n}}co.prototype.bytesPerElement=4,Nt("StructArrayLayout2i4",co);class Fs extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,h,m,v)}emplace(n,h,m,v,S){const i=4*n;return this.int16[i+0]=h,this.int16[i+1]=m,this.int16[i+2]=v,this.int16[i+3]=S,n}}Fs.prototype.bytesPerElement=8,Nt("StructArrayLayout4i8",Fs);class w extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S,i){const t=this.length;return this.resize(t+1),this.emplace(t,n,h,m,v,S,i)}emplace(n,h,m,v,S,i,t){const o=6*n;return this.int16[o+0]=h,this.int16[o+1]=m,this.int16[o+2]=v,this.int16[o+3]=S,this.int16[o+4]=i,this.int16[o+5]=t,n}}w.prototype.bytesPerElement=12,Nt("StructArrayLayout2i4i12",w);class a extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S,i){const t=this.length;return this.resize(t+1),this.emplace(t,n,h,m,v,S,i)}emplace(n,h,m,v,S,i,t){const o=4*n,p=8*n;return this.int16[o+0]=h,this.int16[o+1]=m,this.uint8[p+4]=v,this.uint8[p+5]=S,this.uint8[p+6]=i,this.uint8[p+7]=t,n}}a.prototype.bytesPerElement=8,Nt("StructArrayLayout2i4ub8",a);class r extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h){const m=this.length;return this.resize(m+1),this.emplace(m,n,h)}emplace(n,h,m){const v=2*n;return this.float32[v+0]=h,this.float32[v+1]=m,n}}r.prototype.bytesPerElement=8,Nt("StructArrayLayout2f8",r);class e extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S,i,t,o,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,h,m,v,S,i,t,o,p,f)}emplace(n,h,m,v,S,i,t,o,p,f,_){const x=10*n;return this.uint16[x+0]=h,this.uint16[x+1]=m,this.uint16[x+2]=v,this.uint16[x+3]=S,this.uint16[x+4]=i,this.uint16[x+5]=t,this.uint16[x+6]=o,this.uint16[x+7]=p,this.uint16[x+8]=f,this.uint16[x+9]=_,n}}e.prototype.bytesPerElement=20,Nt("StructArrayLayout10ui20",e);class s extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S,i,t,o,p,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,n,h,m,v,S,i,t,o,p,f,_,x)}emplace(n,h,m,v,S,i,t,o,p,f,_,x,E){const z=12*n;return this.int16[z+0]=h,this.int16[z+1]=m,this.int16[z+2]=v,this.int16[z+3]=S,this.uint16[z+4]=i,this.uint16[z+5]=t,this.uint16[z+6]=o,this.uint16[z+7]=p,this.int16[z+8]=f,this.int16[z+9]=_,this.int16[z+10]=x,this.int16[z+11]=E,n}}s.prototype.bytesPerElement=24,Nt("StructArrayLayout4i4ui4i24",s);class u extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,h,m)}emplace(n,h,m,v){const S=3*n;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,n}}u.prototype.bytesPerElement=12,Nt("StructArrayLayout3f12",u);class d extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.uint32[1*n+0]=h,n}}d.prototype.bytesPerElement=4,Nt("StructArrayLayout1ul4",d);class g extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S,i,t,o,p){const f=this.length;return this.resize(f+1),this.emplace(f,n,h,m,v,S,i,t,o,p)}emplace(n,h,m,v,S,i,t,o,p,f){const _=10*n,x=5*n;return this.int16[_+0]=h,this.int16[_+1]=m,this.int16[_+2]=v,this.int16[_+3]=S,this.int16[_+4]=i,this.int16[_+5]=t,this.uint32[x+3]=o,this.uint16[_+8]=p,this.uint16[_+9]=f,n}}g.prototype.bytesPerElement=20,Nt("StructArrayLayout6i1ul2ui20",g);class b extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S,i){const t=this.length;return this.resize(t+1),this.emplace(t,n,h,m,v,S,i)}emplace(n,h,m,v,S,i,t){const o=6*n;return this.int16[o+0]=h,this.int16[o+1]=m,this.int16[o+2]=v,this.int16[o+3]=S,this.int16[o+4]=i,this.int16[o+5]=t,n}}b.prototype.bytesPerElement=12,Nt("StructArrayLayout2i2i2i12",b);class I extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S){const i=this.length;return this.resize(i+1),this.emplace(i,n,h,m,v,S)}emplace(n,h,m,v,S,i){const t=4*n,o=8*n;return this.float32[t+0]=h,this.float32[t+1]=m,this.float32[t+2]=v,this.int16[o+6]=S,this.int16[o+7]=i,n}}I.prototype.bytesPerElement=16,Nt("StructArrayLayout2f1f2i16",I);class k extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,h,m,v)}emplace(n,h,m,v,S){const i=12*n,t=3*n;return this.uint8[i+0]=h,this.uint8[i+1]=m,this.float32[t+1]=v,this.float32[t+2]=S,n}}k.prototype.bytesPerElement=12,Nt("StructArrayLayout2ub2f12",k);class D extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,h,m)}emplace(n,h,m,v){const S=3*n;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=v,n}}D.prototype.bytesPerElement=6,Nt("StructArrayLayout3ui6",D);class F extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S,i,t,o,p,f,_,x,E,z,R,V,q){const X=this.length;return this.resize(X+1),this.emplace(X,n,h,m,v,S,i,t,o,p,f,_,x,E,z,R,V,q)}emplace(n,h,m,v,S,i,t,o,p,f,_,x,E,z,R,V,q,X){const Y=24*n,Q=12*n,fe=48*n;return this.int16[Y+0]=h,this.int16[Y+1]=m,this.uint16[Y+2]=v,this.uint16[Y+3]=S,this.uint32[Q+2]=i,this.uint32[Q+3]=t,this.uint32[Q+4]=o,this.uint16[Y+10]=p,this.uint16[Y+11]=f,this.uint16[Y+12]=_,this.float32[Q+7]=x,this.float32[Q+8]=E,this.uint8[fe+36]=z,this.uint8[fe+37]=R,this.uint8[fe+38]=V,this.uint32[Q+10]=q,this.int16[Y+22]=X,n}}F.prototype.bytesPerElement=48,Nt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",F);class j extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,m,v,S,i,t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te,Pe,Ee,Me,Le,Ue){const He=this.length;return this.resize(He+1),this.emplace(He,n,h,m,v,S,i,t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te,Pe,Ee,Me,Le,Ue)}emplace(n,h,m,v,S,i,t,o,p,f,_,x,E,z,R,V,q,X,Y,Q,fe,de,Te,Pe,Ee,Me,Le,Ue,He){const Ge=34*n,tt=17*n;return this.int16[Ge+0]=h,this.int16[Ge+1]=m,this.int16[Ge+2]=v,this.int16[Ge+3]=S,this.int16[Ge+4]=i,this.int16[Ge+5]=t,this.int16[Ge+6]=o,this.int16[Ge+7]=p,this.uint16[Ge+8]=f,this.uint16[Ge+9]=_,this.uint16[Ge+10]=x,this.uint16[Ge+11]=E,this.uint16[Ge+12]=z,this.uint16[Ge+13]=R,this.uint16[Ge+14]=V,this.uint16[Ge+15]=q,this.uint16[Ge+16]=X,this.uint16[Ge+17]=Y,this.uint16[Ge+18]=Q,this.uint16[Ge+19]=fe,this.uint16[Ge+20]=de,this.uint16[Ge+21]=Te,this.uint16[Ge+22]=Pe,this.uint32[tt+12]=Ee,this.float32[tt+13]=Me,this.float32[tt+14]=Le,this.float32[tt+15]=Ue,this.float32[tt+16]=He,n}}j.prototype.bytesPerElement=68,Nt("StructArrayLayout8i15ui1ul4f68",j);class N extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.float32[1*n+0]=h,n}}N.prototype.bytesPerElement=4,Nt("StructArrayLayout1f4",N);class K extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,h,m)}emplace(n,h,m,v){const S=3*n;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=v,n}}K.prototype.bytesPerElement=6,Nt("StructArrayLayout3i6",K);class J extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,h,m)}emplace(n,h,m,v){const S=4*n;return this.uint32[2*n+0]=h,this.uint16[S+2]=m,this.uint16[S+3]=v,n}}J.prototype.bytesPerElement=8,Nt("StructArrayLayout1ul2ui8",J);class ee extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h){const m=this.length;return this.resize(m+1),this.emplace(m,n,h)}emplace(n,h,m){const v=2*n;return this.uint16[v+0]=h,this.uint16[v+1]=m,n}}ee.prototype.bytesPerElement=4,Nt("StructArrayLayout2ui4",ee);class le extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.uint16[1*n+0]=h,n}}le.prototype.bytesPerElement=2,Nt("StructArrayLayout1ui2",le);class ce extends Ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,h,m,v)}emplace(n,h,m,v,S){const i=4*n;return this.float32[i+0]=h,this.float32[i+1]=m,this.float32[i+2]=v,this.float32[i+3]=S,n}}ce.prototype.bytesPerElement=16,Nt("StructArrayLayout4f16",ce);class ye extends Rs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new De(this.anchorPointX,this.anchorPointY)}}ye.prototype.size=20;class oe extends g{get(n){return new ye(this,n)}}Nt("CollisionBoxArray",oe);class ve extends Rs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ve.prototype.size=48;class be extends F{get(n){return new ve(this,n)}}Nt("PlacedSymbolArray",be);class ze extends Rs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ze.prototype.size=68;class we extends j{get(n){return new ze(this,n)}}Nt("SymbolInstanceArray",we);class Ne extends N{getoffsetX(n){return this.float32[1*n+0]}}Nt("GlyphOffsetArray",Ne);class Ce extends K{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Nt("SymbolLineVertexArray",Ce);class ut extends Rs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ut.prototype.size=8;class yt extends J{get(n){return new ut(this,n)}}Nt("FeatureIndexArray",yt);class xt extends co{}class Ft extends co{}class ti extends w{}class It extends a{}class ii extends r{}class oi extends e{}class xi extends s{}class vi extends u{}class Gi extends d{}class Yr extends b{}class Pn extends k{}class qr extends D{}class _n extends ee{}const Sn=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Or}=Sn;class Ri{constructor(n=[]){this.segments=n}prepareSegment(n,h,m,v){let S=this.segments[this.segments.length-1];return n>Ri.MAX_VERTEX_ARRAY_LENGTH&&nt(`Max vertices per segment is ${Ri.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!S||S.vertexLength+n>Ri.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==v)&&(S={vertexOffset:h.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},v!==void 0&&(S.sortKey=v),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const n of this.segments)for(const h in n.vaos)n.vaos[h].destroy()}static simpleSegment(n,h,m,v){return new Ri([{vertexOffset:n,primitiveOffset:h,vertexLength:m,primitiveLength:v,vaos:{},sortKey:0}])}}function Yi(c,n){return 256*(c=Z(Math.floor(c),0,255))+Z(Math.floor(n),0,255)}Ri.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Nt("SegmentVector",Ri);const Zi=Oi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rr={exports:{}},wi={exports:{}};wi.exports=function(c,n){var h,m,v,S,i,t,o,p;for(m=c.length-(h=3&c.length),v=n,i=3432918353,t=461845907,p=0;p<m;)o=255&c.charCodeAt(p)|(255&c.charCodeAt(++p))<<8|(255&c.charCodeAt(++p))<<16|(255&c.charCodeAt(++p))<<24,++p,v=27492+(65535&(S=5*(65535&(v=(v^=o=(65535&(o=(o=(65535&o)*i+(((o>>>16)*i&65535)<<16)&4294967295)<<15|o>>>17))*t+(((o>>>16)*t&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(o=0,h){case 3:o^=(255&c.charCodeAt(p+2))<<16;case 2:o^=(255&c.charCodeAt(p+1))<<8;case 1:v^=o=(65535&(o=(o=(65535&(o^=255&c.charCodeAt(p)))*i+(((o>>>16)*i&65535)<<16)&4294967295)<<15|o>>>17))*t+(((o>>>16)*t&65535)<<16)&4294967295}return v^=c.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var Fi={exports:{}};Fi.exports=function(c,n){for(var h,m=c.length,v=n^m,S=0;m>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(S)|(255&c.charCodeAt(++S))<<8|(255&c.charCodeAt(++S))<<16|(255&c.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:v^=(255&c.charCodeAt(S+2))<<16;case 2:v^=(255&c.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&c.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var Gr=wi.exports,Mn=Fi.exports;rr.exports=Gr,rr.exports.murmur3=Gr,rr.exports.murmur2=Mn;var Lr=rr.exports;class Un{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,h,m,v){this.ids.push(vs(n)),this.positions.push(h,m,v)}getPositions(n){const h=vs(n);let m=0,v=this.ids.length-1;for(;m<v;){const i=m+v>>1;this.ids[i]>=h?v=i:m=i+1}const S=[];for(;this.ids[m]===h;)S.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return S}static serialize(n,h){const m=new Float64Array(n.ids),v=new Uint32Array(n.positions);return bs(m,v,0,m.length-1),h&&h.push(m.buffer,v.buffer),{ids:m,positions:v}}static deserialize(n){const h=new Un;return h.ids=n.ids,h.positions=n.positions,h.indexed=!0,h}}function vs(c){const n=+c;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Lr(String(c))}function bs(c,n,h,m){for(;h<m;){const v=c[h+m>>1];let S=h-1,i=m+1;for(;;){do S++;while(c[S]<v);do i--;while(c[i]>v);if(S>=i)break;Js(c,S,i),Js(n,3*S,3*i),Js(n,3*S+1,3*i+1),Js(n,3*S+2,3*i+2)}i-h<m-i?(bs(c,n,h,i),h=i+1):(bs(c,n,i+1,m),m=i)}}function Js(c,n,h){const m=c[n];c[n]=c[h],c[h]=m}Nt("FeaturePositionMap",Un);class Wn{constructor(n,h){this.gl=n.gl,this.location=h}}class Jn extends Wn{constructor(n,h){super(n,h),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class uo extends Wn{constructor(n,h){super(n,h),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class bc extends Wn{constructor(n,h){super(n,h),this.current=L.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const yl=new Float32Array(16);function xl(c){return[Yi(255*c.r,255*c.g),Yi(255*c.b,255*c.a)]}class vl{constructor(n,h,m){this.value=n,this.uniformNames=h.map(v=>`u_${v}`),this.type=m}setUniform(n,h,m){n.set(m.constantOr(this.value))}getBinding(n,h,m){return this.type==="color"?new bc(n,h):new Jn(n,h)}}class Do{constructor(n,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=n.tlbr}setUniform(n,h,m,v){const S=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&n.set(S)}getBinding(n,h,m){return m.substr(0,9)==="u_pattern"?new uo(n,h):new Jn(n,h)}}class ws{constructor(n,h,m,v){this.expression=n,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(n,h,m,v,S){const i=this.paintVertexArray.length,t=this.expression.evaluate(new Ki(0),h,{},v,[],S);this.paintVertexArray.resize(n),this._setPaintValue(i,n,t)}updatePaintArray(n,h,m,v){const S=this.expression.evaluate({zoom:0},m,v);this._setPaintValue(n,h,S)}_setPaintValue(n,h,m){if(this.type==="color"){const v=xl(m);for(let S=n;S<h;S++)this.paintVertexArray.emplace(S,v[0],v[1])}else{for(let v=n;v<h;v++)this.paintVertexArray.emplace(v,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rn{constructor(n,h,m,v,S,i){this.expression=n,this.uniformNames=h.map(t=>`u_${t}_t`),this.type=m,this.useIntegerZoom=v,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map(t=>({name:`a_${t}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new i}populatePaintArray(n,h,m,v,S){const i=this.expression.evaluate(new Ki(this.zoom),h,{},v,[],S),t=this.expression.evaluate(new Ki(this.zoom+1),h,{},v,[],S),o=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(o,n,i,t)}updatePaintArray(n,h,m,v){const S=this.expression.evaluate({zoom:this.zoom},m,v),i=this.expression.evaluate({zoom:this.zoom+1},m,v);this._setPaintValue(n,h,S,i)}_setPaintValue(n,h,m,v){if(this.type==="color"){const S=xl(m),i=xl(v);for(let t=n;t<h;t++)this.paintVertexArray.emplace(t,S[0],S[1],i[0],i[1])}else{for(let S=n;S<h;S++)this.paintVertexArray.emplace(S,m,v);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(v))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,v=Z(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);n.set(v)}getBinding(n,h,m){return new Jn(n,h)}}class Vn{constructor(n,h,m,v,S,i){this.expression=n,this.type=h,this.useIntegerZoom=m,this.zoom=v,this.layerId=i,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(n,h,m){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(v,n,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(n,h,m,v,S){this._setPaintValues(n,h,m.patterns&&m.patterns[this.layerId],S)}_setPaintValues(n,h,m,v){if(!v||!m)return;const{min:S,mid:i,max:t}=m,o=v[S],p=v[i],f=v[t];if(o&&p&&f)for(let _=n;_<h;_++)this.zoomInPaintVertexArray.emplace(_,p.tl[0],p.tl[1],p.br[0],p.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],p.pixelRatio,o.pixelRatio),this.zoomOutPaintVertexArray.emplace(_,p.tl[0],p.tl[1],p.br[0],p.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],p.pixelRatio,f.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Zi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Zi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ma{constructor(n,h,m){this.binders={},this._buffers=[];const v=[];for(const S in n.paint._values){if(!m(S))continue;const i=n.paint.get(S);if(!(i instanceof ys&&ss(i.property.specification)))continue;const t=bl(S,n.type),o=i.value,p=i.property.specification.type,f=i.property.useIntegerZoom,_=i.property.specification["property-type"],x=_==="cross-faded"||_==="cross-faded-data-driven";if(o.kind==="constant")this.binders[S]=x?new Do(o.value,t):new vl(o.value,t,p),v.push(`/u_${S}`);else if(o.kind==="source"||x){const E=Fh(S,p,"source");this.binders[S]=x?new Vn(o,p,f,h,E,n.id):new ws(o,t,p,E),v.push(`/a_${S}`)}else{const E=Fh(S,p,"composite");this.binders[S]=new Rn(o,t,p,f,h,E),v.push(`/z_${S}`)}}this.cacheKey=v.sort().join("")}getMaxValue(n){const h=this.binders[n];return h instanceof ws||h instanceof Rn?h.maxValue:0}populatePaintArrays(n,h,m,v,S){for(const i in this.binders){const t=this.binders[i];(t instanceof ws||t instanceof Rn||t instanceof Vn)&&t.populatePaintArray(n,h,m,v,S)}}setConstantPatternPositions(n,h){for(const m in this.binders){const v=this.binders[m];v instanceof Do&&v.setConstantPatternPositions(n,h)}}updatePaintArrays(n,h,m,v,S){let i=!1;for(const t in n){const o=h.getPositions(t);for(const p of o){const f=m.feature(p.index);for(const _ in this.binders){const x=this.binders[_];if((x instanceof ws||x instanceof Rn||x instanceof Vn)&&x.expression.isStateDependent===!0){const E=v.paint.get(_);x.expression=E.value,x.updatePaintArray(p.start,p.end,f,n[t],S),i=!0}}}}return i}defines(){const n=[];for(const h in this.binders){const m=this.binders[h];(m instanceof vl||m instanceof Do)&&n.push(...m.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return n}getBinderAttributes(){const n=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof ws||m instanceof Rn)for(let v=0;v<m.paintVertexAttributes.length;v++)n.push(m.paintVertexAttributes[v].name);else if(m instanceof Vn)for(let v=0;v<Zi.members.length;v++)n.push(Zi.members[v].name)}return n}getBinderUniforms(){const n=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof vl||m instanceof Do||m instanceof Rn)for(const v of m.uniformNames)n.push(v)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,h){const m=[];for(const v in this.binders){const S=this.binders[v];if(S instanceof vl||S instanceof Do||S instanceof Rn){for(const i of S.uniformNames)if(h[i]){const t=S.getBinding(n,h[i],i);m.push({name:i,property:v,binding:t})}}}return m}setUniforms(n,h,m,v){for(const{name:S,property:i,binding:t}of h)this.binders[i].setUniform(t,v,m.get(i),S)}updatePaintBuffers(n){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(n&&m instanceof Vn){const v=n.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(m instanceof ws||m instanceof Rn)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(n){for(const h in this.binders){const m=this.binders[h];(m instanceof ws||m instanceof Rn||m instanceof Vn)&&m.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const h=this.binders[n];(h instanceof ws||h instanceof Rn||h instanceof Vn)&&h.destroy()}}}class qa{constructor(n,h,m=()=>!0){this.programConfigurations={};for(const v of n)this.programConfigurations[v.id]=new ma(v,h,m);this.needsUpload=!1,this._featureMap=new Un,this._bufferOffset=0}populatePaintArrays(n,h,m,v,S,i){for(const t in this.programConfigurations)this.programConfigurations[t].populatePaintArrays(n,h,v,S,i);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,h,m,v){for(const S of m)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(n,this._featureMap,h,S,v)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function bl(c,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${n}-`,"").replace(/-/g,"_")]}function Fh(c,n,h){const m={color:{source:r,composite:ce},number:{source:N,composite:r}},v=function(S){return{"line-pattern":{source:oi,composite:oi},"fill-pattern":{source:oi,composite:oi},"fill-extrusion-pattern":{source:oi,composite:oi}}[S]}(c);return v&&v[h]||m[n][h]}Nt("ConstantBinder",vl),Nt("CrossFadedConstantBinder",Do),Nt("SourceExpressionBinder",ws),Nt("CrossFadedCompositeBinder",Vn),Nt("CompositeExpressionBinder",Rn),Nt("ProgramConfiguration",ma,{omit:["_buffers"]}),Nt("ProgramConfigurationSet",qa);var En=8192;const yn=Math.pow(2,14)-1,nu=-yn-1;function Ga(c){const n=En/c.extent,h=c.loadGeometry();for(let m=0;m<h.length;m++){const v=h[m];for(let S=0;S<v.length;S++){const i=v[S],t=Math.round(i.x*n),o=Math.round(i.y*n);i.x=Z(t,nu,yn),i.y=Z(o,nu,yn),(t<i.x||t>i.x+1||o<i.y||o>i.y+1)&&nt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Os(c,n){return{type:c.type,id:c.id,properties:c.properties,geometry:n?Ga(c):[]}}function Lo(c,n,h,m,v){c.emplaceBack(2*n+(m+1)/2,2*h+(v+1)/2)}class Bl{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new xt,this.indexArray=new qr,this.segments=new Ri,this.programConfigurations=new qa(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,m){const v=this.layers[0],S=[];let i=null,t=!1;v.type==="circle"&&(i=v.layout.get("circle-sort-key"),t=!i.isConstant());for(const{feature:o,id:p,index:f,sourceLayerIndex:_}of n){const x=this.layers[0]._featureFilter.needGeometry,E=Os(o,x);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),E,m))continue;const z=t?i.evaluate(E,{},m):void 0,R={id:p,properties:o.properties,type:o.type,sourceLayerIndex:_,index:f,geometry:x?E.geometry:Ga(o),patterns:{},sortKey:z};S.push(R)}t&&S.sort((o,p)=>o.sortKey-p.sortKey);for(const o of S){const{geometry:p,index:f,sourceLayerIndex:_}=o,x=n[f].feature;this.addFeature(o,p,f,m),h.featureIndex.insert(x,p,f,_,this.index)}}update(n,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Or),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,h,m,v){for(const S of h)for(const i of S){const t=i.x,o=i.y;if(t<0||t>=En||o<0||o>=En)continue;const p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),f=p.vertexLength;Lo(this.layoutVertexArray,t,o,-1,-1),Lo(this.layoutVertexArray,t,o,1,-1),Lo(this.layoutVertexArray,t,o,1,1),Lo(this.layoutVertexArray,t,o,-1,1),this.indexArray.emplaceBack(f,f+1,f+2),this.indexArray.emplaceBack(f,f+3,f+2),p.vertexLength+=4,p.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,m,{},v)}}function su(c,n){for(let h=0;h<c.length;h++)if(wl(n,c[h]))return!0;for(let h=0;h<n.length;h++)if(wl(c,n[h]))return!0;return!!Uu(c,n)}function Oh(c,n,h){return!!wl(c,n)||!!Nu(n,c,h)}function Uh(c,n){if(c.length===1)return ju(n,c[0]);for(let h=0;h<n.length;h++){const m=n[h];for(let v=0;v<m.length;v++)if(wl(c,m[v]))return!0}for(let h=0;h<c.length;h++)if(ju(n,c[h]))return!0;for(let h=0;h<n.length;h++)if(Uu(c,n[h]))return!0;return!1}function Vh(c,n,h){if(c.length>1){if(Uu(c,n))return!0;for(let m=0;m<n.length;m++)if(Nu(n[m],c,h))return!0}for(let m=0;m<c.length;m++)if(Nu(c[m],n,h))return!0;return!1}function Uu(c,n){if(c.length===0||n.length===0)return!1;for(let h=0;h<c.length-1;h++){const m=c[h],v=c[h+1];for(let S=0;S<n.length-1;S++)if(Vu(m,v,n[S],n[S+1]))return!0}return!1}function Vu(c,n,h,m){return ct(c,h,m)!==ct(n,h,m)&&ct(c,n,h)!==ct(c,n,m)}function Nu(c,n,h){const m=h*h;if(n.length===1)return c.distSqr(n[0])<m;for(let v=1;v<n.length;v++)if(ou(c,n[v-1],n[v])<m)return!0;return!1}function ou(c,n,h){const m=n.distSqr(h);if(m===0)return c.distSqr(n);const v=((c.x-n.x)*(h.x-n.x)+(c.y-n.y)*(h.y-n.y))/m;return c.distSqr(v<0?n:v>1?h:h.sub(n)._mult(v)._add(n))}function ju(c,n){let h,m,v,S=!1;for(let i=0;i<c.length;i++){h=c[i];for(let t=0,o=h.length-1;t<h.length;o=t++)m=h[t],v=h[o],m.y>n.y!=v.y>n.y&&n.x<(v.x-m.x)*(n.y-m.y)/(v.y-m.y)+m.x&&(S=!S)}return S}function wl(c,n){let h=!1;for(let m=0,v=c.length-1;m<c.length;v=m++){const S=c[m],i=c[v];S.y>n.y!=i.y>n.y&&n.x<(i.x-S.x)*(n.y-S.y)/(i.y-S.y)+S.x&&(h=!h)}return h}function Rl(c,n,h){const m=h[0],v=h[2];if(c.x<m.x&&n.x<m.x||c.x>v.x&&n.x>v.x||c.y<m.y&&n.y<m.y||c.y>v.y&&n.y>v.y)return!1;const S=ct(c,n,h[0]);return S!==ct(c,n,h[1])||S!==ct(c,n,h[2])||S!==ct(c,n,h[3])}function wc(c,n,h){const m=n.paint.get(c).value;return m.kind==="constant"?m.value:h.programConfigurations.get(n.id).getMaxValue(c)}function Za(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Tl(c,n,h,m,v){if(!n[0]&&!n[1])return c;const S=De.convert(n)._mult(v);h==="viewport"&&S._rotate(-m);const i=[];for(let t=0;t<c.length;t++)i.push(c[t].sub(S));return i}Nt("CircleBucket",Bl,{omit:["layers"]});const au=new tn({"circle-sort-key":new _t(ae.layout_circle["circle-sort-key"])});var Lp={paint:new tn({"circle-radius":new _t(ae.paint_circle["circle-radius"]),"circle-color":new _t(ae.paint_circle["circle-color"]),"circle-blur":new _t(ae.paint_circle["circle-blur"]),"circle-opacity":new _t(ae.paint_circle["circle-opacity"]),"circle-translate":new Yt(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new Yt(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Yt(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Yt(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _t(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _t(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _t(ae.paint_circle["circle-stroke-opacity"])}),layout:au},Fl=typeof Float32Array!="undefined"?Float32Array:Array;function Nn(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Hn(c,n,h){var m=n[0],v=n[1],S=n[2],i=n[3],t=n[4],o=n[5],p=n[6],f=n[7],_=n[8],x=n[9],E=n[10],z=n[11],R=n[12],V=n[13],q=n[14],X=n[15],Y=h[0],Q=h[1],fe=h[2],de=h[3];return c[0]=Y*m+Q*t+fe*_+de*R,c[1]=Y*v+Q*o+fe*x+de*V,c[2]=Y*S+Q*p+fe*E+de*q,c[3]=Y*i+Q*f+fe*z+de*X,c[4]=(Y=h[4])*m+(Q=h[5])*t+(fe=h[6])*_+(de=h[7])*R,c[5]=Y*v+Q*o+fe*x+de*V,c[6]=Y*S+Q*p+fe*E+de*q,c[7]=Y*i+Q*f+fe*z+de*X,c[8]=(Y=h[8])*m+(Q=h[9])*t+(fe=h[10])*_+(de=h[11])*R,c[9]=Y*v+Q*o+fe*x+de*V,c[10]=Y*S+Q*p+fe*E+de*q,c[11]=Y*i+Q*f+fe*z+de*X,c[12]=(Y=h[12])*m+(Q=h[13])*t+(fe=h[14])*_+(de=h[15])*R,c[13]=Y*v+Q*o+fe*x+de*V,c[14]=Y*S+Q*p+fe*E+de*q,c[15]=Y*i+Q*f+fe*z+de*X,c}Math.hypot||(Math.hypot=function(){for(var c=0,n=arguments.length;n--;)c+=arguments[n]*arguments[n];return Math.sqrt(c)});var Ol,qu=Hn;function Tc(c,n,h){var m=n[0],v=n[1],S=n[2],i=n[3];return c[0]=h[0]*m+h[4]*v+h[8]*S+h[12]*i,c[1]=h[1]*m+h[5]*v+h[9]*S+h[13]*i,c[2]=h[2]*m+h[6]*v+h[10]*S+h[14]*i,c[3]=h[3]*m+h[7]*v+h[11]*S+h[15]*i,c}function Ul(c,n){const h=Tc([],[c.x,c.y,0,1],n);return new De(h[0]/h[3],h[1]/h[3])}Ol=new Fl(4),Fl!=Float32Array&&(Ol[0]=0,Ol[1]=0,Ol[2]=0,Ol[3]=0);class Nh extends Bl{}Nt("HeatmapBucket",Nh,{omit:["layers"]});var jh={paint:new tn({"heatmap-radius":new _t(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _t(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Yt(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mo(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Yt(ae.paint_heatmap["heatmap-opacity"])})};function lu(c,{width:n,height:h},m,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==n*h*m)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${n*h*m}`)}else v=new Uint8Array(n*h*m);return c.width=n,c.height=h,c.data=v,c}function Ic(c,{width:n,height:h},m){if(n===c.width&&h===c.height)return;const v=lu({},{width:n,height:h},m);cu(c,v,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,n),height:Math.min(c.height,h)},m),c.width=n,c.height=h,c.data=v.data}function cu(c,n,h,m,v,S){if(v.width===0||v.height===0)return n;if(v.width>c.width||v.height>c.height||h.x>c.width-v.width||h.y>c.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>n.width||v.height>n.height||m.x>n.width-v.width||m.y>n.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const i=c.data,t=n.data;for(let o=0;o<v.height;o++){const p=((h.y+o)*c.width+h.x)*S,f=((m.y+o)*n.width+m.x)*S;for(let _=0;_<v.width*S;_++)t[f+_]=i[p+_]}return n}class Vl{constructor(n,h){lu(this,n,1,h)}resize(n){Ic(this,n,1)}clone(){return new Vl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,h,m,v,S){cu(n,h,m,v,S,1)}}class Ts{constructor(n,h){lu(this,n,4,h)}resize(n){Ic(this,n,4)}replace(n,h){h?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ts({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,h,m,v,S){cu(n,h,m,v,S,4)}}function qh(c){const n={},h=c.resolution||256,m=c.clips?c.clips.length:1,v=c.image||new Ts({width:h,height:m}),S=(i,t,o)=>{n[c.evaluationKey]=o;const p=c.expression.evaluate(n);v.data[i+t+0]=Math.floor(255*p.r/p.a),v.data[i+t+1]=Math.floor(255*p.g/p.a),v.data[i+t+2]=Math.floor(255*p.b/p.a),v.data[i+t+3]=Math.floor(255*p.a)};if(c.clips)for(let i=0,t=0;i<m;++i,t+=4*h)for(let o=0,p=0;o<h;o++,p+=4){const f=o/(h-1),{start:_,end:x}=c.clips[i];S(t,p,_*(1-f)+x*f)}else for(let i=0,t=0;i<h;i++,t+=4)S(0,t,i/(h-1));return v}Nt("AlphaImage",Vl),Nt("RGBAImage",Ts);var Gu={paint:new tn({"hillshade-illumination-direction":new Yt(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Yt(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Yt(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Yt(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Yt(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Yt(ae.paint_hillshade["hillshade-accent-color"])})};const Gh=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zu}=Gh;var Il={exports:{}};function $n(c,n,h){h=h||2;var m,v,S,i,t,o,p,f=n&&n.length,_=f?n[0]*h:c.length,x=Xu(c,0,_,h,!0),E=[];if(!x||x.next===x.prev)return E;if(f&&(x=function(R,V,q,X){var Y,Q,fe,de=[];for(Y=0,Q=V.length;Y<Q;Y++)(fe=Xu(R,V[Y]*X,Y<Q-1?V[Y+1]*X:R.length,X,!1))===fe.next&&(fe.steiner=!0),de.push(Fp(fe));for(de.sort(Wa),Y=0;Y<de.length;Y++)q=Xa(q=Ec(de[Y],q),q.next);return q}(c,n,x,h)),c.length>80*h){m=S=c[0],v=i=c[1];for(var z=h;z<_;z+=h)(t=c[z])<m&&(m=t),(o=c[z+1])<v&&(v=o),t>S&&(S=t),o>i&&(i=o);p=(p=Math.max(S-m,i-v))!==0?1/p:0}return Sc(x,E,h,m,v,p),E}function Xu(c,n,h,m,v){var S,i;if(v===Gl(c,n,h,m)>0)for(S=n;S<h;S+=m)i=kc(S,c[S],c[S+1],i);else for(S=h-m;S>=n;S-=m)i=kc(S,c[S],c[S+1],i);return i&&pu(i,i.next)&&(jl(i),i=i.next),i}function Xa(c,n){if(!c)return c;n||(n=c);var h,m=c;do if(h=!1,m.steiner||!pu(m,m.next)&&xn(m.prev,m,m.next)!==0)m=m.next;else{if(jl(m),(m=n=m.prev)===m.next)break;h=!0}while(h||m!==n);return n}function Sc(c,n,h,m,v,S,i){if(c){!i&&S&&function(f,_,x,E){var z=f;do z.z===null&&(z.z=Wu(z.x,z.y,_,x,E)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==f);z.prevZ.nextZ=null,z.prevZ=null,function(R){var V,q,X,Y,Q,fe,de,Te,Pe=1;do{for(q=R,R=null,Q=null,fe=0;q;){for(fe++,X=q,de=0,V=0;V<Pe&&(de++,X=X.nextZ);V++);for(Te=Pe;de>0||Te>0&&X;)de!==0&&(Te===0||!X||q.z<=X.z)?(Y=q,q=q.nextZ,de--):(Y=X,X=X.nextZ,Te--),Q?Q.nextZ=Y:R=Y,Y.prevZ=Q,Q=Y;q=X}Q.nextZ=null,Pe*=2}while(fe>1)}(z)}(c,m,v,S);for(var t,o,p=c;c.prev!==c.next;)if(t=c.prev,o=c.next,S?uu(c,m,v,S):Bp(c))n.push(t.i/h),n.push(c.i/h),n.push(o.i/h),jl(c),c=o.next,p=o.next;else if((c=o)===p){i?i===1?Sc(c=hu(Xa(c),n,h),n,h,m,v,S,2):i===2&&Zh(c,n,h,m,v,S):Sc(Xa(c),n,h,m,v,S,1);break}}}function Bp(c){var n=c.prev,h=c,m=c.next;if(xn(n,h,m)>=0)return!1;for(var v=c.next.next;v!==c.prev;){if(Nl(n.x,n.y,h.x,h.y,m.x,m.y,v.x,v.y)&&xn(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function uu(c,n,h,m){var v=c.prev,S=c,i=c.next;if(xn(v,S,i)>=0)return!1;for(var t=v.x>S.x?v.x>i.x?v.x:i.x:S.x>i.x?S.x:i.x,o=v.y>S.y?v.y>i.y?v.y:i.y:S.y>i.y?S.y:i.y,p=Wu(v.x<S.x?v.x<i.x?v.x:i.x:S.x<i.x?S.x:i.x,v.y<S.y?v.y<i.y?v.y:i.y:S.y<i.y?S.y:i.y,n,h,m),f=Wu(t,o,n,h,m),_=c.prevZ,x=c.nextZ;_&&_.z>=p&&x&&x.z<=f;){if(_!==c.prev&&_!==c.next&&Nl(v.x,v.y,S.x,S.y,i.x,i.y,_.x,_.y)&&xn(_.prev,_,_.next)>=0||(_=_.prevZ,x!==c.prev&&x!==c.next&&Nl(v.x,v.y,S.x,S.y,i.x,i.y,x.x,x.y)&&xn(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;_&&_.z>=p;){if(_!==c.prev&&_!==c.next&&Nl(v.x,v.y,S.x,S.y,i.x,i.y,_.x,_.y)&&xn(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=f;){if(x!==c.prev&&x!==c.next&&Nl(v.x,v.y,S.x,S.y,i.x,i.y,x.x,x.y)&&xn(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function hu(c,n,h){var m=c;do{var v=m.prev,S=m.next.next;!pu(v,S)&&du(v,m,m.next,S)&&Ac(v,S)&&Ac(S,v)&&(n.push(v.i/h),n.push(m.i/h),n.push(S.i/h),jl(m),jl(m.next),m=c=S),m=m.next}while(m!==c);return Xa(m)}function Zh(c,n,h,m,v,S){var i=c;do{for(var t=i.next.next;t!==i.prev;){if(i.i!==t.i&&Op(i,t)){var o=dn(i,t);return i=Xa(i,i.next),o=Xa(o,o.next),Sc(i,n,h,m,v,S),void Sc(o,n,h,m,v,S)}t=t.next}i=i.next}while(i!==c)}function Wa(c,n){return c.x-n.x}function Ec(c,n){var h=function(S,i){var t,o=i,p=S.x,f=S.y,_=-1/0;do{if(f<=o.y&&f>=o.next.y&&o.next.y!==o.y){var x=o.x+(f-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(x<=p&&x>_){if(_=x,x===p){if(f===o.y)return o;if(f===o.next.y)return o.next}t=o.x<o.next.x?o:o.next}}o=o.next}while(o!==i);if(!t)return null;if(p===_)return t;var E,z=t,R=t.x,V=t.y,q=1/0;o=t;do p>=o.x&&o.x>=R&&p!==o.x&&Nl(f<V?p:_,f,R,V,f<V?_:p,f,o.x,o.y)&&(E=Math.abs(f-o.y)/(p-o.x),Ac(o,S)&&(E<q||E===q&&(o.x>t.x||o.x===t.x&&Rp(t,o)))&&(t=o,q=E)),o=o.next;while(o!==z);return t}(c,n);if(!h)return n;var m=dn(h,c),v=Xa(h,h.next);return Xa(m,m.next),n===h?v:n}function Rp(c,n){return xn(c.prev,c,n.prev)<0&&xn(n.next,c,c.next)<0}function Wu(c,n,h,m,v){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=32767*(c-h)*v)|c<<8))|c<<4))|c<<2))|c<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-m)*v)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Fp(c){var n=c,h=c;do(n.x<h.x||n.x===h.x&&n.y<h.y)&&(h=n),n=n.next;while(n!==c);return h}function Nl(c,n,h,m,v,S,i,t){return(v-i)*(n-t)-(c-i)*(S-t)>=0&&(c-i)*(m-t)-(h-i)*(n-t)>=0&&(h-i)*(S-t)-(v-i)*(m-t)>=0}function Op(c,n){return c.next.i!==n.i&&c.prev.i!==n.i&&!function(h,m){var v=h;do{if(v.i!==h.i&&v.next.i!==h.i&&v.i!==m.i&&v.next.i!==m.i&&du(v,v.next,h,m))return!0;v=v.next}while(v!==h);return!1}(c,n)&&(Ac(c,n)&&Ac(n,c)&&function(h,m){var v=h,S=!1,i=(h.x+m.x)/2,t=(h.y+m.y)/2;do v.y>t!=v.next.y>t&&v.next.y!==v.y&&i<(v.next.x-v.x)*(t-v.y)/(v.next.y-v.y)+v.x&&(S=!S),v=v.next;while(v!==h);return S}(c,n)&&(xn(c.prev,c,n.prev)||xn(c,n.prev,n))||pu(c,n)&&xn(c.prev,c,c.next)>0&&xn(n.prev,n,n.next)>0)}function xn(c,n,h){return(n.y-c.y)*(h.x-n.x)-(n.x-c.x)*(h.y-n.y)}function pu(c,n){return c.x===n.x&&c.y===n.y}function du(c,n,h,m){var v=ga(xn(c,n,h)),S=ga(xn(c,n,m)),i=ga(xn(h,m,c)),t=ga(xn(h,m,n));return v!==S&&i!==t||!(v!==0||!fu(c,h,n))||!(S!==0||!fu(c,m,n))||!(i!==0||!fu(h,c,m))||!(t!==0||!fu(h,n,m))}function fu(c,n,h){return n.x<=Math.max(c.x,h.x)&&n.x>=Math.min(c.x,h.x)&&n.y<=Math.max(c.y,h.y)&&n.y>=Math.min(c.y,h.y)}function ga(c){return c>0?1:c<0?-1:0}function Ac(c,n){return xn(c.prev,c,c.next)<0?xn(c,n,c.next)>=0&&xn(c,c.prev,n)>=0:xn(c,n,c.prev)<0||xn(c,c.next,n)<0}function dn(c,n){var h=new ql(c.i,c.x,c.y),m=new ql(n.i,n.x,n.y),v=c.next,S=n.prev;return c.next=n,n.prev=c,h.next=v,v.prev=h,m.next=h,h.prev=m,S.next=m,m.prev=S,m}function kc(c,n,h,m){var v=new ql(c,n,h);return m?(v.next=m.next,v.prev=m,m.next.prev=v,m.next=v):(v.prev=v,v.next=v),v}function jl(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function ql(c,n,h){this.i=c,this.x=n,this.y=h,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gl(c,n,h,m){for(var v=0,S=n,i=h-m;S<h;S+=m)v+=(c[i]-c[S])*(c[S+1]+c[i+1]),i=S;return v}Il.exports=$n,Il.exports.default=$n,$n.deviation=function(c,n,h,m){var v=n&&n.length,S=Math.abs(Gl(c,0,v?n[0]*h:c.length,h));if(v)for(var i=0,t=n.length;i<t;i++)S-=Math.abs(Gl(c,n[i]*h,i<t-1?n[i+1]*h:c.length,h));var o=0;for(i=0;i<m.length;i+=3){var p=m[i]*h,f=m[i+1]*h,_=m[i+2]*h;o+=Math.abs((c[p]-c[_])*(c[f+1]-c[p+1])-(c[p]-c[f])*(c[_+1]-c[p+1]))}return S===0&&o===0?0:Math.abs((o-S)/S)},$n.flatten=function(c){for(var n=c[0][0].length,h={vertices:[],holes:[],dimensions:n},m=0,v=0;v<c.length;v++){for(var S=0;S<c[v].length;S++)for(var i=0;i<n;i++)h.vertices.push(c[v][S][i]);v>0&&h.holes.push(m+=c[v-1].length)}return h};var Zl=Il.exports;function Xh(c,n,h,m,v){Hu(c,n,h||0,m||c.length-1,v||Ku)}function Hu(c,n,h,m,v){for(;m>h;){if(m-h>600){var S=m-h+1,i=n-h+1,t=Math.log(S),o=.5*Math.exp(2*t/3),p=.5*Math.sqrt(t*o*(S-o)/S)*(i-S/2<0?-1:1);Hu(c,n,Math.max(h,Math.floor(n-i*o/S+p)),Math.min(m,Math.floor(n+(S-i)*o/S+p)),v)}var f=c[n],_=h,x=m;for(_a(c,h,n),v(c[m],f)>0&&_a(c,h,m);_<x;){for(_a(c,_,x),_++,x--;v(c[_],f)<0;)_++;for(;v(c[x],f)>0;)x--}v(c[h],f)===0?_a(c,h,x):_a(c,++x,m),x<=n&&(h=x+1),n<=x&&(m=x-1)}}function _a(c,n,h){var m=c[n];c[n]=c[h],c[h]=m}function Ku(c,n){return c<n?-1:c>n?1:0}function zc(c,n){const h=c.length;if(h<=1)return[c];const m=[];let v,S;for(let i=0;i<h;i++){const t=Xe(c[i]);t!==0&&(c[i].area=Math.abs(t),S===void 0&&(S=t<0),S===t<0?(v&&m.push(v),v=[c[i]]):v.push(c[i]))}if(v&&m.push(v),n>1)for(let i=0;i<m.length;i++)m[i].length<=n||(Xh(m[i],n,1,m[i].length-1,Up),m[i]=m[i].slice(0,n));return m}function Up(c,n){return n.area-c.area}function mu(c,n,h){const m=h.patternDependencies;let v=!1;for(const S of n){const i=S.paint.get(`${c}-pattern`);i.isConstant()||(v=!0);const t=i.constantOr(null);t&&(v=!0,m[t.to]=!0,m[t.from]=!0)}return v}function Sl(c,n,h,m,v){const S=v.patternDependencies;for(const i of n){const t=i.paint.get(`${c}-pattern`).value;if(t.kind!=="constant"){let o=t.evaluate({zoom:m-1},h,{},v.availableImages),p=t.evaluate({zoom:m},h,{},v.availableImages),f=t.evaluate({zoom:m+1},h,{},v.availableImages);o=o&&o.name?o.name:o,p=p&&p.name?p.name:p,f=f&&f.name?f.name:f,S[o]=!0,S[p]=!0,S[f]=!0,h.patterns[i.id]={min:o,mid:p,max:f}}}return h}class Yu{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ft,this.indexArray=new qr,this.indexArray2=new _n,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ri,this.segments2=new Ri,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,m){this.hasPattern=mu("fill",this.layers,h);const v=this.layers[0].layout.get("fill-sort-key"),S=!v.isConstant(),i=[];for(const{feature:t,id:o,index:p,sourceLayerIndex:f}of n){const _=this.layers[0]._featureFilter.needGeometry,x=Os(t,_);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),x,m))continue;const E=S?v.evaluate(x,{},m,h.availableImages):void 0,z={id:o,properties:t.properties,type:t.type,sourceLayerIndex:f,index:p,geometry:_?x.geometry:Ga(t),patterns:{},sortKey:E};i.push(z)}S&&i.sort((t,o)=>t.sortKey-o.sortKey);for(const t of i){const{geometry:o,index:p,sourceLayerIndex:f}=t;if(this.hasPattern){const _=Sl("fill",this.layers,t,this.zoom,h);this.patternFeatures.push(_)}else this.addFeature(t,o,p,m,{});h.featureIndex.insert(n[p].feature,o,p,f,this.index)}}update(n,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,m)}addFeatures(n,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Zu),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,h,m,v,S){for(const i of zc(h,500)){let t=0;for(const E of i)t+=E.length;const o=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),p=o.vertexLength,f=[],_=[];for(const E of i){if(E.length===0)continue;E!==i[0]&&_.push(f.length/2);const z=this.segments2.prepareSegment(E.length,this.layoutVertexArray,this.indexArray2),R=z.vertexLength;this.layoutVertexArray.emplaceBack(E[0].x,E[0].y),this.indexArray2.emplaceBack(R+E.length-1,R),f.push(E[0].x),f.push(E[0].y);for(let V=1;V<E.length;V++)this.layoutVertexArray.emplaceBack(E[V].x,E[V].y),this.indexArray2.emplaceBack(R+V-1,R+V),f.push(E[V].x),f.push(E[V].y);z.vertexLength+=E.length,z.primitiveLength+=E.length}const x=Zl(f,_);for(let E=0;E<x.length;E+=3)this.indexArray.emplaceBack(p+x[E],p+x[E+1],p+x[E+2]);o.vertexLength+=t,o.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,m,S,v)}}Nt("FillBucket",Yu,{omit:["layers","patternFeatures"]});const Ju=new tn({"fill-sort-key":new _t(ae.layout_fill["fill-sort-key"])});var Vp={paint:new tn({"fill-antialias":new Yt(ae.paint_fill["fill-antialias"]),"fill-opacity":new _t(ae.paint_fill["fill-opacity"]),"fill-color":new _t(ae.paint_fill["fill-color"]),"fill-outline-color":new _t(ae.paint_fill["fill-outline-color"]),"fill-translate":new Yt(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new Yt(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new ri(ae.paint_fill["fill-pattern"])}),layout:Ju};const $u=Oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:Qu}=$u;var Bo={},Np=De,Wh=Xl;function Xl(c,n,h,m,v){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=v,c.readFields(jp,this,n)}function jp(c,n,h){c==1?n.id=h.readVarint():c==2?function(m,v){for(var S=m.readVarint()+m.pos;m.pos<S;){var i=v._keys[m.readVarint()],t=v._values[m.readVarint()];v.properties[i]=t}}(h,n):c==3?n.type=h.readVarint():c==4&&(n._geometry=h.pos)}function qp(c){for(var n,h,m=0,v=0,S=c.length,i=S-1;v<S;i=v++)m+=((h=c[i]).x-(n=c[v]).x)*(n.y+h.y);return m}Xl.types=["Unknown","Point","LineString","Polygon"],Xl.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var n,h=c.readVarint()+c.pos,m=1,v=0,S=0,i=0,t=[];c.pos<h;){if(v<=0){var o=c.readVarint();m=7&o,v=o>>3}if(v--,m===1||m===2)S+=c.readSVarint(),i+=c.readSVarint(),m===1&&(n&&t.push(n),n=[]),n.push(new Np(S,i));else{if(m!==7)throw new Error("unknown command "+m);n&&n.push(n[0].clone())}}return n&&t.push(n),t},Xl.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var n=c.readVarint()+c.pos,h=1,m=0,v=0,S=0,i=1/0,t=-1/0,o=1/0,p=-1/0;c.pos<n;){if(m<=0){var f=c.readVarint();h=7&f,m=f>>3}if(m--,h===1||h===2)(v+=c.readSVarint())<i&&(i=v),v>t&&(t=v),(S+=c.readSVarint())<o&&(o=S),S>p&&(p=S);else if(h!==7)throw new Error("unknown command "+h)}return[i,o,t,p]},Xl.prototype.toGeoJSON=function(c,n,h){var m,v,S=this.extent*Math.pow(2,h),i=this.extent*c,t=this.extent*n,o=this.loadGeometry(),p=Xl.types[this.type];function f(E){for(var z=0;z<E.length;z++){var R=E[z];E[z]=[360*(R.x+i)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+t)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var _=[];for(m=0;m<o.length;m++)_[m]=o[m][0];f(o=_);break;case 2:for(m=0;m<o.length;m++)f(o[m]);break;case 3:for(o=function(E){var z=E.length;if(z<=1)return[E];for(var R,V,q=[],X=0;X<z;X++){var Y=qp(E[X]);Y!==0&&(V===void 0&&(V=Y<0),V===Y<0?(R&&q.push(R),R=[E[X]]):R.push(E[X]))}return R&&q.push(R),q}(o),m=0;m<o.length;m++)for(v=0;v<o[m].length;v++)f(o[m][v])}o.length===1?o=o[0]:p="Multi"+p;var x={type:"Feature",geometry:{type:p,coordinates:o},properties:this.properties};return"id"in this&&(x.id=this.id),x};var Ha=Wh,Hh=eh;function eh(c,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Wl,this,n),this.length=this._features.length}function Wl(c,n,h){c===15?n.version=h.readVarint():c===1?n.name=h.readString():c===5?n.extent=h.readVarint():c===2?n._features.push(h.pos):c===3?n._keys.push(h.readString()):c===4&&n._values.push(function(m){for(var v=null,S=m.readVarint()+m.pos;m.pos<S;){var i=m.readVarint()>>3;v=i===1?m.readString():i===2?m.readFloat():i===3?m.readDouble():i===4?m.readVarint64():i===5?m.readVarint():i===6?m.readSVarint():i===7?m.readBoolean():null}return v}(h))}eh.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var n=this._pbf.readVarint()+this._pbf.pos;return new Ha(this._pbf,n,this.extent,this._keys,this._values)};var Gp=Hh;function Zp(c,n,h){if(c===3){var m=new Gp(h,h.readVarint()+h.pos);m.length&&(n[m.name]=m)}}Bo.VectorTile=function(c,n){this.layers=c.readFields(Zp,{},n)},Bo.VectorTileFeature=Wh,Bo.VectorTileLayer=Hh;const Xp=Bo.VectorTileFeature.types,gu=Math.pow(2,13);function Hl(c,n,h,m,v,S,i,t){c.emplaceBack(n,h,2*Math.floor(m*gu)+i,v*gu*2,S*gu*2,Math.round(t))}class th{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ti,this.indexArray=new qr,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ri,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,m){this.features=[],this.hasPattern=mu("fill-extrusion",this.layers,h);for(const{feature:v,id:S,index:i,sourceLayerIndex:t}of n){const o=this.layers[0]._featureFilter.needGeometry,p=Os(v,o);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),p,m))continue;const f={id:S,sourceLayerIndex:t,index:i,geometry:o?p.geometry:Ga(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(Sl("fill-extrusion",this.layers,f,this.zoom,h)):this.addFeature(f,f.geometry,i,m,{}),h.featureIndex.insert(v,f.geometry,i,t,this.index,!0)}}addFeatures(n,h,m){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,h,m)}}update(n,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Qu),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,h,m,v,S){for(const i of zc(h,500)){let t=0;for(const E of i)t+=E.length;let o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const E of i){if(E.length===0||Hp(E))continue;let z=0;for(let R=0;R<E.length;R++){const V=E[R];if(R>=1){const q=E[R-1];if(!Wp(V,q)){o.vertexLength+4>Ri.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const X=V.sub(q)._perp()._unit(),Y=q.dist(V);z+Y>32768&&(z=0),Hl(this.layoutVertexArray,V.x,V.y,X.x,X.y,0,0,z),Hl(this.layoutVertexArray,V.x,V.y,X.x,X.y,0,1,z),z+=Y,Hl(this.layoutVertexArray,q.x,q.y,X.x,X.y,0,0,z),Hl(this.layoutVertexArray,q.x,q.y,X.x,X.y,0,1,z);const Q=o.vertexLength;this.indexArray.emplaceBack(Q,Q+2,Q+1),this.indexArray.emplaceBack(Q+1,Q+2,Q+3),o.vertexLength+=4,o.primitiveLength+=2}}}}if(o.vertexLength+t>Ri.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),Xp[n.type]!=="Polygon")continue;const p=[],f=[],_=o.vertexLength;for(const E of i)if(E.length!==0){E!==i[0]&&f.push(p.length/2);for(let z=0;z<E.length;z++){const R=E[z];Hl(this.layoutVertexArray,R.x,R.y,0,0,1,1,0),p.push(R.x),p.push(R.y)}}const x=Zl(p,f);for(let E=0;E<x.length;E+=3)this.indexArray.emplaceBack(_+x[E],_+x[E+2],_+x[E+1]);o.primitiveLength+=x.length/3,o.vertexLength+=t}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,m,S,v)}}function Wp(c,n){return c.x===n.x&&(c.x<0||c.x>En)||c.y===n.y&&(c.y<0||c.y>En)}function Hp(c){return c.every(n=>n.x<0)||c.every(n=>n.x>En)||c.every(n=>n.y<0)||c.every(n=>n.y>En)}Nt("FillExtrusionBucket",th,{omit:["layers","features"]});var Kp={paint:new tn({"fill-extrusion-opacity":new Yt(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _t(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Yt(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Yt(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ri(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _t(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _t(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Yt(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function El(c,n){return c.x*n.x+c.y*n.y}function Kl(c,n){if(c.length===1){let h=0;const m=n[h++];let v;for(;!v||m.equals(v);)if(v=n[h++],!v)return 1/0;for(;h<n.length;h++){const S=n[h],i=c[0],t=v.sub(m),o=S.sub(m),p=i.sub(m),f=El(t,t),_=El(t,o),x=El(o,o),E=El(p,t),z=El(p,o),R=f*x-_*_,V=(x*E-_*z)/R,q=(f*z-_*E)/R,X=m.z*(1-V-q)+v.z*V+S.z*q;if(isFinite(X))return X}return 1/0}{let h=1/0;for(const m of n)h=Math.min(h,m.z);return h}}const ih=Oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Yp}=ih,Jp=Oi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:$p}=Jp,Cc=Bo.VectorTileFeature.types,Kh=Math.cos(Math.PI/180*37.5),Yh=Math.pow(2,14)/.5;class rh{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new It,this.layoutVertexArray2=new ii,this.indexArray=new qr,this.programConfigurations=new qa(n.layers,n.zoom),this.segments=new Ri,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,m){this.hasPattern=mu("line",this.layers,h);const v=this.layers[0].layout.get("line-sort-key"),S=!v.isConstant(),i=[];for(const{feature:t,id:o,index:p,sourceLayerIndex:f}of n){const _=this.layers[0]._featureFilter.needGeometry,x=Os(t,_);if(!this.layers[0]._featureFilter.filter(new Ki(this.zoom),x,m))continue;const E=S?v.evaluate(x,{},m):void 0,z={id:o,properties:t.properties,type:t.type,sourceLayerIndex:f,index:p,geometry:_?x.geometry:Ga(t),patterns:{},sortKey:E};i.push(z)}S&&i.sort((t,o)=>t.sortKey-o.sortKey);for(const t of i){const{geometry:o,index:p,sourceLayerIndex:f}=t;if(this.hasPattern){const _=Sl("line",this.layers,t,this.zoom,h);this.patternFeatures.push(_)}else this.addFeature(t,o,p,m,{});h.featureIndex.insert(n[p].feature,o,p,f,this.index)}}update(n,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,m)}addFeatures(n,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,$p)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Yp),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,h,m,v,S){const i=this.layers[0].layout,t=i.get("line-join").evaluate(n,{}),o=i.get("line-cap"),p=i.get("line-miter-limit"),f=i.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const _ of h)this.addLine(_,n,t,o,p,f);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,m,S,v)}addLine(n,h,m,v,S,i){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<n.length-1;q++)this.totalDistance+=n[q].dist(n[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const t=Cc[h.type]==="Polygon";let o=n.length;for(;o>=2&&n[o-1].equals(n[o-2]);)o--;let p=0;for(;p<o-1&&n[p].equals(n[p+1]);)p++;if(o<(t?3:2))return;m==="bevel"&&(S=1.05);const f=this.overscaling<=16?122880/(512*this.overscaling):0,_=this.segments.prepareSegment(10*o,this.layoutVertexArray,this.indexArray);let x,E,z,R,V;this.e1=this.e2=-1,t&&(x=n[o-2],V=n[p].sub(x)._unit()._perp());for(let q=p;q<o;q++){if(z=q===o-1?t?n[p+1]:void 0:n[q+1],z&&n[q].equals(z))continue;V&&(R=V),x&&(E=x),x=n[q],V=z?z.sub(x)._unit()._perp():R,R=R||V;let X=R.add(V);X.x===0&&X.y===0||X._unit();const Y=R.x*V.x+R.y*V.y,Q=X.x*V.x+X.y*V.y,fe=Q!==0?1/Q:1/0,de=2*Math.sqrt(2-2*Q),Te=Q<Kh&&E&&z,Pe=R.x*V.y-R.y*V.x>0;if(Te&&q>p){const Le=x.dist(E);if(Le>2*f){const Ue=x.sub(x.sub(E)._mult(f/Le)._round());this.updateDistance(E,Ue),this.addCurrentVertex(Ue,R,0,0,_),E=Ue}}const Ee=E&&z;let Me=Ee?m:t?"butt":v;if(Ee&&Me==="round"&&(fe<i?Me="miter":fe<=2&&(Me="fakeround")),Me==="miter"&&fe>S&&(Me="bevel"),Me==="bevel"&&(fe>2&&(Me="flipbevel"),fe<S&&(Me="miter")),E&&this.updateDistance(E,x),Me==="miter")X._mult(fe),this.addCurrentVertex(x,X,0,0,_);else if(Me==="flipbevel"){if(fe>100)X=V.mult(-1);else{const Le=fe*R.add(V).mag()/R.sub(V).mag();X._perp()._mult(Le*(Pe?-1:1))}this.addCurrentVertex(x,X,0,0,_),this.addCurrentVertex(x,X.mult(-1),0,0,_)}else if(Me==="bevel"||Me==="fakeround"){const Le=-Math.sqrt(fe*fe-1),Ue=Pe?Le:0,He=Pe?0:Le;if(E&&this.addCurrentVertex(x,R,Ue,He,_),Me==="fakeround"){const Ge=Math.round(180*de/Math.PI/20);for(let tt=1;tt<Ge;tt++){let et=tt/Ge;if(et!==.5){const Tt=et-.5;et+=et*Tt*(et-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*Tt*Tt+(.848013+Y*(.215638*Y-1.06021)))}const ht=V.sub(R)._mult(et)._add(R)._unit()._mult(Pe?-1:1);this.addHalfVertex(x,ht.x,ht.y,!1,Pe,0,_)}}z&&this.addCurrentVertex(x,V,-Ue,-He,_)}else if(Me==="butt")this.addCurrentVertex(x,X,0,0,_);else if(Me==="square"){const Le=E?1:-1;this.addCurrentVertex(x,X,Le,Le,_)}else Me==="round"&&(E&&(this.addCurrentVertex(x,R,0,0,_),this.addCurrentVertex(x,R,1,1,_,!0)),z&&(this.addCurrentVertex(x,V,-1,-1,_,!0),this.addCurrentVertex(x,V,0,0,_)));if(Te&&q<o-1){const Le=x.dist(z);if(Le>2*f){const Ue=x.add(z.sub(x)._mult(f/Le)._round());this.updateDistance(x,Ue),this.addCurrentVertex(Ue,V,0,0,_),x=Ue}}}}addCurrentVertex(n,h,m,v,S,i=!1){const t=h.y*v-h.x,o=-h.y-h.x*v;this.addHalfVertex(n,h.x+h.y*m,h.y-h.x*m,i,!1,m,S),this.addHalfVertex(n,t,o,i,!0,-v,S),this.distance>Yh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,h,m,v,S,i))}addHalfVertex({x:n,y:h},m,v,S,i,t,o){const p=.5*(this.lineClips?this.scaledDistance*(Yh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(S?1:0),(h<<1)+(i?1:0),Math.round(63*m)+128,Math.round(63*v)+128,1+(t===0?0:t<0?-1:1)|(63&p)<<2,p>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const f=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,f),o.primitiveLength++),i?this.e2=f:this.e1=f}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,h){this.distance+=n.dist(h),this.updateScaledDistance()}}Nt("LineBucket",rh,{omit:["layers","patternFeatures"]});const Qp=new tn({"line-cap":new Yt(ae.layout_line["line-cap"]),"line-join":new _t(ae.layout_line["line-join"]),"line-miter-limit":new Yt(ae.layout_line["line-miter-limit"]),"line-round-limit":new Yt(ae.layout_line["line-round-limit"]),"line-sort-key":new _t(ae.layout_line["line-sort-key"])});var Jh={paint:new tn({"line-opacity":new _t(ae.paint_line["line-opacity"]),"line-color":new _t(ae.paint_line["line-color"]),"line-translate":new Yt(ae.paint_line["line-translate"]),"line-translate-anchor":new Yt(ae.paint_line["line-translate-anchor"]),"line-width":new _t(ae.paint_line["line-width"]),"line-gap-width":new _t(ae.paint_line["line-gap-width"]),"line-offset":new _t(ae.paint_line["line-offset"]),"line-blur":new _t(ae.paint_line["line-blur"]),"line-dasharray":new xs(ae.paint_line["line-dasharray"]),"line-pattern":new ri(ae.paint_line["line-pattern"]),"line-gradient":new Mo(ae.paint_line["line-gradient"])}),layout:Qp};const $h=new class extends _t{possiblyEvaluate(c,n){return n=new Ki(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(c,n)}evaluate(c,n,h,m){return n=_e({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(c,n,h,m)}}(Jh.paint.properties["line-width"].specification);function Qh(c,n){return n>0?n+2*c:c}$h.useIntegerZoom=!0;const ep=Oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nh=Oi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ed=Oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Oi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sh=Oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tp=Oi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ip(c,n,h){return c.sections.forEach(m=>{m.text=function(v,S,i){const t=S.layout.get("text-transform").evaluate(i,{});return t==="uppercase"?v=v.toLocaleUpperCase():t==="lowercase"&&(v=v.toLocaleLowerCase()),Gn.applyArabicShaping&&(v=Gn.applyArabicShaping(v)),v}(m.text,n,h)}),c}Oi([{name:"triangle",components:3,type:"Uint16"}]),Oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oi([{type:"Float32",name:"offsetX"}]),Oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Pc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Fn=24,oh=Br,ah=function(c,n,h,m,v){var S,i,t=8*v-m-1,o=(1<<t)-1,p=o>>1,f=-7,_=h?v-1:0,x=h?-1:1,E=c[n+_];for(_+=x,S=E&(1<<-f)-1,E>>=-f,f+=t;f>0;S=256*S+c[n+_],_+=x,f-=8);for(i=S&(1<<-f)-1,S>>=-f,f+=m;f>0;i=256*i+c[n+_],_+=x,f-=8);if(S===0)S=1-p;else{if(S===o)return i?NaN:1/0*(E?-1:1);i+=Math.pow(2,m),S-=p}return(E?-1:1)*i*Math.pow(2,S-m)},rp=function(c,n,h,m,v,S){var i,t,o,p=8*S-v-1,f=(1<<p)-1,_=f>>1,x=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=m?0:S-1,z=m?1:-1,R=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(t=isNaN(n)?1:0,i=f):(i=Math.floor(Math.log(n)/Math.LN2),n*(o=Math.pow(2,-i))<1&&(i--,o*=2),(n+=i+_>=1?x/o:x*Math.pow(2,1-_))*o>=2&&(i++,o/=2),i+_>=f?(t=0,i=f):i+_>=1?(t=(n*o-1)*Math.pow(2,v),i+=_):(t=n*Math.pow(2,_-1)*Math.pow(2,v),i=0));v>=8;c[h+E]=255&t,E+=z,t/=256,v-=8);for(i=i<<v|t,p+=v;p>0;c[h+E]=255&i,E+=z,i/=256,p-=8);c[h+E-z]|=128*R};function Br(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}Br.Varint=0,Br.Fixed64=1,Br.Bytes=2,Br.Fixed32=5;var $s,Dn=4294967296,_u=1/Dn,lh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Ro(c){return c.type===Br.Bytes?c.readVarint()+c.pos:c.pos+1}function ur(c,n,h){return h?4294967296*n+(c>>>0):4294967296*(n>>>0)+(c>>>0)}function ya(c,n,h){var m=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));h.realloc(m);for(var v=h.pos-1;v>=c;v--)h.buf[v+m]=h.buf[v]}function ch(c,n){for(var h=0;h<c.length;h++)n.writeVarint(c[h])}function np(c,n){for(var h=0;h<c.length;h++)n.writeSVarint(c[h])}function sp(c,n){for(var h=0;h<c.length;h++)n.writeFloat(c[h])}function xa(c,n){for(var h=0;h<c.length;h++)n.writeDouble(c[h])}function Yl(c,n){for(var h=0;h<c.length;h++)n.writeBoolean(c[h])}function op(c,n){for(var h=0;h<c.length;h++)n.writeFixed32(c[h])}function td(c,n){for(var h=0;h<c.length;h++)n.writeSFixed32(c[h])}function id(c,n){for(var h=0;h<c.length;h++)n.writeFixed64(c[h])}function rd(c,n){for(var h=0;h<c.length;h++)n.writeSFixed64(c[h])}function yu(c,n){return(c[n]|c[n+1]<<8|c[n+2]<<16)+16777216*c[n+3]}function Jl(c,n,h){c[h]=n,c[h+1]=n>>>8,c[h+2]=n>>>16,c[h+3]=n>>>24}function ap(c,n){return(c[n]|c[n+1]<<8|c[n+2]<<16)+(c[n+3]<<24)}function nd(c,n,h){c===1&&h.readMessage(sd,n)}function sd(c,n,h){if(c===3){const{id:m,bitmap:v,width:S,height:i,left:t,top:o,advance:p}=h.readMessage(od,{});n.push({id:m,bitmap:new Vl({width:S+6,height:i+6},v),metrics:{width:S,height:i,left:t,top:o,advance:p}})}}function od(c,n,h){c===1?n.id=h.readVarint():c===2?n.bitmap=h.readBytes():c===3?n.width=h.readVarint():c===4?n.height=h.readVarint():c===5?n.left=h.readSVarint():c===6?n.top=h.readSVarint():c===7&&(n.advance=h.readVarint())}function Mc(c){let n=0,h=0;for(const i of c)n+=i.w*i.h,h=Math.max(h,i.w);c.sort((i,t)=>t.h-i.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),h),h:1/0}];let v=0,S=0;for(const i of c)for(let t=m.length-1;t>=0;t--){const o=m[t];if(!(i.w>o.w||i.h>o.h)){if(i.x=o.x,i.y=o.y,S=Math.max(S,i.y+i.h),v=Math.max(v,i.x+i.w),i.w===o.w&&i.h===o.h){const p=m.pop();t<m.length&&(m[t]=p)}else i.h===o.h?(o.x+=i.w,o.w-=i.w):i.w===o.w?(o.y+=i.h,o.h-=i.h):(m.push({x:o.x+i.w,y:o.y,w:o.w-i.w,h:i.h}),o.y+=i.h,o.h-=i.h);break}}return{w:v,h:S,fill:n/(v*S)||0}}Br.prototype={destroy:function(){this.buf=null},readFields:function(c,n,h){for(h=h||this.length;this.pos<h;){var m=this.readVarint(),v=m>>3,S=this.pos;this.type=7&m,c(v,n,this),this.pos===S&&this.skip(m)}return n},readMessage:function(c,n){return this.readFields(c,n,this.readVarint()+this.pos)},readFixed32:function(){var c=yu(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=ap(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=yu(this.buf,this.pos)+yu(this.buf,this.pos+4)*Dn;return this.pos+=8,c},readSFixed64:function(){var c=yu(this.buf,this.pos)+ap(this.buf,this.pos+4)*Dn;return this.pos+=8,c},readFloat:function(){var c=ah(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=ah(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var n,h,m=this.buf;return n=127&(h=m[this.pos++]),h<128?n:(n|=(127&(h=m[this.pos++]))<<7,h<128?n:(n|=(127&(h=m[this.pos++]))<<14,h<128?n:(n|=(127&(h=m[this.pos++]))<<21,h<128?n:function(v,S,i){var t,o,p=i.buf;if(t=(112&(o=p[i.pos++]))>>4,o<128||(t|=(127&(o=p[i.pos++]))<<3,o<128)||(t|=(127&(o=p[i.pos++]))<<10,o<128)||(t|=(127&(o=p[i.pos++]))<<17,o<128)||(t|=(127&(o=p[i.pos++]))<<24,o<128)||(t|=(1&(o=p[i.pos++]))<<31,o<128))return ur(v,t,S);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(h=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var c=this.readVarint()+this.pos,n=this.pos;return this.pos=c,c-n>=12&&lh?function(h,m,v){return lh.decode(h.subarray(m,v))}(this.buf,n,c):function(h,m,v){for(var S="",i=m;i<v;){var t,o,p,f=h[i],_=null,x=f>239?4:f>223?3:f>191?2:1;if(i+x>v)break;x===1?f<128&&(_=f):x===2?(192&(t=h[i+1]))==128&&(_=(31&f)<<6|63&t)<=127&&(_=null):x===3?(o=h[i+2],(192&(t=h[i+1]))==128&&(192&o)==128&&((_=(15&f)<<12|(63&t)<<6|63&o)<=2047||_>=55296&&_<=57343)&&(_=null)):x===4&&(o=h[i+2],p=h[i+3],(192&(t=h[i+1]))==128&&(192&o)==128&&(192&p)==128&&((_=(15&f)<<18|(63&t)<<12|(63&o)<<6|63&p)<=65535||_>=1114112)&&(_=null)),_===null?(_=65533,x=1):_>65535&&(_-=65536,S+=String.fromCharCode(_>>>10&1023|55296),_=56320|1023&_),S+=String.fromCharCode(_),i+=x}return S}(this.buf,n,c)},readBytes:function(){var c=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,c);return this.pos=c,n},readPackedVarint:function(c,n){if(this.type!==Br.Bytes)return c.push(this.readVarint(n));var h=Ro(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(n));return c},readPackedSVarint:function(c){if(this.type!==Br.Bytes)return c.push(this.readSVarint());var n=Ro(this);for(c=c||[];this.pos<n;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==Br.Bytes)return c.push(this.readBoolean());var n=Ro(this);for(c=c||[];this.pos<n;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==Br.Bytes)return c.push(this.readFloat());var n=Ro(this);for(c=c||[];this.pos<n;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==Br.Bytes)return c.push(this.readDouble());var n=Ro(this);for(c=c||[];this.pos<n;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==Br.Bytes)return c.push(this.readFixed32());var n=Ro(this);for(c=c||[];this.pos<n;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==Br.Bytes)return c.push(this.readSFixed32());var n=Ro(this);for(c=c||[];this.pos<n;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==Br.Bytes)return c.push(this.readFixed64());var n=Ro(this);for(c=c||[];this.pos<n;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==Br.Bytes)return c.push(this.readSFixed64());var n=Ro(this);for(c=c||[];this.pos<n;)c.push(this.readSFixed64());return c},skip:function(c){var n=7&c;if(n===Br.Varint)for(;this.buf[this.pos++]>127;);else if(n===Br.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Br.Fixed32)this.pos+=4;else{if(n!==Br.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(c,n){this.writeVarint(c<<3|n)},realloc:function(c){for(var n=this.length||16;n<this.pos+c;)n*=2;if(n!==this.length){var h=new Uint8Array(n);h.set(this.buf),this.buf=h,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Jl(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Jl(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Jl(this.buf,-1&c,this.pos),Jl(this.buf,Math.floor(c*_u),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Jl(this.buf,-1&c,this.pos),Jl(this.buf,Math.floor(c*_u),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(n,h){var m,v;if(n>=0?(m=n%4294967296|0,v=n/4294967296|0):(v=~(-n/4294967296),4294967295^(m=~(-n%4294967296))?m=m+1|0:(m=0,v=v+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,i,t){t.buf[t.pos++]=127&S|128,S>>>=7,t.buf[t.pos++]=127&S|128,S>>>=7,t.buf[t.pos++]=127&S|128,S>>>=7,t.buf[t.pos++]=127&S|128,t.buf[t.pos]=127&(S>>>=7)}(m,0,h),function(S,i){var t=(7&S)<<4;i.buf[i.pos++]|=t|((S>>>=3)?128:0),S&&(i.buf[i.pos++]=127&S|((S>>>=7)?128:0),S&&(i.buf[i.pos++]=127&S|((S>>>=7)?128:0),S&&(i.buf[i.pos++]=127&S|((S>>>=7)?128:0),S&&(i.buf[i.pos++]=127&S|((S>>>=7)?128:0),S&&(i.buf[i.pos++]=127&S)))))}(v,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(Boolean(c))},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var n=this.pos;this.pos=function(m,v,S){for(var i,t,o=0;o<v.length;o++){if((i=v.charCodeAt(o))>55295&&i<57344){if(!t){i>56319||o+1===v.length?(m[S++]=239,m[S++]=191,m[S++]=189):t=i;continue}if(i<56320){m[S++]=239,m[S++]=191,m[S++]=189,t=i;continue}i=t-55296<<10|i-56320|65536,t=null}else t&&(m[S++]=239,m[S++]=191,m[S++]=189,t=null);i<128?m[S++]=i:(i<2048?m[S++]=i>>6|192:(i<65536?m[S++]=i>>12|224:(m[S++]=i>>18|240,m[S++]=i>>12&63|128),m[S++]=i>>6&63|128),m[S++]=63&i|128)}return S}(this.buf,c,this.pos);var h=this.pos-n;h>=128&&ya(n,h,this),this.pos=n-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),rp(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),rp(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var n=c.length;this.writeVarint(n),this.realloc(n);for(var h=0;h<n;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,n){this.pos++;var h=this.pos;c(n,this);var m=this.pos-h;m>=128&&ya(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,n,h){this.writeTag(c,Br.Bytes),this.writeRawMessage(n,h)},writePackedVarint:function(c,n){n.length&&this.writeMessage(c,ch,n)},writePackedSVarint:function(c,n){n.length&&this.writeMessage(c,np,n)},writePackedBoolean:function(c,n){n.length&&this.writeMessage(c,Yl,n)},writePackedFloat:function(c,n){n.length&&this.writeMessage(c,sp,n)},writePackedDouble:function(c,n){n.length&&this.writeMessage(c,xa,n)},writePackedFixed32:function(c,n){n.length&&this.writeMessage(c,op,n)},writePackedSFixed32:function(c,n){n.length&&this.writeMessage(c,td,n)},writePackedFixed64:function(c,n){n.length&&this.writeMessage(c,id,n)},writePackedSFixed64:function(c,n){n.length&&this.writeMessage(c,rd,n)},writeBytesField:function(c,n){this.writeTag(c,Br.Bytes),this.writeBytes(n)},writeFixed32Field:function(c,n){this.writeTag(c,Br.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(c,n){this.writeTag(c,Br.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(c,n){this.writeTag(c,Br.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(c,n){this.writeTag(c,Br.Fixed64),this.writeSFixed64(n)},writeVarintField:function(c,n){this.writeTag(c,Br.Varint),this.writeVarint(n)},writeSVarintField:function(c,n){this.writeTag(c,Br.Varint),this.writeSVarint(n)},writeStringField:function(c,n){this.writeTag(c,Br.Bytes),this.writeString(n)},writeFloatField:function(c,n){this.writeTag(c,Br.Fixed32),this.writeFloat(n)},writeDoubleField:function(c,n){this.writeTag(c,Br.Fixed64),this.writeDouble(n)},writeBooleanField:function(c,n){this.writeVarintField(c,Boolean(n))}};class Ka{constructor(n,{pixelRatio:h,version:m,stretchX:v,stretchY:S,content:i}){this.paddedRect=n,this.pixelRatio=h,this.stretchX=v,this.stretchY=S,this.content=i,this.version=m}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class uh{constructor(n,h){const m={},v={};this.haveRenderCallbacks=[];const S=[];this.addImages(n,m,S),this.addImages(h,v,S);const{w:i,h:t}=Mc(S),o=new Ts({width:i||1,height:t||1});for(const p in n){const f=n[p],_=m[p].paddedRect;Ts.copy(f.data,o,{x:0,y:0},{x:_.x+1,y:_.y+1},f.data)}for(const p in h){const f=h[p],_=v[p].paddedRect,x=_.x+1,E=_.y+1,z=f.data.width,R=f.data.height;Ts.copy(f.data,o,{x:0,y:0},{x,y:E},f.data),Ts.copy(f.data,o,{x:0,y:R-1},{x,y:E-1},{width:z,height:1}),Ts.copy(f.data,o,{x:0,y:0},{x,y:E+R},{width:z,height:1}),Ts.copy(f.data,o,{x:z-1,y:0},{x:x-1,y:E},{width:1,height:R}),Ts.copy(f.data,o,{x:0,y:0},{x:x+z,y:E},{width:1,height:R})}this.image=o,this.iconPositions=m,this.patternPositions=v}addImages(n,h,m){for(const v in n){const S=n[v],i={x:0,y:0,w:S.data.width+2,h:S.data.height+2};m.push(i),h[v]=new Ka(i,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(n,h){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in n.updatedImages)this.patchUpdatedImage(this.iconPositions[m],n.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],n.getImage(m),h)}patchUpdatedImage(n,h,m){if(!n||!h||n.version===h.version)return;n.version=h.version;const[v,S]=n.tl;m.update(h.data,void 0,{x:v,y:S})}}Nt("ImagePosition",Ka),Nt("ImageAtlas",uh),l.WritingMode=void 0,($s=l.WritingMode||(l.WritingMode={}))[$s.none=0]="none",$s[$s.horizontal=1]="horizontal",$s[$s.vertical=2]="vertical",$s[$s.horizontalOnly=3]="horizontalOnly";const xu=-17;class Dc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,h){const m=new Dc;return m.scale=n||1,m.fontStack=h,m}static forImage(n){const h=new Dc;return h.imageName=n,h}}class $l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,h){const m=new $l;for(let v=0;v<n.sections.length;v++){const S=n.sections[v];S.image?m.addImageSection(S):m.addTextSection(S,h)}return m}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let h="";for(let m=0;m<n.length;m++){const v=n.charCodeAt(m+1)||null,S=n.charCodeAt(m-1)||null;h+=v&&Oa(v)&&!Pc[n[m+1]]||S&&Oa(S)&&!Pc[n[m-1]]||!Pc[n[m]]?n[m]:Pc[n[m]]}return h}(this.text)}trim(){let n=0;for(let m=0;m<this.text.length&&Ql[this.text.charCodeAt(m)];m++)n++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=n&&Ql[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(n,h),this.sectionIndex=this.sectionIndex.slice(n,h)}substring(n,h){const m=new $l;return m.text=this.text.substring(n,h),m.sectionIndex=this.sectionIndex.slice(n,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,h)=>Math.max(n,this.sections[h].scale),0)}addTextSection(n,h){this.text+=n.text,this.sections.push(Dc.forText(n.scale,n.fontStack||h));const m=this.sections.length-1;for(let v=0;v<n.text.length;++v)this.sectionIndex.push(m)}addImageSection(n){const h=n.image?n.image.name:"";if(h.length===0)return void nt("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(Dc.forImage(h)),this.sectionIndex.push(this.sections.length-1)):nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Lc(c,n,h,m,v,S,i,t,o,p,f,_,x,E,z,R){const V=$l.fromFeature(c,v);let q;_===l.WritingMode.vertical&&V.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:Y}=Gn;if(X&&V.sections.length===1){q=[];const de=X(V.toString(),hh(V,p,S,n,m,E,z));for(const Te of de){const Pe=new $l;Pe.text=Te,Pe.sections=V.sections;for(let Ee=0;Ee<Te.length;Ee++)Pe.sectionIndex.push(0);q.push(Pe)}}else if(Y){q=[];const de=Y(V.text,V.sectionIndex,hh(V,p,S,n,m,E,z));for(const Te of de){const Pe=new $l;Pe.text=Te[0],Pe.sectionIndex=Te[1],Pe.sections=V.sections,q.push(Pe)}}else q=function(de,Te){const Pe=[],Ee=de.text;let Me=0;for(const Le of Te)Pe.push(de.substring(Me,Le)),Me=Le;return Me<Ee.length&&Pe.push(de.substring(Me,Ee.length)),Pe}(V,hh(V,p,S,n,m,E,z));const Q=[],fe={positionedLines:Q,text:V.toString(),top:f[1],bottom:f[1],left:f[0],right:f[0],writingMode:_,iconsInText:!1,verticalizable:!1};return function(de,Te,Pe,Ee,Me,Le,Ue,He,Ge,tt,et,ht){let Tt=0,St=xu,pt=0,Xt=0;const Ot=He==="right"?1:He==="left"?0:.5;let ni=0;for(const Wi of Me){Wi.trim();const ir=Wi.getMaxScale(),hr=(ir-1)*Fn,Sr={positionedGlyphs:[],lineOffset:0};de.positionedLines[ni]=Sr;const Rr=Sr.positionedGlyphs;let Zr=0;if(!Wi.length()){St+=Le,++ni;continue}for(let ar=0;ar<Wi.length();ar++){const mi=Wi.getSection(ar),Xr=Wi.getSectionIndex(ar),Pr=Wi.getCharCode(ar);let Fr=0,lr=null,Ur=null,zi=null,An=Fn;const Wr=!(Ge===l.WritingMode.horizontal||!et&&!Co(Pr)||et&&(Ql[Pr]||(Ei=Pr,Rt.Arabic(Ei)||Rt["Arabic Supplement"](Ei)||Rt["Arabic Extended-A"](Ei)||Rt["Arabic Presentation Forms-A"](Ei)||Rt["Arabic Presentation Forms-B"](Ei))));if(mi.imageName){const Hr=Ee[mi.imageName];if(!Hr)continue;zi=mi.imageName,de.iconsInText=de.iconsInText||!0,Ur=Hr.paddedRect;const sn=Hr.displaySize;mi.scale=mi.scale*Fn/ht,lr={width:sn[0],height:sn[1],left:1,top:-3,advance:Wr?sn[1]:sn[0]},Fr=hr+(Fn-sn[1]*mi.scale),An=lr.advance;const On=Wr?sn[0]*mi.scale-Fn*ir:sn[1]*mi.scale-Fn*ir;On>0&&On>Zr&&(Zr=On)}else{const Hr=Pe[mi.fontStack],sn=Hr&&Hr[Pr];if(sn&&sn.rect)Ur=sn.rect,lr=sn.metrics;else{const On=Te[mi.fontStack],cs=On&&On[Pr];if(!cs)continue;lr=cs.metrics}Fr=(ir-mi.scale)*Fn}Wr?(de.verticalizable=!0,Rr.push({glyph:Pr,imageName:zi,x:Tt,y:St+Fr,vertical:Wr,scale:mi.scale,fontStack:mi.fontStack,sectionIndex:Xr,metrics:lr,rect:Ur}),Tt+=An*mi.scale+tt):(Rr.push({glyph:Pr,imageName:zi,x:Tt,y:St+Fr,vertical:Wr,scale:mi.scale,fontStack:mi.fontStack,sectionIndex:Xr,metrics:lr,rect:Ur}),Tt+=lr.advance*mi.scale+tt)}Rr.length!==0&&(pt=Math.max(Tt-tt,pt),cp(Rr,0,Rr.length-1,Ot,Zr)),Tt=0;const Bi=Le*ir+Zr;Sr.lineOffset=Math.max(Zr,hr),St+=Bi,Xt=Math.max(Bi,Xt),++ni}var Ei;const ji=St-xu,{horizontalAlign:Xi,verticalAlign:Cr}=vu(Ue);(function(Wi,ir,hr,Sr,Rr,Zr,Bi,ar,mi){const Xr=(ir-hr)*Rr;let Pr=0;Pr=Zr!==Bi?-ar*Sr-xu:(-Sr*mi+.5)*Bi;for(const Fr of Wi)for(const lr of Fr.positionedGlyphs)lr.x+=Xr,lr.y+=Pr})(de.positionedLines,Ot,Xi,Cr,pt,Xt,Le,ji,Me.length),de.top+=-Cr*ji,de.bottom=de.top+ji,de.left+=-Xi*pt,de.right=de.left+pt}(fe,n,h,m,q,i,t,o,_,p,x,R),!function(de){for(const Te of de)if(Te.positionedGlyphs.length!==0)return!1;return!0}(Q)&&fe}const Ql={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Bc(c,n,h,m,v,S){if(n.imageName){const i=m[n.imageName];return i?i.displaySize[0]*n.scale*Fn/S+v:0}{const i=h[n.fontStack],t=i&&i[c];return t?t.metrics.advance*n.scale+v:0}}function ec(c,n,h,m){const v=Math.pow(c-n,2);return m?c<n?v/2:2*v:v+Math.abs(h)*h}function tc(c,n,h){let m=0;return c===10&&(m-=1e4),h&&(m+=150),c!==40&&c!==65288||(m+=50),n!==41&&n!==65289||(m+=50),m}function Rc(c,n,h,m,v,S){let i=null,t=ec(n,h,v,S);for(const o of m){const p=ec(n-o.x,h,v,S)+o.badness;p<=t&&(i=o,t=p)}return{index:c,x:n,priorBreak:i,badness:t}}function Fc(c){return c?Fc(c.priorBreak).concat(c.index):[]}function hh(c,n,h,m,v,S,i){if(S!=="point")return[];if(!c)return[];const t=[],o=function(x,E,z,R,V,q){let X=0;for(let Y=0;Y<x.length();Y++){const Q=x.getSection(Y);X+=Bc(x.getCharCode(Y),Q,R,V,E,q)}return X/Math.max(1,Math.ceil(X/z))}(c,n,h,m,v,i),p=c.text.indexOf("\u200B")>=0;let f=0;for(let x=0;x<c.length();x++){const E=c.getSection(x),z=c.getCharCode(x);if(Ql[z]||(f+=Bc(z,E,m,v,n,i)),x<c.length()-1){const R=!((_=z)<11904||!(Rt["Bopomofo Extended"](_)||Rt.Bopomofo(_)||Rt["CJK Compatibility Forms"](_)||Rt["CJK Compatibility Ideographs"](_)||Rt["CJK Compatibility"](_)||Rt["CJK Radicals Supplement"](_)||Rt["CJK Strokes"](_)||Rt["CJK Symbols and Punctuation"](_)||Rt["CJK Unified Ideographs Extension A"](_)||Rt["CJK Unified Ideographs"](_)||Rt["Enclosed CJK Letters and Months"](_)||Rt["Halfwidth and Fullwidth Forms"](_)||Rt.Hiragana(_)||Rt["Ideographic Description Characters"](_)||Rt["Kangxi Radicals"](_)||Rt["Katakana Phonetic Extensions"](_)||Rt.Katakana(_)||Rt["Vertical Forms"](_)||Rt["Yi Radicals"](_)||Rt["Yi Syllables"](_)));(lp[z]||R||E.imageName)&&t.push(Rc(x+1,f,o,t,tc(z,c.getCharCode(x+1),R&&p),!1))}}var _;return Fc(Rc(c.length(),f,o,t,0,!0))}function vu(c){let n=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:n,verticalAlign:h}}function cp(c,n,h,m,v){if(!m&&!v)return;const S=c[h],i=(c[h].x+S.metrics.advance*S.scale)*m;for(let t=n;t<=h;t++)c[t].x-=i,c[t].y+=v}function ad(c,n,h){const{horizontalAlign:m,verticalAlign:v}=vu(h),S=n[0]-c.displaySize[0]*m,i=n[1]-c.displaySize[1]*v;return{image:c,top:i,bottom:i+c.displaySize[1],left:S,right:S+c.displaySize[0]}}function ph(c,n,h,m,v,S){const i=c.image;let t;if(i.content){const V=i.content,q=i.pixelRatio||1;t=[V[0]/q,V[1]/q,i.displaySize[0]-V[2]/q,i.displaySize[1]-V[3]/q]}const o=n.left*S,p=n.right*S;let f,_,x,E;h==="width"||h==="both"?(E=v[0]+o-m[3],_=v[0]+p+m[1]):(E=v[0]+(o+p-i.displaySize[0])/2,_=E+i.displaySize[0]);const z=n.top*S,R=n.bottom*S;return h==="height"||h==="both"?(f=v[1]+z-m[0],x=v[1]+R+m[2]):(f=v[1]+(z+R-i.displaySize[1])/2,x=f+i.displaySize[1]),{image:i,top:f,right:_,bottom:x,left:E,collisionPadding:t}}const Fo=128;function bu(c,n){const{expression:h}=n;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Ki(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:v}=h;let S=0;for(;S<m.length&&m[S]<=c;)S++;S=Math.max(0,S-1);let i=S;for(;i<m.length&&m[i]<c+1;)i++;i=Math.min(m.length-1,i);const t=m[S],o=m[i];return h.kind==="composite"?{kind:"composite",minZoom:t,maxZoom:o,interpolationType:v}:{kind:"camera",minZoom:t,maxZoom:o,minSize:h.evaluate(new Ki(t)),maxSize:h.evaluate(new Ki(o)),interpolationType:v}}}class Oo extends De{constructor(n,h,m,v){super(n,h),this.angle=m,v!==void 0&&(this.segment=v)}clone(){return new Oo(this.x,this.y,this.angle,this.segment)}}function up(c,n,h,m,v){if(n.segment===void 0)return!0;let S=n,i=n.segment+1,t=0;for(;t>-h/2;){if(i--,i<0)return!1;t-=c[i].dist(S),S=c[i]}t+=c[i].dist(c[i+1]),i++;const o=[];let p=0;for(;t<h/2;){const f=c[i],_=c[i+1];if(!_)return!1;let x=c[i-1].angleTo(f)-f.angleTo(_);for(x=Math.abs((x+3*Math.PI)%(2*Math.PI)-Math.PI),o.push({distance:t,angleDelta:x}),p+=x;t-o[0].distance>m;)p-=o.shift().angleDelta;if(p>v)return!1;i++,t+=f.dist(_)}return!0}function hp(c){let n=0;for(let h=0;h<c.length-1;h++)n+=c[h].dist(c[h+1]);return n}function dh(c,n,h){return c?.6*n*h:0}function Uo(c,n){return Math.max(c?c.right-c.left:0,n?n.right-n.left:0)}function pp(c,n,h,m,v,S){const i=dh(h,v,S),t=Uo(h,m)*S;let o=0;const p=hp(c)/2;for(let f=0;f<c.length-1;f++){const _=c[f],x=c[f+1],E=_.dist(x);if(o+E>p){const z=(p-o)/E,R=rn(_.x,x.x,z),V=rn(_.y,x.y,z),q=new Oo(R,V,x.angleTo(_),f);return q._round(),!i||up(c,q,t,i,n)?q:void 0}o+=E}}function Ya(c,n,h,m,v,S,i,t,o){const p=dh(m,S,i),f=Uo(m,v),_=f*i,x=c[0].x===0||c[0].x===o||c[0].y===0||c[0].y===o;return n-_<n/4&&(n=_+n/4),fh(c,x?n/2*t%n:(f/2+2*S)*i*t%n,n,p,h,_,x,!1,o)}function fh(c,n,h,m,v,S,i,t,o){const p=S/2,f=hp(c);let _=0,x=n-h,E=[];for(let z=0;z<c.length-1;z++){const R=c[z],V=c[z+1],q=R.dist(V),X=V.angleTo(R);for(;x+h<_+q;){x+=h;const Y=(x-_)/q,Q=rn(R.x,V.x,Y),fe=rn(R.y,V.y,Y);if(Q>=0&&Q<o&&fe>=0&&fe<o&&x-p>=0&&x+p<=f){const de=new Oo(Q,fe,X,z);de._round(),m&&!up(c,de,S,m,v)||E.push(de)}}_+=q}return t||E.length||i||(E=fh(c,_/2,h,m,v,S,i,!0,o)),E}function mh(c,n,h,m,v){const S=[];for(let i=0;i<c.length;i++){const t=c[i];let o;for(let p=0;p<t.length-1;p++){let f=t[p],_=t[p+1];f.x<n&&_.x<n||(f.x<n?f=new De(n,f.y+(n-f.x)/(_.x-f.x)*(_.y-f.y))._round():_.x<n&&(_=new De(n,f.y+(n-f.x)/(_.x-f.x)*(_.y-f.y))._round()),f.y<h&&_.y<h||(f.y<h?f=new De(f.x+(h-f.y)/(_.y-f.y)*(_.x-f.x),h)._round():_.y<h&&(_=new De(f.x+(h-f.y)/(_.y-f.y)*(_.x-f.x),h)._round()),f.x>=m&&_.x>=m||(f.x>=m?f=new De(m,f.y+(m-f.x)/(_.x-f.x)*(_.y-f.y))._round():_.x>=m&&(_=new De(m,f.y+(m-f.x)/(_.x-f.x)*(_.y-f.y))._round()),f.y>=v&&_.y>=v||(f.y>=v?f=new De(f.x+(v-f.y)/(_.y-f.y)*(_.x-f.x),v)._round():_.y>=v&&(_=new De(f.x+(v-f.y)/(_.y-f.y)*(_.x-f.x),v)._round()),o&&f.equals(o[o.length-1])||(o=[f],S.push(o)),o.push(_)))))}}return S}function gh(c,n,h,m){const v=[],S=c.image,i=S.pixelRatio,t=S.paddedRect.w-2,o=S.paddedRect.h-2,p=c.right-c.left,f=c.bottom-c.top,_=S.stretchX||[[0,t]],x=S.stretchY||[[0,o]],E=(Le,Ue)=>Le+Ue[1]-Ue[0],z=_.reduce(E,0),R=x.reduce(E,0),V=t-z,q=o-R;let X=0,Y=z,Q=0,fe=R,de=0,Te=V,Pe=0,Ee=q;if(S.content&&m){const Le=S.content;X=Oc(_,0,Le[0]),Q=Oc(x,0,Le[1]),Y=Oc(_,Le[0],Le[2]),fe=Oc(x,Le[1],Le[3]),de=Le[0]-X,Pe=Le[1]-Q,Te=Le[2]-Le[0]-Y,Ee=Le[3]-Le[1]-fe}const Me=(Le,Ue,He,Ge)=>{const tt=wu(Le.stretch-X,Y,p,c.left),et=Uc(Le.fixed-de,Te,Le.stretch,z),ht=wu(Ue.stretch-Q,fe,f,c.top),Tt=Uc(Ue.fixed-Pe,Ee,Ue.stretch,R),St=wu(He.stretch-X,Y,p,c.left),pt=Uc(He.fixed-de,Te,He.stretch,z),Xt=wu(Ge.stretch-Q,fe,f,c.top),Ot=Uc(Ge.fixed-Pe,Ee,Ge.stretch,R),ni=new De(tt,ht),Ei=new De(St,ht),ji=new De(St,Xt),Xi=new De(tt,Xt),Cr=new De(et/i,Tt/i),Wi=new De(pt/i,Ot/i),ir=n*Math.PI/180;if(ir){const Rr=Math.sin(ir),Zr=Math.cos(ir),Bi=[Zr,-Rr,Rr,Zr];ni._matMult(Bi),Ei._matMult(Bi),Xi._matMult(Bi),ji._matMult(Bi)}const hr=Le.stretch+Le.fixed,Sr=Ue.stretch+Ue.fixed;return{tl:ni,tr:Ei,bl:Xi,br:ji,tex:{x:S.paddedRect.x+1+hr,y:S.paddedRect.y+1+Sr,w:He.stretch+He.fixed-hr,h:Ge.stretch+Ge.fixed-Sr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cr,pixelOffsetBR:Wi,minFontScaleX:Te/i/p,minFontScaleY:Ee/i/f,isSDF:h}};if(m&&(S.stretchX||S.stretchY)){const Le=dp(_,V,z),Ue=dp(x,q,R);for(let He=0;He<Le.length-1;He++){const Ge=Le[He],tt=Le[He+1];for(let et=0;et<Ue.length-1;et++)v.push(Me(Ge,Ue[et],tt,Ue[et+1]))}}else v.push(Me({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:t+1},{fixed:0,stretch:o+1}));return v}function Oc(c,n,h){let m=0;for(const v of c)m+=Math.max(n,Math.min(h,v[1]))-Math.max(n,Math.min(h,v[0]));return m}function dp(c,n,h){const m=[{fixed:-1,stretch:0}];for(const[v,S]of c){const i=m[m.length-1];m.push({fixed:v-i.stretch,stretch:i.stretch}),m.push({fixed:v-i.stretch,stretch:i.stretch+(S-v)})}return m.push({fixed:n+1,stretch:h}),m}function wu(c,n,h,m){return c/n*h+m}function Uc(c,n,h,m){return c-n*h/m}Nt("Anchor",Oo);class Vc{constructor(n,h,m,v,S,i,t,o,p,f){if(this.boxStartIndex=n.length,p){let _=i.top,x=i.bottom;const E=i.collisionPadding;E&&(_-=E[1],x+=E[3]);let z=x-_;z>0&&(z=Math.max(10,z),this.circleDiameter=z)}else{let _=i.top*t-o,x=i.bottom*t+o,E=i.left*t-o,z=i.right*t+o;const R=i.collisionPadding;if(R&&(E-=R[0]*t,_-=R[1]*t,z+=R[2]*t,x+=R[3]*t),f){const V=new De(E,_),q=new De(z,_),X=new De(E,x),Y=new De(z,x),Q=f*Math.PI/180;V._rotate(Q),q._rotate(Q),X._rotate(Q),Y._rotate(Q),E=Math.min(V.x,q.x,X.x,Y.x),z=Math.max(V.x,q.x,X.x,Y.x),_=Math.min(V.y,q.y,X.y,Y.y),x=Math.max(V.y,q.y,X.y,Y.y)}n.emplaceBack(h.x,h.y,E,_,z,x,m,v,S)}this.boxEndIndex=n.length}}class fp{constructor(n=[],h=Tu){if(this.data=n,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:h,compare:m}=this,v=h[n];for(;n>0;){const S=n-1>>1,i=h[S];if(m(v,i)>=0)break;h[n]=i,n=S}h[n]=v}_down(n){const{data:h,compare:m}=this,v=this.length>>1,S=h[n];for(;n<v;){let i=1+(n<<1),t=h[i];const o=i+1;if(o<this.length&&m(h[o],t)<0&&(i=o,t=h[o]),m(t,S)>=0)break;h[n]=t,n=i}h[n]=S}}function Tu(c,n){return c<n?-1:c>n?1:0}function mp(c,n=1,h=!1){let m=1/0,v=1/0,S=-1/0,i=-1/0;const t=c[0];for(let E=0;E<t.length;E++){const z=t[E];(!E||z.x<m)&&(m=z.x),(!E||z.y<v)&&(v=z.y),(!E||z.x>S)&&(S=z.x),(!E||z.y>i)&&(i=z.y)}const o=Math.min(S-m,i-v);let p=o/2;const f=new fp([],Iu);if(o===0)return new De(m,v);for(let E=m;E<S;E+=o)for(let z=v;z<i;z+=o)f.push(new va(E+p,z+p,p,c));let _=function(E){let z=0,R=0,V=0;const q=E[0];for(let X=0,Y=q.length,Q=Y-1;X<Y;Q=X++){const fe=q[X],de=q[Q],Te=fe.x*de.y-de.x*fe.y;R+=(fe.x+de.x)*Te,V+=(fe.y+de.y)*Te,z+=3*Te}return new va(R/z,V/z,0,E)}(c),x=f.length;for(;f.length;){const E=f.pop();(E.d>_.d||!_.d)&&(_=E,h&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,x)),E.max-_.d<=n||(p=E.h/2,f.push(new va(E.p.x-p,E.p.y-p,p,c)),f.push(new va(E.p.x+p,E.p.y-p,p,c)),f.push(new va(E.p.x-p,E.p.y+p,p,c)),f.push(new va(E.p.x+p,E.p.y+p,p,c)),x+=4)}return h&&(console.log(`num probes: ${x}`),console.log(`best distance: ${_.d}`)),_.p}function Iu(c,n){return n.max-c.max}function va(c,n,h,m){this.p=new De(c,n),this.h=h,this.d=function(v,S){let i=!1,t=1/0;for(let o=0;o<S.length;o++){const p=S[o];for(let f=0,_=p.length,x=_-1;f<_;x=f++){const E=p[f],z=p[x];E.y>v.y!=z.y>v.y&&v.x<(z.x-E.x)*(v.y-E.y)/(z.y-E.y)+E.x&&(i=!i),t=Math.min(t,ou(v,E,z))}}return(i?1:-1)*Math.sqrt(t)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}const ic=Number.POSITIVE_INFINITY;function gp(c,n){return n[1]!==ic?function(h,m,v){let S=0,i=0;switch(m=Math.abs(m),v=Math.abs(v),h){case"top-right":case"top-left":case"top":i=v-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-v}switch(h){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,i]}(c,n[0],n[1]):function(h,m){let v=0,S=0;m<0&&(m=0);const i=m/Math.sqrt(2);switch(h){case"top-right":case"top-left":S=i-7;break;case"bottom-right":case"bottom-left":S=7-i;break;case"bottom":S=7-m;break;case"top":S=m-7}switch(h){case"top-right":case"bottom-right":v=-i;break;case"top-left":case"bottom-left":v=i;break;case"left":v=m;break;case"right":v=-m}return[v,S]}(c,n[0])}function _h(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ld(c,n,h,m,v,S,i,t,o,p,f){let _=S.textMaxSize.evaluate(n,{});_===void 0&&(_=i);const x=c.layers[0].layout,E=x.get("icon-offset").evaluate(n,{},f),z=Su(h.horizontal),R=i/24,V=c.tilePixelRatio*R,q=c.tilePixelRatio*_/24,X=c.tilePixelRatio*t,Y=c.tilePixelRatio*x.get("symbol-spacing"),Q=x.get("text-padding")*c.tilePixelRatio,fe=x.get("icon-padding")*c.tilePixelRatio,de=x.get("text-max-angle")/180*Math.PI,Te=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point",Pe=x.get("icon-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point",Ee=x.get("symbol-placement"),Me=Y/2,Le=x.get("icon-text-fit");let Ue;m&&Le!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(Ue=ph(m,h.vertical,Le,x.get("icon-text-fit-padding"),E,R)),z&&(m=ph(m,z,Le,x.get("icon-text-fit-padding"),E,R)));const He=(Ge,tt)=>{tt.x<0||tt.x>=En||tt.y<0||tt.y>=En||function(et,ht,Tt,St,pt,Xt,Ot,ni,Ei,ji,Xi,Cr,Wi,ir,hr,Sr,Rr,Zr,Bi,ar,mi,Xr,Pr,Fr,lr){const Ur=et.addToLineVertexArray(ht,Tt);let zi,An,Wr,Hr,sn=0,On=0,cs=0,Vo=0,Ss=-1,us=-1;const vn={};let No=Lr(""),Cl=0,Lu=0;if(ni._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Cl,Lu]=ni.layout.get("text-offset").evaluate(mi,{},Fr).map(hs=>hs*Fn):(Cl=ni.layout.get("text-radial-offset").evaluate(mi,{},Fr)*Fn,Lu=ic),et.allowVerticalPlacement&&St.vertical){const hs=ni.layout.get("text-rotate").evaluate(mi,{},Fr)+90;Wr=new Vc(Ei,ht,ji,Xi,Cr,St.vertical,Wi,ir,hr,hs),Ot&&(Hr=new Vc(Ei,ht,ji,Xi,Cr,Ot,Rr,Zr,hr,hs))}if(pt){const hs=ni.layout.get("icon-rotate").evaluate(mi,{}),jo=ni.layout.get("icon-text-fit")!=="none",Xc=gh(pt,hs,Pr,jo),ps=Ot?gh(Ot,hs,Pr,jo):void 0;An=new Vc(Ei,ht,ji,Xi,Cr,pt,Rr,Zr,!1,hs),sn=4*Xc.length;const Wc=et.iconSizeData;let $a=null;Wc.kind==="source"?($a=[Fo*ni.layout.get("icon-size").evaluate(mi,{})],$a[0]>Ja&&nt(`${et.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Wc.kind==="composite"&&($a=[Fo*Xr.compositeIconSizes[0].evaluate(mi,{},Fr),Fo*Xr.compositeIconSizes[1].evaluate(mi,{},Fr)],($a[0]>Ja||$a[1]>Ja)&&nt(`${et.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),et.addSymbols(et.icon,Xc,$a,ar,Bi,mi,l.WritingMode.none,ht,Ur.lineStartIndex,Ur.lineLength,-1,Fr),Ss=et.icon.placedSymbolArray.length-1,ps&&(On=4*ps.length,et.addSymbols(et.icon,ps,$a,ar,Bi,mi,l.WritingMode.vertical,ht,Ur.lineStartIndex,Ur.lineLength,-1,Fr),us=et.icon.placedSymbolArray.length-1)}const Bu=Object.keys(St.horizontal);for(const hs of Bu){const jo=St.horizontal[hs];if(!zi){No=Lr(jo.text);const ps=ni.layout.get("text-rotate").evaluate(mi,{},Fr);zi=new Vc(Ei,ht,ji,Xi,Cr,jo,Wi,ir,hr,ps)}const Xc=jo.positionedLines.length===1;if(cs+=Al(et,ht,jo,Xt,ni,hr,mi,Sr,Ur,St.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,Xc?Bu:[hs],vn,Ss,Xr,Fr),Xc)break}St.vertical&&(Vo+=Al(et,ht,St.vertical,Xt,ni,hr,mi,Sr,Ur,l.WritingMode.vertical,["vertical"],vn,us,Xr,Fr));const Ah=zi?zi.boxStartIndex:et.collisionBoxArray.length,wa=zi?zi.boxEndIndex:et.collisionBoxArray.length,Ep=Wr?Wr.boxStartIndex:et.collisionBoxArray.length,kh=Wr?Wr.boxEndIndex:et.collisionBoxArray.length,zh=An?An.boxStartIndex:et.collisionBoxArray.length,Ap=An?An.boxEndIndex:et.collisionBoxArray.length,hd=Hr?Hr.boxStartIndex:et.collisionBoxArray.length,pd=Hr?Hr.boxEndIndex:et.collisionBoxArray.length;let po=-1;const Ru=(hs,jo)=>hs&&hs.circleDiameter?Math.max(hs.circleDiameter,jo):jo;po=Ru(zi,po),po=Ru(Wr,po),po=Ru(An,po),po=Ru(Hr,po);const kp=po>-1?1:0;kp&&(po*=lr/Fn),et.glyphOffsetArray.length>=rc.MAX_GLYPHS&&nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),mi.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,mi.sortKey),et.symbolInstances.emplaceBack(ht.x,ht.y,vn.right>=0?vn.right:-1,vn.center>=0?vn.center:-1,vn.left>=0?vn.left:-1,vn.vertical||-1,Ss,us,No,Ah,wa,Ep,kh,zh,Ap,hd,pd,ji,cs,Vo,sn,On,kp,0,Wi,Cl,Lu,po)}(c,tt,Ge,h,m,v,Ue,c.layers[0],c.collisionBoxArray,n.index,n.sourceLayerIndex,c.index,V,Q,Te,o,X,fe,Pe,E,n,S,p,f,i)};if(Ee==="line")for(const Ge of mh(n.geometry,0,0,En,En)){const tt=Ya(Ge,Y,de,h.vertical||z,m,24,q,c.overscaling,En);for(const et of tt){const ht=z;ht&&_p(c,ht.text,Me,et)||He(Ge,et)}}else if(Ee==="line-center"){for(const Ge of n.geometry)if(Ge.length>1){const tt=pp(Ge,de,h.vertical||z,m,24,q);tt&&He(Ge,tt)}}else if(n.type==="Polygon")for(const Ge of zc(n.geometry,0)){const tt=mp(Ge,16);He(Ge[0],new Oo(tt.x,tt.y,0))}else if(n.type==="LineString")for(const Ge of n.geometry)He(Ge,new Oo(Ge[0].x,Ge[0].y,0));else if(n.type==="Point")for(const Ge of n.geometry)for(const tt of Ge)He([tt],new Oo(tt.x,tt.y,0))}const Ja=32640;function Al(c,n,h,m,v,S,i,t,o,p,f,_,x,E,z){const R=function(X,Y,Q,fe,de,Te,Pe,Ee){const Me=fe.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,Le=[];for(const Ue of Y.positionedLines)for(const He of Ue.positionedGlyphs){if(!He.rect)continue;const Ge=He.rect||{};let tt=4,et=!0,ht=1,Tt=0;const St=(de||Ee)&&He.vertical,pt=He.metrics.advance*He.scale/2;if(Ee&&Y.verticalizable){const Bi=(He.scale-1)*Fn,ar=(Fn-He.metrics.width*He.scale)/2;Tt=Ue.lineOffset/2-(He.imageName?-ar:Bi)}if(He.imageName){const Bi=Pe[He.imageName];et=Bi.sdf,ht=Bi.pixelRatio,tt=1/ht}const Xt=de?[He.x+pt,He.y]:[0,0];let Ot=de?[0,0]:[He.x+pt+Q[0],He.y+Q[1]-Tt],ni=[0,0];St&&(ni=Ot,Ot=[0,0]);const Ei=(He.metrics.left-tt)*He.scale-pt+Ot[0],ji=(-He.metrics.top-tt)*He.scale+Ot[1],Xi=Ei+Ge.w*He.scale/ht,Cr=ji+Ge.h*He.scale/ht,Wi=new De(Ei,ji),ir=new De(Xi,ji),hr=new De(Ei,Cr),Sr=new De(Xi,Cr);if(St){const Bi=new De(-pt,pt-xu),ar=-Math.PI/2,mi=12-pt,Xr=new De(22-mi,-(He.imageName?mi:0)),Pr=new De(...ni);Wi._rotateAround(ar,Bi)._add(Xr)._add(Pr),ir._rotateAround(ar,Bi)._add(Xr)._add(Pr),hr._rotateAround(ar,Bi)._add(Xr)._add(Pr),Sr._rotateAround(ar,Bi)._add(Xr)._add(Pr)}if(Me){const Bi=Math.sin(Me),ar=Math.cos(Me),mi=[ar,-Bi,Bi,ar];Wi._matMult(mi),ir._matMult(mi),hr._matMult(mi),Sr._matMult(mi)}const Rr=new De(0,0),Zr=new De(0,0);Le.push({tl:Wi,tr:ir,bl:hr,br:Sr,tex:Ge,writingMode:Y.writingMode,glyphOffset:Xt,sectionIndex:He.sectionIndex,isSDF:et,pixelOffsetTL:Rr,pixelOffsetBR:Zr,minFontScaleX:0,minFontScaleY:0})}return Le}(0,h,t,v,S,i,m,c.allowVerticalPlacement),V=c.textSizeData;let q=null;V.kind==="source"?(q=[Fo*v.layout.get("text-size").evaluate(i,{})],q[0]>Ja&&nt(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):V.kind==="composite"&&(q=[Fo*E.compositeTextSizes[0].evaluate(i,{},z),Fo*E.compositeTextSizes[1].evaluate(i,{},z)],(q[0]>Ja||q[1]>Ja)&&nt(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,R,q,t,S,i,p,n,o.lineStartIndex,o.lineLength,x,z);for(const X of f)_[X]=c.text.placedSymbolArray.length-1;return 4*R.length}function Su(c){for(const n in c)return c[n];return null}function _p(c,n,h,m){const v=c.compareText;if(n in v){const S=v[n];for(let i=S.length-1;i>=0;i--)if(m.dist(S[i])<h)return!0}else v[n]=[];return v[n].push(m),!1}const yh=Bo.VectorTileFeature.types,cd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ho(c,n,h,m,v,S,i,t,o,p,f,_,x){const E=t?Math.min(Ja,Math.round(t[0])):0,z=t?Math.min(Ja,Math.round(t[1])):0;c.emplaceBack(n,h,Math.round(32*m),Math.round(32*v),S,i,(E<<1)+(o?1:0),z,16*p,16*f,256*_,256*x)}function Eu(c,n,h){c.emplaceBack(n.x,n.y,h),c.emplaceBack(n.x,n.y,h),c.emplaceBack(n.x,n.y,h),c.emplaceBack(n.x,n.y,h)}function yp(c){for(const n of c.sections)if(vc(n.text))return!0;return!1}class xh{constructor(n){this.layoutVertexArray=new xi,this.indexArray=new qr,this.programConfigurations=n,this.segments=new Ri,this.dynamicLayoutVertexArray=new vi,this.opacityVertexArray=new Gi,this.placedSymbolArray=new be}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,h,m,v){this.isEmpty()||(m&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ep.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,nh.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,cd,!0),this.opacityVertexBuffer.itemSize=1),(m||v)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Nt("SymbolBuffers",xh);class vh{constructor(n,h,m){this.layoutVertexArray=new n,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Ri,this.collisionVertexArray=new Pn}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,ed.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Nt("CollisionBuffers",vh);class rc{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(i=>i.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Nn([]),this.placementViewportMatrix=Nn([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bu(this.zoom,h["text-size"]),this.iconSizeData=bu(this.zoom,h["icon-size"]);const m=this.layers[0].layout,v=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.canOverlap=jc(m,"text-overlap","text-allow-overlap")!=="never"||jc(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(i=>l.WritingMode[i])),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.sourceID=n.sourceID}createArrays(){this.text=new xh(new qa(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new xh(new qa(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Ne,this.lineVertexArray=new Ce,this.symbolInstances=new we}calculateGlyphDependencies(n,h,m,v,S){for(let i=0;i<n.length;i++)if(h[n.charCodeAt(i)]=!0,(m||v)&&S){const t=Pc[n.charAt(i)];t&&(h[t.charCodeAt(0)]=!0)}}populate(n,h,m){const v=this.layers[0],S=v.layout,i=S.get("text-font"),t=S.get("text-field"),o=S.get("icon-image"),p=(t.value.kind!=="constant"||t.value.value instanceof te&&!t.value.value.isEmpty()||t.value.value.toString().length>0)&&(i.value.kind!=="constant"||i.value.value.length>0),f=o.value.kind!=="constant"||!!o.value.value||Object.keys(o.parameters).length>0,_=S.get("symbol-sort-key");if(this.features=[],!p&&!f)return;const x=h.iconDependencies,E=h.glyphDependencies,z=h.availableImages,R=new Ki(this.zoom);for(const{feature:V,id:q,index:X,sourceLayerIndex:Y}of n){const Q=v._featureFilter.needGeometry,fe=Os(V,Q);if(!v._featureFilter.filter(R,fe,m))continue;let de,Te;if(Q||(fe.geometry=Ga(V)),p){const Ee=v.getValueAndResolveTokens("text-field",fe,m,z),Me=te.factory(Ee);yp(Me)&&(this.hasRTLText=!0),(!this.hasRTLText||da()==="unavailable"||this.hasRTLText&&Gn.isParsed())&&(de=ip(Me,v,fe))}if(f){const Ee=v.getValueAndResolveTokens("icon-image",fe,m,z);Te=Ee instanceof ne?Ee:ne.fromString(Ee)}if(!de&&!Te)continue;const Pe=this.sortFeaturesByKey?_.evaluate(fe,{},m):void 0;if(this.features.push({id:q,text:de,icon:Te,index:X,sourceLayerIndex:Y,geometry:fe.geometry,properties:V.properties,type:yh[V.type],sortKey:Pe}),Te&&(x[Te.name]=!0),de){const Ee=i.evaluate(fe,{},m).join(","),Me=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const Le of de.sections)if(Le.image)x[Le.image.name]=!0;else{const Ue=Bt(de.toString()),He=Le.fontStack||Ee,Ge=E[He]=E[He]||{};this.calculateGlyphDependencies(Le.text,Ge,Me,this.allowVerticalPlacement,Ue)}}}S.get("symbol-placement")==="line"&&(this.features=function(V){const q={},X={},Y=[];let Q=0;function fe(Ee){Y.push(V[Ee]),Q++}function de(Ee,Me,Le){const Ue=X[Ee];return delete X[Ee],X[Me]=Ue,Y[Ue].geometry[0].pop(),Y[Ue].geometry[0]=Y[Ue].geometry[0].concat(Le[0]),Ue}function Te(Ee,Me,Le){const Ue=q[Me];return delete q[Me],q[Ee]=Ue,Y[Ue].geometry[0].shift(),Y[Ue].geometry[0]=Le[0].concat(Y[Ue].geometry[0]),Ue}function Pe(Ee,Me,Le){const Ue=Le?Me[0][Me[0].length-1]:Me[0][0];return`${Ee}:${Ue.x}:${Ue.y}`}for(let Ee=0;Ee<V.length;Ee++){const Me=V[Ee],Le=Me.geometry,Ue=Me.text?Me.text.toString():null;if(!Ue){fe(Ee);continue}const He=Pe(Ue,Le),Ge=Pe(Ue,Le,!0);if(He in X&&Ge in q&&X[He]!==q[Ge]){const tt=Te(He,Ge,Le),et=de(He,Ge,Y[tt].geometry);delete q[He],delete X[Ge],X[Pe(Ue,Y[et].geometry,!0)]=et,Y[tt].geometry=null}else He in X?de(He,Ge,Le):Ge in q?Te(He,Ge,Le):(fe(Ee),q[He]=Q-1,X[Ge]=Q-1)}return Y.filter(Ee=>Ee.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((V,q)=>V.sortKey-q.sortKey)}update(n,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(n,h,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,h){const m=this.lineVertexArray.length;if(n.segment!==void 0){let v=n.dist(h[n.segment+1]),S=n.dist(h[n.segment]);const i={};for(let t=n.segment+1;t<h.length;t++)i[t]={x:h[t].x,y:h[t].y,tileUnitDistanceFromAnchor:v},t<h.length-1&&(v+=h[t+1].dist(h[t]));for(let t=n.segment||0;t>=0;t--)i[t]={x:h[t].x,y:h[t].y,tileUnitDistanceFromAnchor:S},t>0&&(S+=h[t-1].dist(h[t]));for(let t=0;t<h.length;t++){const o=i[t];this.lineVertexArray.emplaceBack(o.x,o.y,o.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(n,h,m,v,S,i,t,o,p,f,_,x){const E=n.indexArray,z=n.layoutVertexArray,R=n.segments.prepareSegment(4*h.length,z,E,this.canOverlap?i.sortKey:void 0),V=this.glyphOffsetArray.length,q=R.vertexLength,X=this.allowVerticalPlacement&&t===l.WritingMode.vertical?Math.PI/2:0,Y=i.text&&i.text.sections;for(let Q=0;Q<h.length;Q++){const{tl:fe,tr:de,bl:Te,br:Pe,tex:Ee,pixelOffsetTL:Me,pixelOffsetBR:Le,minFontScaleX:Ue,minFontScaleY:He,glyphOffset:Ge,isSDF:tt,sectionIndex:et}=h[Q],ht=R.vertexLength,Tt=Ge[1];ho(z,o.x,o.y,fe.x,Tt+fe.y,Ee.x,Ee.y,m,tt,Me.x,Me.y,Ue,He),ho(z,o.x,o.y,de.x,Tt+de.y,Ee.x+Ee.w,Ee.y,m,tt,Le.x,Me.y,Ue,He),ho(z,o.x,o.y,Te.x,Tt+Te.y,Ee.x,Ee.y+Ee.h,m,tt,Me.x,Le.y,Ue,He),ho(z,o.x,o.y,Pe.x,Tt+Pe.y,Ee.x+Ee.w,Ee.y+Ee.h,m,tt,Le.x,Le.y,Ue,He),Eu(n.dynamicLayoutVertexArray,o,X),E.emplaceBack(ht,ht+1,ht+2),E.emplaceBack(ht+1,ht+2,ht+3),R.vertexLength+=4,R.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ge[0]),Q!==h.length-1&&et===h[Q+1].sectionIndex||n.programConfigurations.populatePaintArrays(z.length,i,i.index,{},x,Y&&Y[et])}n.placedSymbolArray.emplaceBack(o.x,o.y,V,this.glyphOffsetArray.length-V,q,p,f,o.segment,m?m[0]:0,m?m[1]:0,v[0],v[1],t,0,!1,0,_)}_addCollisionDebugVertex(n,h,m,v,S,i){return h.emplaceBack(0,0),n.emplaceBack(m.x,m.y,v,S,Math.round(i.x),Math.round(i.y))}addCollisionDebugVertices(n,h,m,v,S,i,t){const o=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),p=o.vertexLength,f=S.layoutVertexArray,_=S.collisionVertexArray,x=t.anchorX,E=t.anchorY;this._addCollisionDebugVertex(f,_,i,x,E,new De(n,h)),this._addCollisionDebugVertex(f,_,i,x,E,new De(m,h)),this._addCollisionDebugVertex(f,_,i,x,E,new De(m,v)),this._addCollisionDebugVertex(f,_,i,x,E,new De(n,v)),o.vertexLength+=4;const z=S.indexArray;z.emplaceBack(p,p+1),z.emplaceBack(p+1,p+2),z.emplaceBack(p+2,p+3),z.emplaceBack(p+3,p),o.primitiveLength+=4}addDebugCollisionBoxes(n,h,m,v){for(let S=n;S<h;S++){const i=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(i.x1,i.y1,i.x2,i.y2,v?this.textCollisionBox:this.iconCollisionBox,i.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vh(Yr,sh.members,_n),this.iconCollisionBox=new vh(Yr,sh.members,_n);for(let n=0;n<this.symbolInstances.length;n++){const h=this.symbolInstances.get(n);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(n,h,m,v,S,i,t,o,p){const f={};for(let _=h;_<m;_++){const x=n.get(_);f.textBox={x1:x.x1,y1:x.y1,x2:x.x2,y2:x.y2,anchorPointX:x.anchorPointX,anchorPointY:x.anchorPointY},f.textFeatureIndex=x.featureIndex;break}for(let _=v;_<S;_++){const x=n.get(_);f.verticalTextBox={x1:x.x1,y1:x.y1,x2:x.x2,y2:x.y2,anchorPointX:x.anchorPointX,anchorPointY:x.anchorPointY},f.verticalTextFeatureIndex=x.featureIndex;break}for(let _=i;_<t;_++){const x=n.get(_);f.iconBox={x1:x.x1,y1:x.y1,x2:x.x2,y2:x.y2,anchorPointX:x.anchorPointX,anchorPointY:x.anchorPointY},f.iconFeatureIndex=x.featureIndex;break}for(let _=o;_<p;_++){const x=n.get(_);f.verticalIconBox={x1:x.x1,y1:x.y1,x2:x.x2,y2:x.y2,anchorPointX:x.anchorPointX,anchorPointY:x.anchorPointY},f.verticalIconFeatureIndex=x.featureIndex;break}return f}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,h){const m=n.placedSymbolArray.get(h),v=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<v;S+=4)n.indexArray.emplaceBack(S,S+1,S+2),n.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(n),m=Math.cos(n),v=[],S=[],i=[];for(let t=0;t<this.symbolInstances.length;++t){i.push(t);const o=this.symbolInstances.get(t);v.push(0|Math.round(h*o.anchorX+m*o.anchorY)),S.push(o.featureIndex)}return i.sort((t,o)=>v[t]-v[o]||S[o]-S[t]),i}addToSortKeyRanges(n,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((v,S,i)=>{v>=0&&i.indexOf(v)===S&&this.addIndicesForPlacedSymbol(this.text,v)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Nt("SymbolBucket",rc,{omit:["layers","collisionBoxArray","features","compareText"]}),rc.MAX_GLYPHS=65535,rc.addDynamicAttributes=Eu;const Au=new tn({"symbol-placement":new Yt(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new Yt(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Yt(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _t(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Yt(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Yt(ae.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Yt(ae.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Yt(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new Yt(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Yt(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new _t(ae.layout_symbol["icon-size"]),"icon-text-fit":new Yt(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yt(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new _t(ae.layout_symbol["icon-image"]),"icon-rotate":new _t(ae.layout_symbol["icon-rotate"]),"icon-padding":new Yt(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new Yt(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new _t(ae.layout_symbol["icon-offset"]),"icon-anchor":new _t(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Yt(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Yt(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Yt(ae.layout_symbol["text-rotation-alignment"]),"text-field":new _t(ae.layout_symbol["text-field"]),"text-font":new _t(ae.layout_symbol["text-font"]),"text-size":new _t(ae.layout_symbol["text-size"]),"text-max-width":new _t(ae.layout_symbol["text-max-width"]),"text-line-height":new Yt(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new _t(ae.layout_symbol["text-letter-spacing"]),"text-justify":new _t(ae.layout_symbol["text-justify"]),"text-radial-offset":new _t(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Yt(ae.layout_symbol["text-variable-anchor"]),"text-anchor":new _t(ae.layout_symbol["text-anchor"]),"text-max-angle":new Yt(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new Yt(ae.layout_symbol["text-writing-mode"]),"text-rotate":new _t(ae.layout_symbol["text-rotate"]),"text-padding":new Yt(ae.layout_symbol["text-padding"]),"text-keep-upright":new Yt(ae.layout_symbol["text-keep-upright"]),"text-transform":new _t(ae.layout_symbol["text-transform"]),"text-offset":new _t(ae.layout_symbol["text-offset"]),"text-allow-overlap":new Yt(ae.layout_symbol["text-allow-overlap"]),"text-overlap":new Yt(ae.layout_symbol["text-overlap"]),"text-ignore-placement":new Yt(ae.layout_symbol["text-ignore-placement"]),"text-optional":new Yt(ae.layout_symbol["text-optional"])});var Nc={paint:new tn({"icon-opacity":new _t(ae.paint_symbol["icon-opacity"]),"icon-color":new _t(ae.paint_symbol["icon-color"]),"icon-halo-color":new _t(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new _t(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _t(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new Yt(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new Yt(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new _t(ae.paint_symbol["text-opacity"]),"text-color":new _t(ae.paint_symbol["text-color"],{runtimeType:Ii,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new _t(ae.paint_symbol["text-halo-color"]),"text-halo-width":new _t(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new _t(ae.paint_symbol["text-halo-blur"]),"text-translate":new Yt(ae.paint_symbol["text-translate"]),"text-translate-anchor":new Yt(ae.paint_symbol["text-translate-anchor"])}),layout:Au};class xp{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Mi,this.defaultValue=n}evaluate(n){if(n.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(n.formattedSection))return h.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Nt("FormatSectionOverride",xp,{omit:["defaultValue"]});class nc extends nn{constructor(n){super(n,Nc)}recalculate(n,h){if(super.recalculate(n,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const v=[];for(const S of m)v.indexOf(S)<0&&v.push(S);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,h,m,v){const S=this.layout.get(n).evaluate(h,{},m,v),i=this._unevaluatedLayout._values[n];return i.isDataDriven()||to(i.value)||!S?S:function(t,o){return o.replace(/{([^{}]+)}/g,(p,f)=>f in t?String(t[f]):"")}(h.properties,S)}createBucket(n){return new rc(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Nc.paint.overridableProperties){if(!nc.hasPaintOverride(this.layout,n))continue;const h=this.paint.get(n),m=new xp(h),v=new ra(m,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new io("source",v):new ro("composite",v,h.value.zoomStops,h.value._interpolationType),this.paint._values[n]=new ys(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(n,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&nc.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,h){const m=n.get("text-field"),v=Nc.paint.properties[h];let S=!1;const i=t=>{for(const o of t)if(v.overrides&&v.overrides.hasOverride(o))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof te)i(m.value.value.sections);else if(m.value.kind==="source"){const t=p=>{S||(p instanceof Se&&pe(p.value)===vr?i(p.value.sections):p instanceof qe?i(p.sections):p.eachChild(t))},o=m.value;o._styleExpression&&t(o._styleExpression.expression)}return S}}function jc(c,n,h){let m="never";const v=c.get(n);return v?m=v:c.get(h)&&(m="always"),m}var sc={paint:new tn({"background-color":new Yt(ae.paint_background["background-color"]),"background-pattern":new xs(ae.paint_background["background-pattern"]),"background-opacity":new Yt(ae.paint_background["background-opacity"])})},ud={paint:new tn({"raster-opacity":new Yt(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new Yt(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Yt(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Yt(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new Yt(ae.paint_raster["raster-saturation"]),"raster-contrast":new Yt(ae.paint_raster["raster-contrast"]),"raster-resampling":new Yt(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new Yt(ae.paint_raster["raster-fade-duration"])})};class bh extends nn{constructor(n){super(n,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const vp={circle:class extends nn{constructor(c){super(c,Lp)}createBucket(c){return new Bl(c)}queryRadius(c){const n=c;return wc("circle-radius",this,n)+wc("circle-stroke-width",this,n)+Za(this.paint.get("circle-translate"))}queryIntersectsFeature(c,n,h,m,v,S,i,t){const o=Tl(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,i),p=this.paint.get("circle-radius").evaluate(n,h)+this.paint.get("circle-stroke-width").evaluate(n,h),f=this.paint.get("circle-pitch-alignment")==="map",_=f?o:function(E,z){return E.map(R=>Ul(R,z))}(o,t),x=f?p*i:p;for(const E of m)for(const z of E){const R=f?z:Ul(z,t);let V=x;const q=Tc([],[z.x,z.y,0,1],t);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?V*=q[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(V*=S.cameraToCenterDistance/q[3]),Oh(_,R,V))return!0}return!1}},heatmap:class extends nn{constructor(c){super(c,jh),this._updateColorRamp()}createBucket(c){return new Nh(c)}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends nn{constructor(c){super(c,Gu)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends nn{constructor(c){super(c,Vp)}recalculate(c,n){super.recalculate(c,n);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Yu(c)}queryRadius(){return Za(this.paint.get("fill-translate"))}queryIntersectsFeature(c,n,h,m,v,S,i){return Uh(Tl(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,i),m)}isTileClipped(){return!0}},"fill-extrusion":class extends nn{constructor(c){super(c,Kp)}createBucket(c){return new th(c)}queryRadius(){return Za(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,n,h,m,v,S,i,t){const o=Tl(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,i),p=this.paint.get("fill-extrusion-height").evaluate(n,h),f=this.paint.get("fill-extrusion-base").evaluate(n,h),_=function(E,z,R,V){const q=[];for(const X of E){const Y=[X.x,X.y,0,1];Tc(Y,Y,z),q.push(new De(Y[0]/Y[3],Y[1]/Y[3]))}return q}(o,t),x=function(E,z,R,V){const q=[],X=[],Y=V[8]*z,Q=V[9]*z,fe=V[10]*z,de=V[11]*z,Te=V[8]*R,Pe=V[9]*R,Ee=V[10]*R,Me=V[11]*R;for(const Le of E){const Ue=[],He=[];for(const Ge of Le){const tt=Ge.x,et=Ge.y,ht=V[0]*tt+V[4]*et+V[12],Tt=V[1]*tt+V[5]*et+V[13],St=V[2]*tt+V[6]*et+V[14],pt=V[3]*tt+V[7]*et+V[15],Xt=St+fe,Ot=pt+de,ni=ht+Te,Ei=Tt+Pe,ji=St+Ee,Xi=pt+Me,Cr=new De((ht+Y)/Ot,(Tt+Q)/Ot);Cr.z=Xt/Ot,Ue.push(Cr);const Wi=new De(ni/Xi,Ei/Xi);Wi.z=ji/Xi,He.push(Wi)}q.push(Ue),X.push(He)}return[q,X]}(m,f,p,t);return function(E,z,R){let V=1/0;Uh(R,z)&&(V=Kl(R,z[0]));for(let q=0;q<z.length;q++){const X=z[q],Y=E[q];for(let Q=0;Q<X.length-1;Q++){const fe=X[Q],de=[fe,X[Q+1],Y[Q+1],Y[Q],fe];su(R,de)&&(V=Math.min(V,Kl(R,de)))}}return V!==1/0&&V}(x[0],x[1],_)}},line:class extends nn{constructor(c){super(c,Jh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Xs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,n){super.recalculate(c,n),this.paint._values["line-floorwidth"]=$h.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new rh(c)}queryRadius(c){const n=c,h=Qh(wc("line-width",this,n),wc("line-gap-width",this,n)),m=wc("line-offset",this,n);return h/2+Math.abs(m)+Za(this.paint.get("line-translate"))}queryIntersectsFeature(c,n,h,m,v,S,i){const t=Tl(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,i),o=i/2*Qh(this.paint.get("line-width").evaluate(n,h),this.paint.get("line-gap-width").evaluate(n,h)),p=this.paint.get("line-offset").evaluate(n,h);return p&&(m=function(f,_){const x=[];for(let E=0;E<f.length;E++){const z=f[E],R=[];for(let V=0;V<z.length;V++){const q=z[V-1],X=z[V],Y=z[V+1],Q=V===0?new De(0,0):X.sub(q)._unit()._perp(),fe=V===z.length-1?new De(0,0):Y.sub(X)._unit()._perp(),de=Q._add(fe)._unit(),Te=de.x*fe.x+de.y*fe.y;Te!==0&&de._mult(1/Te),R.push(de._mult(_)._add(X))}x.push(R)}return x}(m,p*i)),function(f,_,x){for(let E=0;E<_.length;E++){const z=_[E];if(f.length>=3){for(let R=0;R<z.length;R++)if(wl(f,z[R]))return!0}if(Vh(f,z,x))return!0}return!1}(t,m,o)}isTileClipped(){return!0}},symbol:nc,background:class extends nn{constructor(c){super(c,sc)}},raster:class extends nn{constructor(c){super(c,ud)}}};class ku{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const zu=63710088e-1;class fn{constructor(n,h){if(isNaN(n)||isNaN(h))throw new Error(`Invalid LngLat object: (${n}, ${h})`);if(this.lng=+n,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fn(me(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const h=Math.PI/180,m=this.lat*h,v=n.lat*h,S=Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos((n.lng-this.lng)*h);return zu*Math.acos(Math.min(S,1))}toBounds(n=0){const h=360*n/40075017,m=h/Math.cos(Math.PI/180*this.lat);return new kl(new fn(this.lng-m,this.lat-h),new fn(this.lng+m,this.lat+h))}static convert(n){if(n instanceof fn)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new fn(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new fn(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class kl{constructor(n,h){n&&(h?this.setSouthWest(n).setNorthEast(h):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof fn?new fn(n.lng,n.lat):fn.convert(n),this}setSouthWest(n){return this._sw=n instanceof fn?new fn(n.lng,n.lat):fn.convert(n),this}extend(n){const h=this._sw,m=this._ne;let v,S;if(n instanceof fn)v=n,S=n;else{if(!(n instanceof kl))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(kl.convert(n)):this.extend(fn.convert(n)):this;if(v=n._sw,S=n._ne,!v||!S)return this}return h||m?(h.lng=Math.min(v.lng,h.lng),h.lat=Math.min(v.lat,h.lat),m.lng=Math.max(S.lng,m.lng),m.lat=Math.max(S.lat,m.lat)):(this._sw=new fn(v.lng,v.lat),this._ne=new fn(S.lng,S.lat)),this}getCenter(){return new fn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fn(this.getWest(),this.getNorth())}getSouthEast(){return new fn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:h,lat:m}=fn.convert(n);let v=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&v}static convert(n){return n instanceof kl?n:n&&new kl(n)}}const bp=2*Math.PI*zu;function wp(c){return bp*Math.cos(c*Math.PI/180)}function Tp(c){return(180+c)/360}function wh(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function un(c,n){return c/wp(n)}function ba(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class qc{constructor(n,h,m=0){this.x=+n,this.y=+h,this.z=+m}static fromLngLat(n,h=0){const m=fn.convert(n);return new qc(Tp(m.lng),wh(m.lat),un(h,m.lat))}toLngLat(){return new fn(360*this.x-180,ba(this.y))}toAltitude(){return this.z*wp(ba(this.y))}meterInMercatorCoordinateUnits(){return 1/bp*(n=ba(this.y),1/Math.cos(n*Math.PI/180));var n}}function Th(c,n,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[c*m-2*Math.PI*6378137/2,n*m-2*Math.PI*6378137/2]}class Cu{constructor(n,h,m){this.z=n,this.x=h,this.y=m,this.key=zl(0,n,n,h,m)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,h,m){const v=(i=this.y,t=this.z,o=Th(256*(S=this.x),256*(i=Math.pow(2,t)-i-1),t),p=Th(256*(S+1),256*(i+1),t),o[0]+","+o[1]+","+p[0]+","+p[1]);var S,i,t,o,p;const f=function(_,x,E){let z,R="";for(let V=_;V>0;V--)z=1<<V-1,R+=(x&z?1:0)+(E&z?2:0);return R}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,f).replace(/{bbox-epsg-3857}/g,v)}getTilePoint(n){const h=Math.pow(2,this.z);return new De((n.x*h-this.x)*En,(n.y*h-this.y)*En)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ih{constructor(n,h){this.wrap=n,this.canonical=h,this.key=zl(n,h.z,h.z,h.x,h.y)}}class Us{constructor(n,h,m,v,S){this.overscaledZ=n,this.wrap=h,this.canonical=new Cu(m,+v,+S),this.key=zl(h,n,m,v,S)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const h=this.canonical.z-n;return n>this.canonical.z?new Us(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Us(n,this.wrap,n,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(n,h){const m=this.canonical.z-n;return n>this.canonical.z?zl(this.wrap*+h,n,this.canonical.z,this.canonical.x,this.canonical.y):zl(this.wrap*+h,n,n,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const h=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>h&&n.canonical.y===this.canonical.y>>h}children(n){if(this.overscaledZ>=n)return[new Us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,v=2*this.canonical.y;return[new Us(h,this.wrap,h,m,v),new Us(h,this.wrap,h,m+1,v),new Us(h,this.wrap,h,m,v+1),new Us(h,this.wrap,h,m+1,v+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Us(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ih(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new qc(n.x-this.wrap,n.y))}}function zl(c,n,h,m,v){(c*=2)<0&&(c=-1*c-1);const S=1<<h;return(S*S*c+S*v+m).toString(36)+h.toString(36)+n.toString(36)}Nt("CanonicalTileID",Cu),Nt("OverscaledTileID",Us,{omit:["posMatrix"]});class Gc{constructor(n,h,m){if(this.uid=n,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&m!=="mapbox"&&m!=="terrarium")return void nt(`"${m}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=h.height;const v=this.dim=h.height-2;this.data=new Uint32Array(h.data.buffer),this.encoding=m||"mapbox";for(let S=0;S<v;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(v,S)]=this.data[this._idx(v-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,v)]=this.data[this._idx(S,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)]}get(n,h){const m=new Uint8Array(this.data.buffer),v=4*this._idx(n,h);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(m[v],m[v+1],m[v+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(n,h){if(n<-1||n>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(n+1)}_unpackMapbox(n,h,m){return(256*n*256+256*h+m)/10-1e4}_unpackTerrarium(n,h,m){return 256*n+h+m/256-32768}getPixels(){return new Ts({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,h,m){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let v=h*this.dim,S=h*this.dim+this.dim,i=m*this.dim,t=m*this.dim+this.dim;switch(h){case-1:v=S-1;break;case 1:S=v+1}switch(m){case-1:i=t-1;break;case 1:t=i+1}const o=-h*this.dim,p=-m*this.dim;for(let f=i;f<t;f++)for(let _=v;_<S;_++)this.data[this._idx(_,f)]=n.data[this._idx(_+o,f+p)]}}Nt("DEMData",Gc);class Sh{constructor(n){this._stringToNumber={},this._numberToString=[];for(let h=0;h<n.length;h++){const m=n[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}class Pu{constructor(n,h,m,v,S){this.type="Feature",this._vectorTileFeature=n,n._z=h,n._x=m,n._y=v,this.properties=n.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(n[h]=this[h]);return n}}class Eh{constructor(n,h){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Ks(En,16,0),this.grid3D=new Ks(En,16,0),this.featureIndexArray=new yt,this.promoteId=h}insert(n,h,m,v,S,i){const t=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,v,S);const o=i?this.grid3D:this.grid;for(let p=0;p<h.length;p++){const f=h[p],_=[1/0,1/0,-1/0,-1/0];for(let x=0;x<f.length;x++){const E=f[x];_[0]=Math.min(_[0],E.x),_[1]=Math.min(_[1],E.y),_[2]=Math.max(_[2],E.x),_[3]=Math.max(_[3],E.y)}_[0]<En&&_[1]<En&&_[2]>=0&&_[3]>=0&&o.insert(t,_[0],_[1],_[2],_[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Bo.VectorTile(new oh(this.rawTileData)).layers,this.sourceLayerCoder=new Sh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,h,m,v){this.loadVTLayers();const S=n.params||{},i=En/n.tileSize/n.scale,t=Cs(S.filter),o=n.queryGeometry,p=n.queryPadding*i,f=oc(o),_=this.grid.query(f.minX-p,f.minY-p,f.maxX+p,f.maxY+p),x=oc(n.cameraQueryGeometry),E=this.grid3D.query(x.minX-p,x.minY-p,x.maxX+p,x.maxY+p,(V,q,X,Y)=>function(Q,fe,de,Te,Pe){for(const Me of Q)if(fe<=Me.x&&de<=Me.y&&Te>=Me.x&&Pe>=Me.y)return!0;const Ee=[new De(fe,de),new De(fe,Pe),new De(Te,Pe),new De(Te,de)];if(Q.length>2){for(const Me of Ee)if(wl(Q,Me))return!0}for(let Me=0;Me<Q.length-1;Me++)if(Rl(Q[Me],Q[Me+1],Ee))return!0;return!1}(n.cameraQueryGeometry,V-p,q-p,X+p,Y+p));for(const V of E)_.push(V);_.sort(Ip);const z={};let R;for(let V=0;V<_.length;V++){const q=_[V];if(q===R)continue;R=q;const X=this.featureIndexArray.get(q);let Y=null;this.loadMatchingFeature(z,X.bucketIndex,X.sourceLayerIndex,X.featureIndex,t,S.layers,S.availableImages,h,m,v,(Q,fe,de)=>(Y||(Y=Ga(Q)),fe.queryIntersectsFeature(o,Q,de,Y,this.z,n.transform,i,n.pixelPosMatrix)))}return z}loadMatchingFeature(n,h,m,v,S,i,t,o,p,f,_){const x=this.bucketLayerIDs[h];if(i&&!function(V,q){for(let X=0;X<V.length;X++)if(q.indexOf(V[X])>=0)return!0;return!1}(i,x))return;const E=this.sourceLayerCoder.decode(m),z=this.vtLayers[E].feature(v);if(S.needGeometry){const V=Os(z,!0);if(!S.filter(new Ki(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!S.filter(new Ki(this.tileID.overscaledZ),z))return;const R=this.getId(z,E);for(let V=0;V<x.length;V++){const q=x[V];if(i&&i.indexOf(q)<0)continue;const X=o[q];if(!X)continue;let Y={};R&&f&&(Y=f.getState(X.sourceLayer||"_geojsonTileLayer",R));const Q=_e({},p[q]);Q.paint=Is(Q.paint,X.paint,z,Y,t),Q.layout=Is(Q.layout,X.layout,z,Y,t);const fe=!_||_(z,X,Y);if(!fe)continue;const de=new Pu(z,this.z,this.x,this.y,R);de.layer=Q;let Te=n[q];Te===void 0&&(Te=n[q]=[]),Te.push({featureIndex:v,feature:de,intersectionZ:fe})}}lookupSymbolFeatures(n,h,m,v,S,i,t,o){const p={};this.loadVTLayers();const f=Cs(S);for(const _ of n)this.loadMatchingFeature(p,m,v,_,f,i,t,o,h);return p}hasLayer(n){for(const h of this.bucketLayerIDs)for(const m of h)if(n===m)return!0;return!1}getId(n,h){let m=n.id;return this.promoteId&&(m=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof m=="boolean"&&(m=Number(m))),m}}function Is(c,n,h,m,v){return zt(c,(S,i)=>{const t=n instanceof Zn?n.get(i):null;return t&&t.evaluate?t.evaluate(h,m,v):t})}function oc(c){let n=1/0,h=1/0,m=-1/0,v=-1/0;for(const S of c)n=Math.min(n,S.x),h=Math.min(h,S.y),m=Math.max(m,S.x),v=Math.max(v,S.y);return{minX:n,minY:h,maxX:m,maxY:v}}function Ip(c,n){return n-c}var Mu;Nt("FeatureIndex",Eh,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(Mu=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Mu.load="load",Mu.fullLoad="fullLoad";let Zc=null,ac=[];const Du=1e3/30,Sp={mark(c){performance.mark(c)},frame(c){const n=c;Zc!=null&&ac.push(n-Zc),Zc=n},clearMetrics(){Zc=null,ac=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const c in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[c])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const c=performance.getEntriesByName("loadTime")[0].duration,n=performance.getEntriesByName("fullLoadTime")[0].duration,h=ac.length,m=1/(ac.reduce((S,i)=>S+i,0)/h/1e3),v=ac.filter(S=>S>Du).reduce((S,i)=>S+(i-Du)/Du,0);return{loadTime:c,fullLoadTime:n,fps:m,percentDroppedFrames:v/(h+v)*100}}};l.AJAXError=Ai,l.ARRAY_TYPE=Fl,l.Actor=class{constructor(c,n,h){this.target=c,this.parent=n,this.mapId=h,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},gt(["receive","process"],this),this.invoker=new ku(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=at()?c:window}send(c,n,h,m,v=!1){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(this.callbacks[S]=h);const i=ft(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:c,hasCallback:!!h,targetMapId:m,mustQueue:v,sourceMapId:this.mapId,data:ao(n,i)},i),{cancel:()=>{h&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:m,sourceMapId:this.mapId})}}}receive(c){const n=c.data,h=n.id;if(h&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){delete this.tasks[h];const m=this.cancelCallbacks[h];delete this.cancelCallbacks[h],m&&m()}else at()||n.mustQueue?(this.tasks[h]=n,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,n)}process(){if(!this.taskQueue.length)return;const c=this.taskQueue.shift(),n=this.tasks[c];delete this.tasks[c],this.taskQueue.length&&this.invoker.trigger(),n&&this.processTask(c,n)}processTask(c,n){if(n.type==="<response>"){const h=this.callbacks[c];delete this.callbacks[c],h&&(n.error?h(Yn(n.error)):h(null,Yn(n.data)))}else{let h=!1;const m=ft(this.globalScope)?void 0:[],v=n.hasCallback?(t,o)=>{h=!0,delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:t?ao(t):null,data:ao(o,m)},m)}:t=>{h=!0};let S=null;const i=Yn(n.data);if(this.parent[n.type])S=this.parent[n.type](n.sourceMapId,i,v);else if(this.parent.getWorkerSource){const t=n.type.split(".");S=this.parent.getWorkerSource(n.sourceMapId,t[0],i.source)[t[1]](i,v)}else v(new Error(`Could not find function ${n.type}`));!h&&S&&S.cancel&&(this.cancelCallbacks[c]=S.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=Vl,l.CanonicalTileID=Cu,l.CollisionBoxArray=oe,l.CollisionCircleLayoutArray=class extends I{},l.Color=L,l.DEMData=Gc,l.DataConstantProperty=Yt,l.DictionaryCoder=Sh,l.EXTENT=En,l.ErrorEvent=jt,l.EvaluationParameters=Ki,l.Event=Di,l.Evented=Vi,l.FeatureIndex=Eh,l.FillBucket=Yu,l.FillExtrusionBucket=th,l.GeoJSONFeature=Pu,l.ImageAtlas=uh,l.ImagePosition=Ka,l.LineBucket=rh,l.LineStripIndexArray=class extends le{},l.LngLat=fn,l.LngLatBounds=kl,l.MercatorCoordinate=qc,l.ONE_EM=Fn,l.OverscaledTileID=Us,l.PerformanceUtils=Sp,l.PosArray=class extends co{},l.Properties=tn,l.QuadTriangleArray=class extends D{},l.RGBAImage=Ts,l.RasterBoundsArray=class extends Fs{},l.RequestPerformance=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},l.ResourceType=Mr,l.SegmentVector=Ri,l.SymbolBucket=rc,l.Transitionable=fa,l.TriangleIndexArray=qr,l.Uniform1f=Jn,l.Uniform1i=class extends Wn{constructor(c,n){super(c,n),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},l.Uniform2f=class extends Wn{constructor(c,n){super(c,n),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},l.Uniform3f=class extends Wn{constructor(c,n){super(c,n),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},l.Uniform4f=uo,l.UniformColor=bc,l.UniformMatrix4f=class extends Wn{constructor(c,n){super(c,n),this.current=yl}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let n=1;n<16;n++)if(c[n]!==this.current[n]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},l.UnwrappedTileID=Ih,l.ValidationError=Ae,l.ZoomHistory=Ds,l.addDynamicAttributes=Eu,l.asyncAll=function(c,n,h){if(!c.length)return h(null,[]);let m=c.length;const v=new Array(c.length);let S=null;c.forEach((i,t)=>{n(i,(o,p)=>{o&&(S=o),v[t]=p,--m==0&&h(S,v)})})},l.bezier=ue,l.bindAll=gt,l.cacheEntryPossiblyAdded=function(c){ei++,ei>Ci&&(c.getActor().send("enforceCacheSizeLimit",ui),ei=0)},l.clamp=Z,l.clearTileCache=function(c){const n=caches.delete(vt);c&&n.catch(c).then(()=>c())},l.clipLine=mh,l.clone=function(c){var n=new Fl(16);return n[0]=c[0],n[1]=c[1],n[2]=c[2],n[3]=c[3],n[4]=c[4],n[5]=c[5],n[6]=c[6],n[7]=c[7],n[8]=c[8],n[9]=c[9],n[10]=c[10],n[11]=c[11],n[12]=c[12],n[13]=c[13],n[14]=c[14],n[15]=c[15],n},l.clone$1=it,l.collisionCircleLayout=tp,l.config=si,l.create=function(){var c=new Fl(16);return Fl!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},l.createExpression=Ws,l.createFilter=Cs,l.createLayout=Oi,l.createStyleLayer=function(c){return c.type==="custom"?new bh(c):new vp[c.type](c)},l.dot=function(c,n){return c[0]*n[0]+c[1]*n[1]+c[2]*n[2]+c[3]*n[3]},l.ease=re,l.emitValidationErrors=Fa,l.enforceCacheSizeLimit=function(c){fi(),Ht&&Ht.then(n=>{n.keys().then(h=>{for(let m=0;m<h.length-c;m++)n.delete(h[m])})})},l.evaluateSizeForFeature=function(c,{uSize:n,uSizeT:h},{lowerSize:m,upperSize:v}){return c.kind==="source"?m/Fo:c.kind==="composite"?rn(m/Fo,v/Fo,h):n},l.evaluateSizeForZoom=function(c,n){let h=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:v,minZoom:S,maxZoom:i}=c,t=v?Z(Ln.interpolationFactor(v,n,S,i),0,1):0;c.kind==="camera"?m=rn(c.minSize,c.maxSize,t):h=t}return{uSizeT:h,uSize:m}},l.evaluateVariableOffset=gp,l.evented=Ys,l.exported=Ze,l.exported$1=_i,l.extend=_e,l.filterObject=Ct,l.getAnchorAlignment=vu,l.getAnchorJustification=_h,l.getArrayBuffer=Dr,l.getImage=Hi,l.getJSON=function(c,n){return Er(_e(c,{type:"json"}),n)},l.getOverlapMode=jc,l.getRTLTextPluginStatus=da,l.getReferrer=gr,l.getVideo=function(c,n){const h=window.document.createElement("video");h.muted=!0,h.onloadstart=function(){n(null,h)};for(let m=0;m<c.length;m++){const v=window.document.createElement("source");Jr(c[m])||(h.crossOrigin="Anonymous"),v.src=c[m],h.appendChild(v)}return{cancel:()=>{}}},l.identity=Nn,l.invert=function(c,n){var h=n[0],m=n[1],v=n[2],S=n[3],i=n[4],t=n[5],o=n[6],p=n[7],f=n[8],_=n[9],x=n[10],E=n[11],z=n[12],R=n[13],V=n[14],q=n[15],X=h*t-m*i,Y=h*o-v*i,Q=h*p-S*i,fe=m*o-v*t,de=m*p-S*t,Te=v*p-S*o,Pe=f*R-_*z,Ee=f*V-x*z,Me=f*q-E*z,Le=_*V-x*R,Ue=_*q-E*R,He=x*q-E*V,Ge=X*He-Y*Ue+Q*Le+fe*Me-de*Ee+Te*Pe;return Ge?(c[0]=(t*He-o*Ue+p*Le)*(Ge=1/Ge),c[1]=(v*Ue-m*He-S*Le)*Ge,c[2]=(R*Te-V*de+q*fe)*Ge,c[3]=(x*de-_*Te-E*fe)*Ge,c[4]=(o*Me-i*He-p*Ee)*Ge,c[5]=(h*He-v*Me+S*Ee)*Ge,c[6]=(V*Q-z*Te-q*Y)*Ge,c[7]=(f*Te-x*Q+E*Y)*Ge,c[8]=(i*Ue-t*Me+p*Pe)*Ge,c[9]=(m*Me-h*Ue-S*Pe)*Ge,c[10]=(z*de-R*Q+q*X)*Ge,c[11]=(_*Q-f*de-E*X)*Ge,c[12]=(t*Ee-i*Le-o*Pe)*Ge,c[13]=(h*Le-m*Ee+v*Pe)*Ge,c[14]=(R*Y-z*fe-V*X)*Ge,c[15]=(f*fe-_*Y+x*X)*Ge,c):null},l.isImageBitmap=wt,l.isSafari=ft,l.keysDifference=function(c,n){const h=[];for(const m in c)m in n||h.push(m);return h},l.lazyLoadRTLTextPlugin=function(){Gn.isLoading()||Gn.isLoaded()||da()!=="deferred"||Bs()},l.makeRequest=Er,l.mapObject=zt,l.mercatorXfromLng=Tp,l.mercatorYfromLat=wh,l.mercatorZfromAltitude=un,l.mul=qu,l.multiply=Hn,l.nextPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},l.number=rn,l.ortho=function(c,n,h,m,v,S,i){var t=1/(n-h),o=1/(m-v),p=1/(S-i);return c[0]=-2*t,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*o,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*p,c[11]=0,c[12]=(n+h)*t,c[13]=(v+m)*o,c[14]=(i+S)*p,c[15]=1,c},l.parseCacheControl=rt,l.parseGlyphPBF=function(c){return new oh(c).readFields(nd,[])},l.pbf=oh,l.performSymbolLayout=function(c,n,h,m,v,S,i){c.createArrays(),c.tilePixelRatio=En/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const t=c.layers[0].layout,o=c.layers[0]._unevaluatedLayout._values,p={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ki(c.zoom+1),i),layoutTextSize:o["text-size"].possiblyEvaluate(new Ki(c.zoom+1),i),textMaxSize:o["text-size"].possiblyEvaluate(new Ki(18))};if(c.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:R}=c.textSizeData;p.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ki(z),i),o["text-size"].possiblyEvaluate(new Ki(R),i)]}if(c.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:R}=c.iconSizeData;p.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ki(z),i),o["icon-size"].possiblyEvaluate(new Ki(R),i)]}const f=t.get("text-line-height")*Fn,_=t.get("text-rotation-alignment")!=="viewport"&&t.get("symbol-placement")!=="point",x=t.get("text-keep-upright"),E=t.get("text-size");for(const z of c.features){const R=t.get("text-font").evaluate(z,{},i).join(","),V=E.evaluate(z,{},i),q=p.layoutTextSize.evaluate(z,{},i),X=p.layoutIconSize.evaluate(z,{},i),Y={horizontal:{},vertical:void 0},Q=z.text;let fe,de=[0,0];if(Q){const Ee=Q.toString(),Me=t.get("text-letter-spacing").evaluate(z,{},i)*Fn,Le=ca(Ee)?Me:0,Ue=t.get("text-anchor").evaluate(z,{},i),He=t.get("text-variable-anchor");if(!He){const Tt=t.get("text-radial-offset").evaluate(z,{},i);de=Tt?gp(Ue,[Tt*Fn,ic]):t.get("text-offset").evaluate(z,{},i).map(St=>St*Fn)}let Ge=_?"center":t.get("text-justify").evaluate(z,{},i);const tt=t.get("symbol-placement"),et=tt==="point"?t.get("text-max-width").evaluate(z,{},i)*Fn:0,ht=()=>{c.allowVerticalPlacement&&Bt(Ee)&&(Y.vertical=Lc(Q,n,h,v,R,et,f,Ue,"left",Le,de,l.WritingMode.vertical,!0,tt,q,V))};if(!_&&He){const Tt=Ge==="auto"?He.map(pt=>_h(pt)):[Ge];let St=!1;for(let pt=0;pt<Tt.length;pt++){const Xt=Tt[pt];if(!Y.horizontal[Xt])if(St)Y.horizontal[Xt]=Y.horizontal[0];else{const Ot=Lc(Q,n,h,v,R,et,f,"center",Xt,Le,de,l.WritingMode.horizontal,!1,tt,q,V);Ot&&(Y.horizontal[Xt]=Ot,St=Ot.positionedLines.length===1)}}ht()}else{Ge==="auto"&&(Ge=_h(Ue));const Tt=Lc(Q,n,h,v,R,et,f,Ue,Ge,Le,de,l.WritingMode.horizontal,!1,tt,q,V);Tt&&(Y.horizontal[Ge]=Tt),ht(),Bt(Ee)&&_&&x&&(Y.vertical=Lc(Q,n,h,v,R,et,f,Ue,Ge,Le,de,l.WritingMode.vertical,!1,tt,q,V))}}let Te=!1;if(z.icon&&z.icon.name){const Ee=m[z.icon.name];Ee&&(fe=ad(v[z.icon.name],t.get("icon-offset").evaluate(z,{},i),t.get("icon-anchor").evaluate(z,{},i)),Te=!!Ee.sdf,c.sdfIcons===void 0?c.sdfIcons=Te:c.sdfIcons!==Te&&nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ee.pixelRatio!==c.pixelRatio||t.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const Pe=Su(Y.horizontal)||Y.vertical;c.iconsInText=!!Pe&&Pe.iconsInText,(Pe||fe)&&ld(c,z,Y,fe,m,p,q,X,de,Te,i)}S&&c.generateCollisionDebugBuffers()},l.perspective=function(c,n,h,m,v){var S,i=1/Math.tan(n/2);return c[0]=i/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,v!=null&&v!==1/0?(c[10]=(v+m)*(S=1/(m-v)),c[14]=2*v*m*S):(c[10]=-1,c[14]=-2*m),c},l.pick=function(c,n){const h={};for(let m=0;m<n.length;m++){const v=n[m];v in c&&(h[v]=c[v])}return h},l.plugin=Gn,l.pointGeometry=De,l.polygonIntersectsPolygon=su,l.potpack=Mc,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=Nt,l.registerForPluginStateChange=function(c){return c({pluginStatus:Bn,pluginURL:cn}),Ys.on("pluginStateChange",c),c},l.renderColorRamp=qh,l.rotateX=function(c,n,h){var m=Math.sin(h),v=Math.cos(h),S=n[4],i=n[5],t=n[6],o=n[7],p=n[8],f=n[9],_=n[10],x=n[11];return n!==c&&(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[4]=S*v+p*m,c[5]=i*v+f*m,c[6]=t*v+_*m,c[7]=o*v+x*m,c[8]=p*v-S*m,c[9]=f*v-i*m,c[10]=_*v-t*m,c[11]=x*v-o*m,c},l.rotateZ=function(c,n,h){var m=Math.sin(h),v=Math.cos(h),S=n[0],i=n[1],t=n[2],o=n[3],p=n[4],f=n[5],_=n[6],x=n[7];return n!==c&&(c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[0]=S*v+p*m,c[1]=i*v+f*m,c[2]=t*v+_*m,c[3]=o*v+x*m,c[4]=p*v-S*m,c[5]=f*v-i*m,c[6]=_*v-t*m,c[7]=x*v-o*m,c},l.scale=function(c,n,h){var m=h[0],v=h[1],S=h[2];return c[0]=n[0]*m,c[1]=n[1]*m,c[2]=n[2]*m,c[3]=n[3]*m,c[4]=n[4]*v,c[5]=n[5]*v,c[6]=n[6]*v,c[7]=n[7]*v,c[8]=n[8]*S,c[9]=n[9]*S,c[10]=n[10]*S,c[11]=n[11]*S,c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15],c},l.scale$1=function(c,n,h){return c[0]=n[0]*h,c[1]=n[1]*h,c[2]=n[2]*h,c[3]=n[3]*h,c},l.setCacheLimits=function(c,n){ui=c,Ci=n},l.setRTLTextPlugin=function(c,n,h=!1){if(Bn===Ua||Bn===ha||Bn===Po)throw new Error("setRTLTextPlugin cannot be called multiple times.");cn=Ze.resolveURL(c),Bn=Ua,pa=n,Va(),h||Bs()},l.spec=ae,l.sphericalToCartesian=function([c,n,h]){return n+=90,n*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(n)*Math.sin(h),y:c*Math.sin(n)*Math.sin(h),z:c*Math.cos(h)}},l.toEvaluationFeature=Os,l.transformMat4=Tc,l.translate=function(c,n,h){var m,v,S,i,t,o,p,f,_,x,E,z,R=h[0],V=h[1],q=h[2];return n===c?(c[12]=n[0]*R+n[4]*V+n[8]*q+n[12],c[13]=n[1]*R+n[5]*V+n[9]*q+n[13],c[14]=n[2]*R+n[6]*V+n[10]*q+n[14],c[15]=n[3]*R+n[7]*V+n[11]*q+n[15]):(v=n[1],S=n[2],i=n[3],t=n[4],o=n[5],p=n[6],f=n[7],_=n[8],x=n[9],E=n[10],z=n[11],c[0]=m=n[0],c[1]=v,c[2]=S,c[3]=i,c[4]=t,c[5]=o,c[6]=p,c[7]=f,c[8]=_,c[9]=x,c[10]=E,c[11]=z,c[12]=m*R+t*V+_*q+n[12],c[13]=v*R+o*V+x*q+n[13],c[14]=S*R+p*V+E*q+n[14],c[15]=i*R+f*V+z*q+n[15]),c},l.triggerPluginCompletionEvent=Ls,l.unicodeBlockLookup=Rt,l.uniqueId=function(){return Fe++},l.validateCustomStyleLayer=function(c){const n=[],h=c.id;return h===void 0&&n.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&n.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&n.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),n},l.validateLight=aa,l.validateStyle=qn,l.vectorTile=Bo,l.warnOnce=nt,l.wrap=me}),O(["./shared"],function(l){function W(B){const M=typeof B;if(M==="number"||M==="boolean"||M==="string"||B==null)return JSON.stringify(B);if(Array.isArray(B)){let H="[";for(const te of B)H+=`${W(te)},`;return`${H}]`}const L=Object.keys(B).sort();let G="{";for(let H=0;H<L.length;H++)G+=`${JSON.stringify(L[H])}:${W(B[L[H]])},`;return`${G}}`}function $(B){let M="";for(const L of l.refProperties)M+=`/${W(B[L])}`;return M}class ue{constructor(M){this.keyCache={},M&&this.replace(M)}replace(M){this._layerConfigs={},this._layers={},this.update(M,[])}update(M,L){for(const H of M){this._layerConfigs[H.id]=H;const te=this._layers[H.id]=l.createStyleLayer(H);te._featureFilter=l.createFilter(te.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of L)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const G=function(H,te){const ne={};for(let se=0;se<H.length;se++){const pe=te&&te[H[se].id]||$(H[se]);te&&(te[H[se].id]=pe);let Ie=ne[pe];Ie||(Ie=ne[pe]=[]),Ie.push(H[se])}const ie=[];for(const se in ne)ie.push(ne[se]);return ie}(Object.values(this._layerConfigs),this.keyCache);for(const H of G){const te=H.map(Se=>this._layers[Se.id]),ne=te[0];if(ne.visibility==="none")continue;const ie=ne.source||"";let se=this.familiesBySource[ie];se||(se=this.familiesBySource[ie]={});const pe=ne.sourceLayer||"_geojsonTileLayer";let Ie=se[pe];Ie||(Ie=se[pe]=[]),Ie.push(te)}}}class re{constructor(M){const L={},G=[];for(const ie in M){const se=M[ie],pe=L[ie]={};for(const Ie in se){const Se=se[+Ie];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const ke={x:0,y:0,w:Se.bitmap.width+2,h:Se.bitmap.height+2};G.push(ke),pe[Ie]={rect:ke,metrics:Se.metrics}}}const{w:H,h:te}=l.potpack(G),ne=new l.AlphaImage({width:H||1,height:te||1});for(const ie in M){const se=M[ie];for(const pe in se){const Ie=se[+pe];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Se=L[ie][pe].rect;l.AlphaImage.copy(Ie.bitmap,ne,{x:0,y:0},{x:Se.x+1,y:Se.y+1},Ie.bitmap)}}this.image=ne,this.positions=L}}l.register("GlyphAtlas",re);class Z{constructor(M){this.tileID=new l.OverscaledTileID(M.tileID.overscaledZ,M.tileID.wrap,M.tileID.canonical.z,M.tileID.canonical.x,M.tileID.canonical.y),this.uid=M.uid,this.zoom=M.zoom,this.pixelRatio=M.pixelRatio,this.tileSize=M.tileSize,this.source=M.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=M.showCollisionBoxes,this.collectResourceTiming=!!M.collectResourceTiming,this.returnDependencies=!!M.returnDependencies,this.promoteId=M.promoteId}parse(M,L,G,H,te){this.status="parsing",this.data=M,this.collisionBoxArray=new l.CollisionBoxArray;const ne=new l.DictionaryCoder(Object.keys(M.layers).sort()),ie=new l.FeatureIndex(this.tileID,this.promoteId);ie.bucketLayerIDs=[];const se={},pe={featureIndex:ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G},Ie=L.familiesBySource[this.source];for(const Et in Ie){const Vt=M.layers[Et];if(!Vt)continue;Vt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${Et}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Kt=ne.encode(Et),Qi=[];for(let Ni=0;Ni<Vt.length;Ni++){const fr=Vt.feature(Ni),gn=ie.getId(fr,Et);Qi.push({feature:fr,id:gn,index:Ni,sourceLayerIndex:Kt})}for(const Ni of Ie[Et]){const fr=Ni[0];fr.minzoom&&this.zoom<Math.floor(fr.minzoom)||fr.maxzoom&&this.zoom>=fr.maxzoom||fr.visibility!=="none"&&(me(Ni,this.zoom,G),(se[fr.id]=fr.createBucket({index:ie.bucketLayerIDs.length,layers:Ni,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kt,sourceID:this.source})).populate(Qi,pe,this.tileID.canonical),ie.bucketLayerIDs.push(Ni.map(gn=>gn.id)))}}let Se,ke,st,he;const qe=l.mapObject(pe.glyphDependencies,Et=>Object.keys(Et).map(Number));Object.keys(qe).length?H.send("getGlyphs",{uid:this.uid,stacks:qe},(Et,Vt)=>{Se||(Se=Et,ke=Vt,Lt.call(this))}):ke={};const ot=Object.keys(pe.iconDependencies);ot.length?H.send("getImages",{icons:ot,source:this.source,tileID:this.tileID,type:"icons"},(Et,Vt)=>{Se||(Se=Et,st=Vt,Lt.call(this))}):st={};const Ut=Object.keys(pe.patternDependencies);function Lt(){if(Se)return te(Se);if(ke&&st&&he){const Et=new re(ke),Vt=new l.ImageAtlas(st,he);for(const Kt in se){const Qi=se[Kt];Qi instanceof l.SymbolBucket?(me(Qi.layers,this.zoom,G),l.performSymbolLayout(Qi,ke,Et.positions,st,Vt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Qi.hasPattern&&(Qi instanceof l.LineBucket||Qi instanceof l.FillBucket||Qi instanceof l.FillExtrusionBucket)&&(me(Qi.layers,this.zoom,G),Qi.addFeatures(pe,this.tileID.canonical,Vt.patternPositions))}this.status="done",te(null,{buckets:Object.values(se).filter(Kt=>!Kt.isEmpty()),featureIndex:ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Et.image,imageAtlas:Vt,glyphMap:this.returnDependencies?ke:null,iconMap:this.returnDependencies?st:null,glyphPositions:this.returnDependencies?Et.positions:null})}}Ut.length?H.send("getImages",{icons:Ut,source:this.source,tileID:this.tileID,type:"patterns"},(Et,Vt)=>{Se||(Se=Et,he=Vt,Lt.call(this))}):he={},Lt.call(this)}}function me(B,M,L){const G=new l.EvaluationParameters(M);for(const H of B)H.recalculate(G,L)}function _e(B,M){const L=l.getArrayBuffer(B.request,(G,H,te,ne)=>{G?M(G):H&&M(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(H)),rawData:H,cacheControl:te,expires:ne})});return()=>{L.cancel(),M()}}class Fe{constructor(M,L,G,H){this.actor=M,this.layerIndex=L,this.availableImages=G,this.loadVectorData=H||_e,this.loading={},this.loaded={}}loadTile(M,L){const G=M.uid;this.loading||(this.loading={});const H=!!(M&&M.request&&M.request.collectResourceTiming)&&new l.RequestPerformance(M.request),te=this.loading[G]=new Z(M);te.abort=this.loadVectorData(M,(ne,ie)=>{if(delete this.loading[G],ne||!ie)return te.status="done",this.loaded[G]=te,L(ne);const se=ie.rawData,pe={};ie.expires&&(pe.expires=ie.expires),ie.cacheControl&&(pe.cacheControl=ie.cacheControl);const Ie={};if(H){const Se=H.finish();Se&&(Ie.resourceTiming=JSON.parse(JSON.stringify(Se)))}te.vectorTile=ie.vectorTile,te.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,(Se,ke)=>{if(Se||!ke)return L(Se);L(null,l.extend({rawTileData:se.slice(0)},ke,pe,Ie))}),this.loaded=this.loaded||{},this.loaded[G]=te})}reloadTile(M,L){const G=this.loaded,H=M.uid,te=this;if(G&&G[H]){const ne=G[H];ne.showCollisionBoxes=M.showCollisionBoxes;const ie=(se,pe)=>{const Ie=ne.reloadCallback;Ie&&(delete ne.reloadCallback,ne.parse(ne.vectorTile,te.layerIndex,this.availableImages,te.actor,Ie)),L(se,pe)};ne.status==="parsing"?ne.reloadCallback=ie:ne.status==="done"&&(ne.vectorTile?ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,ie):ie())}}abortTile(M,L){const G=this.loading,H=M.uid;G&&G[H]&&G[H].abort&&(G[H].abort(),delete G[H]),L()}removeTile(M,L){const G=this.loaded,H=M.uid;G&&G[H]&&delete G[H],L()}}class gt{constructor(){this.loaded={}}loadTile(M,L){const{uid:G,encoding:H,rawImageData:te}=M,ne=l.isImageBitmap(te)?this.getImageData(te):te,ie=new l.DEMData(G,ne,H);this.loaded=this.loaded||{},this.loaded[G]=ie,L(null,ie)}getImageData(M){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(M.width,M.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=M.width,this.offscreenCanvas.height=M.height,this.offscreenCanvasContext.drawImage(M,0,0,M.width,M.height);const L=this.offscreenCanvasContext.getImageData(-1,-1,M.width+2,M.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:L.width,height:L.height},L.data)}removeTile(M){const L=this.loaded,G=M.uid;L&&L[G]&&delete L[G]}}var zt=function B(M,L){var G,H=M&&M.type;if(H==="FeatureCollection")for(G=0;G<M.features.length;G++)B(M.features[G],L);else if(H==="GeometryCollection")for(G=0;G<M.geometries.length;G++)B(M.geometries[G],L);else if(H==="Feature")B(M.geometry,L);else if(H==="Polygon")Ct(M.coordinates,L);else if(H==="MultiPolygon")for(G=0;G<M.coordinates.length;G++)Ct(M.coordinates[G],L);return M};function Ct(B,M){if(B.length!==0){it(B[0],M);for(var L=1;L<B.length;L++)it(B[L],!M)}}function it(B,M){for(var L=0,G=0,H=0,te=B.length,ne=te-1;H<te;ne=H++){var ie=(B[H][0]-B[ne][0])*(B[ne][1]+B[H][1]),se=L+ie;G+=Math.abs(L)>=Math.abs(ie)?L-se+ie:ie-se+L,L=se}L+G>=0!=!!M&&B.reverse()}const je=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class nt{constructor(M){this._feature=M,this.extent=l.EXTENT,this.type=M.type,this.properties=M.tags,"id"in M&&!isNaN(M.id)&&(this.id=parseInt(M.id,10))}loadGeometry(){if(this._feature.type===1){const M=[];for(const L of this._feature.geometry)M.push([new l.pointGeometry(L[0],L[1])]);return M}{const M=[];for(const L of this._feature.geometry){const G=[];for(const H of L)G.push(new l.pointGeometry(H[0],H[1]));M.push(G)}return M}}toGeoJSON(M,L,G){return je.call(this,M,L,G)}}class ct{constructor(M){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=M.length,this._features=M}feature(M){return new nt(this._features[M])}}var Xe={exports:{}},at=l.pointGeometry,rt=l.vectorTile.VectorTileFeature,Oe=bt;function bt(B,M){this.options=M||{},this.features=B,this.length=B.length}function We(B,M){this.id=typeof B.id=="number"?B.id:void 0,this.type=B.type,this.rawGeometry=B.type===1?[B.geometry]:B.geometry,this.properties=B.tags,this.extent=M||4096}bt.prototype.feature=function(B){return new We(this.features[B],this.options.extent)},We.prototype.loadGeometry=function(){var B=this.rawGeometry;this.geometry=[];for(var M=0;M<B.length;M++){for(var L=B[M],G=[],H=0;H<L.length;H++)G.push(new at(L[H][0],L[H][1]));this.geometry.push(G)}return this.geometry},We.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var B=this.geometry,M=1/0,L=-1/0,G=1/0,H=-1/0,te=0;te<B.length;te++)for(var ne=B[te],ie=0;ie<ne.length;ie++){var se=ne[ie];M=Math.min(M,se.x),L=Math.max(L,se.x),G=Math.min(G,se.y),H=Math.max(H,se.y)}return[M,G,L,H]},We.prototype.toGeoJSON=rt.prototype.toGeoJSON;var ft=l.pbf,wt=Oe;function Ze(B){var M=new ft;return function(L,G){for(var H in L.layers)G.writeMessage(3,De,L.layers[H])}(B,M),M.finish()}function De(B,M){var L;M.writeVarintField(15,B.version||1),M.writeStringField(1,B.name||""),M.writeVarintField(5,B.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<B.length;L++)G.feature=B.feature(L),M.writeMessage(2,Wt,G);var H=G.keys;for(L=0;L<H.length;L++)M.writeStringField(3,H[L]);var te=G.values;for(L=0;L<te.length;L++)M.writeMessage(4,ui,te[L])}function Wt(B,M){var L=B.feature;L.id!==void 0&&M.writeVarintField(1,L.id),M.writeMessage(2,si,B),M.writeVarintField(3,L.type),M.writeMessage(4,gi,L)}function si(B,M){var L=B.feature,G=B.keys,H=B.values,te=B.keycache,ne=B.valuecache;for(var ie in L.properties){var se=L.properties[ie],pe=te[ie];if(se!==null){pe===void 0&&(G.push(ie),te[ie]=pe=G.length-1),M.writeVarint(pe);var Ie=typeof se;Ie!=="string"&&Ie!=="boolean"&&Ie!=="number"&&(se=JSON.stringify(se));var Se=Ie+":"+se,ke=ne[Se];ke===void 0&&(H.push(se),ne[Se]=ke=H.length-1),M.writeVarint(ke)}}}function vt(B,M){return(M<<3)+(7&B)}function Ht(B){return B<<1^B>>31}function gi(B,M){for(var L=B.loadGeometry(),G=B.type,H=0,te=0,ne=L.length,ie=0;ie<ne;ie++){var se=L[ie],pe=1;G===1&&(pe=se.length),M.writeVarint(vt(1,pe));for(var Ie=G===3?se.length-1:se.length,Se=0;Se<Ie;Se++){Se===1&&G!==1&&M.writeVarint(vt(2,Ie-1));var ke=se[Se].x-H,st=se[Se].y-te;M.writeVarint(Ht(ke)),M.writeVarint(Ht(st)),H+=ke,te+=st}G===3&&M.writeVarint(vt(7,1))}}function ui(B,M){var L=typeof B;L==="string"?M.writeStringField(1,B):L==="boolean"?M.writeBooleanField(7,B):L==="number"&&(B%1!=0?M.writeDoubleField(3,B):B<0?M.writeSVarintField(6,B):M.writeVarintField(5,B))}Xe.exports=Ze,Xe.exports.fromVectorTileJs=Ze,Xe.exports.fromGeojsonVt=function(B,M){M=M||{};var L={};for(var G in B)L[G]=new wt(B[G].features,M),L[G].name=G,L[G].version=M.version,L[G].extent=M.extent;return Ze({layers:L})},Xe.exports.GeoJSONWrapper=wt;var Ci=Xe.exports;function fi(B,M,L,G,H,te){if(H-G<=L)return;const ne=G+H>>1;ei(B,M,ne,G,H,te%2),fi(B,M,L,G,ne-1,te+1),fi(B,M,L,ne+1,H,te+1)}function ei(B,M,L,G,H,te){for(;H>G;){if(H-G>600){const pe=H-G+1,Ie=L-G+1,Se=Math.log(pe),ke=.5*Math.exp(2*Se/3),st=.5*Math.sqrt(Se*ke*(pe-ke)/pe)*(Ie-pe/2<0?-1:1);ei(B,M,L,Math.max(G,Math.floor(L-Ie*ke/pe+st)),Math.min(H,Math.floor(L+(pe-Ie)*ke/pe+st)),te)}const ne=M[2*L+te];let ie=G,se=H;for(_i(B,M,G,L),M[2*H+te]>ne&&_i(B,M,G,H);ie<se;){for(_i(B,M,ie,se),ie++,se--;M[2*ie+te]<ne;)ie++;for(;M[2*se+te]>ne;)se--}M[2*G+te]===ne?_i(B,M,G,se):(se++,_i(B,M,se,H)),se<=L&&(G=se+1),L<=se&&(H=se-1)}}function _i(B,M,L,G){$i(B,L,G),$i(M,2*L,2*G),$i(M,2*L+1,2*G+1)}function $i(B,M,L){const G=B[M];B[M]=B[L],B[L]=G}function lt(B,M,L,G){const H=B-L,te=M-G;return H*H+te*te}const $e=B=>B[0],di=B=>B[1];class Ui{constructor(M,L=$e,G=di,H=64,te=Float64Array){this.nodeSize=H,this.points=M;const ne=M.length<65536?Uint16Array:Uint32Array,ie=this.ids=new ne(M.length),se=this.coords=new te(2*M.length);for(let pe=0;pe<M.length;pe++)ie[pe]=pe,se[2*pe]=L(M[pe]),se[2*pe+1]=G(M[pe]);fi(ie,se,H,0,ie.length-1,0)}range(M,L,G,H){return function(te,ne,ie,se,pe,Ie,Se){const ke=[0,te.length-1,0],st=[];let he,qe;for(;ke.length;){const ot=ke.pop(),Ut=ke.pop(),Lt=ke.pop();if(Ut-Lt<=Se){for(let Kt=Lt;Kt<=Ut;Kt++)he=ne[2*Kt],qe=ne[2*Kt+1],he>=ie&&he<=pe&&qe>=se&&qe<=Ie&&st.push(te[Kt]);continue}const Et=Math.floor((Lt+Ut)/2);he=ne[2*Et],qe=ne[2*Et+1],he>=ie&&he<=pe&&qe>=se&&qe<=Ie&&st.push(te[Et]);const Vt=(ot+1)%2;(ot===0?ie<=he:se<=qe)&&(ke.push(Lt),ke.push(Et-1),ke.push(Vt)),(ot===0?pe>=he:Ie>=qe)&&(ke.push(Et+1),ke.push(Ut),ke.push(Vt))}return st}(this.ids,this.coords,M,L,G,H,this.nodeSize)}within(M,L,G){return function(H,te,ne,ie,se,pe){const Ie=[0,H.length-1,0],Se=[],ke=se*se;for(;Ie.length;){const st=Ie.pop(),he=Ie.pop(),qe=Ie.pop();if(he-qe<=pe){for(let Vt=qe;Vt<=he;Vt++)lt(te[2*Vt],te[2*Vt+1],ne,ie)<=ke&&Se.push(H[Vt]);continue}const ot=Math.floor((qe+he)/2),Ut=te[2*ot],Lt=te[2*ot+1];lt(Ut,Lt,ne,ie)<=ke&&Se.push(H[ot]);const Et=(st+1)%2;(st===0?ne-se<=Ut:ie-se<=Lt)&&(Ie.push(qe),Ie.push(ot-1),Ie.push(Et)),(st===0?ne+se>=Ut:ie+se>=Lt)&&(Ie.push(ot+1),Ie.push(he),Ie.push(Et))}return Se}(this.ids,this.coords,M,L,G,this.nodeSize)}}const Mr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:B=>B},Ai=Math.fround||(gr=new Float32Array(1),B=>(gr[0]=+B,gr[0]));var gr;class _r{constructor(M){this.options=Qt(Object.create(Mr),M),this.trees=new Array(this.options.maxZoom+1)}load(M){const{log:L,minZoom:G,maxZoom:H,nodeSize:te}=this.options;L&&console.time("total time");const ne=`prepare ${M.length} points`;L&&console.time(ne),this.points=M;let ie=[];for(let se=0;se<M.length;se++)M[se].geometry&&ie.push(Dr(M[se],se));this.trees[H+1]=new Ui(ie,tr,Di,te,Float32Array),L&&console.timeEnd(ne);for(let se=H;se>=G;se--){const pe=+Date.now();ie=this._cluster(ie,se),this.trees[se]=new Ui(ie,tr,Di,te,Float32Array),L&&console.log("z%d: %d clusters in %dms",se,ie.length,+Date.now()-pe)}return L&&console.timeEnd("total time"),this}getClusters(M,L){let G=((M[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,M[1]));let te=M[2]===180?180:((M[2]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,M[3]));if(M[2]-M[0]>=360)G=-180,te=180;else if(G>te){const Ie=this.getClusters([G,H,180,ne],L),Se=this.getClusters([-180,H,te,ne],L);return Ie.concat(Se)}const ie=this.trees[this._limitZoom(L)],se=ie.range(br(G),cr(ne),br(te),cr(H)),pe=[];for(const Ie of se){const Se=ie.points[Ie];pe.push(Se.numPoints?Jr(Se):this.points[Se.index])}return pe}getChildren(M){const L=this._getOriginId(M),G=this._getOriginZoom(M),H="No cluster with the specified id.",te=this.trees[G];if(!te)throw new Error(H);const ne=te.points[L];if(!ne)throw new Error(H);const ie=this.options.radius/(this.options.extent*Math.pow(2,G-1)),se=te.within(ne.x,ne.y,ie),pe=[];for(const Ie of se){const Se=te.points[Ie];Se.parentId===M&&pe.push(Se.numPoints?Jr(Se):this.points[Se.index])}if(pe.length===0)throw new Error(H);return pe}getLeaves(M,L,G){const H=[];return this._appendLeaves(H,M,L=L||10,G=G||0,0),H}getTile(M,L,G){const H=this.trees[this._limitZoom(M)],te=Math.pow(2,M),{extent:ne,radius:ie}=this.options,se=ie/ne,pe=(G-se)/te,Ie=(G+1+se)/te,Se={features:[]};return this._addTileFeatures(H.range((L-se)/te,pe,(L+1+se)/te,Ie),H.points,L,G,te,Se),L===0&&this._addTileFeatures(H.range(1-se/te,pe,1,Ie),H.points,te,G,te,Se),L===te-1&&this._addTileFeatures(H.range(0,pe,se/te,Ie),H.points,-1,G,te,Se),Se.features.length?Se:null}getClusterExpansionZoom(M){let L=this._getOriginZoom(M)-1;for(;L<=this.options.maxZoom;){const G=this.getChildren(M);if(L++,G.length!==1)break;M=G[0].properties.cluster_id}return L}_appendLeaves(M,L,G,H,te){const ne=this.getChildren(L);for(const ie of ne){const se=ie.properties;if(se&&se.cluster?te+se.point_count<=H?te+=se.point_count:te=this._appendLeaves(M,se.cluster_id,G,H,te):te<H?te++:M.push(ie),M.length===G)break}return te}_addTileFeatures(M,L,G,H,te,ne){for(const ie of M){const se=L[ie],pe=se.numPoints;let Ie,Se,ke;if(pe)Ie=bi(se),Se=se.x,ke=se.y;else{const qe=this.points[se.index];Ie=qe.properties,Se=br(qe.geometry.coordinates[0]),ke=cr(qe.geometry.coordinates[1])}const st={type:1,geometry:[[Math.round(this.options.extent*(Se*te-G)),Math.round(this.options.extent*(ke*te-H))]],tags:Ie};let he;pe?he=se.id:this.options.generateId?he=se.index:this.points[se.index].id&&(he=this.points[se.index].id),he!==void 0&&(st.id=he),ne.features.push(st)}}_limitZoom(M){return Math.max(this.options.minZoom,Math.min(+M,this.options.maxZoom+1))}_cluster(M,L){const G=[],{radius:H,extent:te,reduce:ne,minPoints:ie}=this.options,se=H/(te*Math.pow(2,L));for(let pe=0;pe<M.length;pe++){const Ie=M[pe];if(Ie.zoom<=L)continue;Ie.zoom=L;const Se=this.trees[L+1],ke=Se.within(Ie.x,Ie.y,se),st=Ie.numPoints||1;let he=st;for(const qe of ke){const ot=Se.points[qe];ot.zoom>L&&(he+=ot.numPoints||1)}if(he>st&&he>=ie){let qe=Ie.x*st,ot=Ie.y*st,Ut=ne&&st>1?this._map(Ie,!0):null;const Lt=(pe<<5)+(L+1)+this.points.length;for(const Et of ke){const Vt=Se.points[Et];if(Vt.zoom<=L)continue;Vt.zoom=L;const Kt=Vt.numPoints||1;qe+=Vt.x*Kt,ot+=Vt.y*Kt,Vt.parentId=Lt,ne&&(Ut||(Ut=this._map(Ie,!0)),ne(Ut,this._map(Vt)))}Ie.parentId=Lt,G.push(Er(qe/he,ot/he,Lt,he,Ut))}else if(G.push(Ie),he>1)for(const qe of ke){const ot=Se.points[qe];ot.zoom<=L||(ot.zoom=L,G.push(ot))}}return G}_getOriginId(M){return M-this.points.length>>5}_getOriginZoom(M){return(M-this.points.length)%32}_map(M,L){if(M.numPoints)return L?Qt({},M.properties):M.properties;const G=this.points[M.index].properties,H=this.options.map(G);return L&&H===G?Qt({},H):H}}function Er(B,M,L,G,H){return{x:Ai(B),y:Ai(M),zoom:1/0,id:L,parentId:-1,numPoints:G,properties:H}}function Dr(B,M){const[L,G]=B.geometry.coordinates;return{x:Ai(br(L)),y:Ai(cr(G)),zoom:1/0,index:M,parentId:-1}}function Jr(B){return{type:"Feature",id:B.id,properties:bi(B),geometry:{type:"Point",coordinates:[(M=B.x,360*(M-.5)),Hi(B.y)]}};var M}function bi(B){const M=B.numPoints,L=M>=1e4?`${Math.round(M/1e3)}k`:M>=1e3?Math.round(M/100)/10+"k":M;return Qt(Qt({},B.properties),{cluster:!0,cluster_id:B.id,point_count:M,point_count_abbreviated:L})}function br(B){return B/360+.5}function cr(B){const M=Math.sin(B*Math.PI/180),L=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return L<0?0:L>1?1:L}function Hi(B){const M=(180-360*B)*Math.PI/180;return 360*Math.atan(Math.exp(M))/Math.PI-90}function Qt(B,M){for(const L in M)B[L]=M[L];return B}function tr(B){return B.x}function Di(B){return B.y}function jt(B,M,L,G){for(var H,te=G,ne=L-M>>1,ie=L-M,se=B[M],pe=B[M+1],Ie=B[L],Se=B[L+1],ke=M+3;ke<L;ke+=3){var st=Vi(B[ke],B[ke+1],se,pe,Ie,Se);if(st>te)H=ke,te=st;else if(st===te){var he=Math.abs(ke-ne);he<ie&&(H=ke,ie=he)}}te>G&&(H-M>3&&jt(B,M,H,G),B[H+2]=te,L-H>3&&jt(B,H,L,G))}function Vi(B,M,L,G,H,te){var ne=H-L,ie=te-G;if(ne!==0||ie!==0){var se=((B-L)*ne+(M-G)*ie)/(ne*ne+ie*ie);se>1?(L=H,G=te):se>0&&(L+=ne*se,G+=ie*se)}return(ne=B-L)*ne+(ie=M-G)*ie}function ae(B,M,L,G){var H={id:B===void 0?null:B,type:M,geometry:L,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(te){var ne=te.geometry,ie=te.type;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")Ae(te,ne);else if(ie==="Polygon"||ie==="MultiLineString")for(var se=0;se<ne.length;se++)Ae(te,ne[se]);else if(ie==="MultiPolygon")for(se=0;se<ne.length;se++)for(var pe=0;pe<ne[se].length;pe++)Ae(te,ne[se][pe])}(H),H}function Ae(B,M){for(var L=0;L<M.length;L+=3)B.minX=Math.min(B.minX,M[L]),B.minY=Math.min(B.minY,M[L+1]),B.maxX=Math.max(B.maxX,M[L]),B.maxY=Math.max(B.maxY,M[L+1])}function $r(B,M,L,G){if(M.geometry){var H=M.geometry.coordinates,te=M.geometry.type,ne=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),ie=[],se=M.id;if(L.promoteId?se=M.properties[L.promoteId]:L.generateId&&(se=G||0),te==="Point")yr(H,ie);else if(te==="MultiPoint")for(var pe=0;pe<H.length;pe++)yr(H[pe],ie);else if(te==="LineString")Gt(H,ie,ne,!1);else if(te==="MultiLineString"){if(L.lineMetrics){for(pe=0;pe<H.length;pe++)Gt(H[pe],ie=[],ne,!1),B.push(ae(se,"LineString",ie,M.properties));return}hi(H,ie,ne,!1)}else if(te==="Polygon")hi(H,ie,ne,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(pe=0;pe<M.geometry.geometries.length;pe++)$r(B,{id:se,geometry:M.geometry.geometries[pe],properties:M.properties},L,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pe=0;pe<H.length;pe++){var Ie=[];hi(H[pe],Ie,ne,!0),ie.push(Ie)}}B.push(ae(se,te,ie,M.properties))}}function yr(B,M){M.push(Ti(B[0])),M.push(xr(B[1])),M.push(0)}function Gt(B,M,L,G){for(var H,te,ne=0,ie=0;ie<B.length;ie++){var se=Ti(B[ie][0]),pe=xr(B[ie][1]);M.push(se),M.push(pe),M.push(0),ie>0&&(ne+=G?(H*pe-se*te)/2:Math.sqrt(Math.pow(se-H,2)+Math.pow(pe-te,2))),H=se,te=pe}var Ie=M.length-3;M[2]=1,jt(M,0,Ie,L),M[Ie+2]=1,M.size=Math.abs(ne),M.start=0,M.end=M.size}function hi(B,M,L,G){for(var H=0;H<B.length;H++){var te=[];Gt(B[H],te,L,G),M.push(te)}}function Ti(B){return B/360+.5}function xr(B){var M=Math.sin(B*Math.PI/180),L=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return L<0?0:L>1?1:L}function Mi(B,M,L,G,H,te,ne,ie){if(G/=M,te>=(L/=M)&&ne<G)return B;if(ne<L||te>=G)return null;for(var se=[],pe=0;pe<B.length;pe++){var Ie=B[pe],Se=Ie.geometry,ke=Ie.type,st=H===0?Ie.minX:Ie.minY,he=H===0?Ie.maxX:Ie.maxY;if(st>=L&&he<G)se.push(Ie);else if(!(he<L||st>=G)){var qe=[];if(ke==="Point"||ke==="MultiPoint")Ve(Se,qe,L,G,H);else if(ke==="LineString")Dt(Se,qe,L,G,H,!1,ie.lineMetrics);else if(ke==="MultiLineString")Ii(Se,qe,L,G,H,!1);else if(ke==="Polygon")Ii(Se,qe,L,G,H,!0);else if(ke==="MultiPolygon")for(var ot=0;ot<Se.length;ot++){var Ut=[];Ii(Se[ot],Ut,L,G,H,!0),Ut.length&&qe.push(Ut)}if(qe.length){if(ie.lineMetrics&&ke==="LineString"){for(ot=0;ot<qe.length;ot++)se.push(ae(Ie.id,ke,qe[ot],Ie.tags));continue}ke!=="LineString"&&ke!=="MultiLineString"||(qe.length===1?(ke="LineString",qe=qe[0]):ke="MultiLineString"),ke!=="Point"&&ke!=="MultiPoint"||(ke=qe.length===3?"Point":"MultiPoint"),se.push(ae(Ie.id,ke,qe,Ie.tags))}}}return se.length?se:null}function Ve(B,M,L,G,H){for(var te=0;te<B.length;te+=3){var ne=B[te+H];ne>=L&&ne<=G&&(M.push(B[te]),M.push(B[te+1]),M.push(B[te+2]))}}function Dt(B,M,L,G,H,te,ne){for(var ie,se,pe=Pt(B),Ie=H===0?Mt:kn,Se=B.start,ke=0;ke<B.length-3;ke+=3){var st=B[ke],he=B[ke+1],qe=B[ke+2],ot=B[ke+3],Ut=B[ke+4],Lt=H===0?st:he,Et=H===0?ot:Ut,Vt=!1;ne&&(ie=Math.sqrt(Math.pow(st-ot,2)+Math.pow(he-Ut,2))),Lt<L?Et>L&&(se=Ie(pe,st,he,ot,Ut,L),ne&&(pe.start=Se+ie*se)):Lt>G?Et<G&&(se=Ie(pe,st,he,ot,Ut,G),ne&&(pe.start=Se+ie*se)):Ar(pe,st,he,qe),Et<L&&Lt>=L&&(se=Ie(pe,st,he,ot,Ut,L),Vt=!0),Et>G&&Lt<=G&&(se=Ie(pe,st,he,ot,Ut,G),Vt=!0),!te&&Vt&&(ne&&(pe.end=Se+ie*se),M.push(pe),pe=Pt(B)),ne&&(Se+=ie)}var Kt=B.length-3;st=B[Kt],he=B[Kt+1],qe=B[Kt+2],(Lt=H===0?st:he)>=L&&Lt<=G&&Ar(pe,st,he,qe),Kt=pe.length-3,te&&Kt>=3&&(pe[Kt]!==pe[0]||pe[Kt+1]!==pe[1])&&Ar(pe,pe[0],pe[1],pe[2]),pe.length&&M.push(pe)}function Pt(B){var M=[];return M.size=B.size,M.start=B.start,M.end=B.end,M}function Ii(B,M,L,G,H,te){for(var ne=0;ne<B.length;ne++)Dt(B[ne],M,L,G,H,te,!1)}function Ar(B,M,L,G){B.push(M),B.push(L),B.push(G)}function Mt(B,M,L,G,H,te){var ne=(te-M)/(G-M);return B.push(te),B.push(L+(H-L)*ne),B.push(1),ne}function kn(B,M,L,G,H,te){var ne=(te-L)/(H-L);return B.push(M+(G-M)*ne),B.push(te),B.push(1),ne}function vr(B,M){for(var L=[],G=0;G<B.length;G++){var H,te=B[G],ne=te.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")H=bn(te.geometry,M);else if(ne==="MultiLineString"||ne==="Polygon"){H=[];for(var ie=0;ie<te.geometry.length;ie++)H.push(bn(te.geometry[ie],M))}else if(ne==="MultiPolygon")for(H=[],ie=0;ie<te.geometry.length;ie++){for(var se=[],pe=0;pe<te.geometry[ie].length;pe++)se.push(bn(te.geometry[ie][pe],M));H.push(se)}L.push(ae(te.id,ne,H,te.tags))}return L}function bn(B,M){var L=[];L.size=B.size,B.start!==void 0&&(L.start=B.start,L.end=B.end);for(var G=0;G<B.length;G+=3)L.push(B[G]+M,B[G+1],B[G+2]);return L}function ki(B,M){if(B.transformed)return B;var L,G,H,te=1<<B.z,ne=B.x,ie=B.y;for(L=0;L<B.features.length;L++){var se=B.features[L],pe=se.geometry,Ie=se.type;if(se.geometry=[],Ie===1)for(G=0;G<pe.length;G+=2)se.geometry.push(pi(pe[G],pe[G+1],M,te,ne,ie));else for(G=0;G<pe.length;G++){var Se=[];for(H=0;H<pe[G].length;H+=2)Se.push(pi(pe[G][H],pe[G][H+1],M,te,ne,ie));se.geometry.push(Se)}}return B.transformed=!0,B}function pi(B,M,L,G,H,te){return[Math.round(L*(B*G-H)),Math.round(L*(M*G-te))]}function hn(B,M,L,G,H){for(var te=M===H.maxZoom?0:H.tolerance/((1<<M)*H.extent),ne={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:G,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ie=0;ie<B.length;ie++){ne.numFeatures++,mn(ne,B[ie],te,H);var se=B[ie].minX,pe=B[ie].minY,Ie=B[ie].maxX,Se=B[ie].maxY;se<ne.minX&&(ne.minX=se),pe<ne.minY&&(ne.minY=pe),Ie>ne.maxX&&(ne.maxX=Ie),Se>ne.maxY&&(ne.maxY=Se)}return ne}function mn(B,M,L,G){var H=M.geometry,te=M.type,ne=[];if(te==="Point"||te==="MultiPoint")for(var ie=0;ie<H.length;ie+=3)ne.push(H[ie]),ne.push(H[ie+1]),B.numPoints++,B.numSimplified++;else if(te==="LineString")wr(ne,H,B,L,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(ie=0;ie<H.length;ie++)wr(ne,H[ie],B,L,te==="Polygon",ie===0);else if(te==="MultiPolygon")for(var se=0;se<H.length;se++){var pe=H[se];for(ie=0;ie<pe.length;ie++)wr(ne,pe[ie],B,L,!0,ie===0)}if(ne.length){var Ie=M.tags||null;if(te==="LineString"&&G.lineMetrics){for(var Se in Ie={},M.tags)Ie[Se]=M.tags[Se];Ie.mapbox_clip_start=H.start/H.size,Ie.mapbox_clip_end=H.end/H.size}var ke={geometry:ne,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:Ie};M.id!==null&&(ke.id=M.id),B.features.push(ke)}}function wr(B,M,L,G,H,te){var ne=G*G;if(G>0&&M.size<(H?ne:G))L.numPoints+=M.length/3;else{for(var ie=[],se=0;se<M.length;se+=3)(G===0||M[se+2]>ne)&&(L.numSimplified++,ie.push(M[se]),ie.push(M[se+1])),L.numPoints++;H&&function(pe,Ie){for(var Se=0,ke=0,st=pe.length,he=st-2;ke<st;he=ke,ke+=2)Se+=(pe[ke]-pe[he])*(pe[ke+1]+pe[he+1]);if(Se>0===Ie)for(ke=0,st=pe.length;ke<st/2;ke+=2){var qe=pe[ke],ot=pe[ke+1];pe[ke]=pe[st-2-ke],pe[ke+1]=pe[st-1-ke],pe[st-2-ke]=qe,pe[st-1-ke]=ot}}(ie,te),B.push(ie)}}function an(B,M){var L=(M=this.options=function(H,te){for(var ne in te)H[ne]=te[ne];return H}(Object.create(this.options),M)).debug;if(L&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var G=function(H,te){var ne=[];if(H.type==="FeatureCollection")for(var ie=0;ie<H.features.length;ie++)$r(ne,H.features[ie],te,ie);else $r(ne,H.type==="Feature"?H:{geometry:H},te);return ne}(B,M);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),G=function(H,te){var ne=te.buffer/te.extent,ie=H,se=Mi(H,1,-1-ne,ne,0,-1,2,te),pe=Mi(H,1,1-ne,2+ne,0,-1,2,te);return(se||pe)&&(ie=Mi(H,1,-ne,1+ne,0,-1,2,te)||[],se&&(ie=vr(se,1).concat(ie)),pe&&(ie=ie.concat(vr(pe,-1)))),ie}(G,M),G.length&&this.splitTile(G,0,0,0),L&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wn(B,M,L){return 32*((1<<B)*L+M)+B}function is(B,M){const L=B.tileID.canonical;if(!this._geoJSONIndex)return M(null,null);const G=this._geoJSONIndex.getTile(L.z,L.x,L.y);if(!G)return M(null,null);const H=new ct(G.features);let te=Ci(H);te.byteOffset===0&&te.byteLength===te.buffer.byteLength||(te=new Uint8Array(te)),M(null,{vectorTile:H,rawData:te.buffer})}an.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},an.prototype.splitTile=function(B,M,L,G,H,te,ne){for(var ie=[B,M,L,G],se=this.options,pe=se.debug;ie.length;){G=ie.pop(),L=ie.pop(),M=ie.pop(),B=ie.pop();var Ie=1<<M,Se=wn(M,L,G),ke=this.tiles[Se];if(!ke&&(pe>1&&console.time("creation"),ke=this.tiles[Se]=hn(B,M,L,G,se),this.tileCoords.push({z:M,x:L,y:G}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,L,G,ke.numFeatures,ke.numPoints,ke.numSimplified),console.timeEnd("creation"));var st="z"+M;this.stats[st]=(this.stats[st]||0)+1,this.total++}if(ke.source=B,H){if(M===se.maxZoom||M===H)continue;var he=1<<H-M;if(L!==Math.floor(te/he)||G!==Math.floor(ne/he))continue}else if(M===se.indexMaxZoom||ke.numPoints<=se.indexMaxPoints)continue;if(ke.source=null,B.length!==0){pe>1&&console.time("clipping");var qe,ot,Ut,Lt,Et,Vt,Kt=.5*se.buffer/se.extent,Qi=.5-Kt,Ni=.5+Kt,fr=1+Kt;qe=ot=Ut=Lt=null,Et=Mi(B,Ie,L-Kt,L+Ni,0,ke.minX,ke.maxX,se),Vt=Mi(B,Ie,L+Qi,L+fr,0,ke.minX,ke.maxX,se),B=null,Et&&(qe=Mi(Et,Ie,G-Kt,G+Ni,1,ke.minY,ke.maxY,se),ot=Mi(Et,Ie,G+Qi,G+fr,1,ke.minY,ke.maxY,se),Et=null),Vt&&(Ut=Mi(Vt,Ie,G-Kt,G+Ni,1,ke.minY,ke.maxY,se),Lt=Mi(Vt,Ie,G+Qi,G+fr,1,ke.minY,ke.maxY,se),Vt=null),pe>1&&console.timeEnd("clipping"),ie.push(qe||[],M+1,2*L,2*G),ie.push(ot||[],M+1,2*L,2*G+1),ie.push(Ut||[],M+1,2*L+1,2*G),ie.push(Lt||[],M+1,2*L+1,2*G+1)}}},an.prototype.getTile=function(B,M,L){var G=this.options,H=G.extent,te=G.debug;if(B<0||B>24)return null;var ne=1<<B,ie=wn(B,M=(M%ne+ne)%ne,L);if(this.tiles[ie])return ki(this.tiles[ie],H);te>1&&console.log("drilling down to z%d-%d-%d",B,M,L);for(var se,pe=B,Ie=M,Se=L;!se&&pe>0;)pe--,Ie=Math.floor(Ie/2),Se=Math.floor(Se/2),se=this.tiles[wn(pe,Ie,Se)];return se&&se.source?(te>1&&console.log("found parent tile z%d-%d-%d",pe,Ie,Se),te>1&&console.time("drilling down"),this.splitTile(se.source,pe,Ie,Se,B,M,L),te>1&&console.timeEnd("drilling down"),this.tiles[ie]?ki(this.tiles[ie],H):null):null};class Tn extends Fe{constructor(M,L,G,H){super(M,L,G,is),H&&(this.loadGeoJSON=H)}loadData(M,L){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=L,this._pendingLoadDataParams=M,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const M=this._pendingCallback,L=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const G=!!(L&&L.request&&L.request.collectResourceTiming)&&new l.RequestPerformance(L.request);this.loadGeoJSON(L,(H,te)=>{if(H||!te)return M(H);if(typeof te!="object")return M(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{zt(te,!0);try{if(L.filter){const ie=l.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));const se=te.features.filter(pe=>ie.value.evaluate({zoom:0},pe));te={type:"FeatureCollection",features:se}}this._geoJSONIndex=L.cluster?new _r(function({superclusterOptions:ie,clusterProperties:se}){if(!se||!ie)return ie;const pe={},Ie={},Se={accumulated:null,zoom:0},ke={properties:null},st=Object.keys(se);for(const he of st){const[qe,ot]=se[he],Ut=l.createExpression(ot),Lt=l.createExpression(typeof qe=="string"?[qe,["accumulated"],["get",he]]:qe);pe[he]=Ut.value,Ie[he]=Lt.value}return ie.map=he=>{ke.properties=he;const qe={};for(const ot of st)qe[ot]=pe[ot].evaluate(Se,ke);return qe},ie.reduce=(he,qe)=>{ke.properties=qe;for(const ot of st)Se.accumulated=he[ot],he[ot]=Ie[ot].evaluate(Se,ke)},ie}(L)).load(te.features):function(ie,se){return new an(ie,se)}(te,L.geojsonVtOptions)}catch(ie){return M(ie)}this.loaded={};const ne={};if(G){const ie=G.finish();ie&&(ne.resourceTiming={},ne.resourceTiming[L.source]=JSON.parse(JSON.stringify(ie)))}M(null,ne)}})}coalesce(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())}reloadTile(M,L){const G=this.loaded;return G&&G[M.uid]?super.reloadTile(M,L):this.loadTile(M,L)}loadGeoJSON(M,L){if(M.request)l.getJSON(M.request,L);else{if(typeof M.data!="string")return L(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));try{return L(null,JSON.parse(M.data))}catch{return L(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`))}}}removeSource(M,L){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),L()}getClusterExpansionZoom(M,L){try{L(null,this._geoJSONIndex.getClusterExpansionZoom(M.clusterId))}catch(G){L(G)}}getClusterChildren(M,L){try{L(null,this._geoJSONIndex.getChildren(M.clusterId))}catch(G){L(G)}}getClusterLeaves(M,L){try{L(null,this._geoJSONIndex.getLeaves(M.clusterId,M.limit,M.offset))}catch(G){L(G)}}}class ge{constructor(M){this.self=M,this.actor=new l.Actor(M,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Fe,geojson:Tn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(L,G)=>{if(this.workerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.workerSourceTypes[L]=G},this.self.registerRTLTextPlugin=L=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=L.applyArabicShaping,l.plugin.processBidirectionalText=L.processBidirectionalText,l.plugin.processStyledBidirectionalText=L.processStyledBidirectionalText}}setReferrer(M,L){this.referrer=L}setImages(M,L,G){this.availableImages[M]=L;for(const H in this.workerSources[M]){const te=this.workerSources[M][H];for(const ne in te)te[ne].availableImages=L}G()}setLayers(M,L,G){this.getLayerIndex(M).replace(L),G()}updateLayers(M,L,G){this.getLayerIndex(M).update(L.layers,L.removedIds),G()}loadTile(M,L,G){this.getWorkerSource(M,L.type,L.source).loadTile(L,G)}loadDEMTile(M,L,G){this.getDEMWorkerSource(M,L.source).loadTile(L,G)}reloadTile(M,L,G){this.getWorkerSource(M,L.type,L.source).reloadTile(L,G)}abortTile(M,L,G){this.getWorkerSource(M,L.type,L.source).abortTile(L,G)}removeTile(M,L,G){this.getWorkerSource(M,L.type,L.source).removeTile(L,G)}removeDEMTile(M,L){this.getDEMWorkerSource(M,L.source).removeTile(L)}removeSource(M,L,G){if(!this.workerSources[M]||!this.workerSources[M][L.type]||!this.workerSources[M][L.type][L.source])return;const H=this.workerSources[M][L.type][L.source];delete this.workerSources[M][L.type][L.source],H.removeSource!==void 0?H.removeSource(L,G):G()}loadWorkerSource(M,L,G){try{this.self.importScripts(L.url),G()}catch(H){G(H.toString())}}syncRTLPluginState(M,L,G){try{l.plugin.setState(L);const H=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&H!=null){this.self.importScripts(H);const te=l.plugin.isParsed();G(te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${H}`),te)}}catch(H){G(H.toString())}}getAvailableImages(M){let L=this.availableImages[M];return L||(L=[]),L}getLayerIndex(M){let L=this.layerIndexes[M];return L||(L=this.layerIndexes[M]=new ue),L}getWorkerSource(M,L,G){if(this.workerSources[M]||(this.workerSources[M]={}),this.workerSources[M][L]||(this.workerSources[M][L]={}),!this.workerSources[M][L][G]){const H={send:(te,ne,ie)=>{this.actor.send(te,ne,ie,M)}};this.workerSources[M][L][G]=new this.workerSourceTypes[L](H,this.getLayerIndex(M),this.getAvailableImages(M))}return this.workerSources[M][L][G]}getDEMWorkerSource(M,L){return this.demWorkerSources[M]||(this.demWorkerSources[M]={}),this.demWorkerSources[M][L]||(this.demWorkerSources[M][L]=new gt),this.demWorkerSources[M][L]}enforceCacheSizeLimit(M,L){l.enforceCacheSizeLimit(L)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ge(self)),ge}),O(["./shared"],function(l){var W=$;function $(w){return!function(a){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,s,u=new Blob([""],{type:"text/javascript"}),d=URL.createObjectURL(u);try{s=new Worker(d),e=!0}catch{e=!1}return s&&s.terminate(),URL.revokeObjectURL(d),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var s=e.getContext("2d");if(!s)return!1;var u=s.getImageData(0,0,1,1);return u&&u.width===e.width}()?(ue[r=a&&a.failIfMajorPerformanceCaveat]===void 0&&(ue[r]=function(e){var s,u=function(d){var g=document.createElement("canvas"),b=Object.create($.webGLContextAttributes);return b.failIfMajorPerformanceCaveat=d,g.getContext("webgl",b)||g.getContext("experimental-webgl",b)}(e);if(!u)return!1;try{s=u.createShader(u.VERTEX_SHADER)}catch{return!1}return!(!s||u.isContextLost())&&(u.shaderSource(s,"void main() {}"),u.compileShader(s),u.getShaderParameter(s,u.COMPILE_STATUS)===!0)}(r)),ue[r]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var r}(w)}var ue={};function re(w,a){if(Array.isArray(w)){if(!Array.isArray(a)||w.length!==a.length)return!1;for(let r=0;r<w.length;r++)if(!re(w[r],a[r]))return!1;return!0}if(typeof w=="object"&&w!==null&&a!==null){if(typeof a!="object"||Object.keys(w).length!==Object.keys(a).length)return!1;for(const r in w)if(!re(w[r],a[r]))return!1;return!0}return w===a}$.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class Z{static testProp(a){if(!Z.docStyle)return a[0];for(let r=0;r<a.length;r++)if(a[r]in Z.docStyle)return a[r];return a[0]}static create(a,r,e){const s=window.document.createElement(a);return r!==void 0&&(s.className=r),e&&e.appendChild(s),s}static createNS(a,r){return window.document.createElementNS(a,r)}static disableDrag(){Z.docStyle&&Z.selectProp&&(Z.userSelect=Z.docStyle[Z.selectProp],Z.docStyle[Z.selectProp]="none")}static enableDrag(){Z.docStyle&&Z.selectProp&&(Z.docStyle[Z.selectProp]=Z.userSelect)}static setTransform(a,r){a.style[Z.transformProp]=r}static addEventListener(a,r,e,s={}){a.addEventListener(r,e,"passive"in s?s:s.capture)}static removeEventListener(a,r,e,s={}){a.removeEventListener(r,e,"passive"in s?s:s.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",Z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Z.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Z.suppressClickInternal,!0)},0)}static mousePos(a,r){const e=a.getBoundingClientRect();return new l.pointGeometry(r.clientX-e.left-a.clientLeft,r.clientY-e.top-a.clientTop)}static touchPos(a,r){const e=a.getBoundingClientRect(),s=[];for(let u=0;u<r.length;u++)s.push(new l.pointGeometry(r[u].clientX-e.left-a.clientLeft,r[u].clientY-e.top-a.clientTop));return s}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}Z.docStyle=typeof window!="undefined"&&window.document&&window.document.documentElement.style,Z.selectProp=Z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Z.transformProp=Z.testProp(["transform","WebkitTransform"]);class me{constructor(a){this._transformRequestFn=a}transformRequest(a,r){return this._transformRequestFn&&this._transformRequestFn(a,r)||{url:a}}normalizeSpriteURL(a,r,e){const s=function(u){const d=u.match(_e);if(!d)throw new Error(`Unable to parse URL "${u}"`);return{protocol:d[1],authority:d[2],path:d[3]||"/",params:d[4]?d[4].split("&"):[]}}(a);return s.path+=`${r}${e}`,function(u){const d=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${d}`}(s)}setTransformRequest(a){this._transformRequestFn=a}}const _e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Fe(w){var a=new l.ARRAY_TYPE(3);return a[0]=w[0],a[1]=w[1],a[2]=w[2],a}var gt,zt=function(w,a,r){return w[0]=a[0]-r[0],w[1]=a[1]-r[1],w[2]=a[2]-r[2],w};gt=new l.ARRAY_TYPE(3),l.ARRAY_TYPE!=Float32Array&&(gt[0]=0,gt[1]=0,gt[2]=0);var Ct=function(w){var a=w[0],r=w[1];return a*a+r*r};(function(){var w=new l.ARRAY_TYPE(2);l.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0)})();class it{constructor(a,r,e,s){this.context=a,this.format=e,this.texture=a.gl.createTexture(),this.update(r,s)}update(a,r,e){const{width:s,height:u}=a,d=!(this.size&&this.size[0]===s&&this.size[1]===u||e),{context:g}=this,{gl:b}=g;if(this.useMipmap=Boolean(r&&r.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!r||r.premultiply!==!1)),d)this.size=[s,u],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.isImageBitmap(a)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,a):b.texImage2D(b.TEXTURE_2D,0,this.format,s,u,0,this.format,b.UNSIGNED_BYTE,a.data);else{const{x:I,y:k}=e||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.isImageBitmap(a)?b.texSubImage2D(b.TEXTURE_2D,0,I,k,b.RGBA,b.UNSIGNED_BYTE,a):b.texSubImage2D(b.TEXTURE_2D,0,I,k,s,u,b.RGBA,b.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D)}bind(a,r,e){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==u.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(e=u.LINEAR),a!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e||a),this.filter=a),r!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function je(w){const{userImage:a}=w;return!!(a&&a.render&&a.render())&&(w.data.replace(new Uint8Array(a.data.buffer)),!0)}class nt extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:r,callback:e}of this.requestors)this._notify(r,e);this.requestors=[]}}getImage(a){return this.images[a]}addImage(a,r){this._validate(a,r)&&(this.images[a]=r)}_validate(a,r){let e=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),e=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),e=!1),this._validateContent(r.content,r)||(this.fire(new l.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),e=!1),e}_validateStretch(a,r){if(!a)return!0;let e=0;for(const s of a){if(s[0]<e||s[1]<s[0]||r<s[1])return!1;e=s[1]}return!0}_validateContent(a,r){return!(a&&(a.length!==4||a[0]<0||r.data.width<a[0]||a[1]<0||r.data.height<a[1]||a[2]<0||r.data.width<a[2]||a[3]<0||r.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,r){r.version=this.images[a].version+1,this.images[a]=r,this.updatedImages[a]=!0}removeImage(a){const r=this.images[a];delete this.images[a],delete this.patterns[a],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,r){let e=!0;if(!this.isLoaded())for(const s of a)this.images[s]||(e=!1);this.isLoaded()||e?this._notify(a,r):this.requestors.push({ids:a,callback:r})}_notify(a,r){const e={};for(const s of a){this.images[s]||this.fire(new l.Event("styleimagemissing",{id:s}));const u=this.images[s];u?e[s]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,hasRenderCallback:Boolean(u.userImage&&u.userImage.render)}:l.warnOnce(`Image "${s}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,e)}getPixelSize(){const{width:a,height:r}=this.atlasImage;return{width:a,height:r}}getPattern(a){const r=this.patterns[a],e=this.getImage(a);if(!e)return null;if(r&&r.position.version===e.version)return r.position;if(r)r.position.version=e.version;else{const s={w:e.data.width+2,h:e.data.height+2,x:0,y:0},u=new l.ImagePosition(s,e);this.patterns[a]={bin:s,position:u}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const r=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new it(a,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const u in this.patterns)a.push(this.patterns[u].bin);const{w:r,h:e}=l.potpack(a),s=this.atlasImage;s.resize({width:r||1,height:e||1});for(const u in this.patterns){const{bin:d}=this.patterns[u],g=d.x+1,b=d.y+1,I=this.images[u].data,k=I.width,D=I.height;l.RGBAImage.copy(I,s,{x:0,y:0},{x:g,y:b},{width:k,height:D}),l.RGBAImage.copy(I,s,{x:0,y:D-1},{x:g,y:b-1},{width:k,height:1}),l.RGBAImage.copy(I,s,{x:0,y:0},{x:g,y:b+D},{width:k,height:1}),l.RGBAImage.copy(I,s,{x:k-1,y:0},{x:g-1,y:b},{width:1,height:D}),l.RGBAImage.copy(I,s,{x:0,y:0},{x:g+k,y:b},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const r of a){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const e=this.images[r];je(e)&&this.updateImage(r,e)}}}const ct=1e20;function Xe(w,a,r,e,s,u,d,g,b){for(let I=a;I<a+e;I++)at(w,r*u+I,u,s,d,g,b);for(let I=r;I<r+s;I++)at(w,I*u+a,1,e,d,g,b)}function at(w,a,r,e,s,u,d){u[0]=0,d[0]=-ct,d[1]=ct,s[0]=w[a];for(let g=1,b=0,I=0;g<e;g++){s[g]=w[a+g*r];const k=g*g;do{const D=u[b];I=(s[g]-s[D]+k-D*D)/(g-D)/2}while(I<=d[b]&&--b>-1);b++,u[b]=g,d[b]=I,d[b+1]=ct}for(let g=0,b=0;g<e;g++){for(;d[b+1]<g;)b++;const I=u[b],k=g-I;w[a+g*r]=s[I]+k*k}}class rt{constructor(a,r){this.requestManager=a,this.localIdeographFontFamily=r,this.entries={}}setURL(a){this.url=a}getGlyphs(a,r){const e=[];for(const s in a)for(const u of a[s])e.push({stack:s,id:u});l.asyncAll(e,({stack:s,id:u},d)=>{let g=this.entries[s];g||(g=this.entries[s]={glyphs:{},requests:{},ranges:{}});let b=g.glyphs[u];if(b!==void 0)return void d(null,{stack:s,id:u,glyph:b});if(b=this._tinySDF(g,s,u),b)return g.glyphs[u]=b,void d(null,{stack:s,id:u,glyph:b});const I=Math.floor(u/256);if(256*I>65535)return void d(new Error("glyphs > 65535 not supported"));if(g.ranges[I])return void d(null,{stack:s,id:u,glyph:b});let k=g.requests[I];k||(k=g.requests[I]=[],rt.loadGlyphRange(s,I,this.url,this.requestManager,(D,F)=>{if(F){for(const j in F)this._doesCharSupportLocalGlyph(+j)||(g.glyphs[+j]=F[+j]);g.ranges[I]=!0}for(const j of k)j(D,F);delete g.requests[I]})),k.push((D,F)=>{D?d(D):F&&d(null,{stack:s,id:u,glyph:F[u]||null})})},(s,u)=>{if(s)r(s);else if(u){const d={};for(const{stack:g,id:b,glyph:I}of u)(d[g]||(d[g]={}))[b]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};r(null,d)}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](a)||l.unicodeBlockLookup["Hangul Syllables"](a)||l.unicodeBlockLookup.Hiragana(a)||l.unicodeBlockLookup.Katakana(a))}_tinySDF(a,r,e){const s=this.localIdeographFontFamily;if(!s||!this._doesCharSupportLocalGlyph(e))return;let u=a.tinySDF;if(!u){let g="400";/bold/i.test(r)?g="900":/medium/i.test(r)?g="500":/light/i.test(r)&&(g="200"),u=a.tinySDF=new rt.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:s,fontWeight:g})}const d=u.draw(String.fromCharCode(e));return{id:e,bitmap:new l.AlphaImage({width:d.width||30,height:d.height||30},d.data),metrics:{width:d.glyphWidth||24,height:d.glyphHeight||24,left:d.glyphLeft||0,top:d.glyphTop-27||-8,advance:d.glyphAdvance||24}}}}rt.loadGlyphRange=function(w,a,r,e,s){const u=256*a,d=u+255,g=e.transformRequest(r.replace("{fontstack}",w).replace("{range}",`${u}-${d}`),l.ResourceType.Glyphs);l.getArrayBuffer(g,(b,I)=>{if(b)s(b);else if(I){const k={};for(const D of l.parseGlyphPBF(I))k[D.id]=D;s(null,k)}})},rt.TinySDF=class{constructor({fontSize:w=24,buffer:a=3,radius:r=8,cutoff:e=.25,fontFamily:s="sans-serif",fontWeight:u="normal",fontStyle:d="normal"}={}){this.buffer=a,this.cutoff=e,this.radius=r;const g=this.size=w+4*a,b=this._createCanvas(g),I=this.ctx=b.getContext("2d",{willReadFrequently:!0});I.font=`${d} ${u} ${w}px ${s}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(w){const a=document.createElement("canvas");return a.width=a.height=w,a}draw(w){const{width:a,actualBoundingBoxAscent:r,actualBoundingBoxDescent:e,actualBoundingBoxLeft:s,actualBoundingBoxRight:u}=this.ctx.measureText(w),d=Math.ceil(r),g=Math.min(this.size-this.buffer,Math.ceil(u-s)),b=Math.min(this.size-this.buffer,d+Math.ceil(e)),I=g+2*this.buffer,k=b+2*this.buffer,D=Math.max(I*k,0),F=new Uint8ClampedArray(D),j={data:F,width:I,height:k,glyphWidth:g,glyphHeight:b,glyphTop:d,glyphLeft:0,glyphAdvance:a};if(g===0||b===0)return j;const{ctx:N,buffer:K,gridInner:J,gridOuter:ee}=this;N.clearRect(K,K,g,b),N.fillText(w,K,K+d);const le=N.getImageData(K,K,g,b);ee.fill(ct,0,D),J.fill(0,0,D);for(let ce=0;ce<b;ce++)for(let ye=0;ye<g;ye++){const oe=le.data[4*(ce*g+ye)+3]/255;if(oe===0)continue;const ve=(ce+K)*I+ye+K;if(oe===1)ee[ve]=0,J[ve]=ct;else{const be=.5-oe;ee[ve]=be>0?be*be:0,J[ve]=be<0?be*be:0}}Xe(ee,0,0,I,k,I,this.f,this.v,this.z),Xe(J,K,K,g,b,I,this.f,this.v,this.z);for(let ce=0;ce<D;ce++){const ye=Math.sqrt(ee[ce])-Math.sqrt(J[ce]);F[ce]=Math.round(255-255*(ye/this.radius+this.cutoff))}return j}};const Oe=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(w,a){return l.sphericalToCartesian(w.expression.evaluate(a))}interpolate(w,a,r){return{x:l.number(w.x,a.x,r),y:l.number(w.y,a.y,r),z:l.number(w.z,a.z,r)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),bt="-transition";class We extends l.Evented{constructor(a){super(),this._transitionable=new l.Transitionable(Oe),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,r={}){if(!this._validate(l.validateLight,a,r))for(const e in a){const s=a[e];e.endsWith(bt)?this._transitionable.setTransition(e.slice(0,-bt.length),s):this._transitionable.setValue(e,s)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,r,e){return(!e||e.validate!==!1)&&l.emitValidationErrors(this,a.call(l.validateStyle,l.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class ft{constructor(a,r){this.width=a,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,r){const e=a.join(",")+String(r);return this.dashEntry[e]||(this.dashEntry[e]=this.addDash(a,r)),this.dashEntry[e]}getDashRanges(a,r,e){const s=[];let u=a.length%2==1?-a[a.length-1]*e:0,d=a[0]*e,g=!0;s.push({left:u,right:d,isDash:g,zeroLength:a[0]===0});let b=a[0];for(let I=1;I<a.length;I++){g=!g;const k=a[I];u=b*e,b+=k,d=b*e,s.push({left:u,right:d,isDash:g,zeroLength:k===0})}return s}addRoundDash(a,r,e){const s=r/2;for(let u=-e;u<=e;u++){const d=this.width*(this.nextRow+e+u);let g=0,b=a[g];for(let I=0;I<this.width;I++){I/b.right>1&&(b=a[++g]);const k=Math.abs(I-b.left),D=Math.abs(I-b.right),F=Math.min(k,D);let j;const N=u/e*(s+1);if(b.isDash){const K=s-Math.abs(N);j=Math.sqrt(F*F+K*K)}else j=s-Math.sqrt(F*F+N*N);this.data[d+I]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(a){for(let g=a.length-1;g>=0;--g){const b=a[g],I=a[g+1];b.zeroLength?a.splice(g,1):I&&I.isDash===b.isDash&&(I.left=b.left,a.splice(g,1))}const r=a[0],e=a[a.length-1];r.isDash===e.isDash&&(r.left=e.left-this.width,e.right=r.right+this.width);const s=this.width*this.nextRow;let u=0,d=a[u];for(let g=0;g<this.width;g++){g/d.right>1&&(d=a[++u]);const b=Math.abs(g-d.left),I=Math.abs(g-d.right),k=Math.min(b,I);this.data[s+g]=Math.max(0,Math.min(255,(d.isDash?k:-k)+128))}}addDash(a,r){const e=r?7:0,s=2*e+1;if(this.nextRow+s>this.height)return l.warnOnce("LineAtlas out of space"),null;let u=0;for(let g=0;g<a.length;g++)u+=a[g];if(u!==0){const g=this.width/u,b=this.getDashRanges(a,this.width,g);r?this.addRoundDash(b,g,e):this.addRegularDash(b)}const d={y:(this.nextRow+e+.5)/this.height,height:2*e/this.height,width:u};return this.nextRow+=s,this.dirty=!0,d}bind(a){const r=a.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}class wt{constructor(a,r){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const e=this.workerPool.acquire(this.id);for(let s=0;s<e.length;s++){const u=new wt.Actor(e[s],r,this.id);u.name=`Worker ${s}`,this.actors.push(u)}}broadcast(a,r,e){l.asyncAll(this.actors,(s,u)=>{s.send(a,r,u)},e=e||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ze(w,a,r){const e=function(s,u){if(s)return r(s);if(u){const d=l.pick(l.extend(u,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);u.vector_layers&&(d.vectorLayers=u.vector_layers,d.vectorLayerIds=d.vectorLayers.map(g=>g.id)),r(null,d)}};return w.url?l.getJSON(a.transformRequest(w.url,l.ResourceType.Source),e):l.exported.frame(()=>e(null,w))}wt.Actor=l.Actor;class De{constructor(a,r,e){this.bounds=l.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=r||0,this.maxzoom=e||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const r=Math.pow(2,a.z),e=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*r),s=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*r),u=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*r),d=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*r);return a.x>=e&&a.x<u&&a.y>=s&&a.y<d}}class Wt extends l.Evented{constructor(a,r,e,s){if(super(),this.id=a,this.dispatcher=e,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(r,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ze(this._options,this.map._requestManager,(a,r)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a?this.fire(new l.ErrorEvent(a)):r&&(l.extend(this,r),r.bounds&&(this.tileBounds=new De(r.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(a,r){const e=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s={request:this.map._requestManager.transformRequest(e,l.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function u(d,g){return delete a.request,a.aborted?r(null):d&&d.status!==404?r(d):(g&&g.resourceTiming&&(a.resourceTiming=g.resourceTiming),this.map._refreshExpiredTiles&&g&&a.setExpiryData(g),a.loadVectorData(g,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}s.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=r:a.request=a.actor.send("reloadTile",s,u.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",s,u.bind(this)))}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class si extends l.Evented{constructor(a,r,e,s){super(),this.id=a,this.dispatcher=e,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},r),l.extend(this,l.pick(r,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ze(this._options,this.map._requestManager,(a,r)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new l.ErrorEvent(a)):r&&(l.extend(this,r),r.bounds&&(this.tileBounds=new De(r.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,r){const e=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.request=l.getImage(this.map._requestManager.transformRequest(e,l.ResourceType.Tile),(s,u,d)=>{if(delete a.request,a.aborted)a.state="unloaded",r(null);else if(s)a.state="errored",r(s);else if(u){this.map._refreshExpiredTiles&&a.setExpiryData(d);const g=this.map.painter.context,b=g.gl;a.texture=this.map.painter.getTileTexture(u.width),a.texture?a.texture.update(u,{useMipmap:!0}):(a.texture=new it(g,u,b.RGBA,{useMipmap:!0}),a.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),a.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),r(null)}})}abortTile(a,r){a.request&&(a.request.cancel(),delete a.request),r()}unloadTile(a,r){a.texture&&this.map.painter.saveTileTexture(a.texture),r()}hasTransition(){return!1}}let vt;class Ht extends si{constructor(a,r,e,s){super(a,r,e,s),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(a,r){const e=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function s(u,d){u&&(a.state="errored",r(u)),d&&(a.dem=d,a.needsHillshadePrepare=!0,a.state="loaded",r(null))}a.request=l.getImage(this.map._requestManager.transformRequest(e,l.ResourceType.Tile),function(u,d){if(delete a.request,a.aborted)a.state="unloaded",r(null);else if(u)a.state="errored",r(u);else if(d){this.map._refreshExpiredTiles&&a.setExpiryData(d),delete d.cacheControl,delete d.expires;const g=l.isImageBitmap(d)&&(vt==null&&(vt=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),vt)?d:l.exported.getImageData(d,1),b={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:g,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",b,s.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)}_getNeighboringTiles(a){const r=a.canonical,e=Math.pow(2,r.z),s=(r.x-1+e)%e,u=r.x===0?a.wrap-1:a.wrap,d=(r.x+1+e)%e,g=r.x+1===e?a.wrap+1:a.wrap,b={};return b[new l.OverscaledTileID(a.overscaledZ,u,r.z,s,r.y).key]={backfilled:!1},b[new l.OverscaledTileID(a.overscaledZ,g,r.z,d,r.y).key]={backfilled:!1},r.y>0&&(b[new l.OverscaledTileID(a.overscaledZ,u,r.z,s,r.y-1).key]={backfilled:!1},b[new l.OverscaledTileID(a.overscaledZ,a.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},b[new l.OverscaledTileID(a.overscaledZ,g,r.z,d,r.y-1).key]={backfilled:!1}),r.y+1<e&&(b[new l.OverscaledTileID(a.overscaledZ,u,r.z,s,r.y+1).key]={backfilled:!1},b[new l.OverscaledTileID(a.overscaledZ,a.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},b[new l.OverscaledTileID(a.overscaledZ,g,r.z,d,r.y+1).key]={backfilled:!1}),b}unloadTile(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})}}class gi extends l.Evented{constructor(a,r,e,s){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=e.getActor(),this.setEventedParent(s),this._data=r.data,this._options=l.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const u=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*u,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*u,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:l.EXTENT,radius:(r.clusterRadius||50)*u,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData("content"),this}getClusterExpansionZoom(a,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},r),this}getClusterChildren(a,r){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},r),this}getClusterLeaves(a,r,e,s){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:r,offset:e},s),this}_updateWorkerData(a){const r=l.extend({},this.workerOptions),e=this._data;typeof e=="string"?(r.request=this.map._requestManager.transformRequest(l.exported.resolveURL(e),l.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(e),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,r,(s,u)=>{if(this._pendingLoads--,this._removed||u&&u.abandoned)return;let d=null;if(u&&u.resourceTiming&&u.resourceTiming[this.id]&&(d=u.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:r.source},null),s)return void this.fire(new l.ErrorEvent(s));const g={dataType:"source",sourceDataType:a};this._collectResourceTiming&&d&&d.length>0&&l.extend(g,{resourceTiming:d}),this.fire(new l.Event("data",g))})}loaded(){return this._pendingLoads===0}loadTile(a,r){const e=a.actor?"reloadTile":"loadTile";a.actor=this.actor;const s={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request=this.actor.send(e,s,(u,d)=>(delete a.request,a.unloadVectorData(),a.aborted?r(null):u?r(u):(a.loadVectorData(d,this.map.painter,e==="reloadTile"),r(null))))}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0}unloadTile(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ui=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ci extends l.Evented{constructor(a,r,e,s){super(),this.id=a,this.dispatcher=e,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(s),this.options=r}load(a,r){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(e,s)=>{this._loaded=!0,e?this.fire(new l.ErrorEvent(e)):s&&(this.image=s,a&&(this.coordinates=a),r&&r(),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}setCoordinates(a){this.coordinates=a;const r=a.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(s){let u=1/0,d=1/0,g=-1/0,b=-1/0;for(const F of s)u=Math.min(u,F.x),d=Math.min(d,F.y),g=Math.max(g,F.x),b=Math.max(b,F.y);const I=Math.max(g-u,b-d),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,k);return new l.CanonicalTileID(k,Math.floor((u+g)/2*D),Math.floor((d+b)/2*D))}(r),this.minzoom=this.maxzoom=this.tileID.z;const e=r.map(s=>this.tileID.getTilePoint(s)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(e[0].x,e[0].y,0,0),this._boundsArray.emplaceBack(e[1].x,e[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(e[3].x,e[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(e[2].x,e[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,r=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ui.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new it(a,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(const e in this.tiles){const s=this.tiles[e];s.state!=="loaded"&&(s.state="loaded",s.texture=this.texture)}}loadTile(a,r){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},r(null)):(a.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class fi extends Ci{constructor(a,r,e,s){super(a,r,e,s),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const a=this.options;this.urls=[];for(const r of a.urls)this.urls.push(this.map._requestManager.transformRequest(r,l.ResourceType.Source).url);l.getVideo(this.urls,(r,e)=>{this._loaded=!0,r?this.fire(new l.ErrorEvent(r)):e&&(this.video=e,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const r=this.video.seekable;a<r.start(0)||a>r.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,r=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ui.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new it(a,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(const e in this.tiles){const s=this.tiles[e];s.state!=="loaded"&&(s.state="loaded",s.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ei extends Ci{constructor(a,r,e,s){super(a,r,e,s),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(u=>!Array.isArray(u)||u.length!==2||u.some(d=>typeof d!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${a}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${a}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,e=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,ui.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new it(r,this.canvas,e.RGBA,{premultiply:!0});for(const s in this.tiles){const u=this.tiles[s];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const _i={vector:Wt,raster:si,"raster-dem":Ht,geojson:gi,video:fi,image:Ci,canvas:ei};function $i(w,a){const r=l.create();return l.translate(r,r,[1,1,0]),l.scale(r,r,[.5*w.width,.5*w.height,1]),l.multiply(r,r,w.calculatePosMatrix(a.toUnwrapped()))}function lt(w,a,r,e,s,u){const d=function(D,F,j){if(D)for(const N of D){const K=F[N];if(K&&K.source===j&&K.type==="fill-extrusion")return!0}else for(const N in F){const K=F[N];if(K.source===j&&K.type==="fill-extrusion")return!0}return!1}(s&&s.layers,a,w.id),g=u.maxPitchScaleFactor(),b=w.tilesIn(e,g,d);b.sort($e);const I=[];for(const D of b)I.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(a,r,w._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,s,u,g,$i(w.transform,D.tileID))});const k=function(D){const F={},j={};for(const N of D){const K=N.queryResults,J=N.wrappedTileID,ee=j[J]=j[J]||{};for(const le in K){const ce=K[le],ye=ee[le]=ee[le]||{},oe=F[le]=F[le]||[];for(const ve of ce)ye[ve.featureIndex]||(ye[ve.featureIndex]=!0,oe.push(ve))}}return F}(I);for(const D in k)k[D].forEach(F=>{const j=F.feature,N=w.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=N});return k}function $e(w,a){const r=w.tileID,e=a.tileID;return r.overscaledZ-e.overscaledZ||r.canonical.y-e.canonical.y||r.wrap-e.wrap||r.canonical.x-e.canonical.x}class di{constructor(a,r){this.tileID=a,this.uid=l.uniqueId(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const r=a+this.timeAdded;r<l.exported.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(a,r,e){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(s,u){const d={};if(!u)return d;for(const g of s){const b=g.layerIds.map(I=>u.getLayer(I)).filter(Boolean);if(b.length!==0){g.layers=b,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(I=>b.filter(k=>k.id===I)[0]));for(const I of b)d[I.id]=g}}return d}(a.buckets,r.style),this.hasSymbolBuckets=!1;for(const s in this.buckets){const u=this.buckets[s];if(u instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!e)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const s in this.buckets){const u=this.buckets[s];if(u instanceof l.SymbolBucket&&u.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const s in this.buckets){const u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(s).queryRadius(u))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const e in this.buckets){const s=this.buckets[e];s.uploadPending()&&s.upload(a)}const r=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new it(a,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new it(a,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,r,e,s,u,d,g,b,I,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:s,cameraQueryGeometry:u,scale:d,tileSize:this.tileSize,pixelPosMatrix:k,transform:b,params:g,queryPadding:this.queryPadding*I},a,r,e):{}}querySourceFeatures(a,r){const e=this.latestFeatureIndex;if(!e||!e.rawTileData)return;const s=e.loadVTLayers(),u=r?r.sourceLayer:"",d=s._geojsonTileLayer||s[u];if(!d)return;const g=l.createFilter(r&&r.filter),{z:b,x:I,y:k}=this.tileID.canonical,D={z:b,x:I,y:k};for(let F=0;F<d.length;F++){const j=d.feature(F);if(g.needGeometry){const J=l.toEvaluationFeature(j,!0);if(!g.filter(new l.EvaluationParameters(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!g.filter(new l.EvaluationParameters(this.tileID.overscaledZ),j))continue;const N=e.getId(j,u),K=new l.GeoJSONFeature(j,b,I,k,N);K.tile=D,a.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const r=this.expirationTime;if(a.cacheControl){const e=l.parseCacheControl(a.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const e=Date.now();let s=!1;if(this.expirationTime>e)s=!1;else if(r)if(this.expirationTime<r)s=!0;else{const u=this.expirationTime-r;u?this.expirationTime=e+Math.max(u,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const e=this.latestFeatureIndex.loadVTLayers();for(const s in this.buckets){if(!r.style.hasLayer(s))continue;const u=this.buckets[s],d=u.layers[0].sourceLayer||"_geojsonTileLayer",g=e[d],b=a[d];if(!g||!b||Object.keys(b).length===0)continue;u.update(b,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=r&&r.style&&r.style.getLayer(s);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(u)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=l.exported.now()+a}setDependencies(a,r){const e={};for(const s of r)e[s]=!0;this.dependencies[a]=e}hasDependency(a,r){for(const e of a){const s=this.dependencies[e];if(s){for(const u of r)if(s[u])return!0}}return!1}}class Ui{constructor(a,r){this.max=a,this.onRemove=r,this.reset()}reset(){for(const a in this.data)for(const r of this.data[a])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(a,r,e){const s=a.wrapped().key;this.data[s]===void 0&&(this.data[s]=[]);const u={value:r,timeout:void 0};if(e!==void 0&&(u.timeout=setTimeout(()=>{this.remove(a,u)},e)),this.data[s].push(u),this.order.push(s),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const r=this.data[a].shift();return r.timeout&&clearTimeout(r.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),r.value}getByKey(a){const r=this.data[a];return r?r[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,r){if(!this.has(a))return this;const e=a.wrapped().key,s=r===void 0?0:this.data[e].indexOf(r),u=this.data[e][s];return this.data[e].splice(s,1),u.timeout&&clearTimeout(u.timeout),this.data[e].length===0&&delete this.data[e],this.onRemove(u.value),this.order.splice(this.order.indexOf(e),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(a){const r=[];for(const e in this.data)for(const s of this.data[e])a(s.value)||r.push(s);for(const e of r)this.remove(e.value.tileID,e)}}class Mr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,r,e){const s=String(r);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][s]=this.stateChanges[a][s]||{},l.extend(this.stateChanges[a][s],e),this.deletedStates[a]===null){this.deletedStates[a]={};for(const u in this.state[a])u!==s&&(this.deletedStates[a][u]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][s]===null){this.deletedStates[a][s]={};for(const u in this.state[a][s])e[u]||(this.deletedStates[a][s][u]=null)}else for(const u in e)this.deletedStates[a]&&this.deletedStates[a][s]&&this.deletedStates[a][s][u]===null&&delete this.deletedStates[a][s][u]}removeFeatureState(a,r,e){if(this.deletedStates[a]===null)return;const s=String(r);if(this.deletedStates[a]=this.deletedStates[a]||{},e&&r!==void 0)this.deletedStates[a][s]!==null&&(this.deletedStates[a][s]=this.deletedStates[a][s]||{},this.deletedStates[a][s][e]=null);else if(r!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][s])for(e in this.deletedStates[a][s]={},this.stateChanges[a][s])this.deletedStates[a][s][e]=null;else this.deletedStates[a][s]=null;else this.deletedStates[a]=null}getState(a,r){const e=String(r),s=l.extend({},(this.state[a]||{})[e],(this.stateChanges[a]||{})[e]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const u=this.deletedStates[a][r];if(u===null)return{};for(const d in u)delete s[d]}return s}initializeTileState(a,r){a.setFeatureState(this.state,r)}coalesceChanges(a,r){const e={};for(const s in this.stateChanges){this.state[s]=this.state[s]||{};const u={};for(const d in this.stateChanges[s])this.state[s][d]||(this.state[s][d]={}),l.extend(this.state[s][d],this.stateChanges[s][d]),u[d]=this.state[s][d];e[s]=u}for(const s in this.deletedStates){this.state[s]=this.state[s]||{};const u={};if(this.deletedStates[s]===null)for(const d in this.state[s])u[d]={},this.state[s][d]={};else for(const d in this.deletedStates[s]){if(this.deletedStates[s][d]===null)this.state[s][d]={};else for(const g of Object.keys(this.deletedStates[s][d]))delete this.state[s][d][g];u[d]=this.state[s][d]}e[s]=e[s]||{},l.extend(e[s],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(e).length!==0)for(const s in a)a[s].setFeatureState(e,r)}}class Ai extends l.Evented{constructor(a,r,e){super(),this.id=a,this.dispatcher=e,this.on("data",s=>{s.dataType==="source"&&s.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&s.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(s,u,d,g){const b=new _i[u.type](s,u,d,g);if(b.id!==s)throw new Error(`Expected Source id to be ${s} instead of ${b.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],b),b}(a,r,e,this),this._tiles={},this._cache=new Ui(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Mr}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles){const r=this._tiles[a];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,r){return this._source.loadTile(a,r)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a,()=>{})}_abortTile(a){this._source.abortTile&&this._source.abortTile(a,()=>{}),this._source.fire(new l.Event("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const e=this._tiles[r];e.upload(a),e.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(gr).map(a=>a.key)}getRenderableIds(a){const r=[];for(const e in this._tiles)this._isIdRenderable(e,a)&&r.push(this._tiles[e]);return a?r.sort((e,s)=>{const u=e.tileID,d=s.tileID,g=new l.pointGeometry(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),b=new l.pointGeometry(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-d.overscaledZ||b.y-g.y||b.x-g.x}).map(e=>e.tileID.key):r.map(e=>e.tileID).sort(gr).map(e=>e.key)}hasRenderableParent(a){const r=this.findLoadedParent(a,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(a,r){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(r||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,r){const e=this._tiles[a];e&&(e.state!=="loading"&&(e.state=r),this._loadTile(e,this._tileLoaded.bind(this,e,a,r)))}_tileLoaded(a,r,e,s){if(s)return a.state="errored",void(s.status!==404?this._source.fire(new l.ErrorEvent(s,{tile:a})):this.update(this.transform));a.timeAdded=l.exported.now(),e==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(r,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const r=this.getRenderableIds();for(let s=0;s<r.length;s++){const u=r[s];if(a.neighboringTiles&&a.neighboringTiles[u]){const d=this.getTileByID(u);e(a,d),e(d,a)}}function e(s,u){s.needsHillshadePrepare=!0;let d=u.tileID.canonical.x-s.tileID.canonical.x;const g=u.tileID.canonical.y-s.tileID.canonical.y,b=Math.pow(2,s.tileID.canonical.z),I=u.tileID.key;d===0&&g===0||Math.abs(g)>1||(Math.abs(d)>1&&(Math.abs(d+b)===1?d+=b:Math.abs(d-b)===1&&(d-=b)),u.dem&&s.dem&&(s.dem.backfillBorder(u.dem,d,g),s.neighboringTiles&&s.neighboringTiles[I]&&(s.neighboringTiles[I].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,r,e,s){for(const u in this._tiles){let d=this._tiles[u];if(s[u]||!d.hasData()||d.tileID.overscaledZ<=r||d.tileID.overscaledZ>e)continue;let g=d.tileID;for(;d&&d.tileID.overscaledZ>r+1;){const I=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[I.key],d&&d.hasData()&&(g=I)}let b=g;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),a[b.key]){s[g.key]=g;break}}}findLoadedParent(a,r){if(a.key in this._loadedParentTiles){const e=this._loadedParentTiles[a.key];return e&&e.tileID.overscaledZ>=r?e:null}for(let e=a.overscaledZ-1;e>=r;e--){const s=a.scaledTo(e),u=this._getLoadedTile(s);if(u)return u}}_getLoadedTile(a){const r=this._tiles[a.key];return r&&r.hasData()?r:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const r=Math.ceil(a.width/this._source.tileSize)+1,e=Math.ceil(a.height/this._source.tileSize)+1,s=Math.floor(r*e*5),u=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(u)}handleWrapJump(a){const r=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,r){const e={};for(const s in this._tiles){const u=this._tiles[s];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+r),e[u.tileID.key]=u}this._tiles=e;for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s in this._tiles)this._setTileReloadTimer(s,this._tiles[s])}}update(a){if(this.transform=a,!this._sourceLoaded||this._paused)return;let r;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?r=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new l.OverscaledTileID(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(r=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter(b=>this._source.hasTile(b)))):r=[];const e=a.coveringZoomLevel(this._source),s=Math.max(e-Ai.maxOverzooming,this._source.minzoom),u=Math.max(e+Ai.maxUnderzooming,this._source.minzoom),d=this._updateRetainedTiles(r,e);if(_r(this._source.type)){const b={},I={},k=Object.keys(d);for(const D of k){const F=d[D],j=this._tiles[D];if(!j||j.fadeEndTime&&j.fadeEndTime<=l.exported.now())continue;const N=this.findLoadedParent(F,s);N&&(this._addTile(N.tileID),b[N.tileID.key]=N.tileID),I[D]=F}this._retainLoadedChildren(I,e,u,d);for(const D in b)d[D]||(this._coveredTiles[D]=!0,d[D]=b[D])}for(const b in d)this._tiles[b].clearFadeHold();const g=l.keysDifference(this._tiles,d);for(const b of g){const I=this._tiles[b];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,r){const e={},s={},u=Math.max(r-Ai.maxOverzooming,this._source.minzoom),d=Math.max(r+Ai.maxUnderzooming,this._source.minzoom),g={};for(const b of a){const I=this._addTile(b);e[b.key]=b,I.hasData()||r<this._source.maxzoom&&(g[b.key]=b)}this._retainLoadedChildren(g,r,d,e);for(const b of a){let I=this._tiles[b.key];if(I.hasData())continue;if(r+1>this._source.maxzoom){const D=b.children(this._source.maxzoom)[0],F=this.getTile(D);if(F&&F.hasData()){e[D.key]=D;continue}}else{const D=b.children(this._source.maxzoom);if(e[D[0].key]&&e[D[1].key]&&e[D[2].key]&&e[D[3].key])continue}let k=I.wasRequested();for(let D=b.overscaledZ-1;D>=u;--D){const F=b.scaledTo(D);if(s[F.key]||(s[F.key]=!0,I=this.getTile(F),!I&&k&&(I=this._addTile(F)),I&&(e[F.key]=F,k=I.wasRequested(),I.hasData())))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const r=[];let e,s=this._tiles[a].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){e=this._loadedParentTiles[s.key];break}r.push(s.key);const u=s.scaledTo(s.overscaledZ-1);if(e=this._getLoadedTile(u),e)break;s=u}for(const u of r)this._loadedParentTiles[u]=e}}_addTile(a){let r=this._tiles[a.key];if(r)return r;r=this._cache.getAndRemove(a),r&&(this._setTileReloadTimer(a.key,r),r.tileID=a,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,r)));const e=r;return r||(r=new di(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,a.key,r.state))),r.uses++,this._tiles[a.key]=r,e||this._source.fire(new l.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(a,r){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const e=r.getExpiryTimeout();e&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},e))}_removeTile(a){const r=this._tiles[a];r&&(r.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,r,e){const s=[],u=this.transform;if(!u)return s;const d=e?u.getCameraQueryGeometry(a):a,g=a.map(N=>u.pointCoordinate(N)),b=d.map(N=>u.pointCoordinate(N)),I=this.getIds();let k=1/0,D=1/0,F=-1/0,j=-1/0;for(const N of b)k=Math.min(k,N.x),D=Math.min(D,N.y),F=Math.max(F,N.x),j=Math.max(j,N.y);for(let N=0;N<I.length;N++){const K=this._tiles[I[N]];if(K.holdingForFade())continue;const J=K.tileID,ee=Math.pow(2,u.zoom-K.tileID.overscaledZ),le=r*K.queryPadding*l.EXTENT/K.tileSize/ee,ce=[J.getTilePoint(new l.MercatorCoordinate(k,D)),J.getTilePoint(new l.MercatorCoordinate(F,j))];if(ce[0].x-le<l.EXTENT&&ce[0].y-le<l.EXTENT&&ce[1].x+le>=0&&ce[1].y+le>=0){const ye=g.map(ve=>J.getTilePoint(ve)),oe=b.map(ve=>J.getTilePoint(ve));s.push({tile:K,tileID:J,queryGeometry:ye,cameraQueryGeometry:oe,scale:ee})}}return s}getVisibleCoordinates(a){const r=this.getRenderableIds(a).map(e=>this._tiles[e].tileID);for(const e of r)e.posMatrix=this.transform.calculatePosMatrix(e.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(_r(this._source.type))for(const a in this._tiles){const r=this._tiles[a];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(a,r,e){this._state.updateState(a=a||"_geojsonTileLayer",r,e)}removeFeatureState(a,r,e){this._state.removeFeatureState(a=a||"_geojsonTileLayer",r,e)}getFeatureState(a,r){return this._state.getState(a=a||"_geojsonTileLayer",r)}setDependencies(a,r,e){const s=this._tiles[a];s&&s.setDependencies(r,e)}reloadTilesForDependencies(a,r){for(const e in this._tiles)this._tiles[e].hasDependency(a,r)&&this._reloadTile(e,"reloading");this._cache.filter(e=>!e.hasDependency(a,r))}}function gr(w,a){const r=Math.abs(2*w.wrap)-+(w.wrap<0),e=Math.abs(2*a.wrap)-+(a.wrap<0);return w.overscaledZ-a.overscaledZ||e-r||a.canonical.y-w.canonical.y||a.canonical.x-w.canonical.x}function _r(w){return w==="raster"||w==="image"||w==="video"}Ai.maxOverzooming=10,Ai.maxUnderzooming=3;const Er="mapboxgl_preloaded_worker_pool";class Dr{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<Dr.workerCount;)this.workers.push(new Worker(Fs.workerUrl));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Er]}numActive(){return Object.keys(this.active).length}}const Jr=Math.floor(l.exported.hardwareConcurrency/2);let bi;function br(){return bi||(bi=new Dr),bi}function cr(w,a){const r={};for(const e in w)e!=="ref"&&(r[e]=w[e]);return l.refProperties.forEach(e=>{e in a&&(r[e]=a[e])}),r}function Hi(w){w=w.slice();const a=Object.create(null);for(let r=0;r<w.length;r++)a[w[r].id]=w[r];for(let r=0;r<w.length;r++)"ref"in w[r]&&(w[r]=cr(w[r],a[w[r].ref]));return w}Dr.workerCount=Math.max(Math.min(Jr,6),1);const Qt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function tr(w,a,r){r.push({command:Qt.addSource,args:[w,a[w]]})}function Di(w,a,r){a.push({command:Qt.removeSource,args:[w]}),r[w]=!0}function jt(w,a,r,e){Di(w,r,e),tr(w,a,r)}function Vi(w,a,r){let e;for(e in w[r])if(Object.prototype.hasOwnProperty.call(w[r],e)&&e!=="data"&&!re(w[r][e],a[r][e]))return!1;for(e in a[r])if(Object.prototype.hasOwnProperty.call(a[r],e)&&e!=="data"&&!re(w[r][e],a[r][e]))return!1;return!0}function ae(w,a,r,e,s,u){let d;for(d in a=a||{},w=w||{})Object.prototype.hasOwnProperty.call(w,d)&&(re(w[d],a[d])||r.push({command:u,args:[e,d,a[d],s]}));for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&!Object.prototype.hasOwnProperty.call(w,d)&&(re(w[d],a[d])||r.push({command:u,args:[e,d,a[d],s]}))}function Ae(w){return w.id}function $r(w,a){return w[a.id]=a,w}class yr{constructor(a,r){this.reset(a,r)}reset(a,r){this.points=a||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=l.clamp(a,0,1);let r=1,e=this._distances[r];const s=a*this.paddedLength+this.padding;for(;e<s&&r<this._distances.length;)e=this._distances[++r];const u=r-1,d=this._distances[u],g=e-d,b=g>0?(s-d)/g:0;return this.points[u].mult(1-b).add(this.points[r].mult(b))}}function Gt(w,a){let r=!0;return w==="always"||w!=="never"&&a!=="never"||(r=!1),r}class hi{constructor(a,r,e){const s=this.boxCells=[],u=this.circleCells=[];this.xCellCount=Math.ceil(a/e),this.yCellCount=Math.ceil(r/e);for(let d=0;d<this.xCellCount*this.yCellCount;d++)s.push([]),u.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=r,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,r,e,s,u){this._forEachCell(r,e,s,u,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(r),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(u)}insertCircle(a,r,e,s){this._forEachCell(r-s,e-s,r+s,e+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(r),this.circles.push(e),this.circles.push(s)}_insertBoxCell(a,r,e,s,u,d){this.boxCells[u].push(d)}_insertCircleCell(a,r,e,s,u,d){this.circleCells[u].push(d)}_query(a,r,e,s,u,d,g){if(e<0||a>this.width||s<0||r>this.height)return[];const b=[];if(a<=0&&r<=0&&this.width<=e&&this.height<=s){if(u)return[{key:null,x1:a,y1:r,x2:e,y2:s}];for(let I=0;I<this.boxKeys.length;I++)b.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const k=this.circles[3*I],D=this.circles[3*I+1],F=this.circles[3*I+2];b.push({key:this.circleKeys[I],x1:k-F,y1:D-F,x2:k+F,y2:D+F})}}else this._forEachCell(a,r,e,s,this._queryCell,b,{hitTest:u,overlapMode:d,seenUids:{box:{},circle:{}}},g);return b}query(a,r,e,s){return this._query(a,r,e,s,!1,null)}hitTest(a,r,e,s,u,d){return this._query(a,r,e,s,!0,u,d).length>0}hitTestCircle(a,r,e,s,u){const d=a-e,g=a+e,b=r-e,I=r+e;if(g<0||d>this.width||I<0||b>this.height)return!1;const k=[];return this._forEachCell(d,b,g,I,this._queryCellCircle,k,{hitTest:!0,overlapMode:s,circle:{x:a,y:r,radius:e},seenUids:{box:{},circle:{}}},u),k.length>0}_queryCell(a,r,e,s,u,d,g,b){const{seenUids:I,hitTest:k,overlapMode:D}=g,F=this.boxCells[u];if(F!==null){const N=this.bboxes;for(const K of F)if(!I.box[K]){I.box[K]=!0;const J=4*K,ee=this.boxKeys[K];if(a<=N[J+2]&&r<=N[J+3]&&e>=N[J+0]&&s>=N[J+1]&&(!b||b(ee))&&(!k||!Gt(D,ee.overlapMode))&&(d.push({key:ee,x1:N[J],y1:N[J+1],x2:N[J+2],y2:N[J+3]}),k))return!0}}const j=this.circleCells[u];if(j!==null){const N=this.circles;for(const K of j)if(!I.circle[K]){I.circle[K]=!0;const J=3*K,ee=this.circleKeys[K];if(this._circleAndRectCollide(N[J],N[J+1],N[J+2],a,r,e,s)&&(!b||b(ee))&&(!k||!Gt(D,ee.overlapMode))){const le=N[J],ce=N[J+1],ye=N[J+2];if(d.push({key:ee,x1:le-ye,y1:ce-ye,x2:le+ye,y2:ce+ye}),k)return!0}}}return!1}_queryCellCircle(a,r,e,s,u,d,g,b){const{circle:I,seenUids:k,overlapMode:D}=g,F=this.boxCells[u];if(F!==null){const N=this.bboxes;for(const K of F)if(!k.box[K]){k.box[K]=!0;const J=4*K,ee=this.boxKeys[K];if(this._circleAndRectCollide(I.x,I.y,I.radius,N[J+0],N[J+1],N[J+2],N[J+3])&&(!b||b(ee))&&!Gt(D,ee.overlapMode))return d.push(!0),!0}}const j=this.circleCells[u];if(j!==null){const N=this.circles;for(const K of j)if(!k.circle[K]){k.circle[K]=!0;const J=3*K,ee=this.circleKeys[K];if(this._circlesCollide(N[J],N[J+1],N[J+2],I.x,I.y,I.radius)&&(!b||b(ee))&&!Gt(D,ee.overlapMode))return d.push(!0),!0}}}_forEachCell(a,r,e,s,u,d,g,b){const I=this._convertToXCellCoord(a),k=this._convertToYCellCoord(r),D=this._convertToXCellCoord(e),F=this._convertToYCellCoord(s);for(let j=I;j<=D;j++)for(let N=k;N<=F;N++)if(u.call(this,a,r,e,s,this.xCellCount*N+j,d,g,b))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,r,e,s,u,d){const g=s-a,b=u-r,I=e+d;return I*I>g*g+b*b}_circleAndRectCollide(a,r,e,s,u,d,g){const b=(d-s)/2,I=Math.abs(a-(s+b));if(I>b+e)return!1;const k=(g-u)/2,D=Math.abs(r-(u+k));if(D>k+e)return!1;if(I<=b||D<=k)return!0;const F=I-b,j=D-k;return F*F+j*j<=e*e}}function Ti(w,a,r,e,s){const u=l.create();return a?(l.scale(u,u,[1/s,1/s,1]),r||l.rotateZ(u,u,e.angle)):l.multiply(u,e.labelPlaneMatrix,w),u}function xr(w,a,r,e,s){if(a){const u=l.clone(w);return l.scale(u,u,[s,s,1]),r||l.rotateZ(u,u,-e.angle),u}return e.glCoordMatrix}function Mi(w,a){const r=[w.x,w.y,0,1];pi(r,r,a);const e=r[3];return{point:new l.pointGeometry(r[0]/e,r[1]/e),signedDistanceFromCamera:e}}function Ve(w,a){return .5+w/a*.5}function Dt(w,a){const r=w[0]/w[3],e=w[1]/w[3];return r>=-a[0]&&r<=a[0]&&e>=-a[1]&&e<=a[1]}function Pt(w,a,r,e,s,u,d,g,b){const I=e?w.textSizeData:w.iconSizeData,k=l.evaluateSizeForZoom(I,r.transform.zoom),D=[256/r.width*2+1,256/r.height*2+1],F=e?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;F.clear();const j=w.lineVertexArray,N=e?w.text.placedSymbolArray:w.icon.placedSymbolArray,K=r.transform.width/r.transform.height;let J=!1;for(let ee=0;ee<N.length;ee++){const le=N.get(ee);if(le.hidden||le.writingMode===l.WritingMode.vertical&&!J){ki(le.numGlyphs,F);continue}J=!1;const ce=[le.anchorX,le.anchorY,0,1];if(l.transformMat4(ce,ce,a),!Dt(ce,D)){ki(le.numGlyphs,F);continue}const ye=Ve(r.transform.cameraToCenterDistance,ce[3]),oe=l.evaluateSizeForFeature(I,k,le),ve=d?oe/ye:oe*ye,be=new l.pointGeometry(le.anchorX,le.anchorY),ze=Mi(be,s).point,we={},Ne=Mt(le,ve,!1,g,a,s,u,w.glyphOffsetArray,j,F,ze,be,we,K,b);J=Ne.useVertical,(Ne.notEnoughRoom||J||Ne.needsFlipping&&Mt(le,ve,!0,g,a,s,u,w.glyphOffsetArray,j,F,ze,be,we,K,b).notEnoughRoom)&&ki(le.numGlyphs,F)}e?w.text.dynamicLayoutVertexBuffer.updateData(F):w.icon.dynamicLayoutVertexBuffer.updateData(F)}function Ii(w,a,r,e,s,u,d,g,b,I,k,D){const F=g.glyphStartIndex+g.numGlyphs,j=g.lineStartIndex,N=g.lineStartIndex+g.lineLength,K=a.getoffsetX(g.glyphStartIndex),J=a.getoffsetX(F-1),ee=vr(w*K,r,e,s,u,d,g.segment,j,N,b,I,k,D);if(!ee)return null;const le=vr(w*J,r,e,s,u,d,g.segment,j,N,b,I,k,D);return le?{first:ee,last:le}:null}function Ar(w,a,r,e){return w===l.WritingMode.horizontal&&Math.abs(r.y-a.y)>Math.abs(r.x-a.x)*e?{useVertical:!0}:(w===l.WritingMode.vertical?a.y<r.y:a.x>r.x)?{needsFlipping:!0}:null}function Mt(w,a,r,e,s,u,d,g,b,I,k,D,F,j,N){const K=a/24,J=w.lineOffsetX*K,ee=w.lineOffsetY*K;let le;if(w.numGlyphs>1){const ce=w.glyphStartIndex+w.numGlyphs,ye=w.lineStartIndex,oe=w.lineStartIndex+w.lineLength,ve=Ii(K,g,J,ee,r,k,D,w,b,u,F,N);if(!ve)return{notEnoughRoom:!0};const be=Mi(ve.first.point,d).point,ze=Mi(ve.last.point,d).point;if(e&&!r){const we=Ar(w.writingMode,be,ze,j);if(we)return we}le=[ve.first];for(let we=w.glyphStartIndex+1;we<ce-1;we++)le.push(vr(K*g.getoffsetX(we),J,ee,r,k,D,w.segment,ye,oe,b,u,F,N));le.push(ve.last)}else{if(e&&!r){const ye=Mi(D,s).point,oe=w.lineStartIndex+w.segment+1,ve=new l.pointGeometry(b.getx(oe),b.gety(oe)),be=Mi(ve,s),ze=be.signedDistanceFromCamera>0?be.point:kn(D,ve,ye,1,s),we=Ar(w.writingMode,ye,ze,j);if(we)return we}const ce=vr(K*g.getoffsetX(w.glyphStartIndex),J,ee,r,k,D,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,b,u,F,N);if(!ce)return{notEnoughRoom:!0};le=[ce]}for(const ce of le)l.addDynamicAttributes(I,ce.point,ce.angle);return{}}function kn(w,a,r,e,s){const u=Mi(w.add(w.sub(a)._unit()),s).point,d=r.sub(u);return r.add(d._mult(e/d.mag()))}function vr(w,a,r,e,s,u,d,g,b,I,k,D,F){const j=e?w-a:w+a;let N=j>0?1:-1,K=0;e&&(N*=-1,K=Math.PI),N<0&&(K+=Math.PI);let J=N>0?g+d:g+d+1,ee=s,le=s,ce=0,ye=0;const oe=Math.abs(j),ve=[];for(;ce+ye<=oe;){if(J+=N,J<g||J>=b)return null;if(le=ee,ve.push(ee),ee=D[J],ee===void 0){const Ce=new l.pointGeometry(I.getx(J),I.gety(J)),ut=Mi(Ce,k);if(ut.signedDistanceFromCamera>0)ee=D[J]=ut.point;else{const yt=J-N;ee=kn(ce===0?u:new l.pointGeometry(I.getx(yt),I.gety(yt)),Ce,le,oe-ce+1,k)}}ce+=ye,ye=le.dist(ee)}const be=(oe-ce)/ye,ze=ee.sub(le),we=ze.mult(be)._add(le);we._add(ze._unit()._perp()._mult(r*N));const Ne=K+Math.atan2(ee.y-le.y,ee.x-le.x);return ve.push(we),{point:we,angle:F?Ne:0,path:ve}}const bn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ki(w,a){for(let r=0;r<w;r++){const e=a.length;a.resize(e+4),a.float32.set(bn,3*e)}}function pi(w,a,r){const e=a[0],s=a[1];return w[0]=r[0]*e+r[4]*s+r[12],w[1]=r[1]*e+r[5]*s+r[13],w[3]=r[3]*e+r[7]*s+r[15],w}const hn=100;class mn{constructor(a,r=new hi(a.width+200,a.height+200,25),e=new hi(a.width+200,a.height+200,25)){this.transform=a,this.grid=r,this.ignoredGrid=e,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+hn,this.screenBottomBoundary=a.height+hn,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200}placeCollisionBox(a,r,e,s,u){const d=this.projectAndGetPerspectiveRatio(s,a.anchorPointX,a.anchorPointY),g=e*d.perspectiveRatio,b=a.x1*g+d.point.x,I=a.y1*g+d.point.y,k=a.x2*g+d.point.x,D=a.y2*g+d.point.y;return!this.isInsideGrid(b,I,k,D)||r!=="always"&&this.grid.hitTest(b,I,k,D,r,u)?{box:[],offscreen:!1}:{box:[b,I,k,D],offscreen:this.isOffscreen(b,I,k,D)}}placeCollisionCircles(a,r,e,s,u,d,g,b,I,k,D,F,j){const N=[],K=new l.pointGeometry(r.anchorX,r.anchorY),J=Mi(K,d),ee=Ve(this.transform.cameraToCenterDistance,J.signedDistanceFromCamera),le=(k?u/ee:u*ee)/l.ONE_EM,ce=Mi(K,g).point,ye=Ii(le,s,r.lineOffsetX*le,r.lineOffsetY*le,!1,ce,K,r,e,g,{},!1);let oe=!1,ve=!1,be=!0;if(ye){const ze=.5*F*ee+j,we=new l.pointGeometry(-100,-100),Ne=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ce=new yr,ut=ye.first,yt=ye.last;let xt=[];for(let It=ut.path.length-1;It>=1;It--)xt.push(ut.path[It]);for(let It=1;It<yt.path.length;It++)xt.push(yt.path[It]);const Ft=2.5*ze;if(b){const It=xt.map(ii=>Mi(ii,b));xt=It.some(ii=>ii.signedDistanceFromCamera<=0)?[]:It.map(ii=>ii.point)}let ti=[];if(xt.length>0){const It=xt[0].clone(),ii=xt[0].clone();for(let oi=1;oi<xt.length;oi++)It.x=Math.min(It.x,xt[oi].x),It.y=Math.min(It.y,xt[oi].y),ii.x=Math.max(ii.x,xt[oi].x),ii.y=Math.max(ii.y,xt[oi].y);ti=It.x>=we.x&&ii.x<=Ne.x&&It.y>=we.y&&ii.y<=Ne.y?[xt]:ii.x<we.x||It.x>Ne.x||ii.y<we.y||It.y>Ne.y?[]:l.clipLine([xt],we.x,we.y,Ne.x,Ne.y)}for(const It of ti){Ce.reset(It,.25*ze);let ii=0;ii=Ce.length<=.5*ze?1:Math.ceil(Ce.paddedLength/Ft)+1;for(let oi=0;oi<ii;oi++){const xi=oi/Math.max(ii-1,1),vi=Ce.lerp(xi),Gi=vi.x+hn,Yr=vi.y+hn;N.push(Gi,Yr,ze,0);const Pn=Gi-ze,qr=Yr-ze,_n=Gi+ze,Sn=Yr+ze;if(be=be&&this.isOffscreen(Pn,qr,_n,Sn),ve=ve||this.isInsideGrid(Pn,qr,_n,Sn),a!=="always"&&this.grid.hitTestCircle(Gi,Yr,ze,a,D)&&(oe=!0,!I))return{circles:[],offscreen:!1,collisionDetected:oe}}}}return{circles:!I&&oe||!ve?[]:N,offscreen:be,collisionDetected:oe}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let e=1/0,s=1/0,u=-1/0,d=-1/0;for(const k of a){const D=new l.pointGeometry(k.x+hn,k.y+hn);e=Math.min(e,D.x),s=Math.min(s,D.y),u=Math.max(u,D.x),d=Math.max(d,D.y),r.push(D)}const g=this.grid.query(e,s,u,d).concat(this.ignoredGrid.query(e,s,u,d)),b={},I={};for(const k of g){const D=k.key;if(b[D.bucketInstanceId]===void 0&&(b[D.bucketInstanceId]={}),b[D.bucketInstanceId][D.featureIndex])continue;const F=[new l.pointGeometry(k.x1,k.y1),new l.pointGeometry(k.x2,k.y1),new l.pointGeometry(k.x2,k.y2),new l.pointGeometry(k.x1,k.y2)];l.polygonIntersectsPolygon(r,F)&&(b[D.bucketInstanceId][D.featureIndex]=!0,I[D.bucketInstanceId]===void 0&&(I[D.bucketInstanceId]=[]),I[D.bucketInstanceId].push(D.featureIndex))}return I}insertCollisionBox(a,r,e,s,u,d){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:s,featureIndex:u,collisionGroupID:d,overlapMode:r},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,r,e,s,u,d){const g=e?this.ignoredGrid:this.grid,b={bucketInstanceId:s,featureIndex:u,collisionGroupID:d,overlapMode:r};for(let I=0;I<a.length;I+=4)g.insertCircle(b,a[I],a[I+1],a[I+2])}projectAndGetPerspectiveRatio(a,r,e){const s=[r,e,0,1];return pi(s,s,a),{point:new l.pointGeometry((s[0]/s[3]+1)/2*this.transform.width+hn,(-s[1]/s[3]+1)/2*this.transform.height+hn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/s[3]*.5}}isOffscreen(a,r,e,s){return e<hn||a>=this.screenRightBoundary||s<hn||r>this.screenBottomBoundary}isInsideGrid(a,r,e,s){return e>=0&&a<this.gridRightBoundary&&s>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const a=l.identity([]);return l.translate(a,a,[-100,-100,0]),a}}function wr(w,a,r){return a*(l.EXTENT/(w.tileSize*Math.pow(2,r-w.tileID.overscaledZ)))}class an{constructor(a,r,e,s){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?r:-r))):s&&e?1:0,this.placed=e}isHidden(){return this.opacity===0&&!this.placed}}class wn{constructor(a,r,e,s,u){this.text=new an(a?a.text:null,r,e,u),this.icon=new an(a?a.icon:null,r,s,u)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class is{constructor(a,r,e){this.text=a,this.icon=r,this.skipFade=e}}class Tn{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class ge{constructor(a,r,e,s,u){this.bucketInstanceId=a,this.featureIndex=r,this.sourceLayerIndex=e,this.bucketIndex=s,this.tileID=u}}class B{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const r=++this.maxGroupID;this.collisionGroups[a]={ID:r,predicate:e=>e.collisionGroupID===r}}return this.collisionGroups[a]}}function M(w,a,r,e,s){const{horizontalAlign:u,verticalAlign:d}=l.getAnchorAlignment(w),g=-(u-.5)*a,b=-(d-.5)*r,I=l.evaluateVariableOffset(w,e);return new l.pointGeometry(g+I[0]*s,b+I[1]*s)}function L(w,a,r,e,s,u){const{x1:d,x2:g,y1:b,y2:I,anchorPointX:k,anchorPointY:D}=w,F=new l.pointGeometry(a,r);return e&&F._rotate(s?u:-u),{x1:d+F.x,y1:b+F.y,x2:g+F.x,y2:I+F.y,anchorPointX:k,anchorPointY:D}}class G{constructor(a,r,e,s){this.transform=a.clone(),this.collisionIndex=new mn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new B(e),this.collisionCircleArrays={},this.prevPlacement=s,s&&(s.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,r,e,s){const u=e.getBucket(r),d=e.latestFeatureIndex;if(!u||!d||r.id!==u.layerIds[0])return;const g=e.collisionBoxArray,b=u.layers[0].layout,I=Math.pow(2,this.transform.zoom-e.tileID.overscaledZ),k=e.tileSize/l.EXTENT,D=this.transform.calculatePosMatrix(e.tileID.toUnwrapped()),F=b.get("text-pitch-alignment")==="map",j=b.get("text-rotation-alignment")==="map",N=wr(e,1,this.transform.zoom),K=Ti(D,F,j,this.transform,N);let J=null;if(F){const le=xr(D,F,j,this.transform,N);J=l.multiply([],this.transform.labelPlaneMatrix,le)}this.retainedQueryData[u.bucketInstanceId]=new ge(u.bucketInstanceId,d,u.sourceLayerIndex,u.index,e.tileID);const ee={bucket:u,layout:b,posMatrix:D,textLabelPlaneMatrix:K,labelToScreenMatrix:J,scale:I,textPixelRatio:k,holdingForFade:e.holdingForFade(),collisionBoxArray:g,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(u.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(u.sourceID)};if(s)for(const le of u.sortKeyRanges){const{sortKey:ce,symbolInstanceStart:ye,symbolInstanceEnd:oe}=le;a.push({sortKey:ce,symbolInstanceStart:ye,symbolInstanceEnd:oe,parameters:ee})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(a,r,e,s,u,d,g,b,I,k,D,F,j,N,K){const J=[F.textOffset0,F.textOffset1],ee=M(a,e,s,J,u),le=this.collisionIndex.placeCollisionBox(L(r,ee.x,ee.y,d,g,this.transform.angle),D,b,I,k.predicate);if((!K||this.collisionIndex.placeCollisionBox(L(K,ee.x,ee.y,d,g,this.transform.angle),D,b,I,k.predicate).box.length!==0)&&le.box.length>0){let ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(ce=this.prevPlacement.variableOffsets[F.crossTileID].anchor),this.variableOffsets[F.crossTileID]={textOffset:J,width:e,height:s,anchor:a,textBoxScale:u,prevAnchor:ce},this.markUsedJustification(j,a,F,N),j.allowVerticalPlacement&&(this.markUsedOrientation(j,N,F),this.placedOrientations[F.crossTileID]=N),{shift:ee,placedGlyphBoxes:le}}}placeLayerBucketPart(a,r,e){const{bucket:s,layout:u,posMatrix:d,textLabelPlaneMatrix:g,labelToScreenMatrix:b,textPixelRatio:I,holdingForFade:k,collisionBoxArray:D,partiallyEvaluatedTextSize:F,collisionGroup:j}=a.parameters,N=u.get("text-optional"),K=u.get("icon-optional"),J=l.getOverlapMode(u,"text-overlap","text-allow-overlap"),ee=J==="always",le=l.getOverlapMode(u,"icon-overlap","icon-allow-overlap"),ce=le==="always",ye=u.get("text-rotation-alignment")==="map",oe=u.get("text-pitch-alignment")==="map",ve=u.get("icon-text-fit")!=="none",be=u.get("symbol-z-order")==="viewport-y",ze=ee&&(ce||!s.hasIconData()||K),we=ce&&(ee||!s.hasTextData()||N);!s.collisionArrays&&D&&s.deserializeCollisionBoxes(D);const Ne=(Ce,ut)=>{if(r[Ce.crossTileID])return;if(k)return void(this.placements[Ce.crossTileID]=new is(!1,!1,!1));let yt=!1,xt=!1,Ft=!0,ti=null,It={box:null,offscreen:null},ii={box:null,offscreen:null},oi=null,xi=null,vi=null,Gi=0,Yr=0,Pn=0;ut.textFeatureIndex?Gi=ut.textFeatureIndex:Ce.useRuntimeCollisionCircles&&(Gi=Ce.featureIndex),ut.verticalTextFeatureIndex&&(Yr=ut.verticalTextFeatureIndex);const qr=ut.textBox;if(qr){const Or=Yi=>{let Zi=l.WritingMode.horizontal;if(s.allowVerticalPlacement&&!Yi&&this.prevPlacement){const rr=this.prevPlacement.placedOrientations[Ce.crossTileID];rr&&(this.placedOrientations[Ce.crossTileID]=rr,Zi=rr,this.markUsedOrientation(s,Zi,Ce))}return Zi},Ri=(Yi,Zi)=>{if(s.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const rr of s.writingModes)if(rr===l.WritingMode.vertical?(It=Zi(),ii=It):It=Yi(),It&&It.box&&It.box.length)break}else It=Yi()};if(u.get("text-variable-anchor")){let Yi=u.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ce.crossTileID]){const wi=this.prevPlacement.variableOffsets[Ce.crossTileID];Yi.indexOf(wi.anchor)>0&&(Yi=Yi.filter(Fi=>Fi!==wi.anchor),Yi.unshift(wi.anchor))}const Zi=(wi,Fi,Gr)=>{const Mn=wi.x2-wi.x1,Lr=wi.y2-wi.y1,Un=Ce.textBoxScale,vs=ve&&le==="never"?Fi:null;let bs={box:[],offscreen:!1};const Js=J!=="never"?2*Yi.length:Yi.length;for(let Wn=0;Wn<Js;++Wn){const Jn=this.attemptAnchorPlacement(Yi[Wn%Yi.length],wi,Mn,Lr,Un,ye,oe,I,d,j,Wn>=Yi.length?J:"never",Ce,s,Gr,vs);if(Jn&&(bs=Jn.placedGlyphBoxes,bs&&bs.box&&bs.box.length)){yt=!0,ti=Jn.shift;break}}return bs};Ri(()=>Zi(qr,ut.iconBox,l.WritingMode.horizontal),()=>{const wi=ut.verticalTextBox;return s.allowVerticalPlacement&&!(It&&It.box&&It.box.length)&&Ce.numVerticalGlyphVertices>0&&wi?Zi(wi,ut.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),It&&(yt=It.box,Ft=It.offscreen);const rr=Or(It&&It.box);if(!yt&&this.prevPlacement){const wi=this.prevPlacement.variableOffsets[Ce.crossTileID];wi&&(this.variableOffsets[Ce.crossTileID]=wi,this.markUsedJustification(s,wi.anchor,Ce,rr))}}else{const Yi=(Zi,rr)=>{const wi=this.collisionIndex.placeCollisionBox(Zi,J,I,d,j.predicate);return wi&&wi.box&&wi.box.length&&(this.markUsedOrientation(s,rr,Ce),this.placedOrientations[Ce.crossTileID]=rr),wi};Ri(()=>Yi(qr,l.WritingMode.horizontal),()=>{const Zi=ut.verticalTextBox;return s.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&Zi?Yi(Zi,l.WritingMode.vertical):{box:null,offscreen:null}}),Or(It&&It.box&&It.box.length)}}if(oi=It,yt=oi&&oi.box&&oi.box.length>0,Ft=oi&&oi.offscreen,Ce.useRuntimeCollisionCircles){const Or=s.text.placedSymbolArray.get(Ce.centerJustifiedTextSymbolIndex),Ri=l.evaluateSizeForFeature(s.textSizeData,F,Or),Yi=u.get("text-padding");xi=this.collisionIndex.placeCollisionCircles(J,Or,s.lineVertexArray,s.glyphOffsetArray,Ri,d,g,b,e,oe,j.predicate,Ce.collisionCircleDiameter,Yi),yt=ee||xi.circles.length>0&&!xi.collisionDetected,Ft=Ft&&xi.offscreen}if(ut.iconFeatureIndex&&(Pn=ut.iconFeatureIndex),ut.iconBox){const Or=Ri=>{const Yi=ve&&ti?L(Ri,ti.x,ti.y,ye,oe,this.transform.angle):Ri;return this.collisionIndex.placeCollisionBox(Yi,le,I,d,j.predicate)};ii&&ii.box&&ii.box.length&&ut.verticalIconBox?(vi=Or(ut.verticalIconBox),xt=vi.box.length>0):(vi=Or(ut.iconBox),xt=vi.box.length>0),Ft=Ft&&vi.offscreen}const _n=N||Ce.numHorizontalGlyphVertices===0&&Ce.numVerticalGlyphVertices===0,Sn=K||Ce.numIconVertices===0;if(_n||Sn?Sn?_n||(xt=xt&&yt):yt=xt&&yt:xt=yt=xt&&yt,yt&&oi&&oi.box&&this.collisionIndex.insertCollisionBox(oi.box,J,u.get("text-ignore-placement"),s.bucketInstanceId,ii&&ii.box&&Yr?Yr:Gi,j.ID),xt&&vi&&this.collisionIndex.insertCollisionBox(vi.box,le,u.get("icon-ignore-placement"),s.bucketInstanceId,Pn,j.ID),xi&&(yt&&this.collisionIndex.insertCollisionCircles(xi.circles,J,u.get("text-ignore-placement"),s.bucketInstanceId,Gi,j.ID),e)){const Or=s.bucketInstanceId;let Ri=this.collisionCircleArrays[Or];Ri===void 0&&(Ri=this.collisionCircleArrays[Or]=new Tn);for(let Yi=0;Yi<xi.circles.length;Yi+=4)Ri.circles.push(xi.circles[Yi+0]),Ri.circles.push(xi.circles[Yi+1]),Ri.circles.push(xi.circles[Yi+2]),Ri.circles.push(xi.collisionDetected?1:0)}this.placements[Ce.crossTileID]=new is(yt||ze,xt||we,Ft||s.justReloaded),r[Ce.crossTileID]=!0};if(be){const Ce=s.getSortedSymbolIndexes(this.transform.angle);for(let ut=Ce.length-1;ut>=0;--ut){const yt=Ce[ut];Ne(s.symbolInstances.get(yt),s.collisionArrays[yt])}}else for(let Ce=a.symbolInstanceStart;Ce<a.symbolInstanceEnd;Ce++)Ne(s.symbolInstances.get(Ce),s.collisionArrays[Ce]);if(e&&s.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[s.bucketInstanceId];l.invert(Ce.invProjMatrix,d),Ce.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(a,r,e,s){let u;u=s===l.WritingMode.vertical?e.verticalPlacedTextSymbolIndex:{left:e.leftJustifiedTextSymbolIndex,center:e.centerJustifiedTextSymbolIndex,right:e.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(r)];const d=[e.leftJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.rightJustifiedTextSymbolIndex,e.verticalPlacedTextSymbolIndex];for(const g of d)g>=0&&(a.text.placedSymbolArray.get(g).crossTileID=u>=0&&g!==u?0:e.crossTileID)}markUsedOrientation(a,r,e){const s=r===l.WritingMode.horizontal||r===l.WritingMode.horizontalOnly?r:0,u=r===l.WritingMode.vertical?r:0,d=[e.leftJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.rightJustifiedTextSymbolIndex];for(const g of d)a.text.placedSymbolArray.get(g).placedOrientation=s;e.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(e.verticalPlacedTextSymbolIndex).placedOrientation=u)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let e=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const s=r?r.symbolFadeChange(a):1,u=r?r.opacities:{},d=r?r.variableOffsets:{},g=r?r.placedOrientations:{};for(const b in this.placements){const I=this.placements[b],k=u[b];k?(this.opacities[b]=new wn(k,s,I.text,I.icon),e=e||I.text!==k.text.placed||I.icon!==k.icon.placed):(this.opacities[b]=new wn(null,s,I.text,I.icon,I.skipFade),e=e||I.text||I.icon)}for(const b in u){const I=u[b];if(!this.opacities[b]){const k=new wn(I,s,!1,!1);k.isHidden()||(this.opacities[b]=k,e=e||I.text.placed||I.icon.placed)}}for(const b in d)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=d[b]);for(const b in g)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=g[b]);e?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:a)}updateLayerOpacities(a,r){const e={};for(const s of r){const u=s.getBucket(a);u&&s.latestFeatureIndex&&a.id===u.layerIds[0]&&this.updateBucketOpacities(u,e,s.collisionBoxArray)}}updateBucketOpacities(a,r,e){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const s=a.layers[0].layout,u=new wn(null,0,!1,!1,!0),d=s.get("text-allow-overlap"),g=s.get("icon-allow-overlap"),b=s.get("text-variable-anchor"),I=s.get("text-rotation-alignment")==="map",k=s.get("text-pitch-alignment")==="map",D=s.get("icon-text-fit")!=="none",F=new wn(null,0,d&&(g||!a.hasIconData()||s.get("icon-optional")),g&&(d||!a.hasTextData()||s.get("text-optional")),!0);!a.collisionArrays&&e&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(e);const j=(N,K,J)=>{for(let ee=0;ee<K/4;ee++)N.opacityVertexArray.emplaceBack(J)};for(let N=0;N<a.symbolInstances.length;N++){const K=a.symbolInstances.get(N),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:ee,crossTileID:le}=K;let ce=this.opacities[le];r[le]?ce=u:ce||(ce=F,this.opacities[le]=ce),r[le]=!0;const ye=K.numIconVertices>0,oe=this.placedOrientations[K.crossTileID],ve=oe===l.WritingMode.vertical,be=oe===l.WritingMode.horizontal||oe===l.WritingMode.horizontalOnly;if(J>0||ee>0){const ze=ke(ce.text);j(a.text,J,ve?st:ze),j(a.text,ee,be?st:ze);const we=ce.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(ut=>{ut>=0&&(a.text.placedSymbolArray.get(ut).hidden=we||ve?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=we||be?1:0);const Ne=this.variableOffsets[K.crossTileID];Ne&&this.markUsedJustification(a,Ne.anchor,K,oe);const Ce=this.placedOrientations[K.crossTileID];Ce&&(this.markUsedJustification(a,"left",K,Ce),this.markUsedOrientation(a,Ce,K))}if(ye){const ze=ke(ce.icon),we=!(D&&K.verticalPlacedIconSymbolIndex&&ve);K.placedIconSymbolIndex>=0&&(j(a.icon,K.numIconVertices,we?ze:st),a.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=ce.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(j(a.icon,K.numVerticalIconVertices,we?st:ze),a.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ze=a.collisionArrays[N];if(ze){let we=new l.pointGeometry(0,0);if(ze.textBox||ze.verticalTextBox){let Ce=!0;if(b){const ut=this.variableOffsets[le];ut?(we=M(ut.anchor,ut.width,ut.height,ut.textOffset,ut.textBoxScale),I&&we._rotate(k?this.transform.angle:-this.transform.angle)):Ce=!1}ze.textBox&&H(a.textCollisionBox.collisionVertexArray,ce.text.placed,!Ce||ve,we.x,we.y),ze.verticalTextBox&&H(a.textCollisionBox.collisionVertexArray,ce.text.placed,!Ce||be,we.x,we.y)}const Ne=Boolean(!be&&ze.verticalIconBox);ze.iconBox&&H(a.iconCollisionBox.collisionVertexArray,ce.icon.placed,Ne,D?we.x:0,D?we.y:0),ze.verticalIconBox&&H(a.iconCollisionBox.collisionVertexArray,ce.icon.placed,!Ne,D?we.x:0,D?we.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const N=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=N.invProjMatrix,a.placementViewportMatrix=N.viewportMatrix,a.collisionCircleArray=N.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,r){const e=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*e>a}setStale(){this.stale=!0}}function H(w,a,r,e,s){w.emplaceBack(a?1:0,r?1:0,e||0,s||0),w.emplaceBack(a?1:0,r?1:0,e||0,s||0),w.emplaceBack(a?1:0,r?1:0,e||0,s||0),w.emplaceBack(a?1:0,r?1:0,e||0,s||0)}const te=Math.pow(2,25),ne=Math.pow(2,24),ie=Math.pow(2,17),se=Math.pow(2,16),pe=Math.pow(2,9),Ie=Math.pow(2,8),Se=Math.pow(2,1);function ke(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const a=w.placed?1:0,r=Math.floor(127*w.opacity);return r*te+a*ne+r*ie+a*se+r*pe+a*Ie+r*Se+a}const st=0;class he{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,r,e,s,u){const d=this._bucketParts;for(;this._currentTileIndex<a.length;)if(r.getBucketParts(d,s,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,u())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,d.sort((g,b)=>g.sortKey-b.sortKey));this._currentPartIndex<d.length;)if(r.placeLayerBucketPart(d[this._currentPartIndex],this._seenCrossTileIDs,e),this._currentPartIndex++,u())return!0;return!1}}class qe{constructor(a,r,e,s,u,d,g){this.placement=new G(a,u,d,g),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=e,this._showCollisionBoxes=s,this._done=!1}isDone(){return this._done}continuePlacement(a,r,e){const s=l.exported.now(),u=()=>{const d=l.exported.now()-s;return!this._forceFullPlacement&&d>2};for(;this._currentPlacementIndex>=0;){const d=r[a[this._currentPlacementIndex]],g=this.placement.collisionIndex.transform.zoom;if(d.type==="symbol"&&(!d.minzoom||d.minzoom<=g)&&(!d.maxzoom||d.maxzoom>g)){if(this._inProgressLayer||(this._inProgressLayer=new he(d)),this._inProgressLayer.continuePlacement(e[d.source],this.placement,this._showCollisionBoxes,d,u))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const ot=512/l.EXTENT/2;class Ut{constructor(a,r,e){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=e;for(let s=0;s<r.length;s++){const u=r.get(s),d=u.key;this.indexedSymbolInstances[d]||(this.indexedSymbolInstances[d]=[]),this.indexedSymbolInstances[d].push({crossTileID:u.crossTileID,coord:this.getScaledCoordinates(u,a)})}}getScaledCoordinates(a,r){const e=ot/Math.pow(2,r.canonical.z-this.tileID.canonical.z);return{x:Math.floor((r.canonical.x*l.EXTENT+a.anchorX)*e),y:Math.floor((r.canonical.y*l.EXTENT+a.anchorY)*e)}}findMatches(a,r,e){const s=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let u=0;u<a.length;u++){const d=a.get(u);if(d.crossTileID)continue;const g=this.indexedSymbolInstances[d.key];if(!g)continue;const b=this.getScaledCoordinates(d,r);for(const I of g)if(Math.abs(I.coord.x-b.x)<=s&&Math.abs(I.coord.y-b.y)<=s&&!e[I.crossTileID]){e[I.crossTileID]=!0,d.crossTileID=I.crossTileID;break}}}}class Lt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Et{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const r=Math.round((a-this.lng)/360);if(r!==0)for(const e in this.indexes){const s=this.indexes[e],u={};for(const d in s){const g=s[d];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+r),u[g.tileID.key]=g}this.indexes[e]=u}this.lng=a}addBucket(a,r,e){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let u=0;u<r.symbolInstances.length;u++)r.symbolInstances.get(u).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const s=this.usedCrossTileIDs[a.overscaledZ];for(const u in this.indexes){const d=this.indexes[u];if(Number(u)>a.overscaledZ)for(const g in d){const b=d[g];b.tileID.isChildOf(a)&&b.findMatches(r.symbolInstances,a,s)}else{const g=d[a.scaledTo(Number(u)).key];g&&g.findMatches(r.symbolInstances,a,s)}}for(let u=0;u<r.symbolInstances.length;u++){const d=r.symbolInstances.get(u);d.crossTileID||(d.crossTileID=e.generate(),s[d.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Ut(a,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(a,r){for(const e in r.indexedSymbolInstances)for(const s of r.indexedSymbolInstances[e])delete this.usedCrossTileIDs[a][s.crossTileID]}removeStaleBuckets(a){let r=!1;for(const e in this.indexes){const s=this.indexes[e];for(const u in s)a[s[u].bucketInstanceId]||(this.removeBucketCrossTileIDs(e,s[u]),delete s[u],r=!0)}return r}}class Vt{constructor(){this.layerIndexes={},this.crossTileIDs=new Lt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,r,e){let s=this.layerIndexes[a.id];s===void 0&&(s=this.layerIndexes[a.id]=new Et);let u=!1;const d={};s.handleWrapJump(e);for(const g of r){const b=g.getBucket(a);b&&a.id===b.layerIds[0]&&(b.bucketInstanceId||(b.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(g.tileID,b,this.crossTileIDs)&&(u=!0),d[b.bucketInstanceId]=!0)}return s.removeStaleBuckets(d)&&(u=!0),u}pruneUnusedLayers(a){const r={};a.forEach(e=>{r[e]=!0});for(const e in this.layerIndexes)r[e]||delete this.layerIndexes[e]}}const Kt=(w,a)=>l.emitValidationErrors(w,a&&a.filter(r=>r.identifier!=="source.canvas")),Qi=l.pick(Qt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ni=l.pick(Qt,["setCenter","setZoom","setBearing","setPitch"]),fr=function(){const w={},a=l.spec.$version;for(const r in l.spec.$root){const e=l.spec.$root[r];if(e.required){let s=null;s=r==="version"?a:e.type==="array"?[]:{},s!=null&&(w[r]=s)}}return w}();class gn extends l.Evented{constructor(a,r={}){super(),this.map=a,this.dispatcher=new wt(br(),this),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new rt(a._requestManager,r.localIdeographFontFamily),this.lineAtlas=new ft(256,512),this.crossTileSymbolIndex=new Vt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const e=this;this._rtlTextPluginCallback=gn.registerForPluginStateChange(s=>{e.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:s.pluginStatus,pluginURL:s.pluginURL},(u,d)=>{if(l.triggerPluginCompletionEvent(u),d&&d.every(g=>g))for(const g in e.sourceCaches)e.sourceCaches[g].reload()})}),this.on("data",s=>{if(s.dataType!=="source"||s.sourceDataType!=="metadata")return;const u=this.sourceCaches[s.sourceId];if(!u)return;const d=u.getSource();if(d&&d.vectorLayerIds)for(const g in this._layers){const b=this._layers[g];b.source===d.id&&this._validateLayer(b)}})}loadURL(a,r={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const e=typeof r.validate!="boolean"||r.validate,s=this.map._requestManager.transformRequest(a,l.ResourceType.Style);this._request=l.getJSON(s,(u,d)=>{this._request=null,u?this.fire(new l.ErrorEvent(u)):d&&this._load(d,e)})}loadJSON(a,r={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(a,r.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(fr,!1)}_load(a,r){if(r&&Kt(this,l.validateStyle(a)))return;this._loaded=!0,this.stylesheet=a;for(const s in a.sources)this.addSource(s,a.sources[s],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);const e=Hi(this.stylesheet.layers);this._order=e.map(s=>s.id),this._layers={},this._serializedLayers={};for(let s of e)s=l.createStyleLayer(s),s.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new We(this.stylesheet.light),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(a){this._spriteRequest=function(r,e,s,u){let d,g,b;const I=s>1?"@2x":"";let k=l.getJSON(e.transformRequest(e.normalizeSpriteURL(r,I,".json"),l.ResourceType.SpriteJSON),(j,N)=>{k=null,b||(b=j,d=N,F())}),D=l.getImage(e.transformRequest(e.normalizeSpriteURL(r,I,".png"),l.ResourceType.SpriteImage),(j,N)=>{D=null,b||(b=j,g=N,F())});function F(){if(b)u(b);else if(d&&g){const j=l.exported.getImageData(g),N={};for(const K in d){const{width:J,height:ee,x:le,y:ce,sdf:ye,pixelRatio:oe,stretchX:ve,stretchY:be,content:ze}=d[K],we=new l.RGBAImage({width:J,height:ee});l.RGBAImage.copy(j,we,{x:le,y:ce},{x:0,y:0},{width:J,height:ee}),N[K]={data:we,pixelRatio:oe,sdf:ye,stretchX:ve,stretchY:be,content:ze}}u(null,N)}}return{cancel(){k&&(k.cancel(),k=null),D&&(D.cancel(),D=null)}}}(a,this.map._requestManager,this.map.getPixelRatio(),(r,e)=>{if(this._spriteRequest=null,r)this.fire(new l.ErrorEvent(r));else if(e)for(const s in e)this.imageManager.addImage(s,e[s]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(a){const r=this.sourceCaches[a.source];if(!r)return;const e=a.sourceLayer;if(!e)return;const s=r.getSource();(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(e)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${e}" does not exist on source "${s.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const r=[];for(const e of a){const s=this._layers[e];s.type!=="custom"&&r.push(s.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const r=this._changed;if(this._changed){const s=Object.keys(this._updatedLayers),u=Object.keys(this._removedLayers);(s.length||u.length)&&this._updateWorkerLayers(s,u);for(const d in this._updatedSources){const g=this._updatedSources[d];g==="reload"?this._reloadSource(d):g==="clear"&&this._clearSource(d)}this._updateTilesForChangedImages();for(const d in this._updatedPaintProps)this._layers[d].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const e={};for(const s in this.sourceCaches){const u=this.sourceCaches[s];e[s]=u.used,u.used=!1}for(const s of this._order){const u=this._layers[s];u.recalculate(a,this._availableImages),!u.isHidden(a.zoom)&&u.source&&(this.sourceCaches[u.source].used=!0)}for(const s in e){const u=this.sourceCaches[s];e[s]!==u.used&&u.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:s}))}this.light.recalculate(a),this.z=a.zoom,r&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,r){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Kt(this,l.validateStyle(a)))return!1;(a=l.clone$1(a)).layers=Hi(a.layers);const r=function(s,u){if(!s)return[{command:Qt.setStyle,args:[u]}];let d=[];try{if(!re(s.version,u.version))return[{command:Qt.setStyle,args:[u]}];re(s.center,u.center)||d.push({command:Qt.setCenter,args:[u.center]}),re(s.zoom,u.zoom)||d.push({command:Qt.setZoom,args:[u.zoom]}),re(s.bearing,u.bearing)||d.push({command:Qt.setBearing,args:[u.bearing]}),re(s.pitch,u.pitch)||d.push({command:Qt.setPitch,args:[u.pitch]}),re(s.sprite,u.sprite)||d.push({command:Qt.setSprite,args:[u.sprite]}),re(s.glyphs,u.glyphs)||d.push({command:Qt.setGlyphs,args:[u.glyphs]}),re(s.transition,u.transition)||d.push({command:Qt.setTransition,args:[u.transition]}),re(s.light,u.light)||d.push({command:Qt.setLight,args:[u.light]});const g={},b=[];(function(k,D,F,j){let N;for(N in D=D||{},k=k||{})Object.prototype.hasOwnProperty.call(k,N)&&(Object.prototype.hasOwnProperty.call(D,N)||Di(N,F,j));for(N in D)Object.prototype.hasOwnProperty.call(D,N)&&(Object.prototype.hasOwnProperty.call(k,N)?re(k[N],D[N])||(k[N].type==="geojson"&&D[N].type==="geojson"&&Vi(k,D,N)?F.push({command:Qt.setGeoJSONSourceData,args:[N,D[N].data]}):jt(N,D,F,j)):tr(N,D,F))})(s.sources,u.sources,b,g);const I=[];s.layers&&s.layers.forEach(k=>{g[k.source]?d.push({command:Qt.removeLayer,args:[k.id]}):I.push(k)}),d=d.concat(b),function(k,D,F){D=D||[];const j=(k=k||[]).map(Ae),N=D.map(Ae),K=k.reduce($r,{}),J=D.reduce($r,{}),ee=j.slice(),le=Object.create(null);let ce,ye,oe,ve,be,ze,we;for(ce=0,ye=0;ce<j.length;ce++)oe=j[ce],Object.prototype.hasOwnProperty.call(J,oe)?ye++:(F.push({command:Qt.removeLayer,args:[oe]}),ee.splice(ee.indexOf(oe,ye),1));for(ce=0,ye=0;ce<N.length;ce++)oe=N[N.length-1-ce],ee[ee.length-1-ce]!==oe&&(Object.prototype.hasOwnProperty.call(K,oe)?(F.push({command:Qt.removeLayer,args:[oe]}),ee.splice(ee.lastIndexOf(oe,ee.length-ye),1)):ye++,ze=ee[ee.length-ce],F.push({command:Qt.addLayer,args:[J[oe],ze]}),ee.splice(ee.length-ce,0,oe),le[oe]=!0);for(ce=0;ce<N.length;ce++)if(oe=N[ce],ve=K[oe],be=J[oe],!le[oe]&&!re(ve,be))if(re(ve.source,be.source)&&re(ve["source-layer"],be["source-layer"])&&re(ve.type,be.type)){for(we in ae(ve.layout,be.layout,F,oe,null,Qt.setLayoutProperty),ae(ve.paint,be.paint,F,oe,null,Qt.setPaintProperty),re(ve.filter,be.filter)||F.push({command:Qt.setFilter,args:[oe,be.filter]}),re(ve.minzoom,be.minzoom)&&re(ve.maxzoom,be.maxzoom)||F.push({command:Qt.setLayerZoomRange,args:[oe,be.minzoom,be.maxzoom]}),ve)Object.prototype.hasOwnProperty.call(ve,we)&&we!=="layout"&&we!=="paint"&&we!=="filter"&&we!=="metadata"&&we!=="minzoom"&&we!=="maxzoom"&&(we.indexOf("paint.")===0?ae(ve[we],be[we],F,oe,we.slice(6),Qt.setPaintProperty):re(ve[we],be[we])||F.push({command:Qt.setLayerProperty,args:[oe,we,be[we]]}));for(we in be)Object.prototype.hasOwnProperty.call(be,we)&&!Object.prototype.hasOwnProperty.call(ve,we)&&we!=="layout"&&we!=="paint"&&we!=="filter"&&we!=="metadata"&&we!=="minzoom"&&we!=="maxzoom"&&(we.indexOf("paint.")===0?ae(ve[we],be[we],F,oe,we.slice(6),Qt.setPaintProperty):re(ve[we],be[we])||F.push({command:Qt.setLayerProperty,args:[oe,we,be[we]]}))}else F.push({command:Qt.removeLayer,args:[oe]}),ze=ee[ee.lastIndexOf(oe)+1],F.push({command:Qt.addLayer,args:[be,ze]})}(I,u.layers,d)}catch(g){console.warn("Unable to compute style diff:",g),d=[{command:Qt.setStyle,args:[u]}]}return d}(this.serialize(),a).filter(s=>!(s.command in Ni));if(r.length===0)return!1;const e=r.filter(s=>!(s.command in Qi));if(e.length>0)throw new Error(`Unimplemented: ${e.map(s=>s.command).join(", ")}.`);return r.forEach(s=>{s.command!=="setTransition"&&this[s.command].apply(this,s.args)}),this.stylesheet=a,!0}addImage(a,r){if(this.getImage(a))return this.fire(new l.ErrorEvent(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,r),this._afterImageUpdated(a)}updateImage(a,r){this.imageManager.updateImage(a,r)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new l.ErrorEvent(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,r,e={}){if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(l.validateStyle.source,`sources.${a}`,r,null,e))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const s=this.sourceCaches[a]=new Ai(a,r,this.dispatcher);s.style=this,s.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:s.serialize(),sourceId:a})),s.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const e in this._layers)if(this._layers[e].source===a)return this.fire(new l.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${e}" is using it.`)));const r=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],r.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,r){this._checkLoaded(),this.sourceCaches[a].getSource().setData(r),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,r,e={}){this._checkLoaded();const s=a.id;if(this.getLayer(s))return void this.fire(new l.ErrorEvent(new Error(`Layer "${s}" already exists on this map.`)));let u;if(a.type==="custom"){if(Kt(this,l.validateCustomStyleLayer(a)))return;u=l.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(s,a.source),a=l.clone$1(a),a=l.extend(a,{source:s})),this._validate(l.validateStyle.layer,`layers.${s}`,a,{arrayIndex:-1},e))return;u=l.createStyleLayer(a),this._validateLayer(u),u.setEventedParent(this,{layer:{id:s}}),this._serializedLayers[u.id]=u.serialize()}const d=r?this._order.indexOf(r):this._order.length;if(r&&d===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${s}" before non-existing layer "${r}".`)));else{if(this._order.splice(d,0,s),this._layerOrderChanged=!0,this._layers[s]=u,this._removedLayers[s]&&u.source&&u.type!=="custom"){const g=this._removedLayers[s];delete this._removedLayers[s],g.type!==u.type?this._updatedSources[u.source]="clear":(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause())}this._updateLayer(u),u.onAdd&&u.onAdd(this.map)}}moveLayer(a,r){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new l.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===r)return;const e=this._order.indexOf(a);this._order.splice(e,1);const s=r?this._order.indexOf(r):this._order.length;r&&s===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${a}" before non-existing layer "${r}".`))):(this._order.splice(s,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const r=this._layers[a];if(!r)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${a}".`)));r.setEventedParent(null);const e=this._order.indexOf(a);this._order.splice(e,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=r,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],r.onRemove&&r.onRemove(this.map)}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,r,e){this._checkLoaded();const s=this.getLayer(a);s?s.minzoom===r&&s.maxzoom===e||(r!=null&&(s.minzoom=r),e!=null&&(s.maxzoom=e),this._updateLayer(s)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,r,e={}){this._checkLoaded();const s=this.getLayer(a);if(s){if(!re(s.filter,r))return r==null?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(l.validateStyle.filter,`layers.${s.id}.filter`,r,null,e)||(s.filter=l.clone$1(r),this._updateLayer(s)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return l.clone$1(this.getLayer(a).filter)}setLayoutProperty(a,r,e,s={}){this._checkLoaded();const u=this.getLayer(a);u?re(u.getLayoutProperty(r),e)||(u.setLayoutProperty(r,e,s),this._updateLayer(u)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,r){const e=this.getLayer(a);if(e)return e.getLayoutProperty(r);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,r,e,s={}){this._checkLoaded();const u=this.getLayer(a);u?re(u.getPaintProperty(r),e)||(u.setPaintProperty(r,e,s)&&this._updateLayer(u),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,r){return this.getLayer(a).getPaintProperty(r)}setFeatureState(a,r){this._checkLoaded();const e=a.source,s=a.sourceLayer,u=this.sourceCaches[e];if(u===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${e}' does not exist in the map's style.`)));const d=u.getSource().type;d==="geojson"&&s?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):d!=="vector"||s?(a.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),u.setFeatureState(s,a.id,r)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,r){this._checkLoaded();const e=a.source,s=this.sourceCaches[e];if(s===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${e}' does not exist in the map's style.`)));const u=s.getSource().type,d=u==="vector"?a.sourceLayer:void 0;u!=="vector"||d?r&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):s.removeFeatureState(d,a.id,r):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const r=a.source,e=a.sourceLayer,s=this.sourceCaches[r];if(s!==void 0)return s.getSource().type!=="vector"||e?(a.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),s.getFeatureState(e,a.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,a=>a.serialize()),layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(a){const r=d=>this._layers[d].type==="fill-extrusion",e={},s=[];for(let d=this._order.length-1;d>=0;d--){const g=this._order[d];if(r(g)){e[g]=d;for(const b of a){const I=b[g];if(I)for(const k of I)s.push(k)}}}s.sort((d,g)=>g.intersectionZ-d.intersectionZ);const u=[];for(let d=this._order.length-1;d>=0;d--){const g=this._order[d];if(r(g))for(let b=s.length-1;b>=0;b--){const I=s[b].feature;if(e[I.layer.id]<d)break;u.push(I),s.pop()}else for(const b of a){const I=b[g];if(I)for(const k of I)u.push(k.feature)}}return u}queryRenderedFeatures(a,r,e){r&&r.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);const s={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const d of r.layers){const g=this._layers[d];if(!g)return this.fire(new l.ErrorEvent(new Error(`The layer '${d}' does not exist in the map's style and cannot be queried for features.`))),[];s[g.source]=!0}}const u=[];r.availableImages=this._availableImages;for(const d in this.sourceCaches)r.layers&&!s[d]||u.push(lt(this.sourceCaches[d],this._layers,this._serializedLayers,a,r,e));return this.placement&&u.push(function(d,g,b,I,k,D,F){const j={},N=D.queryRenderedSymbols(I),K=[];for(const J of Object.keys(N).map(Number))K.push(F[J]);K.sort($e);for(const J of K){const ee=J.featureIndex.lookupSymbolFeatures(N[J.bucketInstanceId],g,J.bucketIndex,J.sourceLayerIndex,k.filter,k.layers,k.availableImages,d);for(const le in ee){const ce=j[le]=j[le]||[],ye=ee[le];ye.sort((oe,ve)=>{const be=J.featureSortOrder;if(be){const ze=be.indexOf(oe.featureIndex);return be.indexOf(ve.featureIndex)-ze}return ve.featureIndex-oe.featureIndex});for(const oe of ye)ce.push(oe)}}for(const J in j)j[J].forEach(ee=>{const le=ee.feature,ce=b[d[J].source].getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ce});return j}(this._layers,this._serializedLayers,this.sourceCaches,a,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(u)}querySourceFeatures(a,r){r&&r.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);const e=this.sourceCaches[a];return e?function(s,u){const d=s.getRenderableIds().map(I=>s.getTileByID(I)),g=[],b={};for(let I=0;I<d.length;I++){const k=d[I],D=k.tileID.canonical.key;b[D]||(b[D]=!0,k.querySourceFeatures(g,u))}return g}(e,r):[]}addSourceType(a,r,e){return gn.getSourceType(a)?e(new Error(`A source type called "${a}" already exists.`)):(gn.setSourceType(a,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:r.workerSourceURL},e):e(null,null))}getLight(){return this.light.getLight()}setLight(a,r={}){this._checkLoaded();const e=this.light.getLight();let s=!1;for(const d in a)if(!re(a[d],e[d])){s=!0;break}if(!s)return;const u={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,r),this.light.updateTransitions(u)}_validate(a,r,e,s,u={}){return(!u||u.validate!==!1)&&Kt(this,a.call(l.validateStyle,l.extend({key:r,style:this.serialize(),value:e,styleSpec:l.spec},s)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const r=this.sourceCaches[a];r.setEventedParent(null),r.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const r in this.sourceCaches)this.sourceCaches[r].update(a)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,r,e,s,u=!1){let d=!1,g=!1;const b={};for(const I of this._order){const k=this._layers[I];if(k.type!=="symbol")continue;if(!b[k.source]){const F=this.sourceCaches[k.source];b[k.source]=F.getRenderableIds(!0).map(j=>F.getTileByID(j)).sort((j,N)=>N.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(N.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(k,b[k.source],a.center.lng);d=d||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((u=u||this._layerOrderChanged||e===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),a.zoom))&&(this.pauseablePlacement=new qe(a,this._order,u,r,e,s,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),g=!0),d&&this.pauseablePlacement.placement.setStale()),g||d)for(const I of this._order){const k=this._layers[I];k.type==="symbol"&&this.placement.updateLayerOpacities(k,b[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,r,e){this.imageManager.getImages(r.icons,e),this._updateTilesForChangedImages();const s=this.sourceCaches[r.source];s&&s.setDependencies(r.tileID.key,r.type,r.icons)}getGlyphs(a,r,e){this.glyphManager.getGlyphs(r.stacks,e)}getResource(a,r,e){return l.makeRequest(r,e)}}gn.getSourceType=function(w){return _i[w]},gn.setSourceType=function(w,a){_i[w]=a},gn.registerForPluginStateChange=l.registerForPluginStateChange;var Es=l.createLayout([{name:"a_pos",type:"Int16",components:2}]),mr={prelude:Tr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),background:Tr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Tr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Tr(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Tr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Tr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Tr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Tr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Tr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:Tr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Tr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Tr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Tr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Tr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Tr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lineGradient:Tr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),linePattern:Tr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Tr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Tr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Tr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),symbolSDF:Tr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Tr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`)};function Tr(w,a){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,e=a.match(/attribute ([\w]+) ([\w]+)/g),s=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),u=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=u?u.concat(s):s,g={};return{fragmentSource:w=w.replace(r,(b,I,k,D,F)=>(g[F]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${k} ${D} ${F};
#else
uniform ${k} ${D} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${k} ${D} ${F} = u_${F};
#endif
`)),vertexSource:a=a.replace(r,(b,I,k,D,F)=>{const j=D==="float"?"vec2":"vec4",N=F.match(/color/)?"color":j;return g[F]?I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${k} ${j} a_${F};
varying ${k} ${D} ${F};
#else
uniform ${k} ${D} u_${F};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${k} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${N}(a_${F}, u_${F}_t);
#else
    ${k} ${D} ${F} = u_${F};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${k} ${j} a_${F};
#else
uniform ${k} ${D} u_${F};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${D} ${F} = a_${F};
#else
    ${k} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${D} ${F} = unpack_mix_${N}(a_${F}, u_${F}_t);
#else
    ${k} ${D} ${F} = u_${F};
#endif
`}),staticAttributes:e,staticUniforms:d}}class il{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,r,e,s,u,d,g,b){this.context=a;let I=this.boundPaintVertexBuffers.length!==s.length;for(let k=0;!I&&k<s.length;k++)this.boundPaintVertexBuffers[k]!==s[k]&&(I=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===r&&this.boundLayoutVertexBuffer===e&&!I&&this.boundIndexBuffer===u&&this.boundVertexOffset===d&&this.boundDynamicVertexBuffer===g&&this.boundDynamicVertexBuffer2===b?(a.bindVertexArrayOES.set(this.vao),g&&g.bind(),u&&u.dynamicDraw&&u.bind(),b&&b.bind()):this.freshBind(r,e,s,u,d,g,b)}freshBind(a,r,e,s,u,d,g){let b;const I=a.numAttributes,k=this.context,D=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),b=0,this.boundProgram=a,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=e,this.boundIndexBuffer=s,this.boundVertexOffset=u,this.boundDynamicVertexBuffer=d,this.boundDynamicVertexBuffer2=g;else{b=k.currentNumAttributes||0;for(let F=I;F<b;F++)D.disableVertexAttribArray(F)}r.enableAttributes(D,a);for(const F of e)F.enableAttributes(D,a);d&&d.enableAttributes(D,a),g&&g.enableAttributes(D,a),r.bind(),r.setVertexAttribPointers(D,a,u);for(const F of e)F.bind(),F.setVertexAttribPointers(D,a,u);d&&(d.bind(),d.setVertexAttribPointers(D,a,u)),s&&s.bind(),g&&(g.bind(),g.setVertexAttribPointers(D,a,u)),k.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ta(w){const a=[];for(let r=0;r<w.length;r++){if(w[r]===null)continue;const e=w[r].split(" ");a.push(e.pop())}return a}class Pl{constructor(a,r,e,s,u,d){const g=a.gl;this.program=g.createProgram();const b=Ta(e.staticAttributes),I=s?s.getBinderAttributes():[],k=b.concat(I),D=e.staticUniforms?Ta(e.staticUniforms):[],F=s?s.getBinderUniforms():[],j=D.concat(F),N=[];for(const oe of j)N.indexOf(oe)<0&&N.push(oe);const K=s?s.defines():[];d&&K.push("#define OVERDRAW_INSPECTOR;");const J=K.concat(mr.prelude.fragmentSource,e.fragmentSource).join(`
`),ee=K.concat(mr.prelude.vertexSource,e.vertexSource).join(`
`),le=g.createShader(g.FRAGMENT_SHADER);if(g.isContextLost())return void(this.failedToCreate=!0);g.shaderSource(le,J),g.compileShader(le),g.attachShader(this.program,le);const ce=g.createShader(g.VERTEX_SHADER);if(g.isContextLost())return void(this.failedToCreate=!0);g.shaderSource(ce,ee),g.compileShader(ce),g.attachShader(this.program,ce),this.attributes={};const ye={};this.numAttributes=k.length;for(let oe=0;oe<this.numAttributes;oe++)k[oe]&&(g.bindAttribLocation(this.program,oe,k[oe]),this.attributes[k[oe]]=oe);g.linkProgram(this.program),g.deleteShader(ce),g.deleteShader(le);for(let oe=0;oe<N.length;oe++){const ve=N[oe];if(ve&&!ye[ve]){const be=g.getUniformLocation(this.program,ve);be&&(ye[ve]=be)}}this.fixedUniforms=u(a,ye),this.binderUniforms=s?s.getUniforms(a,ye):[]}draw(a,r,e,s,u,d,g,b,I,k,D,F,j,N,K,J){const ee=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(e),a.setStencilMode(s),a.setColorMode(u),a.setCullFace(d);for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(g[ce]);N&&N.setUniforms(a,this.binderUniforms,F,{zoom:j});const le={[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[r];for(const ce of D.get()){const ye=ce.vaos||(ce.vaos={});(ye[b]||(ye[b]=new il)).bind(a,this,I,N?N.getPaintVertexBuffers():[],k,ce.vertexOffset,K,J),ee.drawElements(r,ce.primitiveLength*le,ee.UNSIGNED_SHORT,ce.primitiveOffset*le*2)}}}function fo(w,a,r){const e=1/wr(r,1,a.transform.tileZoom),s=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,a.transform.tileZoom)/s,d=u*(r.tileID.canonical.x+r.tileID.wrap*s),g=u*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[e,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[d>>16,g>>16],u_pixel_coord_lower:[65535&d,65535&g]}}const rl=(w,a,r,e)=>{const s=a.style.light,u=s.properties.get("position"),d=[u.x,u.y,u.z],g=function(){var I=new l.ARRAY_TYPE(9);return l.ARRAY_TYPE!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();s.properties.get("anchor")==="viewport"&&function(I,k){var D=Math.sin(k),F=Math.cos(k);I[0]=F,I[1]=D,I[2]=0,I[3]=-D,I[4]=F,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(g,-a.transform.angle),function(I,k,D){var F=k[0],j=k[1],N=k[2];I[0]=F*D[0]+j*D[3]+N*D[6],I[1]=F*D[1]+j*D[4]+N*D[7],I[2]=F*D[2]+j*D[5]+N*D[8]}(d,d,g);const b=s.properties.get("color");return{u_matrix:w,u_lightpos:d,u_lightintensity:s.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+r,u_opacity:e}},Go=(w,a,r,e,s,u,d)=>l.extend(rl(w,a,r,e),fo(u,a,d),{u_height_factor:-Math.pow(2,s.overscaledZ)/d.tileSize/8}),Zo=w=>({u_matrix:w}),Ia=(w,a,r,e)=>l.extend(Zo(w),fo(r,a,e)),qs=(w,a)=>({u_matrix:w,u_world:a}),Xo=(w,a,r,e,s)=>l.extend(Ia(w,a,r,e),{u_world:s}),rs=(w,a,r,e)=>{const s=w.transform;let u,d;if(e.paint.get("circle-pitch-alignment")==="map"){const g=wr(r,1,s.zoom);u=!0,d=[g,g]}else u=!1,d=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+(e.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(a.posMatrix,r,e.paint.get("circle-translate"),e.paint.get("circle-translate-anchor")),u_pitch_with_map:+u,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:d}},Gs=(w,a,r)=>{const e=wr(r,1,a.zoom),s=Math.pow(2,a.zoom-r.tileID.overscaledZ),u=r.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:e,u_extrude_scale:[a.pixelsToGLUnits[0]/(e*s),a.pixelsToGLUnits[1]/(e*s)],u_overscale_factor:u}},fs=(w,a,r=1)=>({u_matrix:w,u_color:a,u_overlay:0,u_overlay_scale:r}),Zs=w=>({u_matrix:w}),mo=(w,a,r,e)=>({u_matrix:w,u_extrude_scale:wr(a,1,r),u_intensity:e});function As(w,a){const r=Math.pow(2,a.canonical.z),e=a.canonical.y;return[new l.MercatorCoordinate(0,e/r).toLngLat().lat,new l.MercatorCoordinate(0,(e+1)/r).toLngLat().lat]}const ks=(w,a,r)=>{const e=w.transform;return{u_matrix:Sa(w,a,r),u_ratio:1/wr(a,1,e.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/e.pixelsToGLUnits[0],1/e.pixelsToGLUnits[1]]}},Qr=(w,a,r,e)=>l.extend(ks(w,a,r),{u_image:0,u_image_height:e}),Xs=(w,a,r,e)=>{const s=w.transform,u=Qs(a,s);return{u_matrix:Sa(w,a,r),u_texsize:a.imageAtlasTexture.size,u_ratio:1/wr(a,1,s.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[u,e.fromScale,e.toScale],u_fade:e.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},rn=(w,a,r,e,s)=>{const u=w.lineAtlas,d=Qs(a,w.transform),g=r.layout.get("line-cap")==="round",b=u.getDash(e.from,g),I=u.getDash(e.to,g),k=b.width*s.fromScale,D=I.width*s.toScale;return l.extend(ks(w,a,r),{u_patternscale_a:[d/k,-b.height/2],u_patternscale_b:[d/D,-I.height/2],u_sdfgamma:u.width/(256*Math.min(k,D)*w.pixelRatio)/2,u_image:0,u_tex_y_a:b.y,u_tex_y_b:I.y,u_mix:s.t})};function Qs(w,a){return 1/wr(w,1,a.tileZoom)}function Sa(w,a,r){return w.translatePosMatrix(a.tileID.posMatrix,a,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Ea=(w,a,r,e,s)=>{return{u_matrix:w,u_tl_parent:a,u_scale_parent:r,u_buffer_scale:1,u_fade_t:e.mix,u_opacity:e.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(d=s.paint.get("raster-saturation"),d>0?1-1/(1.001-d):-d),u_contrast_factor:(u=s.paint.get("raster-contrast"),u>0?1/(1-u):1+u),u_spin_weights:Aa(s.paint.get("raster-hue-rotate"))};var u,d};function Aa(w){w*=Math.PI/180;const a=Math.sin(w),r=Math.cos(w);return[(2*r+1)/3,(-Math.sqrt(3)*a-r+1)/3,(Math.sqrt(3)*a-r+1)/3]}const Wo=(w,a,r,e,s,u,d,g,b,I)=>{const k=s.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:k.cameraToCenterDistance,u_pitch:k.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:k.width/k.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:u,u_label_plane_matrix:d,u_coord_matrix:g,u_is_text:+b,u_pitch_with_map:+e,u_texsize:I,u_texture:0}},nl=(w,a,r,e,s,u,d,g,b,I,k)=>{const D=s.transform;return l.extend(Wo(w,a,r,e,s,u,d,g,b,I),{u_gamma_scale:e?Math.cos(D._pitch)*D.cameraToCenterDistance:1,u_device_pixel_ratio:s.pixelRatio,u_is_halo:+k})},sl=(w,a,r,e,s,u,d,g,b,I)=>l.extend(nl(w,a,r,e,s,u,d,g,!0,b,!0),{u_texsize_icon:I,u_texture_icon:1}),ol=(w,a,r)=>({u_matrix:w,u_opacity:a,u_color:r}),Ho=(w,a,r,e,s,u)=>l.extend(function(d,g,b,I){const k=b.imageManager.getPattern(d.from.toString()),D=b.imageManager.getPattern(d.to.toString()),{width:F,height:j}=b.imageManager.getPixelSize(),N=Math.pow(2,I.tileID.overscaledZ),K=I.tileSize*Math.pow(2,b.transform.tileZoom)/N,J=K*(I.tileID.canonical.x+I.tileID.wrap*N),ee=K*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[F,j],u_mix:g.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:g.fromScale,u_scale_b:g.toScale,u_tile_units_to_pixels:1/wr(I,1,b.transform.tileZoom),u_pixel_coord_upper:[J>>16,ee>>16],u_pixel_coord_lower:[65535&J,65535&ee]}}(e,u,r,s),{u_matrix:w,u_opacity:a}),Ko={fillExtrusion:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_lightpos:new l.Uniform3f(w,a.u_lightpos),u_lightintensity:new l.Uniform1f(w,a.u_lightintensity),u_lightcolor:new l.Uniform3f(w,a.u_lightcolor),u_vertical_gradient:new l.Uniform1f(w,a.u_vertical_gradient),u_opacity:new l.Uniform1f(w,a.u_opacity)}),fillExtrusionPattern:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_lightpos:new l.Uniform3f(w,a.u_lightpos),u_lightintensity:new l.Uniform1f(w,a.u_lightintensity),u_lightcolor:new l.Uniform3f(w,a.u_lightcolor),u_vertical_gradient:new l.Uniform1f(w,a.u_vertical_gradient),u_height_factor:new l.Uniform1f(w,a.u_height_factor),u_image:new l.Uniform1i(w,a.u_image),u_texsize:new l.Uniform2f(w,a.u_texsize),u_pixel_coord_upper:new l.Uniform2f(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(w,a.u_pixel_coord_lower),u_scale:new l.Uniform3f(w,a.u_scale),u_fade:new l.Uniform1f(w,a.u_fade),u_opacity:new l.Uniform1f(w,a.u_opacity)}),fill:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix)}),fillPattern:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_image:new l.Uniform1i(w,a.u_image),u_texsize:new l.Uniform2f(w,a.u_texsize),u_pixel_coord_upper:new l.Uniform2f(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(w,a.u_pixel_coord_lower),u_scale:new l.Uniform3f(w,a.u_scale),u_fade:new l.Uniform1f(w,a.u_fade)}),fillOutline:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_world:new l.Uniform2f(w,a.u_world)}),fillOutlinePattern:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_world:new l.Uniform2f(w,a.u_world),u_image:new l.Uniform1i(w,a.u_image),u_texsize:new l.Uniform2f(w,a.u_texsize),u_pixel_coord_upper:new l.Uniform2f(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(w,a.u_pixel_coord_lower),u_scale:new l.Uniform3f(w,a.u_scale),u_fade:new l.Uniform1f(w,a.u_fade)}),circle:(w,a)=>({u_camera_to_center_distance:new l.Uniform1f(w,a.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(w,a.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(w,a.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(w,a.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(w,a.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(w,a.u_matrix)}),collisionBox:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_camera_to_center_distance:new l.Uniform1f(w,a.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(w,a.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(w,a.u_extrude_scale),u_overscale_factor:new l.Uniform1f(w,a.u_overscale_factor)}),collisionCircle:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_inv_matrix:new l.UniformMatrix4f(w,a.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(w,a.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(w,a.u_viewport_size)}),debug:(w,a)=>({u_color:new l.UniformColor(w,a.u_color),u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_overlay:new l.Uniform1i(w,a.u_overlay),u_overlay_scale:new l.Uniform1f(w,a.u_overlay_scale)}),clippingMask:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix)}),heatmap:(w,a)=>({u_extrude_scale:new l.Uniform1f(w,a.u_extrude_scale),u_intensity:new l.Uniform1f(w,a.u_intensity),u_matrix:new l.UniformMatrix4f(w,a.u_matrix)}),heatmapTexture:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_world:new l.Uniform2f(w,a.u_world),u_image:new l.Uniform1i(w,a.u_image),u_color_ramp:new l.Uniform1i(w,a.u_color_ramp),u_opacity:new l.Uniform1f(w,a.u_opacity)}),hillshade:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_image:new l.Uniform1i(w,a.u_image),u_latrange:new l.Uniform2f(w,a.u_latrange),u_light:new l.Uniform2f(w,a.u_light),u_shadow:new l.UniformColor(w,a.u_shadow),u_highlight:new l.UniformColor(w,a.u_highlight),u_accent:new l.UniformColor(w,a.u_accent)}),hillshadePrepare:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_image:new l.Uniform1i(w,a.u_image),u_dimension:new l.Uniform2f(w,a.u_dimension),u_zoom:new l.Uniform1f(w,a.u_zoom),u_unpack:new l.Uniform4f(w,a.u_unpack)}),line:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_ratio:new l.Uniform1f(w,a.u_ratio),u_device_pixel_ratio:new l.Uniform1f(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(w,a.u_units_to_pixels)}),lineGradient:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_ratio:new l.Uniform1f(w,a.u_ratio),u_device_pixel_ratio:new l.Uniform1f(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(w,a.u_units_to_pixels),u_image:new l.Uniform1i(w,a.u_image),u_image_height:new l.Uniform1f(w,a.u_image_height)}),linePattern:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_texsize:new l.Uniform2f(w,a.u_texsize),u_ratio:new l.Uniform1f(w,a.u_ratio),u_device_pixel_ratio:new l.Uniform1f(w,a.u_device_pixel_ratio),u_image:new l.Uniform1i(w,a.u_image),u_units_to_pixels:new l.Uniform2f(w,a.u_units_to_pixels),u_scale:new l.Uniform3f(w,a.u_scale),u_fade:new l.Uniform1f(w,a.u_fade)}),lineSDF:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_ratio:new l.Uniform1f(w,a.u_ratio),u_device_pixel_ratio:new l.Uniform1f(w,a.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(w,a.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(w,a.u_patternscale_a),u_patternscale_b:new l.Uniform2f(w,a.u_patternscale_b),u_sdfgamma:new l.Uniform1f(w,a.u_sdfgamma),u_image:new l.Uniform1i(w,a.u_image),u_tex_y_a:new l.Uniform1f(w,a.u_tex_y_a),u_tex_y_b:new l.Uniform1f(w,a.u_tex_y_b),u_mix:new l.Uniform1f(w,a.u_mix)}),raster:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_tl_parent:new l.Uniform2f(w,a.u_tl_parent),u_scale_parent:new l.Uniform1f(w,a.u_scale_parent),u_buffer_scale:new l.Uniform1f(w,a.u_buffer_scale),u_fade_t:new l.Uniform1f(w,a.u_fade_t),u_opacity:new l.Uniform1f(w,a.u_opacity),u_image0:new l.Uniform1i(w,a.u_image0),u_image1:new l.Uniform1i(w,a.u_image1),u_brightness_low:new l.Uniform1f(w,a.u_brightness_low),u_brightness_high:new l.Uniform1f(w,a.u_brightness_high),u_saturation_factor:new l.Uniform1f(w,a.u_saturation_factor),u_contrast_factor:new l.Uniform1f(w,a.u_contrast_factor),u_spin_weights:new l.Uniform3f(w,a.u_spin_weights)}),symbolIcon:(w,a)=>({u_is_size_zoom_constant:new l.Uniform1i(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(w,a.u_is_size_feature_constant),u_size_t:new l.Uniform1f(w,a.u_size_t),u_size:new l.Uniform1f(w,a.u_size),u_camera_to_center_distance:new l.Uniform1f(w,a.u_camera_to_center_distance),u_pitch:new l.Uniform1f(w,a.u_pitch),u_rotate_symbol:new l.Uniform1i(w,a.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(w,a.u_aspect_ratio),u_fade_change:new l.Uniform1f(w,a.u_fade_change),u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(w,a.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(w,a.u_coord_matrix),u_is_text:new l.Uniform1i(w,a.u_is_text),u_pitch_with_map:new l.Uniform1i(w,a.u_pitch_with_map),u_texsize:new l.Uniform2f(w,a.u_texsize),u_texture:new l.Uniform1i(w,a.u_texture)}),symbolSDF:(w,a)=>({u_is_size_zoom_constant:new l.Uniform1i(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(w,a.u_is_size_feature_constant),u_size_t:new l.Uniform1f(w,a.u_size_t),u_size:new l.Uniform1f(w,a.u_size),u_camera_to_center_distance:new l.Uniform1f(w,a.u_camera_to_center_distance),u_pitch:new l.Uniform1f(w,a.u_pitch),u_rotate_symbol:new l.Uniform1i(w,a.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(w,a.u_aspect_ratio),u_fade_change:new l.Uniform1f(w,a.u_fade_change),u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(w,a.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(w,a.u_coord_matrix),u_is_text:new l.Uniform1i(w,a.u_is_text),u_pitch_with_map:new l.Uniform1i(w,a.u_pitch_with_map),u_texsize:new l.Uniform2f(w,a.u_texsize),u_texture:new l.Uniform1i(w,a.u_texture),u_gamma_scale:new l.Uniform1f(w,a.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(w,a.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(w,a.u_is_halo)}),symbolTextAndIcon:(w,a)=>({u_is_size_zoom_constant:new l.Uniform1i(w,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(w,a.u_is_size_feature_constant),u_size_t:new l.Uniform1f(w,a.u_size_t),u_size:new l.Uniform1f(w,a.u_size),u_camera_to_center_distance:new l.Uniform1f(w,a.u_camera_to_center_distance),u_pitch:new l.Uniform1f(w,a.u_pitch),u_rotate_symbol:new l.Uniform1i(w,a.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(w,a.u_aspect_ratio),u_fade_change:new l.Uniform1f(w,a.u_fade_change),u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(w,a.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(w,a.u_coord_matrix),u_is_text:new l.Uniform1i(w,a.u_is_text),u_pitch_with_map:new l.Uniform1i(w,a.u_pitch_with_map),u_texsize:new l.Uniform2f(w,a.u_texsize),u_texsize_icon:new l.Uniform2f(w,a.u_texsize_icon),u_texture:new l.Uniform1i(w,a.u_texture),u_texture_icon:new l.Uniform1i(w,a.u_texture_icon),u_gamma_scale:new l.Uniform1f(w,a.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(w,a.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(w,a.u_is_halo)}),background:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_opacity:new l.Uniform1f(w,a.u_opacity),u_color:new l.UniformColor(w,a.u_color)}),backgroundPattern:(w,a)=>({u_matrix:new l.UniformMatrix4f(w,a.u_matrix),u_opacity:new l.Uniform1f(w,a.u_opacity),u_image:new l.Uniform1i(w,a.u_image),u_pattern_tl_a:new l.Uniform2f(w,a.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(w,a.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(w,a.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(w,a.u_pattern_br_b),u_texsize:new l.Uniform2f(w,a.u_texsize),u_mix:new l.Uniform1f(w,a.u_mix),u_pattern_size_a:new l.Uniform2f(w,a.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(w,a.u_pattern_size_b),u_scale_a:new l.Uniform1f(w,a.u_scale_a),u_scale_b:new l.Uniform1f(w,a.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(w,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(w,a.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(w,a.u_tile_units_to_pixels)})};class ka{constructor(a,r,e){this.context=a;const s=a.gl;this.buffer=s.createBuffer(),this.dynamicDraw=Boolean(e),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const za={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class sr{constructor(a,r,e,s){this.length=r.length,this.attributes=e,this.itemSize=r.bytesPerElement,this.dynamicDraw=s,this.context=a;const u=a.gl;this.buffer=u.createBuffer(),a.bindVertexBuffer.set(this.buffer),u.bufferData(u.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,r){for(let e=0;e<this.attributes.length;e++){const s=r.attributes[this.attributes[e].name];s!==void 0&&a.enableVertexAttribArray(s)}}setVertexAttribPointers(a,r,e){for(let s=0;s<this.attributes.length;s++){const u=this.attributes[s],d=r.attributes[u.name];d!==void 0&&a.vertexAttribPointer(d,u.components,a[za[u.type]],!1,this.itemSize,u.offset+this.itemSize*(e||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class er{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yo extends er{getDefault(){return l.Color.transparent}set(a){const r=this.current;(a.r!==r.r||a.g!==r.g||a.b!==r.b||a.a!==r.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class go extends er{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class zn extends er{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Ca extends er{getDefault(){return[!0,!0,!0,!0]}set(a){const r=this.current;(a[0]!==r[0]||a[1]!==r[1]||a[2]!==r[2]||a[3]!==r[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ln extends er{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class _o extends er{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class yo extends er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const r=this.current;(a.func!==r.func||a.ref!==r.ref||a.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class xo extends er{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const r=this.current;(a[0]!==r[0]||a[1]!==r[1]||a[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class vo extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;a?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=a,this.dirty=!1}}class Jo extends er{getDefault(){return[0,1]}set(a){const r=this.current;(a[0]!==r[0]||a[1]!==r[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class bo extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;a?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=a,this.dirty=!1}}class wo extends er{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Pa extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;a?r.enable(r.BLEND):r.disable(r.BLEND),this.current=a,this.dirty=!1}}class $o extends er{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const r=this.current;(a[0]!==r[0]||a[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class eo extends er{getDefault(){return l.Color.transparent}set(a){const r=this.current;(a.r!==r.r||a.g!==r.g||a.b!==r.b||a.a!==r.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Ml extends er{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class To extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;a?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=a,this.dirty=!1}}class dc extends er{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class fc extends er{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class mc extends er{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class gc extends er{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class al extends er{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const r=this.current;(a[0]!==r[0]||a[1]!==r[1]||a[2]!==r[2]||a[3]!==r[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ma extends er{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Qo extends er{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class ea extends er{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ns extends er{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ll extends er{getDefault(){return null}set(a){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class cl extends er{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class ta extends er{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class jn extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Da extends er{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Kn extends er{constructor(a,r){super(a),this.context=a,this.parent=r}getDefault(){return null}}class ss extends Kn{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ul extends Kn{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Vr{constructor(a,r,e,s){this.context=a,this.width=r,this.height=e;const u=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new ss(a,u),s&&(this.depthAttachment=new ul(a,u))}destroy(){const a=this.context.gl,r=this.colorAttachment.get();if(r&&a.deleteTexture(r),this.depthAttachment){const e=this.depthAttachment.get();e&&a.deleteRenderbuffer(e)}a.deleteFramebuffer(this.framebuffer)}}class qt{constructor(a,r,e){this.blendFunction=a,this.blendColor=r,this.mask=e}}qt.Replace=[1,0],qt.disabled=new qt(qt.Replace,l.Color.transparent,[!1,!1,!1,!1]),qt.unblended=new qt(qt.Replace,l.Color.transparent,[!0,!0,!0,!0]),qt.alphaBlended=new qt([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Li{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Yo(this),this.clearDepth=new go(this),this.clearStencil=new zn(this),this.colorMask=new Ca(this),this.depthMask=new Ln(this),this.stencilMask=new _o(this),this.stencilFunc=new yo(this),this.stencilOp=new xo(this),this.stencilTest=new vo(this),this.depthRange=new Jo(this),this.depthTest=new bo(this),this.depthFunc=new wo(this),this.blend=new Pa(this),this.blendFunc=new $o(this),this.blendColor=new eo(this),this.blendEquation=new Ml(this),this.cullFace=new To(this),this.cullFaceSide=new dc(this),this.frontFace=new fc(this),this.program=new mc(this),this.activeTexture=new gc(this),this.viewport=new al(this),this.bindFramebuffer=new Ma(this),this.bindRenderbuffer=new Qo(this),this.bindTexture=new ea(this),this.bindVertexBuffer=new ns(this),this.bindElementBuffer=new ll(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new cl(this),this.pixelStoreUnpack=new ta(this),this.pixelStoreUnpackPremultiplyAlpha=new jn(this),this.pixelStoreUnpackFlipY=new Da(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,r){return new ka(this,a,r)}createVertexBuffer(a,r,e){return new sr(this,a,r,e)}createRenderbuffer(a,r,e){const s=this.gl,u=s.createRenderbuffer();return this.bindRenderbuffer.set(u),s.renderbufferStorage(s.RENDERBUFFER,a,r,e),this.bindRenderbuffer.set(null),u}createFramebuffer(a,r,e){return new Vr(this,a,r,e)}clear({color:a,depth:r}){const e=this.gl;let s=0;a&&(s|=e.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(s|=e.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),e.clear(s)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){re(a.blendFunction,qt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class or{constructor(a,r,e){this.func=a,this.mask=r,this.range=e}}or.ReadOnly=!1,or.ReadWrite=!0,or.disabled=new or(519,or.ReadOnly,[0,1]);const kr=7680;class yi{constructor(a,r,e,s,u,d){this.test=a,this.ref=r,this.mask=e,this.fail=s,this.depthFail=u,this.pass=d}}yi.disabled=new yi({func:519,mask:0},0,0,kr,kr,kr);class Nr{constructor(a,r,e){this.enable=a,this.mode=r,this.frontFace=e}}let ia;function La(w,a,r,e,s,u,d){const g=w.context,b=g.gl,I=w.useProgram("collisionBox"),k=[];let D=0,F=0;for(let ce=0;ce<e.length;ce++){const ye=e[ce],oe=a.getTile(ye),ve=oe.getBucket(r);if(!ve)continue;let be=ye.posMatrix;s[0]===0&&s[1]===0||(be=w.translatePosMatrix(ye.posMatrix,oe,s,u));const ze=d?ve.textCollisionBox:ve.iconCollisionBox,we=ve.collisionCircleArray;if(we.length>0){const Ne=l.create(),Ce=be;l.mul(Ne,ve.placementInvProjMatrix,w.transform.glCoordMatrix),l.mul(Ne,Ne,ve.placementViewportMatrix),k.push({circleArray:we,circleOffset:F,transform:Ce,invTransform:Ne}),D+=we.length/4,F=D}ze&&I.draw(g,b.LINES,or.disabled,yi.disabled,w.colorModeForRenderPass(),Nr.disabled,Gs(be,w.transform,oe),r.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,w.transform.zoom,null,null,ze.collisionVertexBuffer)}if(!d||!k.length)return;const j=w.useProgram("collisionCircle"),N=new l.CollisionCircleLayoutArray;N.resize(4*D),N._trim();let K=0;for(const ce of k)for(let ye=0;ye<ce.circleArray.length/4;ye++){const oe=4*ye,ve=ce.circleArray[oe+0],be=ce.circleArray[oe+1],ze=ce.circleArray[oe+2],we=ce.circleArray[oe+3];N.emplace(K++,ve,be,ze,we,0),N.emplace(K++,ve,be,ze,we,1),N.emplace(K++,ve,be,ze,we,2),N.emplace(K++,ve,be,ze,we,3)}(!ia||ia.length<2*D)&&(ia=function(ce){const ye=2*ce,oe=new l.QuadTriangleArray;oe.resize(ye),oe._trim();for(let ve=0;ve<ye;ve++){const be=6*ve;oe.uint16[be+0]=4*ve+0,oe.uint16[be+1]=4*ve+1,oe.uint16[be+2]=4*ve+2,oe.uint16[be+3]=4*ve+2,oe.uint16[be+4]=4*ve+3,oe.uint16[be+5]=4*ve+0}return oe}(D));const J=g.createIndexBuffer(ia,!0),ee=g.createVertexBuffer(N,l.collisionCircleLayout.members,!0);for(const ce of k){const ye={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(le=w.transform).cameraToCenterDistance,u_viewport_size:[le.width,le.height]};j.draw(g,b.TRIANGLES,or.disabled,yi.disabled,w.colorModeForRenderPass(),Nr.disabled,ye,r.id,ee,J,l.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,w.transform.zoom,null,null,null)}var le;ee.destroy(),J.destroy()}Nr.disabled=new Nr(!1,1029,2305),Nr.backCCW=new Nr(!0,1029,2305);const _c=l.identity(new Float32Array(16));function ra(w,a,r,e,s,u){const{horizontalAlign:d,verticalAlign:g}=l.getAnchorAlignment(w),b=-(d-.5)*a,I=-(g-.5)*r,k=l.evaluateVariableOffset(w,e);return new l.pointGeometry((b/s+k[0])*u,(I/s+k[1])*u)}function to(w,a,r,e,s,u,d,g,b,I){const k=w.text.placedSymbolArray,D=w.text.dynamicLayoutVertexArray,F=w.icon.dynamicLayoutVertexArray,j={};D.clear();for(let N=0;N<k.length;N++){const K=k.get(N),J=w.allowVerticalPlacement&&!K.placedOrientation,ee=K.hidden||!K.crossTileID||J?null:e[K.crossTileID];if(ee){const le=new l.pointGeometry(K.anchorX,K.anchorY),ce=Mi(le,r?d:u),ye=Ve(s.cameraToCenterDistance,ce.signedDistanceFromCamera);let oe=l.evaluateSizeForFeature(w.textSizeData,b,K)*ye/l.ONE_EM;r&&(oe*=w.tilePixelRatio/g);const{width:ve,height:be,anchor:ze,textOffset:we,textBoxScale:Ne}=ee,Ce=ra(ze,ve,be,we,Ne,oe),ut=r?Mi(le.add(Ce),u).point:ce.point.add(a?Ce.rotate(-s.angle):Ce),yt=w.allowVerticalPlacement&&K.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let xt=0;xt<K.numGlyphs;xt++)l.addDynamicAttributes(D,ut,yt);I&&K.associatedIconIndex>=0&&(j[K.associatedIconIndex]={shiftedAnchor:ut,angle:yt})}else ki(K.numGlyphs,D)}if(I){F.clear();const N=w.icon.placedSymbolArray;for(let K=0;K<N.length;K++){const J=N.get(K);if(J.hidden)ki(J.numGlyphs,F);else{const ee=j[K];if(ee)for(let le=0;le<J.numGlyphs;le++)l.addDynamicAttributes(F,ee.shiftedAnchor,ee.angle);else ki(J.numGlyphs,F)}}w.icon.dynamicLayoutVertexBuffer.updateData(F)}w.text.dynamicLayoutVertexBuffer.updateData(D)}function Ws(w,a,r){return r.iconsInText&&a?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function io(w,a,r,e,s,u,d,g,b,I,k,D){const F=w.context,j=F.gl,N=w.transform,K=g==="map",J=b==="map",ee=g!=="viewport"&&r.layout.get("symbol-placement")!=="point",le=K&&!J&&!ee,ce=!r.layout.get("symbol-sort-key").isConstant();let ye=!1;const oe=w.depthModeForSublayer(0,or.ReadOnly),ve=r.layout.get("text-variable-anchor"),be=[];for(const ze of e){const we=a.getTile(ze),Ne=we.getBucket(r);if(!Ne)continue;const Ce=s?Ne.text:Ne.icon;if(!Ce||!Ce.segments.get().length)continue;const ut=Ce.programConfigurations.get(r.id),yt=s||Ne.sdfIcons,xt=s?Ne.textSizeData:Ne.iconSizeData,Ft=J||N.pitch!==0,ti=w.useProgram(Ws(yt,s,Ne),ut),It=l.evaluateSizeForZoom(xt,N.zoom);let ii,oi,xi,vi,Gi=[0,0],Yr=null;if(s){if(oi=we.glyphAtlasTexture,xi=j.LINEAR,ii=we.glyphAtlasTexture.size,Ne.iconsInText){Gi=we.imageAtlasTexture.size,Yr=we.imageAtlasTexture;const Gr=xt.kind==="composite"||xt.kind==="camera";vi=Ft||w.options.rotating||w.options.zooming||Gr?j.LINEAR:j.NEAREST}}else{const Gr=r.layout.get("icon-size").constantOr(0)!==1||Ne.iconsNeedLinear;oi=we.imageAtlasTexture,xi=yt||w.options.rotating||w.options.zooming||Gr||Ft?j.LINEAR:j.NEAREST,ii=we.imageAtlasTexture.size}const Pn=wr(we,1,w.transform.zoom),qr=Ti(ze.posMatrix,J,K,w.transform,Pn),_n=xr(ze.posMatrix,J,K,w.transform,Pn),Sn=ve&&Ne.hasTextData(),Or=r.layout.get("icon-text-fit")!=="none"&&Sn&&Ne.hasIconData();if(ee){const Gr=r.layout.get("text-rotation-alignment")==="map";Pt(Ne,ze.posMatrix,w,s,qr,_n,J,I,Gr)}const Ri=w.translatePosMatrix(ze.posMatrix,we,u,d),Yi=ee||s&&ve||Or?_c:qr,Zi=w.translatePosMatrix(_n,we,u,d,!0),rr=yt&&r.paint.get(s?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let wi;wi=yt?Ne.iconsInText?sl(xt.kind,It,le,J,w,Ri,Yi,Zi,ii,Gi):nl(xt.kind,It,le,J,w,Ri,Yi,Zi,s,ii,!0):Wo(xt.kind,It,le,J,w,Ri,Yi,Zi,s,ii);const Fi={program:ti,buffers:Ce,uniformValues:wi,atlasTexture:oi,atlasTextureIcon:Yr,atlasInterpolation:xi,atlasInterpolationIcon:vi,isSDF:yt,hasHalo:rr};if(ce&&Ne.canOverlap){ye=!0;const Gr=Ce.segments.get();for(const Mn of Gr)be.push({segments:new l.SegmentVector([Mn]),sortKey:Mn.sortKey,state:Fi})}else be.push({segments:Ce.segments,sortKey:0,state:Fi})}ye&&be.sort((ze,we)=>ze.sortKey-we.sortKey);for(const ze of be){const we=ze.state;if(F.activeTexture.set(j.TEXTURE0),we.atlasTexture.bind(we.atlasInterpolation,j.CLAMP_TO_EDGE),we.atlasTextureIcon&&(F.activeTexture.set(j.TEXTURE1),we.atlasTextureIcon&&we.atlasTextureIcon.bind(we.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),we.isSDF){const Ne=we.uniformValues;we.hasHalo&&(Ne.u_is_halo=1,ro(we.buffers,ze.segments,r,w,we.program,oe,k,D,Ne)),Ne.u_is_halo=0}ro(we.buffers,ze.segments,r,w,we.program,oe,k,D,we.uniformValues)}}function ro(w,a,r,e,s,u,d,g,b){const I=e.context;s.draw(I,I.gl.TRIANGLES,u,d,g,Nr.disabled,b,r.id,w.layoutVertexBuffer,w.indexBuffer,a,r.paint,e.transform.zoom,w.programConfigurations.get(r.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Io(w,a,r,e,s,u,d){const g=w.context.gl,b=r.paint.get("fill-pattern"),I=b&&b.constantOr(1),k=r.getCrossfadeParameters();let D,F,j,N,K;d?(F=I&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=g.LINES):(F=I?"fillPattern":"fill",D=g.TRIANGLES);for(const J of e){const ee=a.getTile(J);if(I&&!ee.patternsLoaded())continue;const le=ee.getBucket(r);if(!le)continue;const ce=le.programConfigurations.get(r.id),ye=w.useProgram(F,ce);I&&(w.context.activeTexture.set(g.TEXTURE0),ee.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),ce.updatePaintBuffers(k));const oe=b.constantOr(null);if(oe&&ee.imageAtlas){const be=ee.imageAtlas,ze=be.patternPositions[oe.to.toString()],we=be.patternPositions[oe.from.toString()];ze&&we&&ce.setConstantPatternPositions(ze,we)}const ve=w.translatePosMatrix(J.posMatrix,ee,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(d){N=le.indexBuffer2,K=le.segments2;const be=[g.drawingBufferWidth,g.drawingBufferHeight];j=F==="fillOutlinePattern"&&I?Xo(ve,w,k,ee,be):qs(ve,be)}else N=le.indexBuffer,K=le.segments,j=I?Ia(ve,w,k,ee):Zo(ve);ye.draw(w.context,D,s,w.stencilModeForClipping(J),u,Nr.disabled,j,r.id,le.layoutVertexBuffer,N,K,r.paint,w.transform.zoom,ce)}}function zs(w,a,r,e,s,u,d){const g=w.context,b=g.gl,I=r.paint.get("fill-extrusion-pattern"),k=I.constantOr(1),D=r.getCrossfadeParameters(),F=r.paint.get("fill-extrusion-opacity");for(const j of e){const N=a.getTile(j),K=N.getBucket(r);if(!K)continue;const J=K.programConfigurations.get(r.id),ee=w.useProgram(k?"fillExtrusionPattern":"fillExtrusion",J);k&&(w.context.activeTexture.set(b.TEXTURE0),N.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),J.updatePaintBuffers(D));const le=I.constantOr(null);if(le&&N.imageAtlas){const ve=N.imageAtlas,be=ve.patternPositions[le.to.toString()],ze=ve.patternPositions[le.from.toString()];be&&ze&&J.setConstantPatternPositions(be,ze)}const ce=w.translatePosMatrix(j.posMatrix,N,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),ye=r.paint.get("fill-extrusion-vertical-gradient"),oe=k?Go(ce,w,ye,F,j,D,N):rl(ce,w,ye,F);ee.draw(g,g.gl.TRIANGLES,s,u,d,Nr.backCCW,oe,r.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,r.paint,w.transform.zoom,J)}}function no(w,a,r,e,s,u){const d=w.context,g=d.gl,b=a.fbo;if(!b)return;const I=w.useProgram("hillshade");d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,b.colorAttachment.get());const k=((D,F,j)=>{const N=j.paint.get("hillshade-shadow-color"),K=j.paint.get("hillshade-highlight-color"),J=j.paint.get("hillshade-accent-color");let ee=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(ee-=D.transform.angle);const le=!D.options.moving;return{u_matrix:D.transform.calculatePosMatrix(F.tileID.toUnwrapped(),le),u_image:0,u_latrange:As(0,F.tileID),u_light:[j.paint.get("hillshade-exaggeration"),ee],u_shadow:N,u_highlight:K,u_accent:J}})(w,a,r);I.draw(d,g.TRIANGLES,e,s,u,Nr.disabled,k,r.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function ln(w,a,r,e,s,u){const d=w.context,g=d.gl,b=a.dem;if(b&&b.data){const I=b.dim,k=b.stride,D=b.getPixels();if(d.activeTexture.set(g.TEXTURE1),d.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||w.getTileTexture(k),a.demTexture){const j=a.demTexture;j.update(D,{premultiply:!1}),j.bind(g.NEAREST,g.CLAMP_TO_EDGE)}else a.demTexture=new it(d,D,g.RGBA,{premultiply:!1}),a.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);d.activeTexture.set(g.TEXTURE0);let F=a.fbo;if(!F){const j=new it(d,{width:I,height:I,data:null},g.RGBA);j.bind(g.LINEAR,g.CLAMP_TO_EDGE),F=a.fbo=d.createFramebuffer(I,I,!0),F.colorAttachment.set(j.texture)}d.bindFramebuffer.set(F.framebuffer),d.viewport.set([0,0,I,I]),w.useProgram("hillshadePrepare").draw(d,g.TRIANGLES,e,s,u,Nr.disabled,((j,N)=>{const K=N.stride,J=l.create();return l.ortho(J,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(J,J,[0,-l.EXTENT,0]),{u_matrix:J,u_image:1,u_dimension:[K,K],u_zoom:j.overscaledZ,u_unpack:N.getUnpackVector()}})(a.tileID,b),r.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function hl(w,a,r,e,s){const u=e.paint.get("raster-fade-duration");if(u>0){const d=l.exported.now(),g=(d-w.timeAdded)/u,b=a?(d-a.timeAdded)/u:-1,I=r.getSource(),k=s.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),D=!a||Math.abs(a.tileID.overscaledZ-k)>Math.abs(w.tileID.overscaledZ-k),F=D&&w.refreshedUponExpiration?1:l.clamp(D?g:1-b,0,1);return w.refreshedUponExpiration&&g>=1&&(w.refreshedUponExpiration=!1),a?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}const pl=new l.Color(1,0,0,1),dl=new l.Color(0,1,0,1),os=new l.Color(0,0,1,1),so=new l.Color(1,0,1,1),So=new l.Color(0,1,1,1);function fl(w,a,r,e){Ba(w,0,a+r/2,w.transform.width,r,e)}function Cs(w,a,r,e){Ba(w,a-r/2,0,r,w.transform.height,e)}function Ba(w,a,r,e,s,u){const d=w.context,g=d.gl;g.enable(g.SCISSOR_TEST),g.scissor(a*w.pixelRatio,r*w.pixelRatio,e*w.pixelRatio,s*w.pixelRatio),d.clear({color:u}),g.disable(g.SCISSOR_TEST)}function Ra(w,a,r){const e=w.context,s=e.gl,u=r.posMatrix,d=w.useProgram("debug"),g=or.disabled,b=yi.disabled,I=w.colorModeForRenderPass(),k="$debug";e.activeTexture.set(s.TEXTURE0),w.emptyTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),d.draw(e,s.LINE_STRIP,g,b,I,Nr.disabled,fs(u,l.Color.red),k,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments);const D=a.getTileByID(r.key).latestRawTileData,F=Math.floor((D&&D.byteLength||0)/1024),j=a.getTile(r).tileSize,N=512/Math.min(j,512)*(r.overscaledZ/w.transform.zoom)*.5;let K=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(K+=` => ${r.overscaledZ}`),function(J,ee){J.initDebugOverlayCanvas();const le=J.debugOverlayCanvas,ce=J.context.gl,ye=J.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,le.width,le.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(ee,5,5),ye.strokeText(ee,5,5),J.debugOverlayTexture.update(le),J.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(w,`${K} ${F}kb`),d.draw(e,s.TRIANGLES,g,b,qt.alphaBlended,Nr.disabled,fs(u,l.Color.transparent,N),k,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments)}const Ps={symbol:function(w,a,r,e,s){if(w.renderPass!=="translucent")return;const u=yi.disabled,d=w.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(g,b,I,k,D,F,j){const N=b.transform,K=D==="map",J=F==="map";for(const ee of g){const le=k.getTile(ee),ce=le.getBucket(I);if(!ce||!ce.text||!ce.text.segments.get().length)continue;const ye=l.evaluateSizeForZoom(ce.textSizeData,N.zoom),oe=wr(le,1,b.transform.zoom),ve=Ti(ee.posMatrix,J,K,b.transform,oe),be=I.layout.get("icon-text-fit")!=="none"&&ce.hasIconData();if(ye){const ze=Math.pow(2,N.zoom-le.tileID.overscaledZ);to(ce,K,J,j,N,ve,ee.posMatrix,ze,ye,be)}}}(e,w,r,a,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),s),r.paint.get("icon-opacity").constantOr(1)!==0&&io(w,a,r,e,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),u,d),r.paint.get("text-opacity").constantOr(1)!==0&&io(w,a,r,e,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),u,d),a.map.showCollisionBoxes&&(La(w,a,r,e,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),La(w,a,r,e,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(w,a,r,e){if(w.renderPass!=="translucent")return;const s=r.paint.get("circle-opacity"),u=r.paint.get("circle-stroke-width"),d=r.paint.get("circle-stroke-opacity"),g=!r.layout.get("circle-sort-key").isConstant();if(s.constantOr(1)===0&&(u.constantOr(1)===0||d.constantOr(1)===0))return;const b=w.context,I=b.gl,k=w.depthModeForSublayer(0,or.ReadOnly),D=yi.disabled,F=w.colorModeForRenderPass(),j=[];for(let N=0;N<e.length;N++){const K=e[N],J=a.getTile(K),ee=J.getBucket(r);if(!ee)continue;const le=ee.programConfigurations.get(r.id),ce={programConfiguration:le,program:w.useProgram("circle",le),layoutVertexBuffer:ee.layoutVertexBuffer,indexBuffer:ee.indexBuffer,uniformValues:rs(w,K,J,r)};if(g){const ye=ee.segments.get();for(const oe of ye)j.push({segments:new l.SegmentVector([oe]),sortKey:oe.sortKey,state:ce})}else j.push({segments:ee.segments,sortKey:0,state:ce})}g&&j.sort((N,K)=>N.sortKey-K.sortKey);for(const N of j){const{programConfiguration:K,program:J,layoutVertexBuffer:ee,indexBuffer:le,uniformValues:ce}=N.state;J.draw(b,I.TRIANGLES,k,D,F,Nr.disabled,ce,r.id,ee,le,N.segments,r.paint,w.transform.zoom,K)}},heatmap:function(w,a,r,e){if(r.paint.get("heatmap-opacity")!==0)if(w.renderPass==="offscreen"){const s=w.context,u=s.gl,d=yi.disabled,g=new qt([u.ONE,u.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(b,I,k){const D=b.gl;b.activeTexture.set(D.TEXTURE1),b.viewport.set([0,0,I.width/4,I.height/4]);let F=k.heatmapFbo;if(F)D.bindTexture(D.TEXTURE_2D,F.colorAttachment.get()),b.bindFramebuffer.set(F.framebuffer);else{const j=D.createTexture();D.bindTexture(D.TEXTURE_2D,j),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),F=k.heatmapFbo=b.createFramebuffer(I.width/4,I.height/4,!1),function(N,K,J,ee){const le=N.gl;le.texImage2D(le.TEXTURE_2D,0,le.RGBA,K.width/4,K.height/4,0,le.RGBA,N.extRenderToTextureHalfFloat?N.extTextureHalfFloat.HALF_FLOAT_OES:le.UNSIGNED_BYTE,null),ee.colorAttachment.set(J)}(b,I,j,F)}})(s,w,r),s.clear({color:l.Color.transparent});for(let b=0;b<e.length;b++){const I=e[b];if(a.hasRenderableParent(I))continue;const k=a.getTile(I),D=k.getBucket(r);if(!D)continue;const F=D.programConfigurations.get(r.id),j=w.useProgram("heatmap",F),{zoom:N}=w.transform;j.draw(s,u.TRIANGLES,or.disabled,d,g,Nr.disabled,mo(I.posMatrix,k,N,r.paint.get("heatmap-intensity")),r.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,r.paint,w.transform.zoom,F)}s.viewport.set([0,0,w.width,w.height])}else w.renderPass==="translucent"&&(w.context.setColorMode(w.colorModeForRenderPass()),function(s,u){const d=s.context,g=d.gl,b=u.heatmapFbo;if(!b)return;d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,b.colorAttachment.get()),d.activeTexture.set(g.TEXTURE1);let I=u.colorRampTexture;I||(I=u.colorRampTexture=new it(d,u.colorRamp,g.RGBA)),I.bind(g.LINEAR,g.CLAMP_TO_EDGE),s.useProgram("heatmapTexture").draw(d,g.TRIANGLES,or.disabled,yi.disabled,s.colorModeForRenderPass(),Nr.disabled,((k,D,F,j)=>{const N=l.create();l.ortho(N,0,k.width,k.height,0,0,1);const K=k.context.gl;return{u_matrix:N,u_world:[K.drawingBufferWidth,K.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")}})(s,u),u.id,s.viewportBuffer,s.quadTriangleIndexBuffer,s.viewportSegments,u.paint,s.transform.zoom)}(w,r))},line:function(w,a,r,e){if(w.renderPass!=="translucent")return;const s=r.paint.get("line-opacity"),u=r.paint.get("line-width");if(s.constantOr(1)===0||u.constantOr(1)===0)return;const d=w.depthModeForSublayer(0,or.ReadOnly),g=w.colorModeForRenderPass(),b=r.paint.get("line-dasharray"),I=r.paint.get("line-pattern"),k=I.constantOr(1),D=r.paint.get("line-gradient"),F=r.getCrossfadeParameters(),j=k?"linePattern":b?"lineSDF":D?"lineGradient":"line",N=w.context,K=N.gl;let J=!0;for(const ee of e){const le=a.getTile(ee);if(k&&!le.patternsLoaded())continue;const ce=le.getBucket(r);if(!ce)continue;const ye=ce.programConfigurations.get(r.id),oe=w.context.program.get(),ve=w.useProgram(j,ye),be=J||ve.program!==oe,ze=I.constantOr(null);if(ze&&le.imageAtlas){const Ne=le.imageAtlas,Ce=Ne.patternPositions[ze.to.toString()],ut=Ne.patternPositions[ze.from.toString()];Ce&&ut&&ye.setConstantPatternPositions(Ce,ut)}const we=k?Xs(w,le,r,F):b?rn(w,le,r,b,F):D?Qr(w,le,r,ce.lineClipsArray.length):ks(w,le,r);if(k)N.activeTexture.set(K.TEXTURE0),le.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),ye.updatePaintBuffers(F);else if(b&&(be||w.lineAtlas.dirty))N.activeTexture.set(K.TEXTURE0),w.lineAtlas.bind(N);else if(D){const Ne=ce.gradients[r.id];let Ce=Ne.texture;if(r.gradientVersion!==Ne.version){let ut=256;if(r.stepInterpolant){const yt=a.getSource().maxzoom,xt=ee.canonical.z===yt?Math.ceil(1<<w.transform.maxZoom-ee.canonical.z):1;ut=l.clamp(l.nextPowerOfTwo(ce.maxLineLength/l.EXTENT*1024*xt),256,N.maxTextureSize)}Ne.gradient=l.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:ut,image:Ne.gradient||void 0,clips:ce.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new it(N,Ne.gradient,K.RGBA),Ne.version=r.gradientVersion,Ce=Ne.texture}N.activeTexture.set(K.TEXTURE0),Ce.bind(r.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}ve.draw(N,K.TRIANGLES,d,w.stencilModeForClipping(ee),g,Nr.disabled,we,r.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,r.paint,w.transform.zoom,ye,ce.layoutVertexBuffer2),J=!1}},fill:function(w,a,r,e){const s=r.paint.get("fill-color"),u=r.paint.get("fill-opacity");if(u.constantOr(1)===0)return;const d=w.colorModeForRenderPass(),g=r.paint.get("fill-pattern"),b=w.opaquePassEnabledForLayer()&&!g.constantOr(1)&&s.constantOr(l.Color.transparent).a===1&&u.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===b){const I=w.depthModeForSublayer(1,w.renderPass==="opaque"?or.ReadWrite:or.ReadOnly);Io(w,a,r,e,I,d,!1)}if(w.renderPass==="translucent"&&r.paint.get("fill-antialias")){const I=w.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,or.ReadOnly);Io(w,a,r,e,I,d,!0)}},"fill-extrusion":function(w,a,r,e){const s=r.paint.get("fill-extrusion-opacity");if(s!==0&&w.renderPass==="translucent"){const u=new or(w.context.gl.LEQUAL,or.ReadWrite,w.depthRangeFor3D);if(s!==1||r.paint.get("fill-extrusion-pattern").constantOr(1))zs(w,a,r,e,u,yi.disabled,qt.disabled),zs(w,a,r,e,u,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const d=w.colorModeForRenderPass();zs(w,a,r,e,u,yi.disabled,d)}}},hillshade:function(w,a,r,e){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const s=w.context,u=w.depthModeForSublayer(0,or.ReadOnly),d=w.colorModeForRenderPass(),[g,b]=w.renderPass==="translucent"?w.stencilConfigForOverlap(e):[{},e];for(const I of b){const k=a.getTile(I);k.needsHillshadePrepare&&w.renderPass==="offscreen"?ln(w,k,r,u,yi.disabled,d):w.renderPass==="translucent"&&no(w,k,r,u,g[I.overscaledZ],d)}s.viewport.set([0,0,w.width,w.height])},raster:function(w,a,r,e){if(w.renderPass!=="translucent"||r.paint.get("raster-opacity")===0||!e.length)return;const s=w.context,u=s.gl,d=a.getSource(),g=w.useProgram("raster"),b=w.colorModeForRenderPass(),[I,k]=d instanceof Ci?[{},e]:w.stencilConfigForOverlap(e),D=k[k.length-1].overscaledZ,F=!w.options.moving;for(const j of k){const N=w.depthModeForSublayer(j.overscaledZ-D,r.paint.get("raster-opacity")===1?or.ReadWrite:or.ReadOnly,u.LESS),K=a.getTile(j),J=w.transform.calculatePosMatrix(j.toUnwrapped(),F);K.registerFadeDuration(r.paint.get("raster-fade-duration"));const ee=a.findLoadedParent(j,0),le=hl(K,ee,a,r,w.transform);let ce,ye;const oe=r.paint.get("raster-resampling")==="nearest"?u.NEAREST:u.LINEAR;s.activeTexture.set(u.TEXTURE0),K.texture.bind(oe,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST),s.activeTexture.set(u.TEXTURE1),ee?(ee.texture.bind(oe,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST),ce=Math.pow(2,ee.tileID.overscaledZ-K.tileID.overscaledZ),ye=[K.tileID.canonical.x*ce%1,K.tileID.canonical.y*ce%1]):K.texture.bind(oe,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST);const ve=Ea(J,ye||[0,0],ce||1,le,r);d instanceof Ci?g.draw(s,u.TRIANGLES,N,yi.disabled,b,Nr.disabled,ve,r.id,d.boundsBuffer,w.quadTriangleIndexBuffer,d.boundsSegments):g.draw(s,u.TRIANGLES,N,I[j.overscaledZ],b,Nr.disabled,ve,r.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}},background:function(w,a,r){const e=r.paint.get("background-color"),s=r.paint.get("background-opacity");if(s===0)return;const u=w.context,d=u.gl,g=w.transform,b=g.tileSize,I=r.paint.get("background-pattern");if(w.isPatternMissing(I))return;const k=!I&&e.a===1&&s===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==k)return;const D=yi.disabled,F=w.depthModeForSublayer(0,k==="opaque"?or.ReadWrite:or.ReadOnly),j=w.colorModeForRenderPass(),N=w.useProgram(I?"backgroundPattern":"background"),K=g.coveringTiles({tileSize:b});I&&(u.activeTexture.set(d.TEXTURE0),w.imageManager.bind(w.context));const J=r.getCrossfadeParameters();for(const ee of K){const le=w.transform.calculatePosMatrix(ee.toUnwrapped()),ce=I?Ho(le,s,w,I,{tileID:ee,tileSize:b},J):ol(le,s,e);N.draw(u,d.TRIANGLES,F,D,j,Nr.disabled,ce,r.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}},debug:function(w,a,r){for(let e=0;e<r.length;e++)Ra(w,a,r[e])},custom:function(w,a,r){const e=w.context,s=r.implementation;if(w.renderPass==="offscreen"){const u=s.prerender;u&&(w.setCustomLayerDefaults(),e.setColorMode(w.colorModeForRenderPass()),u.call(s,e.gl,w.transform.customLayerMatrix()),e.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),e.setColorMode(w.colorModeForRenderPass()),e.setStencilMode(yi.disabled);const u=s.renderingMode==="3d"?new or(w.context.gl.LEQUAL,or.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,or.ReadOnly);e.setDepthMode(u),s.render(e.gl,w.transform.customLayerMatrix()),e.setDirty(),w.setBaseState(),e.bindFramebuffer.set(null)}}};class na{constructor(a,r){this.context=new Li(a),this.transform=r,this._tileTextures={},this.setup(),this.numSublayers=Ai.maxUnderzooming+Ai.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vt,this.gpuTimers={}}resize(a,r,e){if(this.width=a*e,this.height=r*e,this.pixelRatio=e,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const s of this.style._order)this.style._layers[s].resize()}setup(){const a=this.context,r=new l.PosArray;r.emplaceBack(0,0),r.emplaceBack(l.EXTENT,0),r.emplaceBack(0,l.EXTENT),r.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(r,Es.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const e=new l.PosArray;e.emplaceBack(0,0),e.emplaceBack(l.EXTENT,0),e.emplaceBack(0,l.EXTENT),e.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=a.createVertexBuffer(e,Es.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const s=new l.RasterBoundsArray;s.emplaceBack(0,0,0,0),s.emplaceBack(l.EXTENT,0,l.EXTENT,0),s.emplaceBack(0,l.EXTENT,0,l.EXTENT),s.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=a.createVertexBuffer(s,ui.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const u=new l.PosArray;u.emplaceBack(0,0),u.emplaceBack(1,0),u.emplaceBack(0,1),u.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(u,Es.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const d=new l.LineStripIndexArray;d.emplaceBack(0),d.emplaceBack(1),d.emplaceBack(3),d.emplaceBack(2),d.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(d);const g=new l.TriangleIndexArray;g.emplaceBack(0,1,2),g.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(g),this.emptyTexture=new it(a,{width:1,height:1,data:new Uint8Array([0,0,0,0])},a.gl.RGBA);const b=this.context.gl;this.stencilClearMode=new yi({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO)}clearStencil(){const a=this.context,r=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const e=l.create();l.ortho(e,0,this.width,this.height,0,0,1),l.scale(e,e,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,r.TRIANGLES,or.disabled,this.stencilClearMode,qt.disabled,Nr.disabled,Zs(e),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,r){if(this.currentStencilSource===a.source||!a.isTileClipped()||!r||!r.length)return;this.currentStencilSource=a.source;const e=this.context,s=e.gl;this.nextStencilID+r.length>256&&this.clearStencil(),e.setColorMode(qt.disabled),e.setDepthMode(or.disabled);const u=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const d of r){const g=this._tileClippingMaskIDs[d.key]=this.nextStencilID++;u.draw(e,s.TRIANGLES,or.disabled,new yi({func:s.ALWAYS,mask:0},g,255,s.KEEP,s.KEEP,s.REPLACE),qt.disabled,Nr.disabled,Zs(d.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,r=this.context.gl;return new yi({func:r.NOTEQUAL,mask:255},a,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(a){const r=this.context.gl;return new yi({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(a){const r=this.context.gl,e=a.sort((d,g)=>g.overscaledZ-d.overscaledZ),s=e[e.length-1].overscaledZ,u=e[0].overscaledZ-s+1;if(u>1){this.currentStencilSource=void 0,this.nextStencilID+u>256&&this.clearStencil();const d={};for(let g=0;g<u;g++)d[g+s]=new yi({func:r.GEQUAL,mask:255},g+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=u,[d,e]}return[{[s]:yi.disabled},e]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new qt([a.CONSTANT_COLOR,a.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qt.unblended:qt.alphaBlended}depthModeForSublayer(a,r,e){if(!this.opaquePassEnabledForLayer())return or.disabled;const s=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new or(e||this.context.gl.LEQUAL,r,[s,s])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,r){this.style=a,this.options=r,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const e=this.style._order,s=this.style.sourceCaches;for(const b in s){const I=s[b];I.used&&I.prepare(this.context)}const u={},d={},g={};for(const b in s){const I=s[b];u[b]=I.getVisibleCoordinates(),d[b]=u[b].slice().reverse(),g[b]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let b=0;b<e.length;b++)if(this.style._layers[e[b]].is3D()){this.opaquePassCutoff=b;break}this.renderPass="offscreen";for(const b of e){const I=this.style._layers[b];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const k=d[I.source];(I.type==="custom"||k.length)&&this.renderLayer(this,s[I.source],I,k)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=e.length-1;this.currentLayer>=0;this.currentLayer--){const b=this.style._layers[e[this.currentLayer]],I=s[b.source],k=u[b.source];this._renderTileClippingMasks(b,k),this.renderLayer(this,I,b,k)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<e.length;this.currentLayer++){const b=this.style._layers[e[this.currentLayer]],I=s[b.source],k=(b.type==="symbol"?g:d)[b.source];this._renderTileClippingMasks(b,u[b.source]),this.renderLayer(this,I,b,k)}if(this.options.showTileBoundaries){let b,I;Object.values(this.style._layers).forEach(k=>{k.source&&!k.isHidden(this.transform.zoom)&&(k.source!==(I&&I.id)&&(I=this.style.sourceCaches[k.source]),(!b||b.getSource().maxzoom<I.getSource().maxzoom)&&(b=I))}),b&&Ps.debug(this,b,b.getVisibleCoordinates())}this.options.showPadding&&function(b){const I=b.transform.padding;fl(b,b.transform.height-(I.top||0),3,pl),fl(b,I.bottom||0,3,dl),Cs(b,I.left||0,3,os),Cs(b,b.transform.width-(I.right||0),3,so);const k=b.transform.centerPoint;(function(D,F,j,N){Ba(D,F-1,j-10,2,20,N),Ba(D,F-10,j-1,20,2,N)})(b,k.x,b.transform.height-k.y,So)}(this),this.context.setDefault()}renderLayer(a,r,e,s){e.isHidden(this.transform.zoom)||(e.type==="background"||e.type==="custom"||s.length)&&(this.id=e.id,this.gpuTimingStart(e),Ps[e.type](a,r,e,s,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;let e=this.gpuTimers[a.id];e||(e=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:r.createQueryEXT()}),e.calls++,r.beginQueryEXT(r.TIME_ELAPSED_EXT,e.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}queryGpuTimers(a){const r={};for(const e in a){const s=a[e],u=this.context.extTimerQuery,d=u.getQueryObjectEXT(s.query,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(s.query),r[e]=d}return r}translatePosMatrix(a,r,e,s,u){if(!e[0]&&!e[1])return a;const d=u?s==="map"?this.transform.angle:0:s==="viewport"?-this.transform.angle:0;if(d){const I=Math.sin(d),k=Math.cos(d);e=[e[0]*k-e[1]*I,e[0]*I+e[1]*k]}const g=[u?e[0]:wr(r,e[0],this.transform.zoom),u?e[1]:wr(r,e[1],this.transform.zoom),0],b=new Float32Array(16);return l.translate(b,a,g),b}saveTileTexture(a){const r=this._tileTextures[a.size[0]];r?r.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const r=this._tileTextures[a];return r&&r.length>0?r.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const r=this.imageManager.getPattern(a.from.toString()),e=this.imageManager.getPattern(a.to.toString());return!r||!e}useProgram(a,r){this.cache=this.cache||{};const e=`${a}${r?r.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[e]||(this.cache[e]=new Pl(this.context,a,mr[a],r,Ko[a],this._showOverdrawInspector)),this.cache[e]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new it(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Eo{constructor(a,r){this.points=a,this.planes=r}static fromInvProjectionMatrix(a,r,e){const s=Math.pow(2,e),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>l.transformMat4([],g,a)).map(g=>l.scale$1([],g,1/g[3]/r*s)),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const b=function(F,j){var N=j[0],K=j[1],J=j[2],ee=N*N+K*K+J*J;return ee>0&&(ee=1/Math.sqrt(ee)),F[0]=j[0]*ee,F[1]=j[1]*ee,F[2]=j[2]*ee,F}([],function(F,j,N){var K=j[0],J=j[1],ee=j[2],le=N[0],ce=N[1],ye=N[2];return F[0]=J*ye-ee*ce,F[1]=ee*le-K*ye,F[2]=K*ce-J*le,F}([],zt([],u[g[0]],u[g[1]]),zt([],u[g[2]],u[g[1]]))),I=-((k=b)[0]*(D=u[g[1]])[0]+k[1]*D[1]+k[2]*D[2]);var k,D;return b.concat(I)});return new Eo(u,d)}}class sa{constructor(a,r){this.min=a,this.max=r,this.center=function(e,s,u){return e[0]=.5*s[0],e[1]=.5*s[1],e[2]=.5*s[2],e}([],function(e,s,u){return e[0]=s[0]+u[0],e[1]=s[1]+u[1],e[2]=s[2]+u[2],e}([],this.min,this.max))}quadrant(a){const r=[a%2==0,a<2],e=Fe(this.min),s=Fe(this.max);for(let u=0;u<r.length;u++)e[u]=r[u]?this.min[u]:this.center[u],s[u]=r[u]?this.center[u]:this.max[u];return s[2]=this.max[2],new sa(e,s)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const r=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let e=!0;for(let s=0;s<a.planes.length;s++){const u=a.planes[s];let d=0;for(let g=0;g<r.length;g++)l.dot(u,r[g])>=0&&d++;if(d===0)return 0;d!==r.length&&(e=!1)}if(e)return 2;for(let s=0;s<3;s++){let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let g=0;g<a.points.length;g++){const b=a.points[g][s]-this.min[s];u=Math.min(u,b),d=Math.max(d,b)}if(d<0||u>this.max[s]-this.min[s])return 0}return 1}}class as{constructor(a=0,r=0,e=0,s=0){if(isNaN(a)||a<0||isNaN(r)||r<0||isNaN(e)||e<0||isNaN(s)||s<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=r,this.left=e,this.right=s}interpolate(a,r,e){return r.top!=null&&a.top!=null&&(this.top=l.number(a.top,r.top,e)),r.bottom!=null&&a.bottom!=null&&(this.bottom=l.number(a.bottom,r.bottom,e)),r.left!=null&&a.left!=null&&(this.left=l.number(a.left,r.left,e)),r.right!=null&&a.right!=null&&(this.right=l.number(a.right,r.right,e)),this}getCenter(a,r){const e=l.clamp((this.left+a-this.right)/2,0,a),s=l.clamp((this.top+r-this.bottom)/2,0,r);return new l.pointGeometry(e,s)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ms{constructor(a,r,e,s,u){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=u===void 0||!!u,this._minZoom=a||0,this._maxZoom=r||22,this._minPitch=e==null?0:e,this._maxPitch=s==null?60:s,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new as,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const a=new ms(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.tileSize=this.tileSize,a.latRange=this.latRange,a.width=this.width,a.height=this.height,a._center=this._center,a.zoom=this.zoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const r=-l.wrap(a,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var e=new l.ARRAY_TYPE(4);return l.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}(),function(e,s,u){var d=s[0],g=s[1],b=s[2],I=s[3],k=Math.sin(u),D=Math.cos(u);e[0]=d*D+b*k,e[1]=g*D+I*k,e[2]=d*-k+b*D,e[3]=g*-k+I*D}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const r=l.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const r=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,r,e){this._unmodified=!1,this._edgeInsets.interpolate(a,r,e),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const r=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(a){const r=[new l.UnwrappedTileID(0,a)];if(this._renderWorldCopies){const e=this.pointCoordinate(new l.pointGeometry(0,0)),s=this.pointCoordinate(new l.pointGeometry(this.width,0)),u=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),d=this.pointCoordinate(new l.pointGeometry(0,this.height)),g=Math.floor(Math.min(e.x,s.x,u.x,d.x)),b=Math.floor(Math.max(e.x,s.x,u.x,d.x)),I=1;for(let k=g-I;k<=b+I;k++)k!==0&&r.push(new l.UnwrappedTileID(k,a))}return r}coveringTiles(a){let r=this.coveringZoomLevel(a);const e=r;if(a.minzoom!==void 0&&r<a.minzoom)return[];a.maxzoom!==void 0&&r>a.maxzoom&&(r=a.maxzoom);const s=l.MercatorCoordinate.fromLngLat(this.center),u=Math.pow(2,r),d=[u*s.x,u*s.y,0],g=Eo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r);let b=a.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(b=r);const I=N=>({aabb:new sa([N*u,0,0],[(N+1)*u,u,0]),zoom:0,x:0,y:0,wrap:N,fullyVisible:!1}),k=[],D=[],F=r,j=a.reparseOverscaled?e:r;if(this._renderWorldCopies)for(let N=1;N<=3;N++)k.push(I(-N)),k.push(I(N));for(k.push(I(0));k.length>0;){const N=k.pop(),K=N.x,J=N.y;let ee=N.fullyVisible;if(!ee){const ve=N.aabb.intersects(g);if(ve===0)continue;ee=ve===2}const le=N.aabb.distanceX(d),ce=N.aabb.distanceY(d),ye=Math.max(Math.abs(le),Math.abs(ce)),oe=3+(1<<F-N.zoom)-2;if(N.zoom===F||ye>oe&&N.zoom>=b)D.push({tileID:new l.OverscaledTileID(N.zoom===F?j:N.zoom,N.wrap,N.zoom,K,J),distanceSq:Ct([d[0]-.5-K,d[1]-.5-J])});else for(let ve=0;ve<4;ve++){const be=(K<<1)+ve%2,ze=(J<<1)+(ve>>1);k.push({aabb:N.aabb.quadrant(ve),zoom:N.zoom+1,x:be,y:ze,wrap:N.wrap,fullyVisible:ee})}}return D.sort((N,K)=>N.distanceSq-K.distanceSq).map(N=>N.tileID)}resize(a,r){this.width=a,this.height=r,this.pixelsToGLUnits=[2/a,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const r=l.clamp(a.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(a.lng)*this.worldSize,l.mercatorYfromLat(r)*this.worldSize)}unproject(a){return new l.MercatorCoordinate(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(a,r){const e=this.pointCoordinate(r),s=this.pointCoordinate(this.centerPoint),u=this.locationCoordinate(a),d=new l.MercatorCoordinate(u.x-(e.x-s.x),u.y-(e.y-s.y));this.center=this.coordinateLocation(d),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a){return this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}locationCoordinate(a){return l.MercatorCoordinate.fromLngLat(a)}coordinateLocation(a){return a.toLngLat()}pointCoordinate(a){const r=[a.x,a.y,0,1],e=[a.x,a.y,1,1];l.transformMat4(r,r,this.pixelMatrixInverse),l.transformMat4(e,e,this.pixelMatrixInverse);const s=r[3],u=e[3],d=r[1]/s,g=e[1]/u,b=r[2]/s,I=e[2]/u,k=b===I?0:(0-b)/(I-b);return new l.MercatorCoordinate(l.number(r[0]/s,e[0]/u,k)/this.worldSize,l.number(d,g,k)/this.worldSize)}coordinatePoint(a){const r=[a.x*this.worldSize,a.y*this.worldSize,0,1];return l.transformMat4(r,r,this.pixelMatrix),new l.pointGeometry(r[0]/r[3],r[1]/r[3])}getBounds(){return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,0))).extend(this.pointLocation(new l.pointGeometry(this.width,0))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(a,r=!1){const e=a.key,s=r?this._alignedPosMatrixCache:this._posMatrixCache;if(s[e])return s[e];const u=a.canonical,d=this.worldSize/this.zoomScale(u.z),g=u.x+Math.pow(2,u.z)*a.wrap,b=l.identity(new Float64Array(16));return l.translate(b,b,[g*d,u.y*d,0]),l.scale(b,b,[d/l.EXTENT,d/l.EXTENT,1]),l.multiply(b,r?this.alignedProjMatrix:this.projMatrix,b),s[e]=new Float32Array(b),s[e]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a,r,e,s,u=-90,d=90,g=-180,b=180;const I=this.size,k=this._unmodified;if(this.latRange){const j=this.latRange;u=l.mercatorYfromLat(j[1])*this.worldSize,d=l.mercatorYfromLat(j[0])*this.worldSize,a=d-u<I.y?I.y/(d-u):0}if(this.lngRange){const j=this.lngRange;g=l.mercatorXfromLng(j[0])*this.worldSize,b=l.mercatorXfromLng(j[1])*this.worldSize,r=b-g<I.x?I.x/(b-g):0}const D=this.point,F=Math.max(r||0,a||0);if(F)return this.center=this.unproject(new l.pointGeometry(r?(b+g)/2:D.x,a?(d+u)/2:D.y)),this.zoom+=this.scaleZoom(F),this._unmodified=k,void(this._constraining=!1);if(this.latRange){const j=D.y,N=I.y/2;j-N<u&&(s=u+N),j+N>d&&(s=d-N)}if(this.lngRange){const j=D.x,N=I.x/2;j-N<g&&(e=g+N),j+N>b&&(e=b-N)}e===void 0&&s===void 0||(this.center=this.unproject(new l.pointGeometry(e!==void 0?e:D.x,s!==void 0?s:D.y))),this._unmodified=k,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const r=Math.PI/2+this._pitch,e=this._fov*(.5+a.y/this.height),s=Math.sin(e)*this.cameraToCenterDistance/Math.sin(l.clamp(Math.PI-r-e,.01,Math.PI-.01)),u=this.point,d=u.x,g=u.y,b=1.01*(Math.cos(Math.PI/2-this._pitch)*s+this.cameraToCenterDistance),I=this.height/50;let k=new Float64Array(16);l.perspective(k,this._fov,this.width/this.height,I,b),k[8]=2*-a.x/this.width,k[9]=2*a.y/this.height,l.scale(k,k,[1,-1,1]),l.translate(k,k,[0,0,-this.cameraToCenterDistance]),l.rotateX(k,k,this._pitch),l.rotateZ(k,k,this.angle),l.translate(k,k,[-d,-g,0]),this.mercatorMatrix=l.scale([],k,[this.worldSize,this.worldSize,this.worldSize]),l.scale(k,k,[1,1,l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=k,this.invProjMatrix=l.invert([],this.projMatrix);const D=this.width%2/2,F=this.height%2/2,j=Math.cos(this.angle),N=Math.sin(this.angle),K=d-Math.round(d)+j*D+N*F,J=g-Math.round(g)+j*F+N*D,ee=new Float64Array(k);if(l.translate(ee,ee,[K>.5?K-1:K,J>.5?J-1:J,0]),this.alignedProjMatrix=ee,k=l.create(),l.scale(k,k,[this.width/2,-this.height/2,1]),l.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=l.create(),l.scale(k,k,[1,-1,1]),l.translate(k,k,[-1,-1,0]),l.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),k=l.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");this.pixelMatrixInverse=k,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new l.pointGeometry(0,0)),r=[a.x*this.worldSize,a.y*this.worldSize,0,1];return l.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,a))}getCameraQueryGeometry(a){const r=this.getCameraPoint();if(a.length===1)return[a[0],r];{let e=r.x,s=r.y,u=r.x,d=r.y;for(const g of a)e=Math.min(e,g.x),s=Math.min(s,g.y),u=Math.max(u,g.x),d=Math.max(d,g.y);return[new l.pointGeometry(e,s),new l.pointGeometry(u,s),new l.pointGeometry(u,d),new l.pointGeometry(e,d),new l.pointGeometry(e,s)]}}}class oa{constructor(a){this._hashName=a&&encodeURIComponent(a),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(r,e){let s=!1,u=null;const d=()=>{u=null,s&&(r(),u=setTimeout(d,300),s=!1)};return()=>(s=!0,u||d(),u)}(this._updateHashUnthrottled.bind(this))}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const r=this._map.getCenter(),e=Math.round(100*this._map.getZoom())/100,s=Math.ceil((e*Math.LN2+Math.log(512/360/.5))/Math.LN10),u=Math.pow(10,s),d=Math.round(r.lng*u)/u,g=Math.round(r.lat*u)/u,b=this._map.getBearing(),I=this._map.getPitch();let k="";if(k+=a?`/${d}/${g}/${e}`:`${e}/${g}/${d}`,(b||I)&&(k+="/"+Math.round(10*b)/10),I&&(k+=`/${Math.round(I)}`),this._hashName){const D=this._hashName;let F=!1;const j=window.location.hash.slice(1).split("&").map(N=>{const K=N.split("=")[0];return K===D?(F=!0,`${K}=${k}`):N}).filter(N=>N);return F||j.push(`${D}=${k}`),`#${j.join("&")}`}return`#${k}`}_getCurrentHash(){const a=window.location.hash.replace("#","");if(this._hashName){let r;return a.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(r=e)}),(r&&r[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._getCurrentHash();if(a.length>=3&&!a.some(r=>isNaN(r))){const r=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:r,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}}}const Hs={linearity:.3,easing:l.bezier(0,0,.3,1)},ml=l.extend({deceleration:2500,maxSpeed:1400},Hs),Ao=l.extend({deceleration:20,maxSpeed:1400},Hs),gl=l.extend({deceleration:1e3,maxSpeed:360},Hs),ls=l.extend({deceleration:1e3,maxSpeed:90},Hs);class _l{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,r=l.exported.now();for(;a.length>0&&r-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:u}of this._inertiaBuffer)r.zoom+=u.zoomDelta||0,r.bearing+=u.bearingDelta||0,r.pitch+=u.pitchDelta||0,u.panDelta&&r.pan._add(u.panDelta),u.around&&(r.around=u.around),u.pinchAround&&(r.pinchAround=u.pinchAround);const e=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(r.pan.mag()){const u=zo(r.pan.mag(),e,l.extend({},ml,a||{}));s.offset=r.pan.mult(u.amount/r.pan.mag()),s.center=this._map.transform.center,ko(s,u)}if(r.zoom){const u=zo(r.zoom,e,Ao);s.zoom=this._map.transform.zoom+u.amount,ko(s,u)}if(r.bearing){const u=zo(r.bearing,e,gl);s.bearing=this._map.transform.bearing+l.clamp(u.amount,-179,179),ko(s,u)}if(r.pitch){const u=zo(r.pitch,e,ls);s.pitch=this._map.transform.pitch+u.amount,ko(s,u)}if(s.zoom||s.bearing){const u=r.pinchAround===void 0?r.around:r.pinchAround;s.around=u?this._map.unproject(u):this._map.getCenter()}return this.clear(),l.extend(s,{noMoveStart:!0})}}function ko(w,a){(!w.duration||w.duration<a.duration)&&(w.duration=a.duration,w.easing=a.easing)}function zo(w,a,r){const{maxSpeed:e,linearity:s,deceleration:u}=r,d=l.clamp(w*s/(a/1e3),-e,e),g=Math.abs(d)/(u*s);return{easing:r.easing,duration:1e3*g,amount:d*(g/2)}}class Cn extends l.Event{constructor(a,r,e,s={}){const u=Z.mousePos(r.getCanvasContainer(),e),d=r.unproject(u);super(a,l.extend({point:u,lngLat:d,originalEvent:e},s)),this._defaultPrevented=!1,this.target=r}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class In extends l.Event{constructor(a,r,e){const s=a==="touchend"?e.changedTouches:e.touches,u=Z.touchPos(r.getCanvasContainer(),s),d=u.map(b=>r.unproject(b)),g=u.reduce((b,I,k,D)=>b.add(I.div(D.length)),new l.pointGeometry(0,0));super(a,{points:u,point:g,lngLats:d,lngLat:r.unproject(g),originalEvent:e}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class en extends l.Event{constructor(a,r,e){super(a,{originalEvent:e}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class gs{constructor(a,r){this._map=a,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new en(a.type,this._map,a))}mousedown(a,r){return this._mousedownPos=r,this._firePreventable(new Cn(a.type,this._map,a))}mouseup(a){this._map.fire(new Cn(a.type,this._map,a))}click(a,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Cn(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Cn(a.type,this._map,a))}mouseover(a){this._map.fire(new Cn(a.type,this._map,a))}mouseout(a){this._map.fire(new Cn(a.type,this._map,a))}touchstart(a){return this._firePreventable(new In(a.type,this._map,a))}touchmove(a){this._map.fire(new In(a.type,this._map,a))}touchend(a){this._map.fire(new In(a.type,this._map,a))}touchcancel(a){this._map.fire(new In(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ms{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Cn(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Cn(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class oo{constructor(a,r){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,r){this.isEnabled()&&a.shiftKey&&a.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(a,r){if(!this._active)return;const e=r;if(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)return;const s=this._startPos;this._lastPos=e,this._box||(this._box=Z.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const u=Math.min(s.x,e.x),d=Math.max(s.x,e.x),g=Math.min(s.y,e.y),b=Math.max(s.y,e.y);Z.setTransform(this._box,`translate(${u}px,${g}px)`),this._box.style.width=d-u+"px",this._box.style.height=b-g+"px"}mouseupWindow(a,r){if(!this._active||a.button!==0)return;const e=this._startPos,s=r;if(this.reset(),Z.suppressClick(),e.x!==s.x||e.y!==s.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:u=>u.fitScreenCoordinates(e,s,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,r){return this._map.fire(new l.Event(a,{originalEvent:r}))}}function qn(w,a){const r={};for(let e=0;e<w.length;e++)r[w[e].identifier]=a[e];return r}class aa{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,r,e){(this.centroid||e.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),e.length===this.numTouches&&(this.centroid=function(s){const u=new l.pointGeometry(0,0);for(const d of s)u._add(d);return u.div(s.length)}(r),this.touches=qn(e,r)))}touchmove(a,r,e){if(this.aborted||!this.centroid)return;const s=qn(e,r);for(const u in this.touches){const d=this.touches[u],g=s[u];(!g||g.dist(d)>30)&&(this.aborted=!0)}}touchend(a,r,e){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),e.length===0){const s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}class la{constructor(a){this.singleTap=new aa(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,r,e){this.singleTap.touchstart(a,r,e)}touchmove(a,r,e){this.singleTap.touchmove(a,r,e)}touchend(a,r,e){const s=this.singleTap.touchend(a,r,e);if(s){const u=a.timeStamp-this.lastTime<500,d=!this.lastTap||this.lastTap.dist(s)<30;if(u&&d||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}class yc{constructor(){this._zoomIn=new la({numTouches:1,numTaps:2}),this._zoomOut=new la({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,r,e){this._zoomIn.touchstart(a,r,e),this._zoomOut.touchstart(a,r,e)}touchmove(a,r,e){this._zoomIn.touchmove(a,r,e),this._zoomOut.touchmove(a,r,e)}touchend(a,r,e){const s=this._zoomIn.touchend(a,r,e),u=this._zoomOut.touchend(a,r,e);return s?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:d.getZoom()+1,around:d.unproject(s)},{originalEvent:a})}):u?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:d.getZoom()-1,around:d.unproject(u)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Fa={0:1,2:2};class Ks{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(a,r){return!1}_move(a,r){return{}}mousedown(a,r){if(this._lastPoint)return;const e=Z.mouseButton(a);this._correctButton(a,e)&&(this._lastPoint=r,this._eventButton=e)}mousemoveWindow(a,r){const e=this._lastPoint;if(e){if(a.preventDefault(),function(s,u){const d=Fa[u];return s.buttons===void 0||(s.buttons&d)!==d}(a,this._eventButton))this.reset();else if(this._moved||!(r.dist(e)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(e,r)}}mouseupWindow(a){this._lastPoint&&Z.mouseButton(a)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _s extends Ks{mousedown(a,r){super.mousedown(a,r),this._lastPoint&&(this._active=!0)}_correctButton(a,r){return r===0&&!a.ctrlKey}_move(a,r){return{around:r,panDelta:r.sub(a)}}}class Nt extends Ks{_correctButton(a,r){return r===0&&a.ctrlKey||r===2}_move(a,r){const e=.8*(r.x-a.x);if(e)return this._active=!0,{bearingDelta:e}}contextmenu(a){a.preventDefault()}}class Zt extends Ks{_correctButton(a,r){return r===0&&a.ctrlKey||r===2}_move(a,r){const e=-.5*(r.y-a.y);if(e)return this._active=!0,{pitchDelta:e}}contextmenu(a){a.preventDefault()}}class ao{constructor(a){this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(a,r,e){return this._calculateTransform(a,r,e)}touchmove(a,r,e){if(this._active&&!(e.length<this._minTouches))return a.preventDefault(),this._calculateTransform(a,r,e)}touchend(a,r,e){this._calculateTransform(a,r,e),this._active&&e.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,r,e){e.length>0&&(this._active=!0);const s=qn(e,r),u=new l.pointGeometry(0,0),d=new l.pointGeometry(0,0);let g=0;for(const I in s){const k=s[I],D=this._touches[I];D&&(u._add(k),d._add(k.sub(D)),g++,s[I]=k)}if(this._touches=s,g<this._minTouches||!d.mag())return;const b=d.div(g);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:u.div(g),panDelta:b}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(a){}_move(a,r,e){return{}}touchstart(a,r,e){this._firstTwoTouches||e.length<2||(this._firstTwoTouches=[e[0].identifier,e[1].identifier],this._start([r[0],r[1]]))}touchmove(a,r,e){if(!this._firstTwoTouches)return;a.preventDefault();const[s,u]=this._firstTwoTouches,d=Ds(e,r,s),g=Ds(e,r,u);if(!d||!g)return;const b=this._aroundCenter?null:d.add(g).div(2);return this._move([d,g],b,a)}touchend(a,r,e){if(!this._firstTwoTouches)return;const[s,u]=this._firstTwoTouches,d=Ds(e,r,s),g=Ds(e,r,u);d&&g||(this._active&&Z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ds(w,a,r){for(let e=0;e<w.length;e++)if(w[e].identifier===r)return a[e]}function Rt(w,a){return Math.log(w/a)/Math.LN2}class Bt extends Yn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,r){const e=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Rt(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rt(this._distance,e),pinchAround:r}}}function ca(w,a){return 180*w.angleWith(a)/Math.PI}class xc extends Yn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,r){const e=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ca(this._vector,e),pinchAround:r}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const r=25/(Math.PI*this._minDiameter)*360,e=ca(a,this._startVector);return Math.abs(e)<r}}function Co(w){return Math.abs(w.y)>Math.abs(w.x)}class Oa extends Yn{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(a){this._lastPoints=a,Co(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,r,e){const s=a[0].sub(this._lastPoints[0]),u=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(s,u,e.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(s.y+u.y)/2*-.5}}gestureBeginsVertically(a,r,e){if(this._valid!==void 0)return this._valid;const s=a.mag()>=2,u=r.mag()>=2;if(!s&&!u)return;if(!s||!u)return this._firstMove===void 0&&(this._firstMove=e),e-this._firstMove<100&&void 0;const d=a.y>0==r.y>0;return Co(a)&&Co(r)&&d}}const ua={panStep:100,bearingStep:15,pitchStep:10};class Dl{constructor(){const a=ua;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let r=0,e=0,s=0,u=0,d=0;switch(a.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:a.shiftKey?e=-1:(a.preventDefault(),u=-1);break;case 39:a.shiftKey?e=1:(a.preventDefault(),u=1);break;case 38:a.shiftKey?s=1:(a.preventDefault(),d=-1);break;case 40:a.shiftKey?s=-1:(a.preventDefault(),d=1);break;default:return}return this._rotationDisabled&&(e=0,s=0),{cameraAnimation:g=>{const b=g.getZoom();g.easeTo({duration:300,easeId:"keyboardHandler",easing:vc,zoom:r?Math.round(b)+r*(a.shiftKey?2:1):b,bearing:g.getBearing()+e*this._bearingStep,pitch:g.getPitch()+s*this._pitchStep,offset:[-u*this._panStep,-d*this._panStep],center:g.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vc(w){return w*(2-w)}const Ua=4.000244140625;class ha{constructor(a,r){this._map=a,this._el=a.getCanvasContainer(),this._handler=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled())return;let r=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const e=l.exported.now(),s=e-(this._lastWheelEventTime||0);this._lastWheelEventTime=e,r!==0&&r%Ua==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(s*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),a.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=a,this._delta-=r,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Z.mousePos(this._el,a);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;if(this._delta!==0){const g=this._type==="wheel"&&Math.abs(this._delta)>Ua?this._wheelZoomRate:this._defaultZoomRate;let b=2/(1+Math.exp(-Math.abs(this._delta*g)));this._delta<0&&b!==0&&(b=1/b);const I=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(I*b))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,e=this._startZoom,s=this._easing;let u,d=!1;if(this._type==="wheel"&&e&&s){const g=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),b=s(g);u=l.number(e,r,b),g<1?this._frameId||(this._frameId=!0):d=!0}else u=r,d=!0;return this._active=!0,d&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!d,zoomDelta:u-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let r=l.ease;if(this._prevEase){const e=this._prevEase,s=(l.exported.now()-e.start)/e.duration,u=e.easing(s+.01)-e.easing(s),d=.27/Math.sqrt(u*u+1e-4)*.01,g=Math.sqrt(.0729-d*d);r=l.bezier(d,g,.25,1)}return this._prevEase={start:l.exported.now(),duration:a,easing:r},r}reset(){this._active=!1}}class Po{constructor(a,r){this._clickZoom=a,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pa{constructor(){this.reset()}reset(){this._active=!1}dblclick(a,r){return a.preventDefault(),{cameraAnimation:e=>{e.easeTo({duration:300,zoom:e.getZoom()+(a.shiftKey?-1:1),around:e.unproject(r)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bn{constructor(){this._tap=new la({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(a,r,e){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?e.length>0&&(this._swipePoint=r[0],this._swipeTouch=e[0].identifier):this._tap.touchstart(a,r,e))}touchmove(a,r,e){if(this._tapTime){if(this._swipePoint){if(e[0].identifier!==this._swipeTouch)return;const s=r[0],u=s.y-this._swipePoint.y;return this._swipePoint=s,a.preventDefault(),this._active=!0,{zoomDelta:u/128}}}else this._tap.touchmove(a,r,e)}touchend(a,r,e){this._tapTime?this._swipePoint&&e.length===0&&this.reset():this._tap.touchend(a,r,e)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cn{constructor(a,r,e){this._el=a,this._mousePan=r,this._touchPan=e}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ls{constructor(a,r,e){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=r,this._mousePitch=e}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Va{constructor(a,r,e,s){this._el=a,this._touchZoom=r,this._touchRotate=e,this._tapDragZoom=s,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ys=w=>w.zoom||w.drag||w.pitch||w.rotate;class da extends l.Event{}function Bs(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class Gn{constructor(a,r){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _l(a),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),l.bindAll(["handleEvent","handleWindowEvent"],this);const e=this._el;this._listeners=[[e,"touchstart",{passive:!0}],[e,"touchmove",{passive:!1}],[e,"touchend",void 0],[e,"touchcancel",void 0],[e,"mousedown",void 0],[e,"mousemove",void 0],[e,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[e,"mouseover",void 0],[e,"mouseout",void 0],[e,"dblclick",void 0],[e,"click",void 0],[e,"keydown",{capture:!1}],[e,"keyup",void 0],[e,"wheel",{passive:!1}],[e,"contextmenu",void 0],[window,"blur",void 0]];for(const[s,u,d]of this._listeners)Z.addEventListener(s,u,s===document?this.handleWindowEvent:this.handleEvent,d)}destroy(){for(const[a,r,e]of this._listeners)Z.removeEventListener(a,r,a===document?this.handleWindowEvent:this.handleEvent,e)}_addDefaultHandlers(a){const r=this._map,e=r.getCanvasContainer();this._add("mapEvent",new gs(r,a));const s=r.boxZoom=new oo(r,a);this._add("boxZoom",s);const u=new yc,d=new pa;r.doubleClickZoom=new Po(d,u),this._add("tapZoom",u),this._add("clickZoom",d);const g=new Bn;this._add("tapDragZoom",g);const b=r.touchPitch=new Oa;this._add("touchPitch",b);const I=new Nt(a),k=new Zt(a);r.dragRotate=new Ls(a,I,k),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const D=new _s(a),F=new ao(a);r.dragPan=new cn(e,D,F),this._add("mousePan",D),this._add("touchPan",F,["touchZoom","touchRotate"]);const j=new xc,N=new Bt;r.touchZoomRotate=new Va(e,N,j,g),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",N,["touchPan","touchRotate"]);const K=r.scrollZoom=new ha(r,this);this._add("scrollZoom",K,["mousePan"]);const J=r.keyboard=new Dl;this._add("keyboard",J),this._add("blockableMapEvent",new Ms(r));for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[ee]&&r[ee].enable(a[ee])}_add(a,r,e){this._handlers.push({handlerName:a,handler:r,allowed:e}),this._handlersById[a]=r}stop(a){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ys(this._eventsInProgress))||this.isZooming()}_blockedByActive(a,r,e){for(const s in a)if(s!==e&&(!r||r.indexOf(s)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const r=[];for(const e of a)this._el.contains(e.target)&&r.push(e);return r}handleEvent(a,r){if(a.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const e=a.type==="renderFrame"?void 0:a,s={needsRenderFrame:!1},u={},d={},g=a.touches,b=g?this._getMapTouches(g):void 0,I=b?Z.touchPos(this._el,b):Z.mousePos(this._el,a);for(const{handlerName:F,handler:j,allowed:N}of this._handlers){if(!j.isEnabled())continue;let K;this._blockedByActive(d,N,F)?j.reset():j[r||a.type]&&(K=j[r||a.type](a,I,b),this.mergeHandlerResult(s,u,K,F,e),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||j.isActive())&&(d[F]=j)}const k={};for(const F in this._previousActiveHandlers)d[F]||(k[F]=e);this._previousActiveHandlers=d,(Object.keys(k).length||Bs(s))&&(this._changes.push([s,u,k]),this._triggerRenderFrame()),(Object.keys(d).length||Bs(s))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=s;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))}mergeHandlerResult(a,r,e,s,u){if(!e)return;l.extend(a,e);const d={handlerName:s,originalEvent:e.originalEvent||u};e.zoomDelta!==void 0&&(r.zoom=d),e.panDelta!==void 0&&(r.drag=d),e.pitchDelta!==void 0&&(r.pitch=d),e.bearingDelta!==void 0&&(r.rotate=d)}_applyChanges(){const a={},r={},e={};for(const[s,u,d]of this._changes)s.panDelta&&(a.panDelta=(a.panDelta||new l.pointGeometry(0,0))._add(s.panDelta)),s.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+s.pitchDelta),s.around!==void 0&&(a.around=s.around),s.pinchAround!==void 0&&(a.pinchAround=s.pinchAround),s.noInertia&&(a.noInertia=s.noInertia),l.extend(r,u),l.extend(e,d);this._updateMapTransform(a,r,e),this._changes=[]}_updateMapTransform(a,r,e){const s=this._map,u=s.transform;if(!Bs(a))return this._fireEvents(r,e,!0);let{panDelta:d,zoomDelta:g,bearingDelta:b,pitchDelta:I,around:k,pinchAround:D}=a;D!==void 0&&(k=D),s._stop(!0),k=k||s.transform.centerPoint;const F=u.pointLocation(d?k.sub(d):k);b&&(u.bearing+=b),I&&(u.pitch+=I),g&&(u.zoom+=g),u.setLocationAtPoint(F,k),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(r,e,!0)}_fireEvents(a,r,e){const s=Ys(this._eventsInProgress),u=Ys(a),d={};for(const k in a){const{originalEvent:D}=a[k];this._eventsInProgress[k]||(d[`${k}start`]=D),this._eventsInProgress[k]=a[k]}!s&&u&&this._fireEvent("movestart",u.originalEvent);for(const k in d)this._fireEvent(k,d[k]);u&&this._fireEvent("move",u.originalEvent);for(const k in a){const{originalEvent:D}=a[k];this._fireEvent(k,D)}const g={};let b;for(const k in this._eventsInProgress){const{handlerName:D,originalEvent:F}=this._eventsInProgress[k];this._handlersById[D].isActive()||(delete this._eventsInProgress[k],b=r[D]||F,g[`${k}end`]=b)}for(const k in g)this._fireEvent(k,g[k]);const I=Ys(this._eventsInProgress);if(e&&(s||u)&&!I){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;k?(D(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:b})):(this._map.fire(new l.Event("moveend",{originalEvent:b})),D(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,r){this._map.fire(new l.Event(a,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new da("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ki={extend:(w,...a)=>l.extend(w,...a),run(w){w()},logToElement(w,a=!1,r="log"){const e=window.document.getElementById(r);e&&(a&&(e.innerHTML=""),e.innerHTML+=`<br>${w}`)}};class zr extends l.Evented{constructor(a,r){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=r.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,r){return this.jumpTo({center:a},r)}panBy(a,r,e){return a=l.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,l.extend({offset:a},r),e)}panTo(a,r,e){return this.easeTo(l.extend({center:a},r),e)}getZoom(){return this.transform.zoom}setZoom(a,r){return this.jumpTo({zoom:a},r),this}zoomTo(a,r,e){return this.easeTo(l.extend({zoom:a},r),e)}zoomIn(a,r){return this.zoomTo(this.getZoom()+1,a,r),this}zoomOut(a,r){return this.zoomTo(this.getZoom()-1,a,r),this}getBearing(){return this.transform.bearing}setBearing(a,r){return this.jumpTo({bearing:a},r),this}getPadding(){return this.transform.padding}setPadding(a,r){return this.jumpTo({padding:a},r),this}rotateTo(a,r,e){return this.easeTo(l.extend({bearing:a},r),e)}resetNorth(a,r){return this.rotateTo(0,l.extend({duration:1e3},a),r),this}resetNorthPitch(a,r){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},a),r),this}snapToNorth(a,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,r):this}getPitch(){return this.transform.pitch}setPitch(a,r){return this.jumpTo({pitch:a},r),this}cameraForBounds(a,r){a=l.LngLatBounds.convert(a);const e=r&&r.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),e,r)}_cameraForBoxAndBearing(a,r,e,s){const u={top:0,bottom:0,right:0,left:0};if(typeof(s=l.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const oe=s.padding;s.padding={top:oe,bottom:oe,right:oe,left:oe}}s.padding=l.extend(u,s.padding);const d=this.transform,g=d.padding,b=d.project(l.LngLat.convert(a)),I=d.project(l.LngLat.convert(r)),k=b.rotate(-e*Math.PI/180),D=I.rotate(-e*Math.PI/180),F=new l.pointGeometry(Math.max(k.x,D.x),Math.max(k.y,D.y)),j=new l.pointGeometry(Math.min(k.x,D.x),Math.min(k.y,D.y)),N=F.sub(j),K=(d.width-(g.left+g.right+s.padding.left+s.padding.right))/N.x,J=(d.height-(g.top+g.bottom+s.padding.top+s.padding.bottom))/N.y;if(J<0||K<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ee=Math.min(d.scaleZoom(d.scale*Math.min(K,J)),s.maxZoom),le=l.pointGeometry.convert(s.offset),ce=new l.pointGeometry((s.padding.left-s.padding.right)/2,(s.padding.top-s.padding.bottom)/2).rotate(e*Math.PI/180),ye=le.add(ce).mult(d.scale/d.zoomScale(ee));return{center:d.unproject(b.add(I).div(2).sub(ye)),zoom:ee,bearing:e}}fitBounds(a,r,e){return this._fitInternal(this.cameraForBounds(a,r),r,e)}fitScreenCoordinates(a,r,e,s,u){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(a)),this.transform.pointLocation(l.pointGeometry.convert(r)),e,s),s,u)}_fitInternal(a,r,e){return a?(delete(r=l.extend(a,r)).padding,r.linear?this.easeTo(r,e):this.flyTo(r,e)):this}jumpTo(a,r){this.stop();const e=this.transform;let s=!1,u=!1,d=!1;return"zoom"in a&&e.zoom!==+a.zoom&&(s=!0,e.zoom=+a.zoom),a.center!==void 0&&(e.center=l.LngLat.convert(a.center)),"bearing"in a&&e.bearing!==+a.bearing&&(u=!0,e.bearing=+a.bearing),"pitch"in a&&e.pitch!==+a.pitch&&(d=!0,e.pitch=+a.pitch),a.padding==null||e.isPaddingEqual(a.padding)||(e.padding=a.padding),this.fire(new l.Event("movestart",r)).fire(new l.Event("move",r)),s&&this.fire(new l.Event("zoomstart",r)).fire(new l.Event("zoom",r)).fire(new l.Event("zoomend",r)),u&&this.fire(new l.Event("rotatestart",r)).fire(new l.Event("rotate",r)).fire(new l.Event("rotateend",r)),d&&this.fire(new l.Event("pitchstart",r)).fire(new l.Event("pitch",r)).fire(new l.Event("pitchend",r)),this.fire(new l.Event("moveend",r))}easeTo(a,r){this._stop(!1,a.easeId),((a=l.extend({offset:[0,0],duration:500,easing:l.ease},a)).animate===!1||!a.essential&&l.exported.prefersReducedMotion)&&(a.duration=0);const e=this.transform,s=this.getZoom(),u=this.getBearing(),d=this.getPitch(),g=this.getPadding(),b="zoom"in a?+a.zoom:s,I="bearing"in a?this._normalizeBearing(a.bearing,u):u,k="pitch"in a?+a.pitch:d,D="padding"in a?a.padding:e.padding,F=l.pointGeometry.convert(a.offset);let j=e.centerPoint.add(F);const N=e.pointLocation(j),K=l.LngLat.convert(a.center||N);this._normalizeCenter(K);const J=e.project(N),ee=e.project(K).sub(J),le=e.zoomScale(b-s);let ce,ye;a.around&&(ce=l.LngLat.convert(a.around),ye=e.locationPoint(ce));const oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||b!==s,this._rotating=this._rotating||u!==I,this._pitching=this._pitching||k!==d,this._padding=!e.isPaddingEqual(D),this._easeId=a.easeId,this._prepareEase(r,a.noMoveStart,oe),this._ease(ve=>{if(this._zooming&&(e.zoom=l.number(s,b,ve)),this._rotating&&(e.bearing=l.number(u,I,ve)),this._pitching&&(e.pitch=l.number(d,k,ve)),this._padding&&(e.interpolatePadding(g,D,ve),j=e.centerPoint.add(F)),ce)e.setLocationAtPoint(ce,ye);else{const be=e.zoomScale(e.zoom-s),ze=b>s?Math.min(2,le):Math.max(.5,le),we=Math.pow(ze,1-ve),Ne=e.unproject(J.add(ee.mult(ve*we)).mult(be));e.setLocationAtPoint(e.renderWorldCopies?Ne.wrap():Ne,j)}this._fireMoveEvents(r)},ve=>{this._afterEase(r,ve)},a),this}_prepareEase(a,r,e={}){this._moving=!0,r||e.moving||this.fire(new l.Event("movestart",a)),this._zooming&&!e.zooming&&this.fire(new l.Event("zoomstart",a)),this._rotating&&!e.rotating&&this.fire(new l.Event("rotatestart",a)),this._pitching&&!e.pitching&&this.fire(new l.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new l.Event("move",a)),this._zooming&&this.fire(new l.Event("zoom",a)),this._rotating&&this.fire(new l.Event("rotate",a)),this._pitching&&this.fire(new l.Event("pitch",a))}_afterEase(a,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const e=this._zooming,s=this._rotating,u=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,e&&this.fire(new l.Event("zoomend",a)),s&&this.fire(new l.Event("rotateend",a)),u&&this.fire(new l.Event("pitchend",a)),this.fire(new l.Event("moveend",a))}flyTo(a,r){if(!a.essential&&l.exported.prefersReducedMotion){const Ft=l.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ft,r)}this.stop(),a=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},a);const e=this.transform,s=this.getZoom(),u=this.getBearing(),d=this.getPitch(),g=this.getPadding(),b="zoom"in a?l.clamp(+a.zoom,e.minZoom,e.maxZoom):s,I="bearing"in a?this._normalizeBearing(a.bearing,u):u,k="pitch"in a?+a.pitch:d,D="padding"in a?a.padding:e.padding,F=e.zoomScale(b-s),j=l.pointGeometry.convert(a.offset);let N=e.centerPoint.add(j);const K=e.pointLocation(N),J=l.LngLat.convert(a.center||K);this._normalizeCenter(J);const ee=e.project(K),le=e.project(J).sub(ee);let ce=a.curve;const ye=Math.max(e.width,e.height),oe=ye/F,ve=le.mag();if("minZoom"in a){const Ft=l.clamp(Math.min(a.minZoom,s,b),e.minZoom,e.maxZoom),ti=ye/e.zoomScale(Ft-s);ce=Math.sqrt(ti/ve*2)}const be=ce*ce;function ze(Ft){const ti=(oe*oe-ye*ye+(Ft?-1:1)*be*be*ve*ve)/(2*(Ft?oe:ye)*be*ve);return Math.log(Math.sqrt(ti*ti+1)-ti)}function we(Ft){return(Math.exp(Ft)-Math.exp(-Ft))/2}function Ne(Ft){return(Math.exp(Ft)+Math.exp(-Ft))/2}const Ce=ze(0);let ut=function(Ft){return Ne(Ce)/Ne(Ce+ce*Ft)},yt=function(Ft){return ye*((Ne(Ce)*(we(ti=Ce+ce*Ft)/Ne(ti))-we(Ce))/be)/ve;var ti},xt=(ze(1)-Ce)/ce;if(Math.abs(ve)<1e-6||!isFinite(xt)){if(Math.abs(ye-oe)<1e-6)return this.easeTo(a,r);const Ft=oe<ye?-1:1;xt=Math.abs(Math.log(oe/ye))/ce,yt=function(){return 0},ut=function(ti){return Math.exp(Ft*ce*ti)}}return a.duration="duration"in a?+a.duration:1e3*xt/("screenSpeed"in a?+a.screenSpeed/ce:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=u!==I,this._pitching=k!==d,this._padding=!e.isPaddingEqual(D),this._prepareEase(r,!1),this._ease(Ft=>{const ti=Ft*xt,It=1/ut(ti);e.zoom=Ft===1?b:s+e.scaleZoom(It),this._rotating&&(e.bearing=l.number(u,I,Ft)),this._pitching&&(e.pitch=l.number(d,k,Ft)),this._padding&&(e.interpolatePadding(g,D,Ft),N=e.centerPoint.add(j));const ii=Ft===1?J:e.unproject(ee.add(le.mult(yt(ti))).mult(It));e.setLocationAtPoint(e.renderWorldCopies?ii.wrap():ii,N),this._fireMoveEvents(r)},()=>this._afterEase(r),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,r)}if(!a){const e=this.handlers;e&&e.stop(!1)}return this}_ease(a,r,e){e.animate===!1||e.duration===0?(a(1),r()):(this._easeStart=l.exported.now(),this._easeOptions=e,this._onEaseFrame=a,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,r){a=l.wrap(a,-180,180);const e=Math.abs(a-r);return Math.abs(a-360-r)<e&&(a-=360),Math.abs(a+360-r)<e&&(a+=360),a}_normalizeCenter(a){const r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;const e=a.lng-r.center.lng;a.lng+=e>180?-360:e<-180?360:0}}class lo{constructor(a={}){this.options=a,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options&&this.options.compact,this._container=Z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,r){const e=this._map._getUIString(`AttributionControl.${r}`);a.title=e,a.setAttribute("aria-label",e)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(s=>typeof s!="string"?"":s)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const s=this._map.style.stylesheet;this.styleOwner=s.owner,this.styleId=s.id}const r=this._map.style.sourceCaches;for(const s in r){const u=r[s];if(u.used){const d=u.getSource();d.attribution&&a.indexOf(d.attribution)<0&&a.push(d.attribution)}}a=a.filter(s=>String(s).trim()),a.sort((s,u)=>s.length-u.length),a=a.filter((s,u)=>{for(let d=u+1;d<a.length;d++)if(a[d].indexOf(s)>=0)return!1;return!0});const e=a.join(" | ");e!==this._attribHTML&&(this._attribHTML=e,a.length?(this._innerContainer.innerHTML=e,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class fa{constructor(a={}){this.options=a,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=Z.create("div","maplibregl-ctrl mapboxgl-ctrl");const r=Z.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const a=this._container.children;if(a.length){const r=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&r.classList.add("maplibregl-compact","mapboxgl-compact"):r.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Na{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const r=++this._id;return this._queue.push({callback:a,id:r,cancelled:!1}),r}remove(a){const r=this._currentlyRunning,e=r?this._queue.concat(r):this._queue;for(const s of e)if(s.id===a)return void(s.cancelled=!0)}run(a=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const e of r)if(!e.cancelled&&(e.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ja={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ll={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},ys={showCompass:!0,showZoom:!0,visualizePitch:!1};class Zn{constructor(a,r,e=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new Nt({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,e&&(this.mousePitch=new Zt({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(r,"mousedown",this.mousedown),Z.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(r,"touchmove",this.touchmove),Z.addEventListener(r,"touchend",this.touchend),Z.addEventListener(r,"touchcancel",this.reset)}down(a,r){this.mouseRotate.mousedown(a,r),this.mousePitch&&this.mousePitch.mousedown(a,r),Z.disableDrag()}move(a,r){const e=this.map,s=this.mouseRotate.mousemoveWindow(a,r);if(s&&s.bearingDelta&&e.setBearing(e.getBearing()+s.bearingDelta),this.mousePitch){const u=this.mousePitch.mousemoveWindow(a,r);u&&u.pitchDelta&&e.setPitch(e.getPitch()+u.pitchDelta)}}off(){const a=this.element;Z.removeEventListener(a,"mousedown",this.mousedown),Z.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(a,"touchmove",this.touchmove),Z.removeEventListener(a,"touchend",this.touchend),Z.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){Z.enableDrag(),Z.removeEventListener(window,"mousemove",this.mousemove),Z.removeEventListener(window,"mouseup",this.mouseup)}mousedown(a){this.down(l.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Z.mousePos(this.element,a)),Z.addEventListener(window,"mousemove",this.mousemove),Z.addEventListener(window,"mouseup",this.mouseup)}mousemove(a){this.move(a,Z.mousePos(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Yt(w,a,r){if(w=new l.LngLat(w.lng,w.lat),a){const e=new l.LngLat(w.lng-360,w.lat),s=new l.LngLat(w.lng+360,w.lat),u=r.locationPoint(w).distSqr(a);r.locationPoint(e).distSqr(a)<u?w=e:r.locationPoint(s).distSqr(a)<u&&(w=s)}for(;Math.abs(w.lng-r.center.lng)>180;){const e=r.locationPoint(w);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;w.lng>r.center.lng?w.lng-=360:w.lng+=360}return w}const _t={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ri(w,a,r){const e=w.classList;for(const s in _t)e.remove(`maplibregl-${r}-anchor-${s}`,`mapboxgl-${r}-anchor-${s}`);e.add(`maplibregl-${r}-anchor-${a}`,`mapboxgl-${r}-anchor-${a}`)}class xs extends l.Evented{constructor(a,r){if(super(),(a instanceof HTMLElement||r)&&(a=l.extend({element:a},r)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=l.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");const e=Z.createNS("http://www.w3.org/2000/svg","svg"),s=41,u=27;e.setAttributeNS(null,"display","block"),e.setAttributeNS(null,"height",`${s}px`),e.setAttributeNS(null,"width",`${u}px`),e.setAttributeNS(null,"viewBox",`0 0 ${u} ${s}`);const d=Z.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const g=Z.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"fill-rule","nonzero");const b=Z.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const le of I){const ce=Z.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",le.rx),ce.setAttributeNS(null,"ry",le.ry),b.appendChild(ce)}const k=Z.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const D=Z.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(D);const F=Z.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const j=Z.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(j);const N=Z.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(6.0, 7.0)"),N.setAttributeNS(null,"fill","#FFFFFF");const K=Z.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=Z.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const ee=Z.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#FFFFFF"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962"),K.appendChild(J),K.appendChild(ee),g.appendChild(b),g.appendChild(k),g.appendChild(F),g.appendChild(N),g.appendChild(K),e.appendChild(g),e.setAttributeNS(null,"height",s*this._scale+"px"),e.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(e),this._offset=l.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()}),ri(this._element,this._anchor,"marker"),this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=l.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const s=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[s,-1*(38.1-13.5+s)],"bottom-right":[-s,-1*(38.1-13.5+s)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(a){const r=a.code,e=a.charCode||a.keyCode;r!=="Space"&&r!=="Enter"&&e!==32&&e!==13||this.togglePopup()}_onMapClick(a){const r=a.originalEvent.target,e=this._element;this._popup&&(r===e||e.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this}_update(a){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Yt(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let r="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?r=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let e="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?e="rotateX(0deg)":this._pitchAlignment==="map"&&(e=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,`${_t[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${e} ${r}`)}getOffset(){return this._offset}setOffset(a){return this._offset=l.pointGeometry.convert(a),this._update(),this}_onMove(a){if(!this._isDragging){const r=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=r}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Mo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let tn,pn=0,nn=!1;const Xn={maxWidth:100,unit:"metric"};function Rs(w,a,r){const e=r&&r.maxWidth||100,s=w._container.clientHeight/2,u=w.unproject([0,s]),d=w.unproject([e,s]),g=u.distanceTo(d);if(r&&r.unit==="imperial"){const b=3.2808*g;b>5280?Ir(a,e,b/5280,w._getUIString("ScaleControl.Miles")):Ir(a,e,b,w._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Ir(a,e,g/1852,w._getUIString("ScaleControl.NauticalMiles")):g>=1e3?Ir(a,e,g/1e3,w._getUIString("ScaleControl.Kilometers")):Ir(a,e,g,w._getUIString("ScaleControl.Meters"))}function Ir(w,a,r,e){const s=function(u){const d=Math.pow(10,`${Math.floor(u)}`.length-1);let g=u/d;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:function(b){const I=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*I)/I}(g),d*g}(r);w.style.width=a*(s/r)+"px",w.innerHTML=`${s}&nbsp;${e}`}const Oi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function co(w){if(w){if(typeof w=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(w,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,w),"top-left":new l.pointGeometry(a,a),"top-right":new l.pointGeometry(-a,a),bottom:new l.pointGeometry(0,-w),"bottom-left":new l.pointGeometry(a,-a),"bottom-right":new l.pointGeometry(-a,-a),left:new l.pointGeometry(w,0),right:new l.pointGeometry(-w,0)}}if(w instanceof l.pointGeometry||Array.isArray(w)){const a=l.pointGeometry.convert(w);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:l.pointGeometry.convert(w.center||[0,0]),top:l.pointGeometry.convert(w.top||[0,0]),"top-left":l.pointGeometry.convert(w["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(w["top-right"]||[0,0]),bottom:l.pointGeometry.convert(w.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(w["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(w["bottom-right"]||[0,0]),left:l.pointGeometry.convert(w.left||[0,0]),right:l.pointGeometry.convert(w.right||[0,0])}}return co(new l.pointGeometry(0,0))}const Fs={supported:W,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends zr{constructor(w){var a;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(w=l.extend({},Ll,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ms(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new Na,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},ja,w.locale),this._clickTolerance=w.clickTolerance,this._pixelRatio=(a=w.pixelRatio)!==null&&a!==void 0?a:devicePixelRatio,this._requestManager=new me(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window!="undefined"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Gn(this,w),this._hash=w.hash&&new oa(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,l.extend({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new lo({customAttribution:w.customAttribution})),w.maplibreLogo&&this.addControl(new fa,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new l.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new l.Event(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new l.Event("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(w,a){if(a===void 0&&(a=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=w.onAdd(this);this._controls.push(w);const e=this._controlPositions[a];return a.indexOf("bottom")!==-1?e.insertBefore(r,e.firstChild):e.appendChild(r),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(w);return a>-1&&this._controls.splice(a,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}resize(w){const a=this._containerDimensions(),r=a[0],e=a[1];this._resizeCanvas(r,e,this.getPixelRatio()),this.transform.resize(r,e),this.painter.resize(r,e,this.getPixelRatio());const s=!this._moving;return s&&(this.stop(),this.fire(new l.Event("movestart",w)).fire(new l.Event("move",w))),this.fire(new l.Event("resize",w)),s&&this.fire(new l.Event("moveend",w)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(w){const[a,r]=this._containerDimensions();this._pixelRatio=w,this._resizeCanvas(a,r,w),this.painter.resize(a,r,w)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(l.LngLatBounds.convert(w)),this._update()}setMinZoom(w){if((w=w==null?-2:w)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w==null?22:w)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w==null?0:w)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w==null?60:w)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(l.LngLat.convert(w))}unproject(w){return this.transform.pointLocation(l.pointGeometry.convert(w))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(w,a,r){if(w==="mouseenter"||w==="mouseover"){let e=!1;return{layer:a,listener:r,delegates:{mousemove:u=>{const d=this.getLayer(a)?this.queryRenderedFeatures(u.point,{layers:[a]}):[];d.length?e||(e=!0,r.call(this,new Cn(w,this,u.originalEvent,{features:d}))):e=!1},mouseout:()=>{e=!1}}}}if(w==="mouseleave"||w==="mouseout"){let e=!1;return{layer:a,listener:r,delegates:{mousemove:d=>{(this.getLayer(a)?this.queryRenderedFeatures(d.point,{layers:[a]}):[]).length?e=!0:e&&(e=!1,r.call(this,new Cn(w,this,d.originalEvent)))},mouseout:d=>{e&&(e=!1,r.call(this,new Cn(w,this,d.originalEvent)))}}}}{const e=s=>{const u=this.getLayer(a)?this.queryRenderedFeatures(s.point,{layers:[a]}):[];u.length&&(s.features=u,r.call(this,s),delete s.features)};return{layer:a,listener:r,delegates:{[w]:e}}}}on(w,a,r){if(r===void 0)return super.on(w,a);const e=this._createDelegatedListener(w,a,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(e);for(const s in e.delegates)this.on(s,e.delegates[s]);return this}once(w,a,r){if(r===void 0)return super.once(w,a);const e=this._createDelegatedListener(w,a,r);for(const s in e.delegates)this.once(s,e.delegates[s]);return this}off(w,a,r){return r===void 0?super.off(w,a):(this._delegatedListeners&&this._delegatedListeners[w]&&(e=>{const s=this._delegatedListeners[w];for(let u=0;u<s.length;u++){const d=s[u];if(d.layer===a&&d.listener===r){for(const g in d.delegates)this.off(g,d.delegates[g]);return s.splice(u,1),this}}})(),this)}queryRenderedFeatures(w,a){if(!this.style)return[];let r;if(a!==void 0||w===void 0||w instanceof l.pointGeometry||Array.isArray(w)||(a=w,w=void 0),a=a||{},(w=w||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof w[0]=="number")r=[l.pointGeometry.convert(w)];else{const e=l.pointGeometry.convert(w[0]),s=l.pointGeometry.convert(w[1]);r=[e,new l.pointGeometry(s.x,e.y),s,new l.pointGeometry(e.x,s.y),e]}return this.style.queryRenderedFeatures(r,a,this.transform)}querySourceFeatures(w,a){return this.style.querySourceFeatures(w,a)}setStyle(w,a){return(a=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(w,a))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const a=this._locale[w];if(a==null)throw new Error(`Missing UI string '${w}'`);return a}_updateStyle(w,a){return this.style&&(this.style.setEventedParent(null),this.style._remove()),w?(this.style=new gn(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w):this.style.loadJSON(w),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new gn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,a){if(typeof w=="string"){const r=this._requestManager.transformRequest(w,l.ResourceType.Style);l.getJSON(r,(e,s)=>{e?this.fire(new l.ErrorEvent(e)):s&&this._updateDiff(s,a)})}else typeof w=="object"&&this._updateDiff(w,a)}_updateDiff(w,a){try{this.style.setState(w)&&this._update(!0)}catch(r){l.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(w,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(w,a){return this._lazyInitEmptyStyle(),this.style.addSource(w,a),this._update(!0)}isSourceLoaded(w){const a=this.style&&this.style.sourceCaches[w];if(a!==void 0)return a.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${w}'`)))}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const a in w){const r=w[a]._tiles;for(const e in r){const s=r[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}}return!0}addSourceType(w,a,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(w,a,r)}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,a,{pixelRatio:r=1,sdf:e=!1,stretchX:s,stretchY:u,content:d}={}){if(this._lazyInitEmptyStyle(),a instanceof HTMLImageElement||l.isImageBitmap(a)){const{width:g,height:b,data:I}=l.exported.getImageData(a);this.style.addImage(w,{data:new l.RGBAImage({width:g,height:b},I),pixelRatio:r,stretchX:s,stretchY:u,content:d,sdf:e,version:0})}else{if(a.width===void 0||a.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:g,height:b,data:I}=a,k=a;this.style.addImage(w,{data:new l.RGBAImage({width:g,height:b},new Uint8Array(I)),pixelRatio:r,stretchX:s,stretchY:u,content:d,sdf:e,version:0,userImage:k}),k.onAdd&&k.onAdd(this,w)}}}updateImage(w,a){const r=this.style.getImage(w);if(!r)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const e=a instanceof HTMLImageElement||l.isImageBitmap(a)?l.exported.getImageData(a):a,{width:s,height:u,data:d}=e;if(s===void 0||u===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==r.data.width||u!==r.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const g=!(a instanceof HTMLImageElement||l.isImageBitmap(a));r.data.replace(d,g),this.style.updateImage(w,r)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w,a){l.getImage(this._requestManager.transformRequest(w,l.ResourceType.Image),a)}listImages(){return this.style.listImages()}addLayer(w,a){return this._lazyInitEmptyStyle(),this.style.addLayer(w,a),this._update(!0)}moveLayer(w,a){return this.style.moveLayer(w,a),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}setLayerZoomRange(w,a,r){return this.style.setLayerZoomRange(w,a,r),this._update(!0)}setFilter(w,a,r={}){return this.style.setFilter(w,a,r),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,a,r,e={}){return this.style.setPaintProperty(w,a,r,e),this._update(!0)}getPaintProperty(w,a){return this.style.getPaintProperty(w,a)}setLayoutProperty(w,a,r,e={}){return this.style.setLayoutProperty(w,a,r,e),this._update(!0)}getLayoutProperty(w,a){return this.style.getLayoutProperty(w,a)}setLight(w,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,a){return this.style.setFeatureState(w,a),this._update()}removeFeatureState(w,a){return this.style.removeFeatureState(w,a),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,a=0;return this._container&&(w=this._container.clientWidth||400,a=this._container.clientHeight||300),[w,a]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map","mapboxgl-map");const a=this._canvasContainer=Z.create("div","maplibregl-canvas-container mapboxgl-canvas-container",w);this._interactive&&a.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=Z.create("canvas","maplibregl-canvas mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions();this._resizeCanvas(r[0],r[1],this.getPixelRatio());const e=this._controlContainer=Z.create("div","maplibregl-control-container mapboxgl-control-container",w),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(u=>{s[u]=Z.create("div",`maplibregl-ctrl-${u} mapboxgl-ctrl-${u}`,e)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,a,r){this._canvas.width=r*w,this._canvas.height=r*a,this._canvas.style.width=`${w}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const w=l.extend({},W.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",w)||this._canvas.getContext("experimental-webgl",w);a?(this.painter=new na(a,this.transform),l.exported$1.testSupport(a)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(w){w.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:w}))}_contextRestored(w){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:w}))}_onMapScroll(w){if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){let a,r=0;const e=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(a=e.createQueryEXT(),e.beginQueryEXT(e.TIME_ELAPSED_EXT,a),r=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,g=l.exported.now();this.style.zoomHistory.update(d,g);const b=new l.EvaluationParameters(d,{now:g,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=b.crossFadingFactor();I===1&&I===this._crossFadingFactor||(s=!0,this._crossFadingFactor=I),this.style.update(b)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const d=l.exported.now()-r;e.endQueryEXT(e.TIME_ELAPSED_EXT,a),setTimeout(()=>{const g=e.getQueryObjectEXT(a,e.QUERY_RESULT_EXT)/1e6;e.deleteQueryEXT(a),this.fire(new l.Event("gpu-timing-frame",{cpuTime:d,gpuTime:g}))},50)}if(this.listens("gpu-timing-layer")){const d=this.painter.collectGpuTimers();setTimeout(()=>{const g=this.painter.queryGpuTimers(d);this.fire(new l.Event("gpu-timing-layer",{layerTimes:g}))},50)}const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window!="undefined"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Z.remove(this._canvasContainer),Z.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(w=>{l.PerformanceUtils.frame(w),this._frame=null,this._render(w)}))}_onWindowOnline(){this._update()}_onWindowResize(w){this._trackResize&&this.resize({originalEvent:w})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}_setCacheLimits(w,a){l.setCacheLimits(w,a)}},NavigationControl:class{constructor(w){this.options=l.extend({},ys,w),this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const w=this._map.getZoom(),a=w===this._map.getMaxZoom(),r=w===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const w=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=w}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,a){const r=Z.create("button",w,this._container);return r.type="button",r.addEventListener("click",a),r}_setButtonTitle(w,a){const r=this._map._getUIString(`NavigationControl.${a}`);w.title=r,w.setAttribute("aria-label",r)}},GeolocateControl:class extends l.Evented{constructor(w){super(),this.options=l.extend({},Mo,w),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(w){var a;return this._map=w,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),a=this._setupUI,tn!==void 0?a(tn):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(r=>{tn=r.state!=="denied",a(tn)}):(tn=!!window.navigator.geolocation,a(tn)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pn=0,nn=!1}_isOutOfMapMaxBounds(w){const a=this._map.getMaxBounds(),r=w.coords;return a&&(r.longitude<a.getWest()||r.longitude>a.getEast()||r.latitude<a.getSouth()||r.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(w){if(this._map){if(this._isOutOfMapMaxBounds(w))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",w)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=w,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(w),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(w),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",w)),this._finish()}}_updateCamera(w){const a=new l.LngLat(w.coords.longitude,w.coords.latitude),r=w.coords.accuracy,e=this._map.getBearing(),s=l.extend({bearing:e},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(r),s,{geolocateSource:!0})}_updateMarker(w){if(w){const a=new l.LngLat(w.coords.longitude,w.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=w.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const w=this._map._container.clientHeight/2,a=this._map.unproject([0,w]),r=this._map.unproject([1,w]),e=a.distanceTo(r),s=Math.ceil(2*this._accuracy/e);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(w){if(this._map){if(this.options.trackUserLocation)if(w.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(w.code===3&&nn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",w)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(w){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Z.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",w===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new xs(this._dotElement),this._circleElement=Z.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pn--,nn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pn++,pn>1?(w={maximumAge:6e5,timeout:0},nn=!0):(w=this.options.positionOptions,nn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:lo,LogoControl:fa,ScaleControl:class{constructor(w){this.options=l.extend({},Xn,w),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Rs(this._map,this._container,this.options)}onAdd(w){return this._map=w,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(w){this.options.unit=w,Rs(this._map,this._container,this.options)}},FullscreenControl:class{constructor(w){this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const w=this._fullscreenButton=Z.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(w){super(),this.options=l.extend(Object.create(Oi),w),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=l.LngLat.convert(w),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const a=document.createDocumentFragment(),r=document.createElement("body");let e;for(r.innerHTML=w;e=r.firstChild,e;)a.appendChild(e);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Z.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(w){this._update(w.point)}_onMouseMove(w){this._update(w.point)}_onDrag(w){this._update(w.point)}_update(w){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=Z.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(u=>this._container.classList.add(u)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Yt(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!w))return;const a=this._pos=this._trackPointer&&w?w:this._map.project(this._lngLat);let r=this.options.anchor;const e=co(this.options.offset);if(!r){const u=this._container.offsetWidth,d=this._container.offsetHeight;let g;g=a.y+e.bottom.y<d?["top"]:a.y>this._map.transform.height-d?["bottom"]:[],a.x<u/2?g.push("left"):a.x>this._map.transform.width-u/2&&g.push("right"),r=g.length===0?"bottom":g.join("-")}const s=a.add(e[r]).round();Z.setTransform(this._container,`${_t[r]} translate(${s.x}px,${s.y}px)`),ri(this._container,r,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(jr);w&&w.focus()}_onClose(){this.remove()}},Marker:xs,Style:gn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:ei,GeoJSONSource:gi,ImageSource:Ci,RasterDEMTileSource:Ht,RasterTileSource:si,VectorTileSource:Wt,VideoSource:fi,prewarm:function(){br().acquire(Er)},clearPrewarmedResources:function(){const w=bi;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(Er),bi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return Dr.workerCount},set workerCount(w){Dr.workerCount=w},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(w){l.config.MAX_PARALLEL_IMAGE_REQUESTS=w},clearStorage(w){l.clearTileCache(w)},workerUrl:"",addProtocol(w,a){l.config.REGISTERED_PROTOCOLS[w]=a},removeProtocol(w){delete l.config.REGISTERED_PROTOCOLS[w]}};return Ki.extend(Fs,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),Fs});var U=P;return U})})(nm);var Mh=nm.exports;const{document:Dd}=_m;function Ld(C){let y;const T=C[18].default,A=iu(T,C,C[17],null);return{c(){A&&A.c()},l(P){A&&A.l(P)},m(P,O){A&&A.m(P,O),y=!0},p(P,O){A&&A.p&&(!y||O&131072)&&Qc(A,T,P,P[17],y?tu(T,P[17],O,null):eu(P[17]),null)},i(P){y||(Qe(A,P),y=!0)},o(P){mt(A,P),y=!1},d(P){A&&A.d(P)}}}function Bm(C){let y,T,A,P,O=C[2]&&Ld(C);return{c(){y=Ye("link"),T=At(),A=Ye("div"),O&&O.c(),this.h()},l(U){const l=yd('[data-svelte="svelte-xhkxfm"]',Dd.head);y=Je(l,"LINK",{rel:!0,href:!0}),l.forEach(xe),T=kt(U),A=Je(U,"DIV",{id:!0,class:!0});var W=dt(A);O&&O.l(W),W.forEach(xe),this.h()},h(){Re(y,"rel","stylesheet"),Re(y,"href","https://unpkg.com/maplibre-gl@2.1.9/dist/maplibre-gl.css"),Re(A,"id",C[0]),Re(A,"class","map svelte-1tna482")},m(U,l){Be(Dd.head,y),Ke(U,T,l),Ke(U,A,l),O&&O.m(A,null),C[19](A),P=!0},p(U,[l]){U[2]?O?(O.p(U,l),l&4&&Qe(O,1)):(O=Ld(U),O.c(),Qe(O,1),O.m(A,null)):O&&(pr(),mt(O,1,1,()=>{O=null}),dr()),(!P||l&1)&&Re(A,"id",U[0])},i(U){P||(Qe(O),P=!0)},o(U){mt(O),P=!1},d(U){xe(y),U&&xe(T),U&&xe(A),O&&O.d(),C[19](null)}}}function Rm(C=1e3){return new Promise(y=>setTimeout(y,C))}function Fm(C,y,T){let{$$slots:A={},$$scope:P}=y;const O=Lh();let{map:U}=y,{id:l="map"}=y,{location:W={lng:15,lat:45,zoom:1}}=y,{style:$={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=y,{options:ue={}}=y,{minzoom:re=0}=y,{maxzoom:Z=14}=y,{controls:me=!1}=y,{tabbable:_e=!1}=y,{zoom:Fe=null}=y,{center:gt=null}=y,{pitch:zt=null}=y,{bearing:Ct=null}=y,{interactive:it=!0}=y,{attribution:je=!0}=y,nt,ct={},Xe=!1;Pp("map",{getMap:()=>U}),W.bounds?ct.bounds=W.bounds:W.lng&&W.lat&&(ct.center=[+W.lng,+W.lat],W.zoom&&(ct.zoom=+W.zoom),W.pitch&&(ct.pitch=+W.pitch),W.bearing&&(ct.bearing=+W.bearing)),je||(ct.attributionControl=!1),ct=qo(qo({},ct),ue),Ou(()=>{T(3,U=new Mh.Map(qo({container:nt,style:$,minZoom:re,maxZoom:Z,interactive:it},ct))),me&&!Array.isArray(me)?U.addControl(new Mh.NavigationControl({showCompass:!1})):Array.isArray(me)&&me!=["locate"]&&U.addControl(new Mh.NavigationControl({showCompass:me.includes("compass"),visualizePitch:me.includes("pitch")})),Array.isArray(me)&&me.includes("locate")&&U.addControl(new Mh.GeolocateControl),U.on("load",Oe=>{T(4,Fe=U.getZoom()),T(5,gt=U.getCenter()),T(2,Xe=!0),!_e&&document.querySelector(`#${l} canvas`)&&(document.querySelector(`#${l} canvas`).tabIndex="-1"),O("load",{event:Oe})}),U.on("moveend",()=>{T(4,Fe=U.getZoom()),T(5,gt=U.getCenter()),T(6,zt=U.getPitch()),T(7,Ct=U.getBearing())})}),Bh(async()=>{await Rm(250),U&&U.remove(),T(3,U=null)});function at(Oe){U&&U.setStyle(Oe),O("style",{style:Oe})}function rt(Oe){js[Oe?"unshift":"push"](()=>{nt=Oe,T(1,nt)})}return C.$$set=Oe=>{"map"in Oe&&T(3,U=Oe.map),"id"in Oe&&T(0,l=Oe.id),"location"in Oe&&T(8,W=Oe.location),"style"in Oe&&T(9,$=Oe.style),"options"in Oe&&T(10,ue=Oe.options),"minzoom"in Oe&&T(11,re=Oe.minzoom),"maxzoom"in Oe&&T(12,Z=Oe.maxzoom),"controls"in Oe&&T(13,me=Oe.controls),"tabbable"in Oe&&T(14,_e=Oe.tabbable),"zoom"in Oe&&T(4,Fe=Oe.zoom),"center"in Oe&&T(5,gt=Oe.center),"pitch"in Oe&&T(6,zt=Oe.pitch),"bearing"in Oe&&T(7,Ct=Oe.bearing),"interactive"in Oe&&T(15,it=Oe.interactive),"attribution"in Oe&&T(16,je=Oe.attribution),"$$scope"in Oe&&T(17,P=Oe.$$scope)},C.$$.update=()=>{C.$$.dirty&512&&at($)},[l,nt,Xe,U,Fe,gt,zt,Ct,W,$,ue,re,Z,me,_e,it,je,P,A,rt]}class Om extends Qn{constructor(y){super(),es(this,y,Fm,Bm,ts,{map:3,id:0,location:8,style:9,options:10,minzoom:11,maxzoom:12,controls:13,tabbable:14,zoom:4,center:5,pitch:6,bearing:7,interactive:15,attribution:16})}}function Bd(C){let y;const T=C[12].default,A=iu(T,C,C[11],null);return{c(){A&&A.c()},l(P){A&&A.l(P)},m(P,O){A&&A.m(P,O),y=!0},p(P,O){A&&A.p&&(!y||O&2048)&&Qc(A,T,P,P[11],y?tu(T,P[11],O,null):eu(P[11]),null)},i(P){y||(Qe(A,P),y=!0)},o(P){mt(A,P),y=!1},d(P){A&&A.d(P)}}}function Um(C){let y,T,A=C[0]&&Bd(C);return{c(){A&&A.c(),y=Pi()},l(P){A&&A.l(P),y=Pi()},m(P,O){A&&A.m(P,O),Ke(P,y,O),T=!0},p(P,[O]){P[0]?A?(A.p(P,O),O&1&&Qe(A,1)):(A=Bd(P),A.c(),Qe(A,1),A.m(y.parentNode,y)):A&&(pr(),mt(A,1,1,()=>{A=null}),dr())},i(P){T||(Qe(A),T=!0)},o(P){mt(A),T=!1},d(P){A&&A.d(P),P&&xe(y)}}}function Vm(C=1e3){return new Promise(y=>setTimeout(y,C))}function Nm(C,y,T){let{$$slots:A={},$$scope:P}=y,{id:O}=y,{type:U}=y,{url:l=null}=y,{props:W={}}=y,{data:$=null}=y,{layer:ue=null}=y,{promoteId:re=null}=y,{minzoom:Z=null}=y,{maxzoom:me=null}=y,{tilesize:_e=256}=y,Fe=!1;const{getMap:gt}=Yc("map"),zt=gt();Pp("source",{source:O,layer:ue,promoteId:re}),zt.getSource(O)&&zt.removeSource(O);async function Ct(){await Vm(100),zt.isSourceLoaded(O)?(T(0,Fe=!0),console.log(O+" map source loaded!")):(console.log("..."),Ct())}Z&&(W.minzoom=Z),me&&(W.maxzoom=me),ue&&re?(W.promoteId={},W.promoteId[ue]=re):re&&(W.promoteId=re);function it(){console.log(O+" map source loading...");let Xe;U=="geojson"?$?Xe=qo({type:U,data:$},W):l&&(Xe=qo({type:U,data:l},W)):U=="vector"?Xe=qo({type:U,tiles:[l]},W):U=="raster"?Xe=qo({type:U,tiles:[l],tileSize:_e},W):U=="raster-dem"&&(Xe=qo({type:U,tiles:[l],tileSize:_e},W)),Xe&&(zt.addSource(O,Xe),Ct())}it();function je(Xe){let at=zt.getSource(O);at&&at.setData(Xe)}function nt(Xe){let at=zt.getSource(O);at&&at.setTiles([Xe])}function ct(Xe){zt.getSource(O).tiles=[Xe],zt.style.sourceCaches[O].clearTiles(),zt.style.sourceCaches[O].update(zt.transform),zt.triggerRepaint()}return Bh(async()=>{zt&&zt.getSource(O)&&(zt.getStyle().layers.filter(at=>at.source==O).forEach(at=>{zt.removeLayer(at.id)}),zt.removeSource(O))}),C.$$set=Xe=>{"id"in Xe&&T(2,O=Xe.id),"type"in Xe&&T(3,U=Xe.type),"url"in Xe&&T(4,l=Xe.url),"props"in Xe&&T(1,W=Xe.props),"data"in Xe&&T(5,$=Xe.data),"layer"in Xe&&T(6,ue=Xe.layer),"promoteId"in Xe&&T(7,re=Xe.promoteId),"minzoom"in Xe&&T(8,Z=Xe.minzoom),"maxzoom"in Xe&&T(9,me=Xe.maxzoom),"tilesize"in Xe&&T(10,_e=Xe.tilesize),"$$scope"in Xe&&T(11,P=Xe.$$scope)},C.$$.update=()=>{C.$$.dirty&41&&U=="geojson"&&Fe&&je($),C.$$.dirty&25&&U=="vector"&&Fe&&nt(l),C.$$.dirty&25&&U=="raster"&&Fe&&ct(l)},[Fe,W,O,U,l,$,ue,re,Z,me,_e,P,A]}class Dh extends Qn{constructor(y){super(),es(this,y,Nm,Um,ts,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const jm=C=>({hovered:C[0]&1}),Rd=C=>({hovered:C[0]});function qm(C){let y;const T=C[30].default,A=iu(T,C,C[29],Rd);return{c(){A&&A.c()},l(P){A&&A.l(P)},m(P,O){A&&A.m(P,O),y=!0},p(P,O){A&&A.p&&(!y||O[0]&536870913)&&Qc(A,T,P,P[29],y?tu(T,P[29],O,jm):eu(P[29]),Rd)},i(P){y||(Qe(A,P),y=!0)},o(P){mt(A,P),y=!1},d(P){A&&A.d(P)}}}function Gm(C,y,T){let A,{$$slots:P={},$$scope:O}=y;const U=Lh();let{id:l}=y,{type:W}=y,{filter:$=null}=y,{layout:ue={}}=y,{paint:re={}}=y,{data:Z=null}=y,{colorKey:me="color"}=y,{nameKey:_e=null}=y,{valueKey:Fe=null}=y,{idKey:gt=null}=y,{select:zt=!1}=y,{clickIgnore:Ct=!1}=y,{clickCenter:it=!1}=y,{selected:je=null}=y,{hover:nt=!1}=y,{hovered:ct=null}=y,{highlight:Xe=!1}=y,{highlightKey:at="highlighted"}=y,{highlighted:rt=[]}=y,{order:Oe=null}=y,{maxzoom:bt=null}=y,{minzoom:We=null}=y,{sourceLayer:ft=null}=y,{visible:wt=!0}=y;const{source:Ze,layer:De,promoteId:Wt}=Yc("source"),{getMap:si}=Yc("map"),vt=si();Pp("layer",{layer:l});const Ht=zm({id:null,feature:null,event:null});xd(C,Ht,$e=>T(32,A=$e)),Pp("hover",Ht),gt=gt||Wt,ft=ft||De;let gi=null,ui=null,Ci=[];ue.visibility=wt?"visible":"none";let fi={id:l,type:W,source:Ze,paint:re,layout:ue};$&&(fi.filter=$),ft&&(fi["source-layer"]=ft),bt&&(fi.maxzoom=bt),We&&(fi.minzoom=We),vt.getLayer(l)&&vt.removeLayer(l),vt.addLayer(fi,Oe);function ei($e,di=me){if(console.log("updating colors..."),_e||Fe)for(const Ui of $e)vt.setFeatureState({source:Ze,sourceLayer:ft,id:Ui[gt]},{color:di?Ui[di]:null,name:_e?Ui[_e]:null,value:Fe?Ui[Fe]:null});else for(const Ui of $e)vt.setFeatureState({source:Ze,sourceLayer:ft,id:Ui[gt]},{color:Ui[di]})}function _i($e){vt.getLayer(l)&&vt.setFilter(l,$e)}function $i($e){if(vt.getLayer(l))for(const di in $e)vt.setPaintProperty(l,di,$e[di])}function lt($e){vt.getLayer(l)&&vt.setLayoutProperty(l,"visibility",$e?"visible":"none")}return zt&&vt.on("click",l,$e=>{if($e.features.length>0&&!Ct){let di=$e.features[0];if(T(2,je=di.id),U("select",{id:je,feature:di,event:$e}),gi&&vt.setFeatureState({source:Ze,sourceLayer:ft,id:gi},{selected:!1}),vt.setFeatureState({source:Ze,sourceLayer:ft,id:je},{selected:!0}),it){let Ui=centroid($e.features[0].toJSON().geometry);vt.flyTo({center:Ui.geometry.coordinates})}T(26,gi=je)}}),nt&&(vt.on("mousemove",l,$e=>{if($e.features.length>0){ct&&vt.setFeatureState({source:Ze,sourceLayer:ft,id:ct},{hovered:!1});let di=$e.features[0];T(0,ct=T(27,ui=di.id)),Ht.set({id:ct,feature:di,event:$e}),U("hover",A),vt.setFeatureState({source:Ze,sourceLayer:ft,id:ct},{hovered:!0}),vt.getCanvas().style.cursor="pointer"}}),vt.on("mouseleave",l,$e=>{ct&&vt.setFeatureState({source:Ze,sourceLayer:ft,id:ct},{hovered:!1}),T(0,ct=T(27,ui=null)),Ht.set({id:null,feature:null,event:$e}),U("hover",A),vt.getCanvas().style.cursor=""})),Bh(async()=>{vt&&vt.getLayer(l)&&vt.removeLayer(l)}),C.$$set=$e=>{"id"in $e&&T(6,l=$e.id),"type"in $e&&T(7,W=$e.type),"filter"in $e&&T(8,$=$e.filter),"layout"in $e&&T(4,ue=$e.layout),"paint"in $e&&T(9,re=$e.paint),"data"in $e&&T(10,Z=$e.data),"colorKey"in $e&&T(11,me=$e.colorKey),"nameKey"in $e&&T(12,_e=$e.nameKey),"valueKey"in $e&&T(13,Fe=$e.valueKey),"idKey"in $e&&T(5,gt=$e.idKey),"select"in $e&&T(14,zt=$e.select),"clickIgnore"in $e&&T(15,Ct=$e.clickIgnore),"clickCenter"in $e&&T(16,it=$e.clickCenter),"selected"in $e&&T(2,je=$e.selected),"hover"in $e&&T(17,nt=$e.hover),"hovered"in $e&&T(0,ct=$e.hovered),"highlight"in $e&&T(18,Xe=$e.highlight),"highlightKey"in $e&&T(19,at=$e.highlightKey),"highlighted"in $e&&T(20,rt=$e.highlighted),"order"in $e&&T(21,Oe=$e.order),"maxzoom"in $e&&T(22,bt=$e.maxzoom),"minzoom"in $e&&T(23,We=$e.minzoom),"sourceLayer"in $e&&T(3,ft=$e.sourceLayer),"visible"in $e&&T(24,wt=$e.visible),"$$scope"in $e&&T(29,O=$e.$$scope)},C.$$.update=()=>{if(C.$$.dirty[0]&3072&&Z&&ei(Z,me),C.$$.dirty[0]&256&&_i($),C.$$.dirty[0]&512&&$i(re),C.$$.dirty[0]&16777216&&lt(wt),C.$$.dirty[0]&270270472&&Xe&&rt!=Ci){if(Ci[0])for(const $e of Ci){let di={};di[at]=!1,vt.setFeatureState({source:Ze,sourceLayer:ft,id:$e},di)}if(T(28,Ci=rt),rt[0])for(const $e of rt){let di={};di[at]=!0,vt.setFeatureState({source:Ze,sourceLayer:ft,id:$e},di)}}C.$$.dirty[0]&67125260&&zt&&je!=gi&&(gi&&vt.setFeatureState({source:Ze,sourceLayer:ft,id:gi},{selected:!1}),je&&vt.setFeatureState({source:Ze,sourceLayer:ft,id:je},{selected:!0}),T(26,gi=je)),C.$$.dirty[0]&134348809&&nt&&ct!=ui&&(ui&&vt.setFeatureState({source:Ze,sourceLayer:ft,id:ui},{hovered:!1}),ct&&vt.setFeatureState({source:Ze,sourceLayer:ft,id:ct},{hovered:!0}),T(27,ui=ct))},[ct,Ht,je,ft,ue,gt,l,W,$,re,Z,me,_e,Fe,zt,Ct,it,nt,Xe,at,rt,Oe,bt,We,wt,ei,gi,ui,Ci,O,P]}class Fu extends Qn{constructor(y){super(),es(this,y,Gm,qm,ts,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function Zm(C,y,T){let A,{content:P}=y;const O=new Mh.Popup({closeButton:!1,closeOnClick:!1}),{getMap:U}=Yc("map"),l=U(),W=Yc("hover");xd(C,W,ue=>T(2,A=ue));function $(ue,re){ue.id?O.setLngLat(ue.event.lngLat).setHTML(re||ue.code).addTo(l):O.remove()}return Bh(()=>O.remove()),C.$$set=ue=>{"content"in ue&&T(1,P=ue.content)},C.$$.update=()=>{C.$$.dirty&6&&$(A,P)},[W,P,A]}class Xm extends Qn{constructor(y){super(),es(this,y,Zm,null,ts,{content:1})}}function Wm(C,y){var T=C.getCenter(),A=C.getZoom(),P=C.getBearing(),O=C.getPitch();y.forEach(function(U){U.jumpTo({center:T,zoom:A,bearing:P,pitch:O})})}function Hm(){var C,y=arguments.length;if(y===1)C=arguments[0];else{C=[];for(var T=0;T<y;T++)C.push(arguments[T])}var A=[];C.forEach(function(l,W){A[W]=U.bind(null,l,C.filter(function($,ue){return ue!==W}))});function P(){C.forEach(function(l,W){l.on("move",A[W])})}function O(){C.forEach(function(l,W){l.off("move",A[W])})}function U(l,W){O(),Wm(l,W),P()}return P(),function(){O(),A=[]}}var Km=Hm;function Ym(C,y,T){return T={path:y,exports:{},require:function(A,P){return Jm(A,P==null?T.path:P)}},C(T,T.exports),T.exports}function Jm(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var $m;function uc(){}uc.prototype=Object.create(null);function on(){on.init.call(this)}on.EventEmitter=on;on.usingDomains=!1;on.prototype.domain=void 0;on.prototype._events=void 0;on.prototype._maxListeners=void 0;on.defaultMaxListeners=10;on.init=function(){this.domain=null,on.usingDomains&&$m.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new uc,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};on.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||isNaN(y))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=y,this};function om(C){return C._maxListeners===void 0?on.defaultMaxListeners:C._maxListeners}on.prototype.getMaxListeners=function(){return om(this)};function Qm(C,y,T){if(y)C.call(T);else for(var A=C.length,P=Rh(C,A),O=0;O<A;++O)P[O].call(T)}function eg(C,y,T,A){if(y)C.call(T,A);else for(var P=C.length,O=Rh(C,P),U=0;U<P;++U)O[U].call(T,A)}function tg(C,y,T,A,P){if(y)C.call(T,A,P);else for(var O=C.length,U=Rh(C,O),l=0;l<O;++l)U[l].call(T,A,P)}function ig(C,y,T,A,P,O){if(y)C.call(T,A,P,O);else for(var U=C.length,l=Rh(C,U),W=0;W<U;++W)l[W].call(T,A,P,O)}function rg(C,y,T,A){if(y)C.apply(T,A);else for(var P=C.length,O=Rh(C,P),U=0;U<P;++U)O[U].apply(T,A)}on.prototype.emit=function(y){var T,A,P,O,U,l,W,$=y==="error";if(l=this._events,l)$=$&&l.error==null;else if(!$)return!1;if(W=this.domain,$){if(T=arguments[1],W)T||(T=new Error('Uncaught, unspecified "error" event')),T.domainEmitter=this,T.domain=W,T.domainThrown=!1,W.emit("error",T);else{if(T instanceof Error)throw T;var ue=new Error('Uncaught, unspecified "error" event. ('+T+")");throw ue.context=T,ue}return!1}if(A=l[y],!A)return!1;var re=typeof A=="function";switch(P=arguments.length,P){case 1:Qm(A,re,this);break;case 2:eg(A,re,this,arguments[1]);break;case 3:tg(A,re,this,arguments[1],arguments[2]);break;case 4:ig(A,re,this,arguments[1],arguments[2],arguments[3]);break;default:for(O=new Array(P-1),U=1;U<P;U++)O[U-1]=arguments[U];rg(A,re,this,O)}return!0};function am(C,y,T,A){var P,O,U;if(typeof T!="function")throw new TypeError('"listener" argument must be a function');if(O=C._events,O?(O.newListener&&(C.emit("newListener",y,T.listener?T.listener:T),O=C._events),U=O[y]):(O=C._events=new uc,C._eventsCount=0),!U)U=O[y]=T,++C._eventsCount;else if(typeof U=="function"?U=O[y]=A?[T,U]:[U,T]:A?U.unshift(T):U.push(T),!U.warned&&(P=om(C),P&&P>0&&U.length>P)){U.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+y+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=C,l.type=y,l.count=U.length,ng(l)}return C}function ng(C){typeof console.warn=="function"?console.warn(C):console.log(C)}on.prototype.addListener=function(y,T){return am(this,y,T,!1)};on.prototype.on=on.prototype.addListener;on.prototype.prependListener=function(y,T){return am(this,y,T,!0)};function lm(C,y,T){var A=!1;function P(){C.removeListener(y,P),A||(A=!0,T.apply(C,arguments))}return P.listener=T,P}on.prototype.once=function(y,T){if(typeof T!="function")throw new TypeError('"listener" argument must be a function');return this.on(y,lm(this,y,T)),this};on.prototype.prependOnceListener=function(y,T){if(typeof T!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(y,lm(this,y,T)),this};on.prototype.removeListener=function(y,T){var A,P,O,U,l;if(typeof T!="function")throw new TypeError('"listener" argument must be a function');if(P=this._events,!P)return this;if(A=P[y],!A)return this;if(A===T||A.listener&&A.listener===T)--this._eventsCount===0?this._events=new uc:(delete P[y],P.removeListener&&this.emit("removeListener",y,A.listener||T));else if(typeof A!="function"){for(O=-1,U=A.length;U-- >0;)if(A[U]===T||A[U].listener&&A[U].listener===T){l=A[U].listener,O=U;break}if(O<0)return this;if(A.length===1){if(A[0]=void 0,--this._eventsCount===0)return this._events=new uc,this;delete P[y]}else sg(A,O);P.removeListener&&this.emit("removeListener",y,l||T)}return this};on.prototype.removeAllListeners=function(y){var T,A;if(A=this._events,!A)return this;if(!A.removeListener)return arguments.length===0?(this._events=new uc,this._eventsCount=0):A[y]&&(--this._eventsCount===0?this._events=new uc:delete A[y]),this;if(arguments.length===0){for(var P=Object.keys(A),O=0,U;O<P.length;++O)U=P[O],U!=="removeListener"&&this.removeAllListeners(U);return this.removeAllListeners("removeListener"),this._events=new uc,this._eventsCount=0,this}if(T=A[y],typeof T=="function")this.removeListener(y,T);else if(T)do this.removeListener(y,T[T.length-1]);while(T[0]);return this};on.prototype.listeners=function(y){var T,A,P=this._events;return P?(T=P[y],T?typeof T=="function"?A=[T.listener||T]:A=og(T):A=[]):A=[],A};on.listenerCount=function(C,y){return typeof C.listenerCount=="function"?C.listenerCount(y):cm.call(C,y)};on.prototype.listenerCount=cm;function cm(C){var y=this._events;if(y){var T=y[C];if(typeof T=="function")return 1;if(T)return T.length}return 0}on.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function sg(C,y){for(var T=y,A=T+1,P=C.length;A<P;T+=1,A+=1)C[T]=C[A];C.pop()}function Rh(C,y){for(var T=new Array(y);y--;)T[y]=C[y];return T}function og(C){for(var y=new Array(C.length),T=0;T<y.length;++T)y[T]=C[T].listener||C[T];return y}var ag=Object.freeze({__proto__:null,default:on,EventEmitter:on}),lg=Ym(function(C){var y=ag.EventEmitter;function T(A,P,O,U){if(this.options=U||{},this._mapA=A,this._mapB=P,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new y,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof O=="string"&&document.body.querySelectorAll){var l=document.body.querySelectorAll(O)[0];if(!l)throw new Error("Cannot find element with specified container selector.");l.appendChild(this._controlContainer)}else if(O instanceof Element&&O.appendChild)O.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=P.getContainer().getBoundingClientRect();var W=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(W),this._clearSync=Km(A,P),this._onResize=function(){this._bounds=P.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}.bind(this),P.on("resize",this._onResize),this.options&&this.options.mousemove&&(A.getContainer().addEventListener("mousemove",this._onMove),P.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}T.prototype={_setPointerEvents:function(A){this._controlContainer.style.pointerEvents=A,this._swiper.style.pointerEvents=A},_onDown:function(A){A.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(A){A=Math.min(A,this._horizontal?this._bounds.height:this._bounds.width);var P=this._horizontal?"translate(0, "+A+"px)":"translate("+A+"px, 0)";this._controlContainer.style.transform=P,this._controlContainer.style.WebkitTransform=P;var O=this._horizontal?"rect(0, 999em, "+A+"px, 0)":"rect(0, "+A+"px, "+this._bounds.height+"px, 0)",U=this._horizontal?"rect("+A+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+A+"px)";this._mapA.getContainer().style.clip=O,this._mapB.getContainer().style.clip=U,this.currentPosition=A},_onMove:function(A){this.options&&this.options.mousemove&&this._setPointerEvents(A.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(A)):this._setPosition(this._getX(A))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(A){A=A.touches?A.touches[0]:A;var P=A.clientX-this._bounds.left;return P<0&&(P=0),P>this._bounds.width&&(P=this._bounds.width),P},_getY:function(A){A=A.touches?A.touches[0]:A;var P=A.clientY-this._bounds.top;return P<0&&(P=0),P>this._bounds.height&&(P=this._bounds.height),P},setSlider:function(A){this._setPosition(A)},on:function(A,P){return this._ev.on(A,P),this},fire:function(A,P){return this._ev.emit(A,P),this},off:function(A,P){return this._ev.removeListener(A,P),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var A=this._mapA.getContainer();A&&(A.style.clip=null,A.removeEventListener("mousemove",this._onMove));var P=this._mapB.getContainer();P&&(P.style.clip=null,P.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},C.exports=T});function cg(C){let y,T,A,P;const O=C[6].default,U=iu(O,C,C[5],null);return{c(){y=Ye("link"),T=At(),A=Ye("div"),U&&U.c(),this.h()},l(l){const W=yd('[data-svelte="svelte-pzwhem"]',document.head);y=Je(W,"LINK",{href:!0,rel:!0}),W.forEach(xe),T=kt(l),A=Je(l,"DIV",{id:!0,class:!0});var $=dt(A);U&&U.l($),$.forEach(xe),this.h()},h(){Re(y,"href","https://unpkg.com/@maplibre/maplibre-gl-compare@0.5.0/dist/maplibre-gl-compare.css"),Re(y,"rel","stylesheet"),Re(A,"id","comparison-container"),Re(A,"class","svelte-wyhxu8")},m(l,W){Be(document.head,y),Ke(l,T,W),Ke(l,A,W),U&&U.m(A,null),C[7](A),P=!0},p(l,[W]){U&&U.p&&(!P||W&32)&&Qc(U,O,l,l[5],P?tu(O,l[5],W,null):eu(l[5]),null)},i(l){P||(Qe(U,l),P=!0)},o(l){mt(U,l),P=!1},d(l){xe(y),l&&xe(T),l&&xe(A),U&&U.d(l),C[7](null)}}}function ug(C,y,T){let{$$slots:A={},$$scope:P}=y,{mapLeft:O}=y,{mapRight:U}=y,l,W,$=!1;function ue(re){js[re?"unshift":"push"](()=>{W=re,T(0,W)})}return C.$$set=re=>{"mapLeft"in re&&T(1,O=re.mapLeft),"mapRight"in re&&T(2,U=re.mapRight),"$$scope"in re&&T(5,P=re.$$scope)},C.$$.update=()=>{C.$$.dirty&23&&!$&&window&&W&&O&&U&&(T(3,l=new lg(O,U,W,{})),T(4,$=!0)),C.$$.dirty&30&&$&&(!O||!U)&&(l.remove(),T(3,l=null),T(4,$=!1))},[W,O,U,l,$,P,A,ue]}class hg extends Qn{constructor(y){super(),es(this,y,ug,cg,ts,{mapLeft:1,mapRight:2})}}function pg(C,y,T){let{exaggeration:A=.15}=y;const{source:P}=Yc("source"),{getMap:O}=Yc("map"),U=O();return Ou(()=>{console.log("setting terrain"),U.setTerrain({source:P,exaggeration:A})}),Bh(()=>{U&&U.setTerrain()}),C.$$set=l=>{"exaggeration"in l&&T(0,A=l.exaggeration)},[A]}class dg extends Qn{constructor(y){super(),es(this,y,pg,null,ts,{exaggeration:0})}}function fg(C,y){const T=C.getBoundingClientRect(),A=y.getBoundingClientRect(),P={};return P.top=T.top<0,P.left=T.left<0,P.bottom=T.bottom+A.height>(window.innerHeight||document.documentElement.clientHeight),P.right=T.right>(window.innerWidth||document.documentElement.clientWidth),P.any=P.top||P.left||P.bottom||P.right,P}function mg(C){let y,T=C[0](C[1],C[2])+"",A;return{c(){y=Ye("div"),this.h()},l(P){y=Je(P,"DIV",{class:!0});var O=dt(y);O.forEach(xe),this.h()},h(){Re(y,"class",A="item "+C[3]+" svelte-3e0qet")},m(P,O){Ke(P,y,O),y.innerHTML=T},p(P,[O]){O&7&&T!==(T=P[0](P[1],P[2])+"")&&(y.innerHTML=T),O&8&&A!==(A="item "+P[3]+" svelte-3e0qet")&&Re(y,"class",A)},i:ds,o:ds,d(P){P&&xe(y)}}}function gg(C,y,T){let{isActive:A=!1}=y,{isFirst:P=!1}=y,{isHover:O=!1}=y,{isSelectable:U=!1}=y,{getOptionLabel:l=void 0}=y,{item:W=void 0}=y,{filterText:$=""}=y,ue="";return C.$$set=re=>{"isActive"in re&&T(4,A=re.isActive),"isFirst"in re&&T(5,P=re.isFirst),"isHover"in re&&T(6,O=re.isHover),"isSelectable"in re&&T(7,U=re.isSelectable),"getOptionLabel"in re&&T(0,l=re.getOptionLabel),"item"in re&&T(1,W=re.item),"filterText"in re&&T(2,$=re.filterText)},C.$$.update=()=>{if(C.$$.dirty&242){const re=[];A&&re.push("active"),P&&re.push("first"),O&&re.push("hover"),W.isGroupHeader&&re.push("groupHeader"),W.isGroupItem&&re.push("groupItem"),U||re.push("notSelectable"),T(3,ue=re.join(" "))}},[l,W,$,ue,A,P,O,U]}class um extends Qn{constructor(y){super(),es(this,y,gg,mg,ts,{isActive:4,isFirst:5,isHover:6,isSelectable:7,getOptionLabel:0,item:1,filterText:2})}}function Fd(C,y,T){const A=C.slice();return A[41]=y[T],A[42]=T,A}function _g(C){let y,T,A=C[1],P=[];for(let l=0;l<A.length;l+=1)P[l]=Vd(Fd(C,A,l));const O=l=>mt(P[l],1,1,()=>{P[l]=null});let U=null;return A.length||(U=Od(C)),{c(){for(let l=0;l<P.length;l+=1)P[l].c();y=Pi(),U&&U.c()},l(l){for(let W=0;W<P.length;W+=1)P[W].l(l);y=Pi(),U&&U.l(l)},m(l,W){for(let $=0;$<P.length;$+=1)P[$].m(l,W);Ke(l,y,W),U&&U.m(l,W),T=!0},p(l,W){if(W[0]&114390){A=l[1];let $;for($=0;$<A.length;$+=1){const ue=Fd(l,A,$);P[$]?(P[$].p(ue,W),Qe(P[$],1)):(P[$]=Vd(ue),P[$].c(),Qe(P[$],1),P[$].m(y.parentNode,y))}for(pr(),$=A.length;$<P.length;$+=1)O($);dr(),!A.length&&U?U.p(l,W):A.length?U&&(U.d(1),U=null):(U=Od(l),U.c(),U.m(y.parentNode,y))}},i(l){if(!T){for(let W=0;W<A.length;W+=1)Qe(P[W]);T=!0}},o(l){P=P.filter(Boolean);for(let W=0;W<P.length;W+=1)mt(P[W]);T=!1},d(l){tl(P,l),l&&xe(y),U&&U.d(l)}}}function yg(C){let y,T,A;var P=C[3];function O(U){return{props:{items:U[1],itemHeight:U[8],$$slots:{default:[bg,({item:l,i:W})=>({41:l,42:W}),({item:l,i:W})=>[0,(l?1024:0)|(W?2048:0)]]},$$scope:{ctx:U}}}}return P&&(y=new P(O(C))),{c(){y&&ai(y.$$.fragment),T=Pi()},l(U){y&&Si(y.$$.fragment,U),T=Pi()},m(U,l){y&&li(y,U,l),Ke(U,T,l),A=!0},p(U,l){const W={};if(l[0]&2&&(W.items=U[1]),l[0]&256&&(W.itemHeight=U[8]),l[0]&9814|l[1]&11264&&(W.$$scope={dirty:l,ctx:U}),P!==(P=U[3])){if(y){pr();const $=y;mt($.$$.fragment,1,0,()=>{ci($,1)}),dr()}P?(y=new P(O(U)),ai(y.$$.fragment),Qe(y.$$.fragment,1),li(y,T.parentNode,T)):y=null}else P&&y.$set(W)},i(U){A||(y&&Qe(y.$$.fragment,U),A=!0)},o(U){y&&mt(y.$$.fragment,U),A=!1},d(U){U&&xe(T),y&&ci(y,U)}}}function Od(C){let y,T=!C[11]&&Ud(C);return{c(){T&&T.c(),y=Pi()},l(A){T&&T.l(A),y=Pi()},m(A,P){T&&T.m(A,P),Ke(A,y,P)},p(A,P){A[11]?T&&(T.d(1),T=null):T?T.p(A,P):(T=Ud(A),T.c(),T.m(y.parentNode,y))},d(A){T&&T.d(A),A&&xe(y)}}}function Ud(C){let y,T;return{c(){y=Ye("div"),T=Jt(C[12]),this.h()},l(A){y=Je(A,"DIV",{class:!0});var P=dt(y);T=$t(P,C[12]),P.forEach(xe),this.h()},h(){Re(y,"class","empty svelte-1uyqfml")},m(A,P){Ke(A,y,P),Be(y,T)},p(A,P){P[0]&4096&&Kr(T,A[12])},d(A){A&&xe(y)}}}function xg(C){let y,T,A,P,O,U;var l=C[4];function W(Z){return{props:{item:Z[41],filterText:Z[13],getOptionLabel:Z[6],isFirst:_d(Z[42]),isActive:Mp(Z[41],Z[9],Z[10]),isHover:Dp(Z[2],Z[41],Z[42],Z[1]),isSelectable:Jc(Z[41])}}}l&&(T=new l(W(C)));function $(){return C[29](C[42])}function ue(){return C[30](C[42])}function re(...Z){return C[31](C[41],C[42],...Z)}return{c(){y=Ye("div"),T&&ai(T.$$.fragment),A=At(),this.h()},l(Z){y=Je(Z,"DIV",{class:!0,tabindex:!0});var me=dt(y);T&&Si(T.$$.fragment,me),A=kt(me),me.forEach(xe),this.h()},h(){Re(y,"class","listItem"),Re(y,"tabindex","-1")},m(Z,me){Ke(Z,y,me),T&&li(T,y,null),Be(y,A),P=!0,O||(U=[nr(y,"mouseover",$),nr(y,"focus",ue),nr(y,"click",re)],O=!0)},p(Z,me){C=Z;const _e={};if(me[0]&2&&(_e.item=C[41]),me[0]&8192&&(_e.filterText=C[13]),me[0]&64&&(_e.getOptionLabel=C[6]),me[0]&1538&&(_e.isActive=Mp(C[41],C[9],C[10])),me[0]&6&&(_e.isHover=Dp(C[2],C[41],C[42],C[1])),me[0]&2&&(_e.isSelectable=Jc(C[41])),l!==(l=C[4])){if(T){pr();const Fe=T;mt(Fe.$$.fragment,1,0,()=>{ci(Fe,1)}),dr()}l?(T=new l(W(C)),ai(T.$$.fragment),Qe(T.$$.fragment,1),li(T,y,A)):T=null}else l&&T.$set(_e)},i(Z){P||(T&&Qe(T.$$.fragment,Z),P=!0)},o(Z){T&&mt(T.$$.fragment,Z),P=!1},d(Z){Z&&xe(y),T&&ci(T),O=!1,ru(U)}}}function vg(C){let y,T=C[7](C[41])+"",A;return{c(){y=Ye("div"),A=Jt(T),this.h()},l(P){y=Je(P,"DIV",{class:!0});var O=dt(y);A=$t(O,T),O.forEach(xe),this.h()},h(){Re(y,"class","listGroupTitle svelte-1uyqfml")},m(P,O){Ke(P,y,O),Be(y,A)},p(P,O){O[0]&130&&T!==(T=P[7](P[41])+"")&&Kr(A,T)},i:ds,o:ds,d(P){P&&xe(y)}}}function Vd(C){let y,T,A,P;const O=[vg,xg],U=[];function l(W,$){return W[41].isGroupHeader&&!W[41].isSelectable?0:1}return y=l(C),T=U[y]=O[y](C),{c(){T.c(),A=Pi()},l(W){T.l(W),A=Pi()},m(W,$){U[y].m(W,$),Ke(W,A,$),P=!0},p(W,$){let ue=y;y=l(W),y===ue?U[y].p(W,$):(pr(),mt(U[ue],1,1,()=>{U[ue]=null}),dr(),T=U[y],T?T.p(W,$):(T=U[y]=O[y](W),T.c()),Qe(T,1),T.m(A.parentNode,A))},i(W){P||(Qe(T),P=!0)},o(W){mt(T),P=!1},d(W){U[y].d(W),W&&xe(A)}}}function bg(C){let y,T,A,P,O;var U=C[4];function l(re){return{props:{item:re[41],filterText:re[13],getOptionLabel:re[6],isFirst:_d(re[42]),isActive:Mp(re[41],re[9],re[10]),isHover:Dp(re[2],re[41],re[42],re[1]),isSelectable:Jc(re[41])}}}U&&(T=new U(l(C)));function W(){return C[26](C[42])}function $(){return C[27](C[42])}function ue(...re){return C[28](C[41],C[42],...re)}return{c(){y=Ye("div"),T&&ai(T.$$.fragment),this.h()},l(re){y=Je(re,"DIV",{class:!0});var Z=dt(y);T&&Si(T.$$.fragment,Z),Z.forEach(xe),this.h()},h(){Re(y,"class","listItem")},m(re,Z){Ke(re,y,Z),T&&li(T,y,null),A=!0,P||(O=[nr(y,"mouseover",W),nr(y,"focus",$),nr(y,"click",ue)],P=!0)},p(re,Z){C=re;const me={};if(Z[1]&1024&&(me.item=C[41]),Z[0]&8192&&(me.filterText=C[13]),Z[0]&64&&(me.getOptionLabel=C[6]),Z[1]&2048&&(me.isFirst=_d(C[42])),Z[0]&1536|Z[1]&1024&&(me.isActive=Mp(C[41],C[9],C[10])),Z[0]&6|Z[1]&3072&&(me.isHover=Dp(C[2],C[41],C[42],C[1])),Z[1]&1024&&(me.isSelectable=Jc(C[41])),U!==(U=C[4])){if(T){pr();const _e=T;mt(_e.$$.fragment,1,0,()=>{ci(_e,1)}),dr()}U?(T=new U(l(C)),ai(T.$$.fragment),Qe(T.$$.fragment,1),li(T,y,null)):T=null}else U&&T.$set(me)},i(re){A||(T&&Qe(T.$$.fragment,re),A=!0)},o(re){T&&mt(T.$$.fragment,re),A=!1},d(re){re&&xe(y),T&&ci(T),P=!1,ru(O)}}}function wg(C){let y,T,A,P,O,U;const l=[yg,_g],W=[];function $(ue,re){return ue[5]?0:1}return T=$(C),A=W[T]=l[T](C),{c(){y=Ye("div"),A.c(),this.h()},l(ue){y=Je(ue,"DIV",{class:!0,style:!0});var re=dt(y);A.l(re),re.forEach(xe),this.h()},h(){Re(y,"class","listContainer svelte-1uyqfml"),Re(y,"style",C[14]),qi(y,"virtualList",C[5])},m(ue,re){Ke(ue,y,re),W[T].m(y,null),C[32](y),P=!0,O||(U=[nr(window,"keydown",C[17]),nr(window,"resize",C[18])],O=!0)},p(ue,re){let Z=T;T=$(ue),T===Z?W[T].p(ue,re):(pr(),mt(W[Z],1,1,()=>{W[Z]=null}),dr(),A=W[T],A?A.p(ue,re):(A=W[T]=l[T](ue),A.c()),Qe(A,1),A.m(y,null)),(!P||re[0]&16384)&&Re(y,"style",ue[14]),re[0]&32&&qi(y,"virtualList",ue[5])},i(ue){P||(Qe(A),P=!0)},o(ue){mt(A),P=!1},d(ue){ue&&xe(y),W[T].d(),C[32](null),O=!1,ru(U)}}}function Mp(C,y,T){return y&&y[T]===C[T]}function _d(C){return C===0}function Dp(C,y,T,A){return Jc(y)&&(C===T||A.length===1)}function Jc(C){return C.isGroupHeader&&C.isSelectable||C.selectable||!C.hasOwnProperty("selectable")}function Tg(C,y,T){const A=Lh();let{container:P=void 0}=y,{VirtualList:O=null}=y,{Item:U=um}=y,{isVirtualList:l=!1}=y,{items:W=[]}=y,{labelIdentifier:$="label"}=y,{getOptionLabel:ue=(lt,$e)=>{if(lt)return lt.isCreator?`Create "${$e}"`:lt[$]}}=y,{getGroupHeaderLabel:re=null}=y,{itemHeight:Z=40}=y,{hoverItemIndex:me=0}=y,{value:_e=void 0}=y,{optionIdentifier:Fe="value"}=y,{hideEmptyState:gt=!1}=y,{noOptionsMessage:zt="No options"}=y,{isMulti:Ct=!1}=y,{activeItemIndex:it=0}=y,{filterText:je=""}=y,{parent:nt=null}=y,{listPlacement:ct=null}=y,{listAutoWidth:Xe=null}=y,{listOffset:at=5}=y,rt=0,Oe=!1,bt;Ou(()=>{if(W.length>0&&!Ct&&_e){const lt=W.findIndex($e=>$e[Fe]===_e[Fe]);lt&&T(2,me=lt)}si("active"),P.addEventListener("scroll",()=>{clearTimeout(rt),rt=setTimeout(()=>{Oe=!1},100)},!1)}),Qf(()=>{W||T(1,W=[]),W!==bt&&W.length>0&&T(2,me=0),bt=W});function We(lt){lt.isCreator||A("itemSelected",lt)}function ft(lt){Oe||T(2,me=lt)}function wt(lt){const{item:$e,i:di,event:Ui}=lt;if(Ui.stopPropagation(),_e&&!Ct&&_e[Fe]===$e[Fe])return Ze();$e.isCreator?A("itemCreated",je):Jc($e)&&(T(19,it=di),T(2,me=di),We($e))}function Ze(){A("closeList")}async function De(lt){if(l)return;let $e=!0;for(;$e;)lt>0&&me===W.length-1?T(2,me=0):lt<0&&me===0?T(2,me=W.length-1):T(2,me=me+lt),$e=!Jc(W[me]);await Cp(),si("hover")}function Wt(lt){switch(lt.key){case"Escape":lt.preventDefault(),Ze();break;case"ArrowDown":lt.preventDefault(),W.length&&De(1);break;case"ArrowUp":lt.preventDefault(),W.length&&De(-1);break;case"Enter":if(lt.preventDefault(),W.length===0)break;const $e=W[me];if(_e&&!Ct&&_e[Fe]===$e[Fe]){Ze();break}$e.isCreator?A("itemCreated",je):(T(19,it=me),We(W[me]));break;case"Tab":if(lt.preventDefault(),W.length===0||_e&&_e[Fe]===W[me][Fe])return Ze();T(19,it=me),We(W[me]);break}}function si(lt){if(l||!P)return;let $e;const di=P.querySelector(`.listItem .${lt}`);di&&($e=P.getBoundingClientRect().bottom-di.getBoundingClientRect().bottom),T(0,P.scrollTop-=$e,P)}let vt;function Ht(){const{height:lt,width:$e}=nt.getBoundingClientRect();T(14,vt=""),T(14,vt+=`min-width:${$e}px;width:${Xe?"auto":"100%"};`),ct==="top"||ct==="auto"&&fg(nt,P).bottom?T(14,vt+=`bottom:${lt+at}px;`):T(14,vt+=`top:${lt+at}px;`)}const gi=lt=>ft(lt),ui=lt=>ft(lt),Ci=(lt,$e,di)=>wt({item:lt,i:$e,event:di}),fi=lt=>ft(lt),ei=lt=>ft(lt),_i=(lt,$e,di)=>wt({item:lt,i:$e,event:di});function $i(lt){js[lt?"unshift":"push"](()=>{P=lt,T(0,P)})}return C.$$set=lt=>{"container"in lt&&T(0,P=lt.container),"VirtualList"in lt&&T(3,O=lt.VirtualList),"Item"in lt&&T(4,U=lt.Item),"isVirtualList"in lt&&T(5,l=lt.isVirtualList),"items"in lt&&T(1,W=lt.items),"labelIdentifier"in lt&&T(20,$=lt.labelIdentifier),"getOptionLabel"in lt&&T(6,ue=lt.getOptionLabel),"getGroupHeaderLabel"in lt&&T(7,re=lt.getGroupHeaderLabel),"itemHeight"in lt&&T(8,Z=lt.itemHeight),"hoverItemIndex"in lt&&T(2,me=lt.hoverItemIndex),"value"in lt&&T(9,_e=lt.value),"optionIdentifier"in lt&&T(10,Fe=lt.optionIdentifier),"hideEmptyState"in lt&&T(11,gt=lt.hideEmptyState),"noOptionsMessage"in lt&&T(12,zt=lt.noOptionsMessage),"isMulti"in lt&&T(21,Ct=lt.isMulti),"activeItemIndex"in lt&&T(19,it=lt.activeItemIndex),"filterText"in lt&&T(13,je=lt.filterText),"parent"in lt&&T(22,nt=lt.parent),"listPlacement"in lt&&T(23,ct=lt.listPlacement),"listAutoWidth"in lt&&T(24,Xe=lt.listAutoWidth),"listOffset"in lt&&T(25,at=lt.listOffset)},C.$$.update=()=>{C.$$.dirty[0]&4194305&&nt&&P&&Ht()},[P,W,me,O,U,l,ue,re,Z,_e,Fe,gt,zt,je,vt,ft,wt,Wt,Ht,it,$,Ct,nt,ct,Xe,at,gi,ui,Ci,fi,ei,_i,$i]}class Ig extends Qn{constructor(y){super(),es(this,y,Tg,wg,ts,{container:0,VirtualList:3,Item:4,isVirtualList:5,items:1,labelIdentifier:20,getOptionLabel:6,getGroupHeaderLabel:7,itemHeight:8,hoverItemIndex:2,value:9,optionIdentifier:10,hideEmptyState:11,noOptionsMessage:12,isMulti:21,activeItemIndex:19,filterText:13,parent:22,listPlacement:23,listAutoWidth:24,listOffset:25},null,[-1,-1])}}function Sg(C){let y,T=C[0](C[1])+"";return{c(){y=Ye("div"),this.h()},l(A){y=Je(A,"DIV",{class:!0});var P=dt(y);P.forEach(xe),this.h()},h(){Re(y,"class","selection svelte-pu1q1n")},m(A,P){Ke(A,y,P),y.innerHTML=T},p(A,[P]){P&3&&T!==(T=A[0](A[1])+"")&&(y.innerHTML=T)},i:ds,o:ds,d(A){A&&xe(y)}}}function Eg(C,y,T){let{getSelectionLabel:A=void 0}=y,{item:P=void 0}=y;return C.$$set=O=>{"getSelectionLabel"in O&&T(0,A=O.getSelectionLabel),"item"in O&&T(1,P=O.item)},[A,P]}class Ag extends Qn{constructor(y){super(),es(this,y,Eg,Sg,ts,{getSelectionLabel:0,item:1})}}function Nd(C,y,T){const A=C.slice();return A[9]=y[T],A[11]=T,A}function jd(C){let y,T,A,P,O;function U(...l){return C[6](C[11],...l)}return{c(){y=Ye("div"),T=hc("svg"),A=hc("path"),this.h()},l(l){y=Je(l,"DIV",{class:!0});var W=dt(y);T=pc(W,"svg",{width:!0,height:!0,viewBox:!0,focusable:!0,"aria-hidden":!0,role:!0,class:!0});var $=dt(T);A=pc($,"path",{d:!0}),dt(A).forEach(xe),$.forEach(xe),W.forEach(xe),this.h()},h(){Re(A,"d","M34.923,37.251L24,26.328L13.077,37.251L9.436,33.61l10.923-10.923L9.436,11.765l3.641-3.641L24,19.047L34.923,8.124 l3.641,3.641L27.641,22.688L38.564,33.61L34.923,37.251z"),Re(T,"width","100%"),Re(T,"height","100%"),Re(T,"viewBox","-2 -2 50 50"),Re(T,"focusable","false"),Re(T,"aria-hidden","true"),Re(T,"role","presentation"),Re(T,"class","svelte-liu9pa"),Re(y,"class","multiSelectItem_clear svelte-liu9pa")},m(l,W){Ke(l,y,W),Be(y,T),Be(T,A),P||(O=nr(y,"click",U),P=!0)},p(l,W){C=l},d(l){l&&xe(y),P=!1,O()}}}function qd(C){let y,T,A=C[4](C[9])+"",P,O,U,l,W,$=!C[2]&&!C[3]&&jd(C);function ue(...re){return C[7](C[11],...re)}return{c(){y=Ye("div"),T=Ye("div"),P=At(),$&&$.c(),O=At(),this.h()},l(re){y=Je(re,"DIV",{class:!0});var Z=dt(y);T=Je(Z,"DIV",{class:!0});var me=dt(T);me.forEach(xe),P=kt(Z),$&&$.l(Z),O=kt(Z),Z.forEach(xe),this.h()},h(){Re(T,"class","multiSelectItem_label svelte-liu9pa"),Re(y,"class",U="multiSelectItem "+(C[1]===C[11]?"active":"")+" "+(C[2]?"disabled":"")+" svelte-liu9pa")},m(re,Z){Ke(re,y,Z),Be(y,T),T.innerHTML=A,Be(y,P),$&&$.m(y,null),Be(y,O),l||(W=nr(y,"click",ue),l=!0)},p(re,Z){C=re,Z&17&&A!==(A=C[4](C[9])+"")&&(T.innerHTML=A),!C[2]&&!C[3]?$?$.p(C,Z):($=jd(C),$.c(),$.m(y,O)):$&&($.d(1),$=null),Z&6&&U!==(U="multiSelectItem "+(C[1]===C[11]?"active":"")+" "+(C[2]?"disabled":"")+" svelte-liu9pa")&&Re(y,"class",U)},d(re){re&&xe(y),$&&$.d(),l=!1,W()}}}function kg(C){let y,T=C[0],A=[];for(let P=0;P<T.length;P+=1)A[P]=qd(Nd(C,T,P));return{c(){for(let P=0;P<A.length;P+=1)A[P].c();y=Pi()},l(P){for(let O=0;O<A.length;O+=1)A[O].l(P);y=Pi()},m(P,O){for(let U=0;U<A.length;U+=1)A[U].m(P,O);Ke(P,y,O)},p(P,[O]){if(O&63){T=P[0];let U;for(U=0;U<T.length;U+=1){const l=Nd(P,T,U);A[U]?A[U].p(l,O):(A[U]=qd(l),A[U].c(),A[U].m(y.parentNode,y))}for(;U<A.length;U+=1)A[U].d(1);A.length=T.length}},i:ds,o:ds,d(P){tl(A,P),P&&xe(y)}}}function zg(C,y,T){const A=Lh();let{value:P=[]}=y,{activeValue:O=void 0}=y,{isDisabled:U=!1}=y,{multiFullItemClearable:l=!1}=y,{getSelectionLabel:W=void 0}=y;function $(Z,me){me.stopPropagation(),A("multiItemClear",{i:Z})}const ue=(Z,me)=>$(Z,me),re=(Z,me)=>l?$(Z,me):{};return C.$$set=Z=>{"value"in Z&&T(0,P=Z.value),"activeValue"in Z&&T(1,O=Z.activeValue),"isDisabled"in Z&&T(2,U=Z.isDisabled),"multiFullItemClearable"in Z&&T(3,l=Z.multiFullItemClearable),"getSelectionLabel"in Z&&T(4,W=Z.getSelectionLabel)},[P,O,U,l,W,$,ue,re]}class Cg extends Qn{constructor(y){super(),es(this,y,zg,kg,ts,{value:0,activeValue:1,isDisabled:2,multiFullItemClearable:3,getSelectionLabel:4})}}function Gd(C,y,T){const A=C.slice();return A[23]=y[T],A}const Pg=C=>({item:C&32,i:C&32,hoverItemIndex:C&2}),Zd=C=>({item:C[23].data,i:C[23].index,hoverItemIndex:C[1]});function Mg(C){let y;return{c(){y=Jt("Missing template")},l(T){y=$t(T,"Missing template")},m(T,A){Ke(T,y,A)},d(T){T&&xe(y)}}}function Xd(C,y){let T,A,P;const O=y[15].default,U=iu(O,y,y[14],Zd),l=U||Mg();return{key:C,first:null,c(){T=Ye("svelte-virtual-list-row"),l&&l.c(),A=At(),this.h()},l(W){T=Je(W,"SVELTE-VIRTUAL-LIST-ROW",{class:!0});var $=dt(T);l&&l.l($),A=kt($),$.forEach(xe),this.h()},h(){md(T,"class","svelte-g2cagw"),this.first=T},m(W,$){Ke(W,T,$),l&&l.m(T,null),Be(T,A),P=!0},p(W,$){y=W,U&&U.p&&(!P||$&16418)&&Qc(U,O,y,y[14],P?tu(O,y[14],$,Pg):eu(y[14]),Zd)},i(W){P||(Qe(l,W),P=!0)},o(W){mt(l,W),P=!1},d(W){W&&xe(T),l&&l.d(W)}}}function Dg(C){let y,T,A=[],P=new Map,O,U,l,W,$=C[5];const ue=re=>re[23].index;for(let re=0;re<$.length;re+=1){let Z=Gd(C,$,re),me=ue(Z);P.set(me,A[re]=Xd(me,Z))}return{c(){y=Ye("svelte-virtual-list-viewport"),T=Ye("svelte-virtual-list-contents");for(let re=0;re<A.length;re+=1)A[re].c();this.h()},l(re){y=Je(re,"SVELTE-VIRTUAL-LIST-VIEWPORT",{style:!0,class:!0});var Z=dt(y);T=Je(Z,"SVELTE-VIRTUAL-LIST-CONTENTS",{style:!0,class:!0});var me=dt(T);for(let _e=0;_e<A.length;_e+=1)A[_e].l(me);me.forEach(xe),Z.forEach(xe),this.h()},h(){Ji(T,"padding-top",C[6]+"px"),Ji(T,"padding-bottom",C[7]+"px"),md(T,"class","svelte-g2cagw"),Ji(y,"height",C[0]),md(y,"class","svelte-g2cagw"),ym(()=>C[18].call(y))},m(re,Z){Ke(re,y,Z),Be(y,T);for(let me=0;me<A.length;me+=1)A[me].m(T,null);C[16](T),C[17](y),O=xm(y,C[18].bind(y)),U=!0,l||(W=nr(y,"scroll",C[8]),l=!0)},p(re,[Z]){Z&16418&&($=re[5],pr(),A=vm(A,Z,ue,1,re,$,P,T,bm,Xd,null,Gd),dr()),(!U||Z&64)&&Ji(T,"padding-top",re[6]+"px"),(!U||Z&128)&&Ji(T,"padding-bottom",re[7]+"px"),(!U||Z&1)&&Ji(y,"height",re[0])},i(re){if(!U){for(let Z=0;Z<$.length;Z+=1)Qe(A[Z]);U=!0}},o(re){for(let Z=0;Z<A.length;Z+=1)mt(A[Z]);U=!1},d(re){re&&xe(y);for(let Z=0;Z<A.length;Z+=1)A[Z].d();C[16](null),C[17](null),O(),l=!1,W()}}}function Lg(C,y,T){let{$$slots:A={},$$scope:P}=y,{items:O=void 0}=y,{height:U="100%"}=y,{itemHeight:l=40}=y,{hoverItemIndex:W=0}=y,{start:$=0}=y,{end:ue=0}=y,re=[],Z,me,_e,Fe=0,gt,zt,Ct=0,it=0,je;async function nt(Oe,bt,We){const{scrollTop:ft}=me;await Cp();let wt=Ct-ft,Ze=$;for(;wt<bt&&Ze<Oe.length;){let Wt=Z[Ze-$];Wt||(T(10,ue=Ze+1),await Cp(),Wt=Z[Ze-$]),wt+=re[Ze]=We||Wt.offsetHeight,Ze+=1}T(10,ue=Ze);const De=Oe.length-ue;je=(Ct+wt)/ue,T(7,it=De*je),re.length=Oe.length,me&&T(3,me.scrollTop=0,me)}async function ct(){const{scrollTop:Oe}=me,bt=$;for(let Ze=0;Ze<Z.length;Ze+=1)re[$+Ze]=l||Z[Ze].offsetHeight;let We=0,ft=0;for(;We<O.length;){const Ze=re[We]||je;if(ft+Ze>Oe){T(9,$=We),T(6,Ct=ft);break}ft+=Ze,We+=1}for(;We<O.length&&(ft+=re[We]||je,We+=1,!(ft>Oe+Fe)););T(10,ue=We);const wt=O.length-ue;for(je=ft/ue;We<O.length;)re[We++]=je;if(T(7,it=wt*je),$<bt){await Cp();let Ze=0,De=0;for(let si=$;si<bt;si+=1)Z[si-$]&&(Ze+=re[si],De+=l||Z[si-$].offsetHeight);const Wt=De-Ze;me.scrollTo(0,Oe+Wt)}}Ou(()=>{Z=_e.getElementsByTagName("svelte-virtual-list-row"),T(13,zt=!0)});function Xe(Oe){js[Oe?"unshift":"push"](()=>{_e=Oe,T(4,_e)})}function at(Oe){js[Oe?"unshift":"push"](()=>{me=Oe,T(3,me)})}function rt(){Fe=this.offsetHeight,T(2,Fe)}return C.$$set=Oe=>{"items"in Oe&&T(11,O=Oe.items),"height"in Oe&&T(0,U=Oe.height),"itemHeight"in Oe&&T(12,l=Oe.itemHeight),"hoverItemIndex"in Oe&&T(1,W=Oe.hoverItemIndex),"start"in Oe&&T(9,$=Oe.start),"end"in Oe&&T(10,ue=Oe.end),"$$scope"in Oe&&T(14,P=Oe.$$scope)},C.$$.update=()=>{C.$$.dirty&3584&&T(5,gt=O.slice($,ue).map((Oe,bt)=>({index:bt+$,data:Oe}))),C.$$.dirty&14340&&zt&&nt(O,Fe,l)},[U,W,Fe,me,_e,gt,Ct,it,ct,$,ue,O,l,zt,P,A,Xe,at,rt]}class Bg extends Qn{constructor(y){super(),es(this,y,Lg,Dg,ts,{items:11,height:0,itemHeight:12,hoverItemIndex:1,start:9,end:10})}}function Rg(C){let y,T;return{c(){y=hc("svg"),T=hc("path"),this.h()},l(A){y=pc(A,"svg",{width:!0,height:!0,viewBox:!0,focusable:!0,"aria-hidden":!0,role:!0});var P=dt(y);T=pc(P,"path",{fill:!0,d:!0}),dt(T).forEach(xe),P.forEach(xe),this.h()},h(){Re(T,"fill","currentColor"),Re(T,"d",`M34.923,37.251L24,26.328L13.077,37.251L9.436,33.61l10.923-10.923L9.436,11.765l3.641-3.641L24,19.047L34.923,8.124
    l3.641,3.641L27.641,22.688L38.564,33.61L34.923,37.251z`),Re(y,"width","100%"),Re(y,"height","100%"),Re(y,"viewBox","-2 -2 50 50"),Re(y,"focusable","false"),Re(y,"aria-hidden","true"),Re(y,"role","presentation")},m(A,P){Ke(A,y,P),Be(y,T)},p:ds,i:ds,o:ds,d(A){A&&xe(y)}}}class Fg extends Qn{constructor(y){super(),es(this,y,null,Rg,ts,{})}}function Og(C,y,T){let A;return function(){let O=this,U=arguments,l=function(){A=null,T||C.apply(O,U)},W=T&&!A;clearTimeout(A),A=setTimeout(l,y),W&&C.apply(O,U)}}function Wd(C,y,T){const A=C.slice();return A[103]=y[T],A}function Hd(C){let y,T,A,P,O;return{c(){y=Ye("span"),T=Jt(C[33]),A=At(),P=Ye("span"),O=Jt(C[32]),this.h()},l(U){y=Je(U,"SPAN",{id:!0});var l=dt(y);T=$t(l,C[33]),l.forEach(xe),A=kt(U),P=Je(U,"SPAN",{id:!0});var W=dt(P);O=$t(W,C[32]),W.forEach(xe),this.h()},h(){Re(y,"id","aria-selection"),Re(P,"id","aria-context")},m(U,l){Ke(U,y,l),Be(y,T),Ke(U,A,l),Ke(U,P,l),Be(P,O)},p(U,l){l[1]&4&&Kr(T,U[33]),l[1]&2&&Kr(O,U[32])},d(U){U&&xe(y),U&&xe(A),U&&xe(P)}}}function Kd(C){let y,T,A;const P=[C[18]];var O=C[17];function U(l){let W={};for(let $=0;$<P.length;$+=1)W=bd(W,P[$]);return{props:W}}return O&&(y=new O(U())),{c(){y&&ai(y.$$.fragment),T=Pi()},l(l){y&&Si(y.$$.fragment,l),T=Pi()},m(l,W){y&&li(y,l,W),Ke(l,T,W),A=!0},p(l,W){const $=W[0]&262144?vd(P,[em(l[18])]):{};if(O!==(O=l[17])){if(y){pr();const ue=y;mt(ue.$$.fragment,1,0,()=>{ci(ue,1)}),dr()}O?(y=new O(U()),ai(y.$$.fragment),Qe(y.$$.fragment,1),li(y,T.parentNode,T)):y=null}else O&&y.$set($)},i(l){A||(y&&Qe(y.$$.fragment,l),A=!0)},o(l){y&&mt(y.$$.fragment,l),A=!1},d(l){l&&xe(T),y&&ci(y,l)}}}function Yd(C){let y,T,A;var P=C[26];function O(U){return{props:{value:U[2],getSelectionLabel:U[12],activeValue:U[30],isDisabled:U[9],multiFullItemClearable:U[8]}}}return P&&(y=new P(O(C)),y.$on("multiItemClear",C[38]),y.$on("focus",C[40])),{c(){y&&ai(y.$$.fragment),T=Pi()},l(U){y&&Si(y.$$.fragment,U),T=Pi()},m(U,l){y&&li(y,U,l),Ke(U,T,l),A=!0},p(U,l){const W={};if(l[0]&4&&(W.value=U[2]),l[0]&4096&&(W.getSelectionLabel=U[12]),l[0]&1073741824&&(W.activeValue=U[30]),l[0]&512&&(W.isDisabled=U[9]),l[0]&256&&(W.multiFullItemClearable=U[8]),P!==(P=U[26])){if(y){pr();const $=y;mt($.$$.fragment,1,0,()=>{ci($,1)}),dr()}P?(y=new P(O(U)),y.$on("multiItemClear",U[38]),y.$on("focus",U[40]),ai(y.$$.fragment),Qe(y.$$.fragment,1),li(y,T.parentNode,T)):y=null}else P&&y.$set(W)},i(U){A||(y&&Qe(y.$$.fragment,U),A=!0)},o(U){y&&mt(y.$$.fragment,U),A=!1},d(U){U&&xe(T),y&&ci(y,U)}}}function Jd(C){let y,T,A,P,O;var U=C[25];function l(W){return{props:{item:W[2],getSelectionLabel:W[12]}}}return U&&(T=new U(l(C))),{c(){y=Ye("div"),T&&ai(T.$$.fragment),this.h()},l(W){y=Je(W,"DIV",{class:!0});var $=dt(y);T&&Si(T.$$.fragment,$),$.forEach(xe),this.h()},h(){Re(y,"class","selectedItem svelte-17l1npl")},m(W,$){Ke(W,y,$),T&&li(T,y,null),A=!0,P||(O=nr(y,"focus",C[40]),P=!0)},p(W,$){const ue={};if($[0]&4&&(ue.item=W[2]),$[0]&4096&&(ue.getSelectionLabel=W[12]),U!==(U=W[25])){if(T){pr();const re=T;mt(re.$$.fragment,1,0,()=>{ci(re,1)}),dr()}U?(T=new U(l(W)),ai(T.$$.fragment),Qe(T.$$.fragment,1),li(T,y,null)):T=null}else U&&T.$set(ue)},i(W){A||(T&&Qe(T.$$.fragment,W),A=!0)},o(W){T&&mt(T.$$.fragment,W),A=!1},d(W){W&&xe(y),T&&ci(T),P=!1,O()}}}function $d(C){let y,T,A,P,O;var U=C[23];function l(W){return{}}return U&&(T=new U(l())),{c(){y=Ye("div"),T&&ai(T.$$.fragment),this.h()},l(W){y=Je(W,"DIV",{class:!0,"aria-hidden":!0});var $=dt(y);T&&Si(T.$$.fragment,$),$.forEach(xe),this.h()},h(){Re(y,"class","clearSelect svelte-17l1npl"),Re(y,"aria-hidden","true")},m(W,$){Ke(W,y,$),T&&li(T,y,null),A=!0,P||(O=nr(y,"click",wm(C[27])),P=!0)},p(W,$){if(U!==(U=W[23])){if(T){pr();const ue=T;mt(ue.$$.fragment,1,0,()=>{ci(ue,1)}),dr()}U?(T=new U(l()),ai(T.$$.fragment),Qe(T.$$.fragment,1),li(T,y,null)):T=null}},i(W){A||(T&&Qe(T.$$.fragment,W),A=!0)},o(W){T&&mt(T.$$.fragment,W),A=!1},d(W){W&&xe(y),T&&ci(T),P=!1,O()}}}function Qd(C){let y;function T(O,U){return O[22]?Vg:Ug}let A=T(C),P=A(C);return{c(){y=Ye("div"),P.c(),this.h()},l(O){y=Je(O,"DIV",{class:!0,"aria-hidden":!0});var U=dt(y);P.l(U),U.forEach(xe),this.h()},h(){Re(y,"class","indicator svelte-17l1npl"),Re(y,"aria-hidden","true")},m(O,U){Ke(O,y,U),P.m(y,null)},p(O,U){A===(A=T(O))&&P?P.p(O,U):(P.d(1),P=A(O),P&&(P.c(),P.m(y,null)))},d(O){O&&xe(y),P.d()}}}function Ug(C){let y,T;return{c(){y=hc("svg"),T=hc("path"),this.h()},l(A){y=pc(A,"svg",{width:!0,height:!0,viewBox:!0,focusable:!0,"aria-hidden":!0,class:!0});var P=dt(y);T=pc(P,"path",{d:!0}),dt(T).forEach(xe),P.forEach(xe),this.h()},h(){Re(T,"d",`M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747
          3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0
          1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502
          0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0
          0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z`),Re(y,"width","100%"),Re(y,"height","100%"),Re(y,"viewBox","0 0 20 20"),Re(y,"focusable","false"),Re(y,"aria-hidden","true"),Re(y,"class","svelte-17l1npl")},m(A,P){Ke(A,y,P),Be(y,T)},p:ds,d(A){A&&xe(y)}}}function Vg(C){let y,T;return{c(){y=new Tm,T=Pi(),this.h()},l(A){y=Im(A),T=Pi(),this.h()},h(){y.a=T},m(A,P){y.m(C[22],A,P),Ke(A,T,P)},p(A,P){P[0]&4194304&&y.p(A[22])},d(A){A&&xe(T),A&&y.d()}}}function ef(C){let y,T,A;return{c(){y=Ye("div"),T=hc("svg"),A=hc("circle"),this.h()},l(P){y=Je(P,"DIV",{class:!0});var O=dt(y);T=pc(O,"svg",{class:!0,viewBox:!0});var U=dt(T);A=pc(U,"circle",{class:!0,cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0,"stroke-miterlimit":!0}),dt(A).forEach(xe),U.forEach(xe),O.forEach(xe),this.h()},h(){Re(A,"class","spinner_path svelte-17l1npl"),Re(A,"cx","50"),Re(A,"cy","50"),Re(A,"r","20"),Re(A,"fill","none"),Re(A,"stroke","currentColor"),Re(A,"stroke-width","5"),Re(A,"stroke-miterlimit","10"),Re(T,"class","spinner_icon svelte-17l1npl"),Re(T,"viewBox","25 25 50 50"),Re(y,"class","spinner svelte-17l1npl")},m(P,O){Ke(P,y,O),Be(y,T),Be(T,A)},d(P){P&&xe(y)}}}function tf(C){let y,T,A,P;const O=[C[34]];function U($){C[84]($)}var l=C[24];function W($){let ue={};for(let re=0;re<O.length;re+=1)ue=bd(ue,O[re]);return $[28]!==void 0&&(ue.hoverItemIndex=$[28]),{props:ue}}return l&&(y=new l(W(C)),js.push(()=>lc(y,"hoverItemIndex",U)),y.$on("itemSelected",C[43]),y.$on("itemCreated",C[44]),y.$on("closeList",C[45])),{c(){y&&ai(y.$$.fragment),A=Pi()},l($){y&&Si(y.$$.fragment,$),A=Pi()},m($,ue){y&&li(y,$,ue),Ke($,A,ue),P=!0},p($,ue){const re=ue[1]&8?vd(O,[em($[34])]):{};if(!T&&ue[0]&268435456&&(T=!0,re.hoverItemIndex=$[28],Kc(()=>T=!1)),l!==(l=$[24])){if(y){pr();const Z=y;mt(Z.$$.fragment,1,0,()=>{ci(Z,1)}),dr()}l?(y=new l(W($)),js.push(()=>lc(y,"hoverItemIndex",U)),y.$on("itemSelected",$[43]),y.$on("itemCreated",$[44]),y.$on("closeList",$[45]),ai(y.$$.fragment),Qe(y.$$.fragment,1),li(y,A.parentNode,A)):y=null}else l&&y.$set(re)},i($){P||(y&&Qe(y.$$.fragment,$),P=!0)},o($){y&&mt(y.$$.fragment,$),P=!1},d($){$&&xe(A),y&&ci(y,$)}}}function rf(C){let y,T,A;return{c(){y=Ye("input"),this.h()},l(P){y=Je(P,"INPUT",{name:!0,type:!0,class:!0}),this.h()},h(){Re(y,"name",T=C[16].name),Re(y,"type","hidden"),y.value=A=C[2]?C[12](C[2]):null,Re(y,"class","svelte-17l1npl")},m(P,O){Ke(P,y,O)},p(P,O){O[0]&65536&&T!==(T=P[16].name)&&Re(y,"name",T),O[0]&4100&&A!==(A=P[2]?P[12](P[2]):null)&&(y.value=A)},d(P){P&&xe(y)}}}function nf(C){let y,T=C[2],A=[];for(let P=0;P<T.length;P+=1)A[P]=sf(Wd(C,T,P));return{c(){for(let P=0;P<A.length;P+=1)A[P].c();y=Pi()},l(P){for(let O=0;O<A.length;O+=1)A[O].l(P);y=Pi()},m(P,O){for(let U=0;U<A.length;U+=1)A[U].m(P,O);Ke(P,y,O)},p(P,O){if(O[0]&69636){T=P[2];let U;for(U=0;U<T.length;U+=1){const l=Wd(P,T,U);A[U]?A[U].p(l,O):(A[U]=sf(l),A[U].c(),A[U].m(y.parentNode,y))}for(;U<A.length;U+=1)A[U].d(1);A.length=T.length}},d(P){tl(A,P),P&&xe(y)}}}function sf(C){let y,T,A;return{c(){y=Ye("input"),this.h()},l(P){y=Je(P,"INPUT",{name:!0,type:!0,class:!0}),this.h()},h(){Re(y,"name",T=C[16].name),Re(y,"type","hidden"),y.value=A=C[103]?C[12](C[103]):null,Re(y,"class","svelte-17l1npl")},m(P,O){Ke(P,y,O)},p(P,O){O[0]&65536&&T!==(T=P[16].name)&&Re(y,"name",T),O[0]&4100&&A!==(A=P[103]?P[12](P[103]):null)&&(y.value=A)},d(P){P&&xe(y)}}}function Ng(C){let y,T,A,P,O,U,l,W,$,ue,re,Z,me,_e,Fe,gt,zt,Ct,it=C[1]&&Hd(C),je=C[17]&&Kd(C),nt=C[35]&&Yd(C),ct=[{readOnly:l=!C[13]},C[31],{placeholder:C[36]},{style:C[14]},{disabled:C[9]}],Xe={};for(let Ze=0;Ze<ct.length;Ze+=1)Xe=bd(Xe,ct[Ze]);let at=!C[7]&&C[29]&&Jd(C),rt=C[37]&&$d(C),Oe=!C[37]&&(C[20]||C[19]&&!C[2]||!C[13]&&!C[9]&&!C[4]&&(C[29]&&!C[15]||!C[29]))&&Qd(C),bt=C[4]&&ef(),We=C[5]&&tf(C),ft=(!C[7]||C[7]&&!C[35])&&rf(C),wt=C[7]&&C[35]&&nf(C);return{c(){y=Ye("div"),T=Ye("span"),it&&it.c(),A=At(),je&&je.c(),P=At(),nt&&nt.c(),O=At(),U=Ye("input"),W=At(),at&&at.c(),$=At(),rt&&rt.c(),ue=At(),Oe&&Oe.c(),re=At(),bt&&bt.c(),Z=At(),We&&We.c(),me=At(),ft&&ft.c(),_e=At(),wt&&wt.c(),this.h()},l(Ze){y=Je(Ze,"DIV",{class:!0,style:!0});var De=dt(y);T=Je(De,"SPAN",{"aria-live":!0,"aria-atomic":!0,"aria-relevant":!0,class:!0});var Wt=dt(T);it&&it.l(Wt),Wt.forEach(xe),A=kt(De),je&&je.l(De),P=kt(De),nt&&nt.l(De),O=kt(De),U=Je(De,"INPUT",{placeholder:!0,style:!0}),W=kt(De),at&&at.l(De),$=kt(De),rt&&rt.l(De),ue=kt(De),Oe&&Oe.l(De),re=kt(De),bt&&bt.l(De),Z=kt(De),We&&We.l(De),me=kt(De),ft&&ft.l(De),_e=kt(De),wt&&wt.l(De),De.forEach(xe),this.h()},h(){Re(T,"aria-live","polite"),Re(T,"aria-atomic","false"),Re(T,"aria-relevant","additions text"),Re(T,"class","a11yText svelte-17l1npl"),Sd(U,Xe),qi(U,"svelte-17l1npl",!0),Re(y,"class",Fe="selectContainer "+C[21]+" svelte-17l1npl"),Re(y,"style",C[11]),qi(y,"hasError",C[10]),qi(y,"multiSelect",C[7]),qi(y,"disabled",C[9]),qi(y,"focused",C[1])},m(Ze,De){Ke(Ze,y,De),Be(y,T),it&&it.m(T,null),Be(y,A),je&&je.m(y,null),Be(y,P),nt&&nt.m(y,null),Be(y,O),Be(y,U),U.autofocus&&U.focus(),C[82](U),Ed(U,C[3]),Be(y,W),at&&at.m(y,null),Be(y,$),rt&&rt.m(y,null),Be(y,ue),Oe&&Oe.m(y,null),Be(y,re),bt&&bt.m(y,null),Be(y,Z),We&&We.m(y,null),Be(y,me),ft&&ft.m(y,null),Be(y,_e),wt&&wt.m(y,null),C[85](y),gt=!0,zt||(Ct=[nr(window,"click",C[41]),nr(window,"focusin",C[41]),nr(window,"keydown",C[39]),nr(U,"focus",C[40]),nr(U,"input",C[83]),nr(y,"click",C[42])],zt=!0)},p(Ze,De){Ze[1]?it?it.p(Ze,De):(it=Hd(Ze),it.c(),it.m(T,null)):it&&(it.d(1),it=null),Ze[17]?je?(je.p(Ze,De),De[0]&131072&&Qe(je,1)):(je=Kd(Ze),je.c(),Qe(je,1),je.m(y,P)):je&&(pr(),mt(je,1,1,()=>{je=null}),dr()),Ze[35]?nt?(nt.p(Ze,De),De[1]&16&&Qe(nt,1)):(nt=Yd(Ze),nt.c(),Qe(nt,1),nt.m(y,O)):nt&&(pr(),mt(nt,1,1,()=>{nt=null}),dr()),Sd(U,Xe=vd(ct,[(!gt||De[0]&8192&&l!==(l=!Ze[13]))&&{readOnly:l},De[1]&1&&Ze[31],(!gt||De[1]&32)&&{placeholder:Ze[36]},(!gt||De[0]&16384)&&{style:Ze[14]},(!gt||De[0]&512)&&{disabled:Ze[9]}])),De[0]&8&&U.value!==Ze[3]&&Ed(U,Ze[3]),qi(U,"svelte-17l1npl",!0),!Ze[7]&&Ze[29]?at?(at.p(Ze,De),De[0]&536871040&&Qe(at,1)):(at=Jd(Ze),at.c(),Qe(at,1),at.m(y,$)):at&&(pr(),mt(at,1,1,()=>{at=null}),dr()),Ze[37]?rt?(rt.p(Ze,De),De[1]&64&&Qe(rt,1)):(rt=$d(Ze),rt.c(),Qe(rt,1),rt.m(y,ue)):rt&&(pr(),mt(rt,1,1,()=>{rt=null}),dr()),!Ze[37]&&(Ze[20]||Ze[19]&&!Ze[2]||!Ze[13]&&!Ze[9]&&!Ze[4]&&(Ze[29]&&!Ze[15]||!Ze[29]))?Oe?Oe.p(Ze,De):(Oe=Qd(Ze),Oe.c(),Oe.m(y,re)):Oe&&(Oe.d(1),Oe=null),Ze[4]?bt||(bt=ef(),bt.c(),bt.m(y,Z)):bt&&(bt.d(1),bt=null),Ze[5]?We?(We.p(Ze,De),De[0]&32&&Qe(We,1)):(We=tf(Ze),We.c(),Qe(We,1),We.m(y,me)):We&&(pr(),mt(We,1,1,()=>{We=null}),dr()),!Ze[7]||Ze[7]&&!Ze[35]?ft?ft.p(Ze,De):(ft=rf(Ze),ft.c(),ft.m(y,_e)):ft&&(ft.d(1),ft=null),Ze[7]&&Ze[35]?wt?wt.p(Ze,De):(wt=nf(Ze),wt.c(),wt.m(y,null)):wt&&(wt.d(1),wt=null),(!gt||De[0]&2097152&&Fe!==(Fe="selectContainer "+Ze[21]+" svelte-17l1npl"))&&Re(y,"class",Fe),(!gt||De[0]&2048)&&Re(y,"style",Ze[11]),De[0]&2098176&&qi(y,"hasError",Ze[10]),De[0]&2097280&&qi(y,"multiSelect",Ze[7]),De[0]&2097664&&qi(y,"disabled",Ze[9]),De[0]&2097154&&qi(y,"focused",Ze[1])},i(Ze){gt||(Qe(je),Qe(nt),Qe(at),Qe(rt),Qe(We),gt=!0)},o(Ze){mt(je),mt(nt),mt(at),mt(rt),mt(We),gt=!1},d(Ze){Ze&&xe(y),it&&it.d(),je&&je.d(),nt&&nt.d(),C[82](null),at&&at.d(),rt&&rt.d(),Oe&&Oe.d(),bt&&bt.d(),We&&We.d(),ft&&ft.d(),wt&&wt.d(),C[85](null),zt=!1,ru(Ct)}}}function of(C){return C.map((y,T)=>({index:T,value:y,label:`${y}`}))}function jg(C,y,T){let A,P,O,U,l,W,$,ue;const re=Lh();let{id:Z=null}=y,{container:me=void 0}=y,{input:_e=void 0}=y,{isMulti:Fe=!1}=y,{multiFullItemClearable:gt=!1}=y,{isDisabled:zt=!1}=y,{isCreatable:Ct=!1}=y,{isFocused:it=!1}=y,{value:je=null}=y,{filterText:nt=""}=y,{placeholder:ct="Select..."}=y,{placeholderAlwaysShow:Xe=!1}=y,{items:at=null}=y,{itemFilter:rt=(he,qe,ot)=>`${he}`.toLowerCase().includes(qe.toLowerCase())}=y,{groupBy:Oe=void 0}=y,{groupFilter:bt=he=>he}=y,{isGroupHeaderSelectable:We=!1}=y,{getGroupHeaderLabel:ft=he=>he[wt]||he.id}=y,{labelIdentifier:wt="label"}=y,{getOptionLabel:Ze=(he,qe)=>he.isCreator?`Create "${qe}"`:he[wt]}=y,{optionIdentifier:De="value"}=y,{loadOptions:Wt=void 0}=y,{hasError:si=!1}=y,{containerStyles:vt=""}=y,{getSelectionLabel:Ht=he=>he?he[wt]:null}=y,{createGroupHeaderItem:gi=he=>({value:he,label:he})}=y,{createItem:ui=he=>({value:he,label:he})}=y;const Ci=()=>A;let{isSearchable:fi=!0}=y,{inputStyles:ei=""}=y,{isClearable:_i=!0}=y,{isWaiting:$i=!1}=y,{listPlacement:lt="auto"}=y,{listOpen:$e=!1}=y,{isVirtualList:di=!1}=y,{loadOptionsInterval:Ui=300}=y,{noOptionsMessage:Mr="No options"}=y,{hideEmptyState:Ai=!1}=y,{inputAttributes:gr={}}=y,{listAutoWidth:_r=!0}=y,{itemHeight:Er=40}=y,{Icon:Dr=void 0}=y,{iconProps:Jr={}}=y,{showChevron:bi=!1}=y,{showIndicator:br=!1}=y,{containerClasses:cr=""}=y,{indicatorSvg:Hi=void 0}=y,{listOffset:Qt=5}=y,{ClearIcon:tr=Fg}=y,{Item:Di=um}=y,{List:jt=Ig}=y,{Selection:Vi=Ag}=y,{MultiSelection:ae=Cg}=y,{VirtualList:Ae=Bg}=y;function $r(he){if(he.loadOptions&&he.filterText.length>0)return;if(!he.items)return[];he.items&&he.items.length>0&&typeof he.items[0]!="object"&&(he.items=of(he.items));let qe=he.items.filter(ot=>{let Ut=rt(Ze(ot,he.filterText),he.filterText,ot);return Ut&&he.isMulti&&he.value&&Array.isArray(he.value)&&(Ut=!he.value.some(Lt=>Lt[he.optionIdentifier]===ot[he.optionIdentifier])),Ut});return he.groupBy&&(qe=kn(qe)),he.isCreatable&&(qe=yr(qe,he.filterText)),qe}function yr(he,qe){if(qe.length===0)return he;const ot=ui(qe);return he[0]&&qe===he[0][wt]?he:(ot.isCreator=!0,[...he,ot])}let{selectedValue:Gt=null}=y,hi,Ti,xr,Mi,Ve,Dt;const Pt=Og(async()=>{T(4,$i=!0);let he=await Wt(nt).catch(qe=>{console.warn("svelte-select loadOptions error :>> ",qe),re("error",{type:"loadOptions",details:qe})});he&&!he.cancelled&&(he?(he&&he.length>0&&typeof he[0]!="object"&&(he=of(he)),T(81,A=[...he]),re("loaded",{items:A})):T(81,A=[]),Ct&&T(81,A=yr(A,nt)),T(4,$i=!1),T(1,it=!0),T(5,$e=!0))},Ui);function Ii(){typeof je=="string"?T(2,je={[De]:je,label:je}):Fe&&Array.isArray(je)&&je.length>0&&T(2,je=je.map(he=>typeof he=="string"?{value:he,label:he}:he))}let Ar;function Mt(){T(31,Ar=Object.assign({autocapitalize:"none",autocomplete:"off",autocorrect:"off",spellcheck:!1,tabindex:0,type:"text","aria-autocomplete":"list"},gr)),Z&&T(31,Ar.id=Z,Ar),fi||T(31,Ar.readonly=!0,Ar)}function kn(he){const qe=[],ot={};he.forEach(Lt=>{const Et=Oe(Lt);qe.includes(Et)||(qe.push(Et),ot[Et]=[],Et&&ot[Et].push(Object.assign(gi(Et,Lt),{id:Et,isGroupHeader:!0,isSelectable:We}))),ot[Et].push(Object.assign({isGroupItem:!!Et},Lt))});const Ut=[];return bt(qe).forEach(Lt=>{Ut.push(...ot[Lt])}),Ut}function vr(){if(Fe){JSON.stringify(je)!==JSON.stringify(Ti)&&mn()&&re("select",je);return}(!Ti||JSON.stringify(je[De])!==JSON.stringify(Ti[De]))&&re("select",je)}function bn(){it||$e?Tn():_e&&_e.blur()}function ki(){je&&(Array.isArray(je)?T(2,je=[...je]):T(2,je=[je]))}function pi(){je&&T(2,je=null)}function hn(){nt.length!==0&&(T(1,it=!0),T(5,$e=!0),Wt?Pt():(T(5,$e=!0),Fe&&T(30,hi=void 0)))}Qf(async()=>{T(77,Ti=je),T(78,xr=nt),T(79,Mi=it),T(80,Ve=Fe)});function mn(){let he=!0;if(je){const qe=[],ot=[];je.forEach(Ut=>{qe.includes(Ut[De])?he=!1:(qe.push(Ut[De]),ot.push(Ut))}),he||T(2,je=ot)}return he}function wr(he){let qe=he?he[De]:je[De];return at.find(ot=>ot[De]===qe)}function an(he){!he||he.length===0||he.some(qe=>typeof qe!="object")||!je||(Fe?je.some(qe=>!qe||!qe[De]):!je[De])||(Array.isArray(je)?T(2,je=je.map(qe=>wr(qe)||qe)):T(2,je=wr()||je))}function wn(he){const{detail:qe}=he,ot=je[qe?qe.i:je.length-1];je.length===1?T(2,je=void 0):T(2,je=je.filter(Ut=>Ut!==ot)),re("clear",ot)}function is(he){if(!!it)switch(he.key){case"ArrowDown":he.preventDefault(),T(5,$e=!0),T(30,hi=void 0);break;case"ArrowUp":he.preventDefault(),T(5,$e=!0),T(30,hi=void 0);break;case"Tab":$e||T(1,it=!1);break;case"Backspace":if(!Fe||nt.length>0)return;if(Fe&&je&&je.length>0){if(wn(hi!==void 0?hi:je.length-1),hi===0||hi===void 0)break;T(30,hi=je.length>hi?hi-1:void 0)}break;case"ArrowLeft":if(!Fe||nt.length>0)return;hi===void 0?T(30,hi=je.length-1):je.length>hi&&hi!==0&&T(30,hi-=1);break;case"ArrowRight":if(!Fe||nt.length>0||hi===void 0)return;hi===je.length-1?T(30,hi=void 0):hi<je.length-1&&T(30,hi+=1);break}}function Tn(){T(1,it=!0),_e&&_e.focus()}function ge(he){if(!me)return;const qe=he.path&&he.path.length>0?he.path[0]:he.target;me.contains(qe)||me.contains(he.relatedTarget)||(T(1,it=!1),T(5,$e=!1),T(30,hi=void 0),_e&&_e.blur())}function B(){zt||(T(1,it=!0),T(5,$e=!$e))}function M(){T(2,je=void 0),T(5,$e=!1),re("clear",je),Tn()}Ou(()=>{it&&_e&&_e.focus()});function L(he){const{detail:qe}=he;if(qe){T(3,nt="");const ot=Object.assign({},qe);(!ot.isGroupHeader||ot.isSelectable)&&(Fe?T(2,je=je?je.concat([ot]):[ot]):T(2,je=ot),T(2,je),setTimeout(()=>{T(5,$e=!1),T(30,hi=void 0)}))}}function G(he){const{detail:qe}=he;Fe?(T(2,je=je||[]),T(2,je=[...je,ui(qe)])):T(2,je=ui(qe)),re("itemCreated",qe),T(3,nt=""),T(5,$e=!1),T(30,hi=void 0)}function H(){T(3,nt=""),T(5,$e=!1)}let{ariaValues:te=he=>`Option ${he}, selected.`}=y,{ariaListOpen:ne=(he,qe)=>`You are currently focused on option ${he}. There are ${qe} results available.`}=y,{ariaFocused:ie=()=>"Select is focused, type to refine list, press down to open the menu."}=y;function se(){let he;return Fe&&je.length>0?he=je.map(qe=>Ht(qe)).join(", "):he=Ht(je),te(he)}function pe(){if(!it||!A||A.length===0)return"";let he=A[Dt];if($e&&he){let qe=Ht(he),ot=A?A.length:0;return ne(qe,ot)}else return ie()}function Ie(he){js[he?"unshift":"push"](()=>{_e=he,T(6,_e)})}function Se(){nt=this.value,T(3,nt)}function ke(he){Dt=he,T(28,Dt)}function st(he){js[he?"unshift":"push"](()=>{me=he,T(0,me)})}return C.$$set=he=>{"id"in he&&T(46,Z=he.id),"container"in he&&T(0,me=he.container),"input"in he&&T(6,_e=he.input),"isMulti"in he&&T(7,Fe=he.isMulti),"multiFullItemClearable"in he&&T(8,gt=he.multiFullItemClearable),"isDisabled"in he&&T(9,zt=he.isDisabled),"isCreatable"in he&&T(47,Ct=he.isCreatable),"isFocused"in he&&T(1,it=he.isFocused),"value"in he&&T(2,je=he.value),"filterText"in he&&T(3,nt=he.filterText),"placeholder"in he&&T(48,ct=he.placeholder),"placeholderAlwaysShow"in he&&T(49,Xe=he.placeholderAlwaysShow),"items"in he&&T(50,at=he.items),"itemFilter"in he&&T(51,rt=he.itemFilter),"groupBy"in he&&T(52,Oe=he.groupBy),"groupFilter"in he&&T(53,bt=he.groupFilter),"isGroupHeaderSelectable"in he&&T(54,We=he.isGroupHeaderSelectable),"getGroupHeaderLabel"in he&&T(55,ft=he.getGroupHeaderLabel),"labelIdentifier"in he&&T(56,wt=he.labelIdentifier),"getOptionLabel"in he&&T(57,Ze=he.getOptionLabel),"optionIdentifier"in he&&T(58,De=he.optionIdentifier),"loadOptions"in he&&T(59,Wt=he.loadOptions),"hasError"in he&&T(10,si=he.hasError),"containerStyles"in he&&T(11,vt=he.containerStyles),"getSelectionLabel"in he&&T(12,Ht=he.getSelectionLabel),"createGroupHeaderItem"in he&&T(60,gi=he.createGroupHeaderItem),"createItem"in he&&T(61,ui=he.createItem),"isSearchable"in he&&T(13,fi=he.isSearchable),"inputStyles"in he&&T(14,ei=he.inputStyles),"isClearable"in he&&T(15,_i=he.isClearable),"isWaiting"in he&&T(4,$i=he.isWaiting),"listPlacement"in he&&T(63,lt=he.listPlacement),"listOpen"in he&&T(5,$e=he.listOpen),"isVirtualList"in he&&T(64,di=he.isVirtualList),"loadOptionsInterval"in he&&T(65,Ui=he.loadOptionsInterval),"noOptionsMessage"in he&&T(66,Mr=he.noOptionsMessage),"hideEmptyState"in he&&T(67,Ai=he.hideEmptyState),"inputAttributes"in he&&T(16,gr=he.inputAttributes),"listAutoWidth"in he&&T(68,_r=he.listAutoWidth),"itemHeight"in he&&T(69,Er=he.itemHeight),"Icon"in he&&T(17,Dr=he.Icon),"iconProps"in he&&T(18,Jr=he.iconProps),"showChevron"in he&&T(19,bi=he.showChevron),"showIndicator"in he&&T(20,br=he.showIndicator),"containerClasses"in he&&T(21,cr=he.containerClasses),"indicatorSvg"in he&&T(22,Hi=he.indicatorSvg),"listOffset"in he&&T(70,Qt=he.listOffset),"ClearIcon"in he&&T(23,tr=he.ClearIcon),"Item"in he&&T(71,Di=he.Item),"List"in he&&T(24,jt=he.List),"Selection"in he&&T(25,Vi=he.Selection),"MultiSelection"in he&&T(26,ae=he.MultiSelection),"VirtualList"in he&&T(72,Ae=he.VirtualList),"selectedValue"in he&&T(73,Gt=he.selectedValue),"ariaValues"in he&&T(74,te=he.ariaValues),"ariaListOpen"in he&&T(75,ne=he.ariaListOpen),"ariaFocused"in he&&T(76,ie=he.ariaFocused)},C.$$.update=()=>{C.$$.dirty[0]&140|C.$$.dirty[1]&405340160&&T(81,A=$r({loadOptions:Wt,filterText:nt,items:at,value:je,isMulti:Fe,optionIdentifier:De,groupBy:Oe,isCreatable:Ct})),C.$$.dirty[2]&2048&&Gt&&console.warn("selectedValue is no longer used. Please use value instead."),C.$$.dirty[1]&524288&&an(at),C.$$.dirty[0]&4&&je&&Ii(),C.$$.dirty[0]&73728&&(gr||!fi)&&Mt(),C.$$.dirty[0]&128|C.$$.dirty[2]&262144&&(Fe&&ki(),Ve&&!Fe&&pi()),C.$$.dirty[0]&132&&Fe&&je&&je.length>1&&mn(),C.$$.dirty[0]&4&&je&&vr(),C.$$.dirty[0]&132|C.$$.dirty[2]&32768&&!je&&Fe&&Ti&&re("select",je),C.$$.dirty[0]&2|C.$$.dirty[2]&131072&&it!==Mi&&bn(),C.$$.dirty[0]&8|C.$$.dirty[2]&65536&&nt!==xr&&hn(),C.$$.dirty[0]&12&&T(29,P=je&&nt.length===0),C.$$.dirty[0]&536904208&&T(37,O=P&&_i&&!zt&&!$i),C.$$.dirty[0]&132|C.$$.dirty[1]&393216&&T(36,U=Xe&&Fe?ct:je?"":ct),C.$$.dirty[0]&132&&T(35,l=Fe&&je&&je.length>0),C.$$.dirty[0]&141|C.$$.dirty[1]&218103808|C.$$.dirty[2]&526326&&T(34,W={Item:Di,filterText:nt,optionIdentifier:De,noOptionsMessage:Mr,hideEmptyState:Ai,isVirtualList:di,VirtualList:Ae,value:je,isMulti:Fe,getGroupHeaderLabel:ft,items:A,itemHeight:Er,getOptionLabel:Ze,listPlacement:lt,parent:me,listAutoWidth:_r,listOffset:Qt}),C.$$.dirty[0]&132&&T(33,$=je?se():""),C.$$.dirty[0]&268435490|C.$$.dirty[2]&524288&&T(32,ue=pe())},[me,it,je,nt,$i,$e,_e,Fe,gt,zt,si,vt,Ht,fi,ei,_i,gr,Dr,Jr,bi,br,cr,Hi,tr,jt,Vi,ae,M,Dt,P,hi,Ar,ue,$,W,l,U,O,wn,is,Tn,ge,B,L,G,H,Z,Ct,ct,Xe,at,rt,Oe,bt,We,ft,wt,Ze,De,Wt,gi,ui,Ci,lt,di,Ui,Mr,Ai,_r,Er,Qt,Di,Ae,Gt,te,ne,ie,Ti,xr,Mi,Ve,A,Ie,Se,ke,st]}class qg extends Qn{constructor(y){super(),es(this,y,jg,Ng,ts,{id:46,container:0,input:6,isMulti:7,multiFullItemClearable:8,isDisabled:9,isCreatable:47,isFocused:1,value:2,filterText:3,placeholder:48,placeholderAlwaysShow:49,items:50,itemFilter:51,groupBy:52,groupFilter:53,isGroupHeaderSelectable:54,getGroupHeaderLabel:55,labelIdentifier:56,getOptionLabel:57,optionIdentifier:58,loadOptions:59,hasError:10,containerStyles:11,getSelectionLabel:12,createGroupHeaderItem:60,createItem:61,getFilteredItems:62,isSearchable:13,inputStyles:14,isClearable:15,isWaiting:4,listPlacement:63,listOpen:5,isVirtualList:64,loadOptionsInterval:65,noOptionsMessage:66,hideEmptyState:67,inputAttributes:16,listAutoWidth:68,itemHeight:69,Icon:17,iconProps:18,showChevron:19,showIndicator:20,containerClasses:21,indicatorSvg:22,listOffset:70,ClearIcon:23,Item:71,List:24,Selection:25,MultiSelection:26,VirtualList:72,selectedValue:73,handleClear:27,ariaValues:74,ariaListOpen:75,ariaFocused:76},null,[-1,-1,-1,-1])}get getFilteredItems(){return this.$$.ctx[62]}get handleClear(){return this.$$.ctx[27]}}function af(C){let y,T;const A=C[4].default,P=iu(A,C,C[3],null);return{c(){y=Ye("div"),P&&P.c(),this.h()},l(O){y=Je(O,"DIV",{class:!0});var U=dt(y);P&&P.l(U),U.forEach(xe),this.h()},h(){Re(y,"class","content svelte-1p93wzj")},m(O,U){Ke(O,y,U),P&&P.m(y,null),T=!0},p(O,U){P&&P.p&&(!T||U&8)&&Qc(P,A,O,O[3],T?tu(A,O[3],U,null):eu(O[3]),null)},i(O){T||(Qe(P,O),T=!0)},o(O){mt(P,O),T=!1},d(O){O&&xe(y),P&&P.d(O)}}}function Gg(C){let y,T,A,P,O,U,l,W,$;A=new Ns({props:{type:"arrow",rotation:C[0]?"90":C[2]?"180":"0"}});let ue=C[0]&&af(C);return{c(){y=Ye("div"),T=Ye("button"),ai(A.$$.fragment),P=At(),O=Jt(C[1]),U=At(),ue&&ue.c(),this.h()},l(re){y=Je(re,"DIV",{class:!0});var Z=dt(y);T=Je(Z,"BUTTON",{class:!0});var me=dt(T);Si(A.$$.fragment,me),P=kt(me),O=$t(me,C[1]),me.forEach(xe),U=kt(Z),ue&&ue.l(Z),Z.forEach(xe),this.h()},h(){Re(T,"class","label svelte-1p93wzj"),qi(T,"label-rtl",C[2]),Re(y,"class","accordion svelte-1p93wzj")},m(re,Z){Ke(re,y,Z),Be(y,T),li(A,T,null),Be(T,P),Be(T,O),Be(y,U),ue&&ue.m(y,null),l=!0,W||($=nr(T,"click",C[5]),W=!0)},p(re,[Z]){const me={};Z&5&&(me.rotation=re[0]?"90":re[2]?"180":"0"),A.$set(me),(!l||Z&2)&&Kr(O,re[1]),Z&4&&qi(T,"label-rtl",re[2]),re[0]?ue?(ue.p(re,Z),Z&1&&Qe(ue,1)):(ue=af(re),ue.c(),Qe(ue,1),ue.m(y,null)):ue&&(pr(),mt(ue,1,1,()=>{ue=null}),dr())},i(re){l||(Qe(A.$$.fragment,re),Qe(ue),l=!0)},o(re){mt(A.$$.fragment,re),mt(ue),l=!1},d(re){re&&xe(y),ci(A),ue&&ue.d(),W=!1,$()}}}function Zg(C,y,T){let{$$slots:A={},$$scope:P}=y,{label:O=""}=y,{open:U=!1}=y,{rtl:l=!1}=y;const W=()=>T(0,U=!U);return C.$$set=$=>{"label"in $&&T(1,O=$.label),"open"in $&&T(0,U=$.open),"rtl"in $&&T(2,l=$.rtl),"$$scope"in $&&T(3,P=$.$$scope)},[U,O,l,P,A,W]}class zp extends Qn{constructor(y){super(),es(this,y,Zg,Gg,ts,{label:1,open:0,rtl:2})}}function Xg(C){let y,T,A,P,O;const U=C[3].default,l=iu(U,C,C[2],null);return{c(){y=Ye("h3"),T=Jt(C[0]),A=At(),P=Ye("div"),l&&l.c(),this.h()},l(W){y=Je(W,"H3",{class:!0});var $=dt(y);T=$t($,C[0]),$.forEach(xe),A=kt(W),P=Je(W,"DIV",{class:!0});var ue=dt(P);l&&l.l(ue),ue.forEach(xe),this.h()},h(){Re(y,"class","section svelte-pim8c1"),qi(y,"hr",C[1]),Re(P,"class","content svelte-pim8c1")},m(W,$){Ke(W,y,$),Be(y,T),Ke(W,A,$),Ke(W,P,$),l&&l.m(P,null),O=!0},p(W,[$]){(!O||$&1)&&Kr(T,W[0]),$&2&&qi(y,"hr",W[1]),l&&l.p&&(!O||$&4)&&Qc(l,U,W,W[2],O?tu(U,W[2],$,null):eu(W[2]),null)},i(W){O||(Qe(l,W),O=!0)},o(W){mt(l,W),O=!1},d(W){W&&xe(y),W&&xe(A),W&&xe(P),l&&l.d(W)}}}function Wg(C,y,T){let{$$slots:A={},$$scope:P}=y,{label:O=""}=y,{hr:U=!0}=y;return C.$$set=l=>{"label"in l&&T(0,O=l.label),"hr"in l&&T(1,U=l.hr),"$$scope"in l&&T(2,P=l.$$scope)},[O,U,P,A]}class $c extends Qn{constructor(y){super(),es(this,y,Wg,Xg,ts,{label:0,hr:1})}}function lf(C){let y,T=`${C[0].p2016.pal}%`;return{c(){y=Ye("div"),this.h()},l(A){y=Je(A,"DIV",{class:!0}),dt(y).forEach(xe),this.h()},h(){Re(y,"class","bar svelte-1mshsl8"),Ji(y,"left","0",!1),Ji(y,"width",T,!1),Ji(y,"background-color","#5EBD4C",!1)},m(A,P){Ke(A,y,P)},p(A,P){P&1&&T!==(T=`${A[0].p2016.pal}%`)&&Ji(y,"width",T,!1)},d(A){A&&xe(y)}}}function cf(C){let y,T=`${C[1](C[0].p2016.pal)}%`,A=`${C[0].p2016.oth}%`;return{c(){y=Ye("div"),this.h()},l(P){y=Je(P,"DIV",{class:!0}),dt(y).forEach(xe),this.h()},h(){Re(y,"class","bar svelte-1mshsl8"),Ji(y,"left",T,!1),Ji(y,"width",A,!1),Ji(y,"background-color","#aaa",!1)},m(P,O){Ke(P,y,O)},p(P,O){O&1&&T!==(T=`${P[1](P[0].p2016.pal)}%`)&&Ji(y,"left",T,!1),O&1&&A!==(A=`${P[0].p2016.oth}%`)&&Ji(y,"width",A,!1)},d(P){P&&xe(y)}}}function uf(C){let y,T=`${C[1](C[0].p2016.pal+C[0].p2016.oth)}%`,A=`${C[0].p2016.jsh}%`;return{c(){y=Ye("div"),this.h()},l(P){y=Je(P,"DIV",{class:!0}),dt(y).forEach(xe),this.h()},h(){Re(y,"class","bar svelte-1mshsl8"),Ji(y,"left",T,!1),Ji(y,"width",A,!1),Ji(y,"background-color","#0485A8",!1)},m(P,O){Ke(P,y,O)},p(P,O){O&1&&T!==(T=`${P[1](P[0].p2016.pal+P[0].p2016.oth)}%`)&&Ji(y,"left",T,!1),O&1&&A!==(A=`${P[0].p2016.jsh}%`)&&Ji(y,"width",A,!1)},d(P){P&&xe(y)}}}function hf(C){let y;return{c(){y=Jt(": No data")},l(T){y=$t(T,": No data")},m(T,A){Ke(T,y,A)},d(T){T&&xe(y)}}}function pf(C){let y,T=`${C[0].p1945.pal}%`;return{c(){y=Ye("div"),this.h()},l(A){y=Je(A,"DIV",{class:!0}),dt(y).forEach(xe),this.h()},h(){Re(y,"class","bar svelte-1mshsl8"),Ji(y,"left","0",!1),Ji(y,"width",T,!1),Ji(y,"background-color","#5EBD4C",!1)},m(A,P){Ke(A,y,P)},p(A,P){P&1&&T!==(T=`${A[0].p1945.pal}%`)&&Ji(y,"width",T,!1)},d(A){A&&xe(y)}}}function df(C){let y,T=`${C[1](C[0].p1945.pal)}%`,A=`${C[0].p1945.jsh}%`;return{c(){y=Ye("div"),this.h()},l(P){y=Je(P,"DIV",{class:!0}),dt(y).forEach(xe),this.h()},h(){Re(y,"class","bar svelte-1mshsl8"),Ji(y,"left",T,!1),Ji(y,"width",A,!1),Ji(y,"background-color","#0485A8",!1)},m(P,O){Ke(P,y,O)},p(P,O){O&1&&T!==(T=`${P[1](P[0].p1945.pal)}%`)&&Ji(y,"left",T,!1),O&1&&A!==(A=`${P[0].p1945.jsh}%`)&&Ji(y,"width",A,!1)},d(P){P&&xe(y)}}}function ff(C){let y;return{c(){y=Jt(": No data")},l(T){y=$t(T,": No data")},m(T,A){Ke(T,y,A)},d(T){T&&xe(y)}}}function mf(C){let y,T,A,P,O,U,l=(C[0].p1945.pal?C[0].p1945.pal.toFixed(0):"N/A")+"",W,$,ue,re=(C[0].p2016.pal?C[0].p2016.pal.toFixed(0):"N/A")+"",Z;return{c(){y=Ye("tr"),T=Ye("td"),A=Ye("div"),P=Jt(" Palestinian"),O=At(),U=Ye("td"),W=Jt(l),$=At(),ue=Ye("td"),Z=Jt(re),this.h()},l(me){y=Je(me,"TR",{});var _e=dt(y);T=Je(_e,"TD",{});var Fe=dt(T);A=Je(Fe,"DIV",{class:!0}),dt(A).forEach(xe),P=$t(Fe," Palestinian"),Fe.forEach(xe),O=kt(_e),U=Je(_e,"TD",{class:!0});var gt=dt(U);W=$t(gt,l),gt.forEach(xe),$=kt(_e),ue=Je(_e,"TD",{class:!0});var zt=dt(ue);Z=$t(zt,re),zt.forEach(xe),_e.forEach(xe),this.h()},h(){Re(A,"class","bullet svelte-1mshsl8"),Ji(A,"background-color","#5EBD4C",!1),Re(U,"class","right svelte-1mshsl8"),qi(U,"muted",!C[0].p1945.pal),Re(ue,"class","right svelte-1mshsl8"),qi(ue,"muted",!C[0].p2016.pal)},m(me,_e){Ke(me,y,_e),Be(y,T),Be(T,A),Be(T,P),Be(y,O),Be(y,U),Be(U,W),Be(y,$),Be(y,ue),Be(ue,Z)},p(me,_e){_e&1&&l!==(l=(me[0].p1945.pal?me[0].p1945.pal.toFixed(0):"N/A")+"")&&Kr(W,l),_e&1&&qi(U,"muted",!me[0].p1945.pal),_e&1&&re!==(re=(me[0].p2016.pal?me[0].p2016.pal.toFixed(0):"N/A")+"")&&Kr(Z,re),_e&1&&qi(ue,"muted",!me[0].p2016.pal)},d(me){me&&xe(y)}}}function gf(C){let y,T,A,P,O,U,l=(C[0].p1945.jsh?C[0].p1945.jsh.toFixed(0):"N/A")+"",W,$,ue,re=(C[0].p2016.jsh?C[0].p2016.jsh.toFixed(0):"N/A")+"",Z;return{c(){y=Ye("tr"),T=Ye("td"),A=Ye("div"),P=Jt(" Jewish"),O=At(),U=Ye("td"),W=Jt(l),$=At(),ue=Ye("td"),Z=Jt(re),this.h()},l(me){y=Je(me,"TR",{});var _e=dt(y);T=Je(_e,"TD",{});var Fe=dt(T);A=Je(Fe,"DIV",{class:!0}),dt(A).forEach(xe),P=$t(Fe," Jewish"),Fe.forEach(xe),O=kt(_e),U=Je(_e,"TD",{class:!0});var gt=dt(U);W=$t(gt,l),gt.forEach(xe),$=kt(_e),ue=Je(_e,"TD",{class:!0});var zt=dt(ue);Z=$t(zt,re),zt.forEach(xe),_e.forEach(xe),this.h()},h(){Re(A,"class","bullet svelte-1mshsl8"),Ji(A,"background-color","#0485A8",!1),Re(U,"class","right svelte-1mshsl8"),qi(U,"muted",!C[0].p1945.jsh),Re(ue,"class","right svelte-1mshsl8"),qi(ue,"muted",!C[0].p2016.jsh)},m(me,_e){Ke(me,y,_e),Be(y,T),Be(T,A),Be(T,P),Be(y,O),Be(y,U),Be(U,W),Be(y,$),Be(y,ue),Be(ue,Z)},p(me,_e){_e&1&&l!==(l=(me[0].p1945.jsh?me[0].p1945.jsh.toFixed(0):"N/A")+"")&&Kr(W,l),_e&1&&qi(U,"muted",!me[0].p1945.jsh),_e&1&&re!==(re=(me[0].p2016.jsh?me[0].p2016.jsh.toFixed(0):"N/A")+"")&&Kr(Z,re),_e&1&&qi(ue,"muted",!me[0].p2016.jsh)},d(me){me&&xe(y)}}}function _f(C){let y,T,A,P,O,U,l,W,$,ue=(C[0].p2016.oth?C[0].p2016.oth.toFixed(0):"N/A")+"",re;return{c(){y=Ye("tr"),T=Ye("td"),A=Ye("div"),P=Jt(" Other"),O=At(),U=Ye("td"),l=Jt("N/A"),W=At(),$=Ye("td"),re=Jt(ue),this.h()},l(Z){y=Je(Z,"TR",{});var me=dt(y);T=Je(me,"TD",{});var _e=dt(T);A=Je(_e,"DIV",{class:!0}),dt(A).forEach(xe),P=$t(_e," Other"),_e.forEach(xe),O=kt(me),U=Je(me,"TD",{class:!0});var Fe=dt(U);l=$t(Fe,"N/A"),Fe.forEach(xe),W=kt(me),$=Je(me,"TD",{class:!0});var gt=dt($);re=$t(gt,ue),gt.forEach(xe),me.forEach(xe),this.h()},h(){Re(A,"class","bullet svelte-1mshsl8"),Ji(A,"background-color","#aaa",!1),Re(U,"class","right muted svelte-1mshsl8"),Re($,"class","right svelte-1mshsl8"),qi($,"muted",!C[0].p2016.oth)},m(Z,me){Ke(Z,y,me),Be(y,T),Be(T,A),Be(T,P),Be(y,O),Be(y,U),Be(U,l),Be(y,W),Be(y,$),Be($,re)},p(Z,me){me&1&&ue!==(ue=(Z[0].p2016.oth?Z[0].p2016.oth.toFixed(0):"N/A")+"")&&Kr(re,ue),me&1&&qi($,"muted",!Z[0].p2016.oth)},d(Z){Z&&xe(y)}}}function Hg(C){let y,T,A,P,O,U,l,W,$,ue,re,Z,me,_e,Fe,gt,zt,Ct,it,je,nt,ct,Xe,at,rt,Oe,bt,We,ft,wt,Ze=C[0].p2016.pal&&lf(C),De=C[0].p2016.oth&&cf(C),Wt=C[0].p2016.jsh&&uf(C),si=!C[0].p2016.pop&&hf(),vt=C[0].p1945.pal&&pf(C),Ht=C[0].p1945.jsh&&df(C),gi=!C[0].p1945.pop&&ff(),ui=(C[0].p1945.pal||C[0].p2016.pal)&&mf(C),Ci=(C[0].p1945.jsh||C[0].p2016.jsh)&&gf(C),fi=C[0].p2016.oth&&_f(C);return{c(){y=Ye("div"),T=Ye("div"),A=Ye("div"),Ze&&Ze.c(),P=At(),De&&De.c(),O=At(),Wt&&Wt.c(),U=At(),l=Ye("div"),W=Jt("2016"),si&&si.c(),$=At(),ue=Ye("div"),vt&&vt.c(),re=At(),Ht&&Ht.c(),Z=At(),me=Ye("div"),_e=Jt("1945"),gi&&gi.c(),Fe=At(),gt=Ye("table"),zt=Ye("thead"),Ct=Ye("tr"),it=Ye("th"),je=Jt("%"),nt=At(),ct=Ye("th"),Xe=Jt("1945"),at=At(),rt=Ye("th"),Oe=Jt("2016"),bt=At(),We=Ye("tbody"),ui&&ui.c(),ft=At(),Ci&&Ci.c(),wt=At(),fi&&fi.c(),this.h()},l(ei){y=Je(ei,"DIV",{class:!0});var _i=dt(y);T=Je(_i,"DIV",{class:!0});var $i=dt(T);A=Je($i,"DIV",{class:!0});var lt=dt(A);Ze&&Ze.l(lt),P=kt(lt),De&&De.l(lt),O=kt(lt),Wt&&Wt.l(lt),U=kt(lt),l=Je(lt,"DIV",{class:!0});var $e=dt(l);W=$t($e,"2016"),si&&si.l($e),$e.forEach(xe),lt.forEach(xe),$=kt($i),ue=Je($i,"DIV",{class:!0});var di=dt(ue);vt&&vt.l(di),re=kt(di),Ht&&Ht.l(di),Z=kt(di),me=Je(di,"DIV",{class:!0});var Ui=dt(me);_e=$t(Ui,"1945"),gi&&gi.l(Ui),Ui.forEach(xe),di.forEach(xe),$i.forEach(xe),Fe=kt(_i),gt=Je(_i,"TABLE",{class:!0});var Mr=dt(gt);zt=Je(Mr,"THEAD",{});var Ai=dt(zt);Ct=Je(Ai,"TR",{});var gr=dt(Ct);it=Je(gr,"TH",{class:!0});var _r=dt(it);je=$t(_r,"%"),_r.forEach(xe),nt=kt(gr),ct=Je(gr,"TH",{class:!0});var Er=dt(ct);Xe=$t(Er,"1945"),Er.forEach(xe),at=kt(gr),rt=Je(gr,"TH",{class:!0});var Dr=dt(rt);Oe=$t(Dr,"2016"),Dr.forEach(xe),gr.forEach(xe),Ai.forEach(xe),bt=kt(Mr),We=Je(Mr,"TBODY",{});var Jr=dt(We);ui&&ui.l(Jr),ft=kt(Jr),Ci&&Ci.l(Jr),wt=kt(Jr),fi&&fi.l(Jr),Jr.forEach(xe),Mr.forEach(xe),_i.forEach(xe),this.h()},h(){Re(l,"class","bar-label white svelte-1mshsl8"),Re(A,"class","bar-group svelte-1mshsl8"),Ji(A,"height","60px",!1),Re(me,"class","bar-label white svelte-1mshsl8"),Re(ue,"class","bar-group svelte-1mshsl8"),Ji(ue,"height","20px",!1),Ji(ue,"margin-top","2px",!1),Re(T,"class","chart svelte-1mshsl8"),Re(it,"class","svelte-1mshsl8"),Re(ct,"class","right svelte-1mshsl8"),Re(rt,"class","right svelte-1mshsl8"),Re(gt,"class","table svelte-1mshsl8"),Re(y,"class","chart-container svelte-1mshsl8")},m(ei,_i){Ke(ei,y,_i),Be(y,T),Be(T,A),Ze&&Ze.m(A,null),Be(A,P),De&&De.m(A,null),Be(A,O),Wt&&Wt.m(A,null),Be(A,U),Be(A,l),Be(l,W),si&&si.m(l,null),Be(T,$),Be(T,ue),vt&&vt.m(ue,null),Be(ue,re),Ht&&Ht.m(ue,null),Be(ue,Z),Be(ue,me),Be(me,_e),gi&&gi.m(me,null),Be(y,Fe),Be(y,gt),Be(gt,zt),Be(zt,Ct),Be(Ct,it),Be(it,je),Be(Ct,nt),Be(Ct,ct),Be(ct,Xe),Be(Ct,at),Be(Ct,rt),Be(rt,Oe),Be(gt,bt),Be(gt,We),ui&&ui.m(We,null),Be(We,ft),Ci&&Ci.m(We,null),Be(We,wt),fi&&fi.m(We,null)},p(ei,[_i]){ei[0].p2016.pal?Ze?Ze.p(ei,_i):(Ze=lf(ei),Ze.c(),Ze.m(A,P)):Ze&&(Ze.d(1),Ze=null),ei[0].p2016.oth?De?De.p(ei,_i):(De=cf(ei),De.c(),De.m(A,O)):De&&(De.d(1),De=null),ei[0].p2016.jsh?Wt?Wt.p(ei,_i):(Wt=uf(ei),Wt.c(),Wt.m(A,U)):Wt&&(Wt.d(1),Wt=null),ei[0].p2016.pop?si&&(si.d(1),si=null):si||(si=hf(),si.c(),si.m(l,null)),ei[0].p1945.pal?vt?vt.p(ei,_i):(vt=pf(ei),vt.c(),vt.m(ue,re)):vt&&(vt.d(1),vt=null),ei[0].p1945.jsh?Ht?Ht.p(ei,_i):(Ht=df(ei),Ht.c(),Ht.m(ue,Z)):Ht&&(Ht.d(1),Ht=null),ei[0].p1945.pop?gi&&(gi.d(1),gi=null):gi||(gi=ff(),gi.c(),gi.m(me,null)),ei[0].p1945.pal||ei[0].p2016.pal?ui?ui.p(ei,_i):(ui=mf(ei),ui.c(),ui.m(We,ft)):ui&&(ui.d(1),ui=null),ei[0].p1945.jsh||ei[0].p2016.jsh?Ci?Ci.p(ei,_i):(Ci=gf(ei),Ci.c(),Ci.m(We,wt)):Ci&&(Ci.d(1),Ci=null),ei[0].p2016.oth?fi?fi.p(ei,_i):(fi=_f(ei),fi.c(),fi.m(We,null)):fi&&(fi.d(1),fi=null)},i:ds,o:ds,d(ei){ei&&xe(y),Ze&&Ze.d(),De&&De.d(),Wt&&Wt.d(),si&&si.d(),vt&&vt.d(),Ht&&Ht.d(),gi&&gi.d(),ui&&ui.d(),Ci&&Ci.d(),fi&&fi.d()}}}function Kg(C,y,T){let{data:A}=y;const P=O=>O==null?0:O;return C.$$set=O=>{"data"in O&&T(0,A=O.data)},[A,P]}class Yg extends Qn{constructor(y){super(),es(this,y,Kg,Hg,ts,{data:0})}}function Jg(C){let y,T,A,P,O,U,l,W,$,ue,re=C[0].name+"",Z,me,_e,Fe,gt=C[0].author+"",zt,Ct,it=C[0].scale.toLocaleString()+"",je,nt,ct,Xe=C[0].year+"",at,rt,Oe,bt,We;return bt=new Ns({props:{type:"download"}}),{c(){y=Ye("div"),T=Ye("div"),A=Ye("a"),P=Ye("img"),W=At(),$=Ye("div"),ue=Ye("h3"),Z=Jt(re),me=At(),_e=Ye("p"),Fe=Ye("strong"),zt=Jt(gt),Ct=Jt(`
      Scale: 1:`),je=Jt(it),nt=Ye("br"),ct=Jt(`
      Date: `),at=Jt(Xe),rt=At(),Oe=Ye("button"),ai(bt.$$.fragment),this.h()},l(ft){y=Je(ft,"DIV",{class:!0});var wt=dt(y);T=Je(wt,"DIV",{class:!0});var Ze=dt(T);A=Je(Ze,"A",{href:!0});var De=dt(A);P=Je(De,"IMG",{src:!0,alt:!0,class:!0}),De.forEach(xe),Ze.forEach(xe),W=kt(wt),$=Je(wt,"DIV",{class:!0});var Wt=dt($);ue=Je(Wt,"H3",{class:!0});var si=dt(ue);Z=$t(si,re),si.forEach(xe),me=kt(Wt),_e=Je(Wt,"P",{class:!0});var vt=dt(_e);Fe=Je(vt,"STRONG",{});var Ht=dt(Fe);zt=$t(Ht,gt),Ht.forEach(xe),Ct=$t(vt,`
      Scale: 1:`),je=$t(vt,it),nt=Je(vt,"BR",{}),ct=$t(vt,`
      Date: `),at=$t(vt,Xe),vt.forEach(xe),rt=kt(Wt),Oe=Je(Wt,"BUTTON",{name:!0,class:!0});var gi=dt(Oe);Si(bt.$$.fragment,gi),gi.forEach(xe),Wt.forEach(xe),wt.forEach(xe),this.h()},h(){Ad(P.src,O="https://palopenmaps.org/static/images/thumbs/"+C[0].layer+"/"+C[0].file_name)||Re(P,"src",O),Re(P,"alt",U=C[0].name),Re(P,"class","svelte-15vju7l"),Re(A,"href",l=C[0].dropbox_link),Re(T,"class","svelte-15vju7l"),Re(ue,"class","svelte-15vju7l"),Re(_e,"class","svelte-15vju7l"),Re(Oe,"name","Download sheet"),Re(Oe,"class","svelte-15vju7l"),Re($,"class","sheet-info svelte-15vju7l"),Re(y,"class","sheet svelte-15vju7l")},m(ft,wt){Ke(ft,y,wt),Be(y,T),Be(T,A),Be(A,P),Be(y,W),Be(y,$),Be($,ue),Be(ue,Z),Be($,me),Be($,_e),Be(_e,Fe),Be(Fe,zt),Be(_e,Ct),Be(_e,je),Be(_e,nt),Be(_e,ct),Be(_e,at),Be($,rt),Be($,Oe),li(bt,Oe,null),We=!0},p(ft,[wt]){(!We||wt&1&&!Ad(P.src,O="https://palopenmaps.org/static/images/thumbs/"+ft[0].layer+"/"+ft[0].file_name))&&Re(P,"src",O),(!We||wt&1&&U!==(U=ft[0].name))&&Re(P,"alt",U),(!We||wt&1&&l!==(l=ft[0].dropbox_link))&&Re(A,"href",l),(!We||wt&1)&&re!==(re=ft[0].name+"")&&Kr(Z,re),(!We||wt&1)&&gt!==(gt=ft[0].author+"")&&Kr(zt,gt),(!We||wt&1)&&it!==(it=ft[0].scale.toLocaleString()+"")&&Kr(je,it),(!We||wt&1)&&Xe!==(Xe=ft[0].year+"")&&Kr(at,Xe)},i(ft){We||(Qe(bt.$$.fragment,ft),We=!0)},o(ft){mt(bt.$$.fragment,ft),We=!1},d(ft){ft&&xe(y),ci(bt)}}}function $g(C,y,T){let{sheet:A}=y;return C.$$set=P=>{"sheet"in P&&T(0,A=P.sheet)},[A]}class hm extends Qn{constructor(y){super(),es(this,y,$g,Jg,ts,{sheet:0})}}function yf(C,y,T){const A=C.slice();return A[59]=y[T],A}function xf(C,y,T){const A=C.slice();return A[59]=y[T],A}function vf(C,y,T){const A=C.slice();return A[64]=y[T],A}function bf(C,y,T){const A=C.slice();return A[67]=y[T],A}function wf(C,y,T){const A=C.slice();return A[67]=y[T],A}function Tf(C,y,T){const A=C.slice();return A[72]=y[T],A[73]=y,A[74]=T,A}function If(C,y,T){const A=C.slice();return A[67]=y[T],A}function Qg(C){let y,T;return{c(){y=Ye("style"),T=Jt(`@media only screen and (max-width: 450px) {
			.maplibregl-ctrl-top-right {
				top: 50px !important;
			}
		}`)},l(A){y=Je(A,"STYLE",{});var P=dt(y);T=$t(P,`@media only screen and (max-width: 450px) {
			.maplibregl-ctrl-top-right {
				top: 50px !important;
			}
		}`),P.forEach(xe)},m(A,P){Ke(A,y,P),Be(y,T)},d(A){A&&xe(y)}}}function e_(C){let y,T;return{c(){y=Ye("style"),T=Jt(`html {
			direction: rtl;
		}
		.maplibregl-ctrl-top-right {
			left: 0;
			right: auto !important;
		}
		@media only screen and (max-width: 450px) {
			.maplibregl-ctrl-top-right {
				top: 50px !important;
			}
		}
		.maplibregl-ctrl-top-right .maplibregl-ctrl {
			margin: 10px 0 0 10px !important;
		}
		.selectContainer .selectedItem {
			padding: 0 0 0 20px !important;
		}
		.selectContainer .clearSelect {
			right: auto !important;
			left: 10px !important;
		}`)},l(A){y=Je(A,"STYLE",{});var P=dt(y);T=$t(P,`html {
			direction: rtl;
		}
		.maplibregl-ctrl-top-right {
			left: 0;
			right: auto !important;
		}
		@media only screen and (max-width: 450px) {
			.maplibregl-ctrl-top-right {
				top: 50px !important;
			}
		}
		.maplibregl-ctrl-top-right .maplibregl-ctrl {
			margin: 10px 0 0 10px !important;
		}
		.selectContainer .selectedItem {
			padding: 0 0 0 20px !important;
		}
		.selectContainer .clearSelect {
			right: auto !important;
			left: 10px !important;
		}`),P.forEach(xe)},m(A,P){Ke(A,y,P),Be(y,T)},d(A){A&&xe(y)}}}function Sf(C){let y,T;return y=new hg({props:{mapLeft:C[11].left,mapRight:C[11].right,$$slots:{default:[l_]},$$scope:{ctx:C}}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&2048&&(O.mapLeft=A[11].left),P[0]&2048&&(O.mapRight=A[11].right),P[0]&5160830|P[2]&65536&&(O.$$scope={dirty:P,ctx:A}),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function Ef(C){let y,T,A,P,O,U,l;function W(_e){C[31](_e,C[72])}function $(_e){C[32](_e,C[72])}function ue(_e){C[33](_e,C[72])}function re(_e){C[34](_e,C[72])}function Z(_e){C[35](_e,C[72])}let me={id:"map-"+C[72],style:Lm,location:C[72]=="left"||!C[6].left?C[17]:dd(qo({},C[5].left),{zoom:C[6].left,pitch:C[12].left,bearing:C[13].left}),minzoom:5,maxzoom:17,attribution:!1,controls:["compass","pitch","locate"],$$slots:{default:[a_]},$$scope:{ctx:C}};return C[11][C[72]]!==void 0&&(me.map=C[11][C[72]]),C[5][C[72]]!==void 0&&(me.center=C[5][C[72]]),C[6][C[72]]!==void 0&&(me.zoom=C[6][C[72]]),C[12][C[72]]!==void 0&&(me.pitch=C[12][C[72]]),C[13][C[72]]!==void 0&&(me.bearing=C[13][C[72]]),y=new Om({props:me}),js.push(()=>lc(y,"map",W)),js.push(()=>lc(y,"center",$)),js.push(()=>lc(y,"zoom",ue)),js.push(()=>lc(y,"pitch",re)),js.push(()=>lc(y,"bearing",Z)),{c(){ai(y.$$.fragment)},l(_e){Si(y.$$.fragment,_e)},m(_e,Fe){li(y,_e,Fe),l=!0},p(_e,Fe){C=_e;const gt={};Fe[0]&143456&&(gt.location=C[72]=="left"||!C[6].left?C[17]:dd(qo({},C[5].left),{zoom:C[6].left,pitch:C[12].left,bearing:C[13].left})),Fe[0]&5015326|Fe[2]&65536&&(gt.$$scope={dirty:Fe,ctx:C}),!T&&Fe[0]&2048&&(T=!0,gt.map=C[11][C[72]],Kc(()=>T=!1)),!A&&Fe[0]&32&&(A=!0,gt.center=C[5][C[72]],Kc(()=>A=!1)),!P&&Fe[0]&64&&(P=!0,gt.zoom=C[6][C[72]],Kc(()=>P=!1)),!O&&Fe[0]&4096&&(O=!0,gt.pitch=C[12][C[72]],Kc(()=>O=!1)),!U&&Fe[0]&8192&&(U=!0,gt.bearing=C[13][C[72]],Kc(()=>U=!1)),y.$set(gt)},i(_e){l||(Qe(y.$$.fragment,_e),l=!0)},o(_e){mt(y.$$.fragment,_e),l=!1},d(_e){ci(y,_e)}}}function t_(C){let y,T;return y=new Fu({props:{id:"basemap",type:"raster",paint:{"raster-saturation":C[18].overlay?-.85:0},order:"basemap-div"}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&262144&&(O.paint={"raster-saturation":A[18].overlay?-.85:0}),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function Af(C){let y,T;return y=new Fu({props:{id:C[67].id,type:C[67].type,sourceLayer:C[67]["source-layer"],filter:C[67].filter?C[67].filter:null,layout:C[67].layout?C[67].layout:{},paint:C[67].paint,minzoom:C[67].minzoom?C[67].minzoom:null,maxzoom:C[67].maxzoom?C[67].maxzoom:null,order:["building","transport"].includes(C[67].group)?"overlays-div":null,visible:C[18].overlay&&C[19][C[67].group]}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&786432&&(O.visible=A[18].overlay&&A[19][A[67].group]),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function i_(C){let y,T,A=Pd,P=[];for(let U=0;U<A.length;U+=1)P[U]=Af(If(C,A,U));const O=U=>mt(P[U],1,1,()=>{P[U]=null});return{c(){for(let U=0;U<P.length;U+=1)P[U].c();y=Pi()},l(U){for(let l=0;l<P.length;l+=1)P[l].l(U);y=Pi()},m(U,l){for(let W=0;W<P.length;W+=1)P[W].m(U,l);Ke(U,y,l),T=!0},p(U,l){if(l[0]&786432){A=Pd;let W;for(W=0;W<A.length;W+=1){const $=If(U,A,W);P[W]?(P[W].p($,l),Qe(P[W],1)):(P[W]=Af($),P[W].c(),Qe(P[W],1),P[W].m(y.parentNode,y))}for(pr(),W=A.length;W<P.length;W+=1)O(W);dr()}},i(U){if(!T){for(let l=0;l<A.length;l+=1)Qe(P[l]);T=!0}},o(U){P=P.filter(Boolean);for(let l=0;l<P.length;l+=1)mt(P[l]);T=!1},d(U){tl(P,U),U&&xe(y)}}}function r_(C){let y,T;function A(...P){return C[29](C[75],...P)}return y=new Xm({props:{content:C[75]?C[3].features.find(A).properties.name_en:""}}),{c(){ai(y.$$.fragment)},l(P){Si(y.$$.fragment,P)},m(P,O){li(y,P,O),T=!0},p(P,O){C=P;const U={};O[0]&8|O[2]&8192&&(U.content=C[75]?C[3].features.find(A).properties.name_en:""),y.$set(U)},i(P){T||(Qe(y.$$.fragment,P),T=!0)},o(P){mt(y.$$.fragment,P),T=!1},d(P){ci(y,P)}}}function n_(C){let y,T;return y=new Fu({props:{id:"places",type:"circle",paint:{"circle-radius":{base:1,stops:[[5,1],[12,5]]},"circle-color":["get","color"],"circle-stroke-color":["case",["==",["feature-state","selected"],!0],"black",["==",["feature-state","hovered"],!0],"black","rgba(0,0,0,0.2)"],"circle-stroke-width":{base:1,stops:[[5,1],[12,2]]}},filter:C[22],hover:!0,select:!0,selected:C[4]?C[4].properties.id:null,visible:C[18].places,order:"places-div",$$slots:{default:[r_,({hovered:A})=>({75:A}),({hovered:A})=>[0,0,A?8192:0]]},$$scope:{ctx:C}}}),y.$on("select",C[25]),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&4194304&&(O.filter=A[22]),P[0]&16&&(O.selected=A[4]?A[4].properties.id:null),P[0]&262144&&(O.visible=A[18].places),P[0]&8|P[2]&73728&&(O.$$scope={dirty:P,ctx:A}),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function kf(C){let y,T;return y=new Dh({props:{id:"sheets",type:"geojson",data:C[2],promoteId:"id",maxzoom:14,$$slots:{default:[s_]},$$scope:{ctx:C}}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&4&&(O.data=A[2]),P[0]&34048|P[2]&65536&&(O.$$scope={dirty:P,ctx:A}),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function s_(C){let y,T,A,P;return y=new Fu({props:{id:"sheets-click",type:"fill",paint:{"fill-color":"magenta","fill-opacity":.02},select:!0}}),y.$on("select",C[30]),A=new Fu({props:{id:"sheets",type:"line",filter:C[8].id==15?["in","layer",6,8,9]:["==","layer",C[8].id],paint:{"line-color":"magenta","line-width":1}}}),{c(){ai(y.$$.fragment),T=At(),ai(A.$$.fragment)},l(O){Si(y.$$.fragment,O),T=kt(O),Si(A.$$.fragment,O)},m(O,U){li(y,O,U),Ke(O,T,U),li(A,O,U),P=!0},p(O,U){const l={};U[0]&256&&(l.filter=O[8].id==15?["in","layer",6,8,9]:["==","layer",O[8].id]),A.$set(l)},i(O){P||(Qe(y.$$.fragment,O),Qe(A.$$.fragment,O),P=!0)},o(O){mt(y.$$.fragment,O),mt(A.$$.fragment,O),P=!1},d(O){ci(y,O),O&&xe(T),ci(A,O)}}}function zf(C){let y,T,A,P;return y=new Fu({props:{id:"hillshade",type:"hillshade",order:"basemap-div",paint:{"hillshade-exaggeration":.1,"hillshade-accent-color":"rgba(0,0,0,0)","hillshade-shadow-color":"rgba(0,0,0,0.7)","hillshade-highlight-color":"rgba(255,255,255,0.3)"}}}),A=new dg({}),{c(){ai(y.$$.fragment),T=At(),ai(A.$$.fragment)},l(O){Si(y.$$.fragment,O),T=kt(O),Si(A.$$.fragment,O)},m(O,U){li(y,O,U),Ke(O,T,U),li(A,O,U),P=!0},i(O){P||(Qe(y.$$.fragment,O),Qe(A.$$.fragment,O),P=!0)},o(O){mt(y.$$.fragment,O),mt(A.$$.fragment,O),P=!1},d(O){ci(y,O),O&&xe(T),ci(A,O)}}}function o_(C){let y,T,A=C[18].threed&&zf();return{c(){A&&A.c(),y=Pi()},l(P){A&&A.l(P),y=Pi()},m(P,O){A&&A.m(P,O),Ke(P,y,O),T=!0},p(P,O){P[18].threed?A?O[0]&262144&&Qe(A,1):(A=zf(),A.c(),Qe(A,1),A.m(y.parentNode,y)):A&&(pr(),mt(A,1,1,()=>{A=null}),dr())},i(P){T||(Qe(A),T=!0)},o(P){mt(A),T=!1},d(P){A&&A.d(P),P&&xe(y)}}}function a_(C){let y,T,A,P,O,U,l,W,$,ue,re;y=new Dh({props:{id:"basemap",type:"raster",url:C[72]=="left"?C[8].url:C[1][0].url,maxzoom:17,$$slots:{default:[t_]},$$scope:{ctx:C}}}),A=new Dh({props:{id:"overlay",type:"vector",url:C[9].url,maxzoom:14,$$slots:{default:[i_]},$$scope:{ctx:C}}}),O=new Dh({props:{id:"places",type:"geojson",data:C[3],promoteId:"id",$$slots:{default:[n_]},$$scope:{ctx:C}}});let Z=C[18].download&&kf(C);W=new Dh({props:{id:"terrain",type:"raster-dem",url:"https://tile.nextzen.org/tilezen/terrain/v1/256/terrarium/{z}/{x}/{y}.png?api_key=_WbqOjpNS6-ug4JaHzHcdw",$$slots:{default:[o_]},$$scope:{ctx:C}}});let me=!1;return{c(){ai(y.$$.fragment),T=At(),ai(A.$$.fragment),P=At(),ai(O.$$.fragment),U=At(),Z&&Z.c(),l=At(),ai(W.$$.fragment),$=At(),ue=At()},l(_e){Si(y.$$.fragment,_e),T=kt(_e),Si(A.$$.fragment,_e),P=kt(_e),Si(O.$$.fragment,_e),U=kt(_e),Z&&Z.l(_e),l=kt(_e),Si(W.$$.fragment,_e),$=kt(_e),ue=kt(_e)},m(_e,Fe){li(y,_e,Fe),Ke(_e,T,Fe),li(A,_e,Fe),Ke(_e,P,Fe),li(O,_e,Fe),Ke(_e,U,Fe),Z&&Z.m(_e,Fe),Ke(_e,l,Fe),li(W,_e,Fe),Ke(_e,$,Fe),Ke(_e,ue,Fe),re=!0},p(_e,Fe){const gt={};Fe[0]&258&&(gt.url=_e[72]=="left"?_e[8].url:_e[1][0].url),Fe[0]&262144|Fe[2]&65536&&(gt.$$scope={dirty:Fe,ctx:_e}),y.$set(gt);const zt={};Fe[0]&512&&(zt.url=_e[9].url),Fe[0]&786432|Fe[2]&65536&&(zt.$$scope={dirty:Fe,ctx:_e}),A.$set(zt);const Ct={};Fe[0]&8&&(Ct.data=_e[3]),Fe[0]&4456472|Fe[2]&65536&&(Ct.$$scope={dirty:Fe,ctx:_e}),O.$set(Ct),_e[18].download?Z?(Z.p(_e,Fe),Fe[0]&262144&&Qe(Z,1)):(Z=kf(_e),Z.c(),Qe(Z,1),Z.m(l.parentNode,l)):Z&&(pr(),mt(Z,1,1,()=>{Z=null}),dr());const it={};Fe[0]&262144|Fe[2]&65536&&(it.$$scope={dirty:Fe,ctx:_e}),W.$set(it)},i(_e){re||(Qe(y.$$.fragment,_e),Qe(A.$$.fragment,_e),Qe(O.$$.fragment,_e),Qe(Z),Qe(W.$$.fragment,_e),Qe(me),re=!0)},o(_e){mt(y.$$.fragment,_e),mt(A.$$.fragment,_e),mt(O.$$.fragment,_e),mt(Z),mt(W.$$.fragment,_e),mt(me),re=!1},d(_e){ci(y,_e),_e&&xe(T),ci(A,_e),_e&&xe(P),ci(O,_e),_e&&xe(U),Z&&Z.d(_e),_e&&xe(l),ci(W,_e),_e&&xe($),_e&&xe(ue)}}}function Cf(C){let y,T,A=(C[72]=="left"||C[72]=="right"&&C[18].split)&&Ef(C);return{c(){A&&A.c(),y=Pi()},l(P){A&&A.l(P),y=Pi()},m(P,O){A&&A.m(P,O),Ke(P,y,O),T=!0},p(P,O){P[72]=="left"||P[72]=="right"&&P[18].split?A?(A.p(P,O),O[0]&262144&&Qe(A,1)):(A=Ef(P),A.c(),Qe(A,1),A.m(y.parentNode,y)):A&&(pr(),mt(A,1,1,()=>{A=null}),dr())},i(P){T||(Qe(A),T=!0)},o(P){mt(A),T=!1},d(P){A&&A.d(P),P&&xe(y)}}}function l_(C){let y,T,A=["left","right"],P=[];for(let U=0;U<2;U+=1)P[U]=Cf(Tf(C,A,U));const O=U=>mt(P[U],1,1,()=>{P[U]=null});return{c(){for(let U=0;U<2;U+=1)P[U].c();y=Pi()},l(U){for(let l=0;l<2;l+=1)P[l].l(U);y=Pi()},m(U,l){for(let W=0;W<2;W+=1)P[W].m(U,l);Ke(U,y,l),T=!0},p(U,l){if(l[0]&38715262|l[2]&8192){A=["left","right"];let W;for(W=0;W<2;W+=1){const $=Tf(U,A,W);P[W]?(P[W].p($,l),Qe(P[W],1)):(P[W]=Cf($),P[W].c(),Qe(P[W],1),P[W].m(y.parentNode,y))}for(pr(),W=2;W<2;W+=1)O(W);dr()}},i(U){if(!T){for(let l=0;l<2;l+=1)Qe(P[l]);T=!0}},o(U){P=P.filter(Boolean);for(let l=0;l<2;l+=1)mt(P[l]);T=!1},d(U){tl(P,U),U&&xe(y)}}}function Pf(C){let y,T,A,P,O,U,l,W,$;A=new Ns({props:{type:"close"}});const ue=[u_,c_],re=[];function Z(me,_e){return me[4]&&me[16]=="place"?0:me[16]=="layer"?1:-1}return~(O=Z(C))&&(U=re[O]=ue[O](C)),{c(){y=Ye("article"),T=Ye("button"),ai(A.$$.fragment),P=At(),U&&U.c(),this.h()},l(me){y=Je(me,"ARTICLE",{id:!0,class:!0});var _e=dt(y);T=Je(_e,"BUTTON",{class:!0});var Fe=dt(T);Si(A.$$.fragment,Fe),Fe.forEach(xe),P=kt(_e),U&&U.l(_e),_e.forEach(xe),this.h()},h(){Re(T,"class","content-toggle svelte-1n8wvn1"),qi(T,"content-toggle-rtl",C[21]),Re(y,"id","content"),Re(y,"class","svelte-1n8wvn1"),qi(y,"content-rtl",C[21])},m(me,_e){Ke(me,y,_e),Be(y,T),li(A,T,null),Be(y,P),~O&&re[O].m(y,null),l=!0,W||($=nr(T,"click",C[42]),W=!0)},p(me,_e){_e[0]&2097152&&qi(T,"content-toggle-rtl",me[21]);let Fe=O;O=Z(me),O===Fe?~O&&re[O].p(me,_e):(U&&(pr(),mt(re[Fe],1,1,()=>{re[Fe]=null}),dr()),~O?(U=re[O],U?U.p(me,_e):(U=re[O]=ue[O](me),U.c()),Qe(U,1),U.m(y,null)):U=null),_e[0]&2097152&&qi(y,"content-rtl",me[21])},i(me){l||(Qe(A.$$.fragment,me),Qe(U),l=!0)},o(me){mt(A.$$.fragment,me),mt(U),l=!1},d(me){me&&xe(y),ci(A),~O&&re[O].d(),W=!1,$()}}}function c_(C){let y,T=C[8].name.slice(0,C[8].name.lastIndexOf(","))+"",A,P,O,U=C[8].attribution.split(",")[0]+"",l,W,$,ue,re,Z;return $=new $c({props:{label:"Information",$$slots:{default:[h_]},$$scope:{ctx:C}}}),re=new $c({props:{label:"Description",$$slots:{default:[p_]},$$scope:{ctx:C}}}),{c(){y=Ye("h1"),A=Jt(T),P=At(),O=Ye("h2"),l=Jt(U),W=At(),ai($.$$.fragment),ue=At(),ai(re.$$.fragment),this.h()},l(me){y=Je(me,"H1",{class:!0});var _e=dt(y);A=$t(_e,T),_e.forEach(xe),P=kt(me),O=Je(me,"H2",{class:!0});var Fe=dt(O);l=$t(Fe,U),Fe.forEach(xe),W=kt(me),Si($.$$.fragment,me),ue=kt(me),Si(re.$$.fragment,me),this.h()},h(){Re(y,"class","svelte-1n8wvn1"),Re(O,"class","svelte-1n8wvn1")},m(me,_e){Ke(me,y,_e),Be(y,A),Ke(me,P,_e),Ke(me,O,_e),Be(O,l),Ke(me,W,_e),li($,me,_e),Ke(me,ue,_e),li(re,me,_e),Z=!0},p(me,_e){(!Z||_e[0]&256)&&T!==(T=me[8].name.slice(0,me[8].name.lastIndexOf(","))+"")&&Kr(A,T),(!Z||_e[0]&256)&&U!==(U=me[8].attribution.split(",")[0]+"")&&Kr(l,U);const Fe={};_e[0]&260|_e[2]&65536&&(Fe.$$scope={dirty:_e,ctx:me}),$.$set(Fe);const gt={};_e[0]&256|_e[2]&65536&&(gt.$$scope={dirty:_e,ctx:me}),re.$set(gt)},i(me){Z||(Qe($.$$.fragment,me),Qe(re.$$.fragment,me),Z=!0)},o(me){mt($.$$.fragment,me),mt(re.$$.fragment,me),Z=!1},d(me){me&&xe(y),me&&xe(P),me&&xe(O),me&&xe(W),ci($,me),me&&xe(ue),ci(re,me)}}}function u_(C){let y,T=(C[21]?C[4].properties.name_ar:C[4].properties.name_en)+"",A,P,O,U=C[4].properties.group+"",l,W,$=C[4].properties.type+"",ue,re,Z=C[4].properties.district_1945+"",me,_e,Fe,gt,zt,Ct,it,je,nt;gt=new $c({props:{label:"Change since 1948",$$slots:{default:[d_]},$$scope:{ctx:C}}});let ct=(C[4].properties.start||C[4].properties.end)&&Df(C),Xe=(C[4].properties.pop_1945||C[4].properties.pop_2016)&&Rf(C),at=(C[4].properties.map_20k=="yes"||C[4].properties.id_zo)&&Uf(C);return{c(){y=Ye("h1"),A=Jt(T),P=At(),O=Ye("h2"),l=Jt(U),W=At(),ue=Jt($),re=Jt(` in
				`),me=Jt(Z),_e=Jt(" district"),Fe=At(),ai(gt.$$.fragment),zt=At(),ct&&ct.c(),Ct=At(),Xe&&Xe.c(),it=At(),at&&at.c(),je=Pi(),this.h()},l(rt){y=Je(rt,"H1",{class:!0});var Oe=dt(y);A=$t(Oe,T),Oe.forEach(xe),P=kt(rt),O=Je(rt,"H2",{class:!0});var bt=dt(O);l=$t(bt,U),W=kt(bt),ue=$t(bt,$),re=$t(bt,` in
				`),me=$t(bt,Z),_e=$t(bt," district"),bt.forEach(xe),Fe=kt(rt),Si(gt.$$.fragment,rt),zt=kt(rt),ct&&ct.l(rt),Ct=kt(rt),Xe&&Xe.l(rt),it=kt(rt),at&&at.l(rt),je=Pi(),this.h()},h(){Re(y,"class","svelte-1n8wvn1"),Re(O,"class","svelte-1n8wvn1")},m(rt,Oe){Ke(rt,y,Oe),Be(y,A),Ke(rt,P,Oe),Ke(rt,O,Oe),Be(O,l),Be(O,W),Be(O,ue),Be(O,re),Be(O,me),Be(O,_e),Ke(rt,Fe,Oe),li(gt,rt,Oe),Ke(rt,zt,Oe),ct&&ct.m(rt,Oe),Ke(rt,Ct,Oe),Xe&&Xe.m(rt,Oe),Ke(rt,it,Oe),at&&at.m(rt,Oe),Ke(rt,je,Oe),nt=!0},p(rt,Oe){(!nt||Oe[0]&2097168)&&T!==(T=(rt[21]?rt[4].properties.name_ar:rt[4].properties.name_en)+"")&&Kr(A,T),(!nt||Oe[0]&16)&&U!==(U=rt[4].properties.group+"")&&Kr(l,U),(!nt||Oe[0]&16)&&$!==($=rt[4].properties.type+"")&&Kr(ue,$),(!nt||Oe[0]&16)&&Z!==(Z=rt[4].properties.district_1945+"")&&Kr(me,Z);const bt={};Oe[0]&16|Oe[2]&65536&&(bt.$$scope={dirty:Oe,ctx:rt}),gt.$set(bt),rt[4].properties.start||rt[4].properties.end?ct?(ct.p(rt,Oe),Oe[0]&16&&Qe(ct,1)):(ct=Df(rt),ct.c(),Qe(ct,1),ct.m(Ct.parentNode,Ct)):ct&&(pr(),mt(ct,1,1,()=>{ct=null}),dr()),rt[4].properties.pop_1945||rt[4].properties.pop_2016?Xe?(Xe.p(rt,Oe),Oe[0]&16&&Qe(Xe,1)):(Xe=Rf(rt),Xe.c(),Qe(Xe,1),Xe.m(it.parentNode,it)):Xe&&(pr(),mt(Xe,1,1,()=>{Xe=null}),dr()),rt[4].properties.map_20k=="yes"||rt[4].properties.id_zo?at?(at.p(rt,Oe),Oe[0]&16&&Qe(at,1)):(at=Uf(rt),at.c(),Qe(at,1),at.m(je.parentNode,je)):at&&(pr(),mt(at,1,1,()=>{at=null}),dr())},i(rt){nt||(Qe(gt.$$.fragment,rt),Qe(ct),Qe(Xe),Qe(at),nt=!0)},o(rt){mt(gt.$$.fragment,rt),mt(ct),mt(Xe),mt(at),nt=!1},d(rt){rt&&xe(y),rt&&xe(P),rt&&xe(O),rt&&xe(Fe),ci(gt,rt),rt&&xe(zt),ct&&ct.d(rt),rt&&xe(Ct),Xe&&Xe.d(rt),rt&&xe(it),at&&at.d(rt),rt&&xe(je)}}}function Mf(C){let y,T,A,P,O,U=C[2].features.filter(C[43]).length+"",l;return{c(){y=Ye("div"),T=Jt("No. of map sheets"),A=Ye("br"),P=At(),O=Ye("span"),l=Jt(U),this.h()},l(W){y=Je(W,"DIV",{});var $=dt(y);T=$t($,"No. of map sheets"),A=Je($,"BR",{}),P=kt($),O=Je($,"SPAN",{class:!0});var ue=dt(O);l=$t(ue,U),ue.forEach(xe),$.forEach(xe),this.h()},h(){Re(O,"class","text-lrg svelte-1n8wvn1")},m(W,$){Ke(W,y,$),Be(y,T),Be(y,A),Be(y,P),Be(y,O),Be(O,l)},p(W,$){$[0]&260&&U!==(U=W[2].features.filter(W[43]).length+"")&&Kr(l,U)},d(W){W&&xe(y)}}}function h_(C){let y,T,A,P,O,U=Jf(C[8])+"",l,W=C[2].features.filter(C[27]).length>0,$,ue=W&&Mf(C);return{c(){y=Ye("div"),T=Jt("Dates"),A=Ye("br"),P=At(),O=Ye("span"),l=At(),ue&&ue.c(),$=Pi(),this.h()},l(re){y=Je(re,"DIV",{});var Z=dt(y);T=$t(Z,"Dates"),A=Je(Z,"BR",{}),P=kt(Z),O=Je(Z,"SPAN",{class:!0});var me=dt(O);me.forEach(xe),Z.forEach(xe),l=kt(re),ue&&ue.l(re),$=Pi(),this.h()},h(){Re(O,"class","text-lrg svelte-1n8wvn1")},m(re,Z){Ke(re,y,Z),Be(y,T),Be(y,A),Be(y,P),Be(y,O),O.innerHTML=U,Ke(re,l,Z),ue&&ue.m(re,Z),Ke(re,$,Z)},p(re,Z){Z[0]&256&&U!==(U=Jf(re[8])+"")&&(O.innerHTML=U),Z[0]&260&&(W=re[2].features.filter(re[27]).length>0),W?ue?ue.p(re,Z):(ue=Mf(re),ue.c(),ue.m($.parentNode,$)):ue&&(ue.d(1),ue=null)},d(re){re&&xe(y),re&&xe(l),ue&&ue.d(re),re&&xe($)}}}function p_(C){let y,T=C[8].description+"",A;return{c(){y=Ye("div"),A=Jt(T)},l(P){y=Je(P,"DIV",{});var O=dt(y);A=$t(O,T),O.forEach(xe)},m(P,O){Ke(P,y,O),Be(y,A)},p(P,O){O[0]&256&&T!==(T=P[8].description+"")&&Kr(A,T)},d(P){P&&xe(y)}}}function d_(C){let y,T,A,P=C[4].properties.change_2016+"",O;return{c(){y=Ye("div"),T=Ye("div"),A=At(),O=Jt(P),this.h()},l(U){y=Je(U,"DIV",{});var l=dt(y);T=Je(l,"DIV",{class:!0}),dt(T).forEach(xe),A=kt(l),O=$t(l,P),l.forEach(xe),this.h()},h(){Re(T,"class","bullet svelte-1n8wvn1"),Ji(T,"background-color",C[4].properties.color,!1)},m(U,l){Ke(U,y,l),Be(y,T),Be(y,A),Be(y,O)},p(U,l){l[0]&16&&Ji(T,"background-color",U[4].properties.color,!1),l[0]&16&&P!==(P=U[4].properties.change_2016+"")&&Kr(O,P)},d(U){U&&xe(y)}}}function Df(C){let y,T;return y=new $c({props:{label:"Key dates",$$slots:{default:[f_]},$$scope:{ctx:C}}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&16|P[2]&65536&&(O.$$scope={dirty:P,ctx:A}),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function Lf(C){let y,T,A,P,O,U=C[4].properties.start+"",l;return{c(){y=Ye("div"),T=Jt("Founded"),A=Ye("br"),P=At(),O=Ye("span"),l=Jt(U),this.h()},l(W){y=Je(W,"DIV",{});var $=dt(y);T=$t($,"Founded"),A=Je($,"BR",{}),P=kt($),O=Je($,"SPAN",{class:!0});var ue=dt(O);l=$t(ue,U),ue.forEach(xe),$.forEach(xe),this.h()},h(){Re(O,"class","text-lrg svelte-1n8wvn1")},m(W,$){Ke(W,y,$),Be(y,T),Be(y,A),Be(y,P),Be(y,O),Be(O,l)},p(W,$){$[0]&16&&U!==(U=W[4].properties.start+"")&&Kr(l,U)},d(W){W&&xe(y)}}}function Bf(C){let y,T,A,P,O,U=C[4].properties.end.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})+"",l;return{c(){y=Ye("div"),T=Jt("Depopulated"),A=Ye("br"),P=At(),O=Ye("span"),l=Jt(U),this.h()},l(W){y=Je(W,"DIV",{});var $=dt(y);T=$t($,"Depopulated"),A=Je($,"BR",{}),P=kt($),O=Je($,"SPAN",{class:!0});var ue=dt(O);l=$t(ue,U),ue.forEach(xe),$.forEach(xe),this.h()},h(){Re(O,"class","text-lrg svelte-1n8wvn1")},m(W,$){Ke(W,y,$),Be(y,T),Be(y,A),Be(y,P),Be(y,O),Be(O,l)},p(W,$){$[0]&16&&U!==(U=W[4].properties.end.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})+"")&&Kr(l,U)},d(W){W&&xe(y)}}}function f_(C){let y,T,A=C[4].properties.start&&Lf(C),P=C[4].properties.end&&Bf(C);return{c(){A&&A.c(),y=At(),P&&P.c(),T=Pi()},l(O){A&&A.l(O),y=kt(O),P&&P.l(O),T=Pi()},m(O,U){A&&A.m(O,U),Ke(O,y,U),P&&P.m(O,U),Ke(O,T,U)},p(O,U){O[4].properties.start?A?A.p(O,U):(A=Lf(O),A.c(),A.m(y.parentNode,y)):A&&(A.d(1),A=null),O[4].properties.end?P?P.p(O,U):(P=Bf(O),P.c(),P.m(T.parentNode,T)):P&&(P.d(1),P=null)},d(O){A&&A.d(O),O&&xe(y),P&&P.d(O),O&&xe(T)}}}function Rf(C){let y,T,A,P;return y=new $c({props:{label:"Population",$$slots:{default:[m_]},$$scope:{ctx:C}}}),A=new $c({props:{label:"Population by group",hr:!1,$$slots:{default:[g_]},$$scope:{ctx:C}}}),{c(){ai(y.$$.fragment),T=At(),ai(A.$$.fragment)},l(O){Si(y.$$.fragment,O),T=kt(O),Si(A.$$.fragment,O)},m(O,U){li(y,O,U),Ke(O,T,U),li(A,O,U),P=!0},p(O,U){const l={};U[0]&16|U[2]&65536&&(l.$$scope={dirty:U,ctx:O}),y.$set(l);const W={};U[0]&16|U[2]&65536&&(W.$$scope={dirty:U,ctx:O}),A.$set(W)},i(O){P||(Qe(y.$$.fragment,O),Qe(A.$$.fragment,O),P=!0)},o(O){mt(y.$$.fragment,O),mt(A.$$.fragment,O),P=!1},d(O){ci(y,O),O&&xe(T),ci(A,O)}}}function Ff(C){let y,T,A,P,O,U=C[4].properties.pop_1945.toLocaleString()+"",l;return{c(){y=Ye("div"),T=Jt("1945"),A=Ye("br"),P=At(),O=Ye("span"),l=Jt(U),this.h()},l(W){y=Je(W,"DIV",{});var $=dt(y);T=$t($,"1945"),A=Je($,"BR",{}),P=kt($),O=Je($,"SPAN",{class:!0});var ue=dt(O);l=$t(ue,U),ue.forEach(xe),$.forEach(xe),this.h()},h(){Re(O,"class","text-lrg svelte-1n8wvn1")},m(W,$){Ke(W,y,$),Be(y,T),Be(y,A),Be(y,P),Be(y,O),Be(O,l)},p(W,$){$[0]&16&&U!==(U=W[4].properties.pop_1945.toLocaleString()+"")&&Kr(l,U)},d(W){W&&xe(y)}}}function Of(C){let y,T,A,P,O,U=C[4].properties.pop_2016.toLocaleString()+"",l;return{c(){y=Ye("div"),T=Jt("2016"),A=Ye("br"),P=At(),O=Ye("span"),l=Jt(U),this.h()},l(W){y=Je(W,"DIV",{});var $=dt(y);T=$t($,"2016"),A=Je($,"BR",{}),P=kt($),O=Je($,"SPAN",{class:!0});var ue=dt(O);l=$t(ue,U),ue.forEach(xe),$.forEach(xe),this.h()},h(){Re(O,"class","text-lrg svelte-1n8wvn1")},m(W,$){Ke(W,y,$),Be(y,T),Be(y,A),Be(y,P),Be(y,O),Be(O,l)},p(W,$){$[0]&16&&U!==(U=W[4].properties.pop_2016.toLocaleString()+"")&&Kr(l,U)},d(W){W&&xe(y)}}}function m_(C){let y,T,A=C[4].properties.pop_1945&&Ff(C),P=C[4].properties.pop_2016&&Of(C);return{c(){A&&A.c(),y=At(),P&&P.c(),T=Pi()},l(O){A&&A.l(O),y=kt(O),P&&P.l(O),T=Pi()},m(O,U){A&&A.m(O,U),Ke(O,y,U),P&&P.m(O,U),Ke(O,T,U)},p(O,U){O[4].properties.pop_1945?A?A.p(O,U):(A=Ff(O),A.c(),A.m(y.parentNode,y)):A&&(A.d(1),A=null),O[4].properties.pop_2016?P?P.p(O,U):(P=Of(O),P.c(),P.m(T.parentNode,T)):P&&(P.d(1),P=null)},d(O){A&&A.d(O),O&&xe(y),P&&P.d(O),O&&xe(T)}}}function g_(C){let y,T;return y=new Yg({props:{data:Cd(C[4])}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&16&&(O.data=Cd(A[4])),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function Uf(C){let y,T;return y=new $c({props:{label:"Related links",$$slots:{default:[__]},$$scope:{ctx:C}}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&17|P[2]&65536&&(O.$$scope={dirty:P,ctx:A}),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function Vf(C){let y,T,A,P;return{c(){y=Ye("a"),T=Jt("Palestine Today"),P=Ye("br"),this.h()},l(O){y=Je(O,"A",{href:!0,target:!0});var U=dt(y);T=$t(U,"Palestine Today"),U.forEach(xe),P=Je(O,"BR",{}),this.h()},h(){Re(y,"href",A="https://today.visualizingpalestine.org/"+C[4].properties.slug),Re(y,"target","_blank")},m(O,U){Ke(O,y,U),Be(y,T),Ke(O,P,U)},p(O,U){U[0]&16&&A!==(A="https://today.visualizingpalestine.org/"+O[4].properties.slug)&&Re(y,"href",A)},d(O){O&&xe(y),O&&xe(P)}}}function Nf(C){let y,T,A;return{c(){y=Ye("a"),T=Jt("Zochrot"),this.h()},l(P){y=Je(P,"A",{href:!0,target:!0});var O=dt(y);T=$t(O,"Zochrot"),O.forEach(xe),this.h()},h(){Re(y,"href",A="https://www.zochrot.org/villages/village_details/"+C[4].properties.id_zo+"/"+C[0]),Re(y,"target","_blank")},m(P,O){Ke(P,y,O),Be(y,T)},p(P,O){O[0]&17&&A!==(A="https://www.zochrot.org/villages/village_details/"+P[4].properties.id_zo+"/"+P[0])&&Re(y,"href",A)},d(P){P&&xe(y)}}}function __(C){let y,T,A=C[4].properties.map_20k=="yes"&&Vf(C),P=C[4].properties.id_zo&&Nf(C);return{c(){y=Ye("div"),A&&A.c(),T=At(),P&&P.c()},l(O){y=Je(O,"DIV",{});var U=dt(y);A&&A.l(U),T=kt(U),P&&P.l(U),U.forEach(xe)},m(O,U){Ke(O,y,U),A&&A.m(y,null),Be(y,T),P&&P.m(y,null)},p(O,U){O[4].properties.map_20k=="yes"?A?A.p(O,U):(A=Vf(O),A.c(),A.m(y,T)):A&&(A.d(1),A=null),O[4].properties.id_zo?P?P.p(O,U):(P=Nf(O),P.c(),P.m(y,null)):P&&(P.d(1),P=null)},d(O){O&&xe(y),A&&A.d(),P&&P.d()}}}function jf(C){let y;return{c(){y=Ye("div"),this.h()},l(T){y=Je(T,"DIV",{id:!0,class:!0}),dt(y).forEach(xe),this.h()},h(){Re(y,"id","mask"),Re(y,"class","svelte-1n8wvn1")},m(T,A){Ke(T,y,A)},d(T){T&&xe(y)}}}function qf(C){let y,T;return y=new qg({props:{value:C[4]?C[4].properties:null,items:C[3].features.map($f),optionIdentifier:"id",labelIdentifier:"name_"+C[0],placeholder:"Find a town or village",showIndicator:!0}}),y.$on("select",C[25]),y.$on("clear",C[26]),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&16&&(O.value=A[4]?A[4].properties:null),P[0]&8&&(O.items=A[3].features.map($f)),P[0]&1&&(O.labelIdentifier="name_"+A[0]),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function Gf(C){let y,T,A,P,O=C[67].name+"",U,l,W;return{c(){y=Ye("label"),T=Ye("input"),P=At(),U=Jt(O),this.h()},l($){y=Je($,"LABEL",{class:!0});var ue=dt(y);T=Je(ue,"INPUT",{type:!0,name:!0}),P=kt(ue),U=$t(ue,O),ue.forEach(xe),this.h()},h(){Re(T,"type","radio"),Re(T,"name","layers"),T.__value=A=C[67],T.value=T.__value,C[45][1].push(T),Re(y,"class","svelte-1n8wvn1")},m($,ue){Ke($,y,ue),Be(y,T),T.checked=T.__value===C[8],Be(y,P),Be(y,U),l||(W=nr(T,"change",C[44]),l=!0)},p($,ue){ue[0]&2&&A!==(A=$[67])&&(T.__value=A,T.value=T.__value),ue[0]&256&&(T.checked=T.__value===$[8]),ue[0]&2&&O!==(O=$[67].name+"")&&Kr(U,O)},d($){$&&xe(y),C[45][1].splice(C[45][1].indexOf(T),1),l=!1,W()}}}function y_(C){let y,T=C[1],A=[];for(let P=0;P<T.length;P+=1)A[P]=Gf(wf(C,T,P));return{c(){for(let P=0;P<A.length;P+=1)A[P].c();y=Pi()},l(P){for(let O=0;O<A.length;O+=1)A[O].l(P);y=Pi()},m(P,O){for(let U=0;U<A.length;U+=1)A[U].m(P,O);Ke(P,y,O)},p(P,O){if(O[0]&258){T=P[1];let U;for(U=0;U<T.length;U+=1){const l=wf(P,T,U);A[U]?A[U].p(l,O):(A[U]=Gf(l),A[U].c(),A[U].m(y.parentNode,y))}for(;U<A.length;U+=1)A[U].d(1);A.length=T.length}},d(P){tl(A,P),P&&xe(y)}}}function Zf(C){let y,T,A,P,O,U=C[67].name+"",l,W,$;return{c(){y=Ye("label"),T=Ye("input"),O=At(),l=Jt(U),this.h()},l(ue){y=Je(ue,"LABEL",{class:!0});var re=dt(y);T=Je(re,"INPUT",{type:!0,name:!0}),O=kt(re),l=$t(re,U),re.forEach(xe),this.h()},h(){Re(T,"type","radio"),T.disabled=A=!C[18].overlay,Re(T,"name","overlays"),T.__value=P=C[67],T.value=T.__value,C[45][2].push(T),Re(y,"class","svelte-1n8wvn1")},m(ue,re){Ke(ue,y,re),Be(y,T),T.checked=T.__value===C[9],Be(y,O),Be(y,l),W||($=nr(T,"change",C[47]),W=!0)},p(ue,re){re[0]&262144&&A!==(A=!ue[18].overlay)&&(T.disabled=A),re[0]&512&&(T.checked=T.__value===ue[9])},d(ue){ue&&xe(y),C[45][2].splice(C[45][2].indexOf(T),1),W=!1,$()}}}function x_(C){let y,T,A,P,O,U,l,W,$,ue,re,Z,me,_e,Fe,gt,zt,Ct,it,je,nt,ct,Xe,at,rt,Oe=gd,bt=[];for(let We=0;We<Oe.length;We+=1)bt[We]=Zf(bf(C,Oe,We));return{c(){y=Ye("label"),T=Ye("input"),A=Jt(" Show overlays"),P=At(),O=Ye("hr"),U=At();for(let We=0;We<bt.length;We+=1)bt[We].c();l=At(),W=Ye("hr"),$=At(),ue=Ye("label"),re=Ye("input"),me=Jt(" Buildings"),_e=At(),Fe=Ye("label"),gt=Ye("input"),Ct=Jt(" Roads/rail"),it=At(),je=Ye("label"),nt=Ye("input"),Xe=Jt(" Place names"),this.h()},l(We){y=Je(We,"LABEL",{class:!0});var ft=dt(y);T=Je(ft,"INPUT",{type:!0}),A=$t(ft," Show overlays"),ft.forEach(xe),P=kt(We),O=Je(We,"HR",{class:!0}),U=kt(We);for(let Wt=0;Wt<bt.length;Wt+=1)bt[Wt].l(We);l=kt(We),W=Je(We,"HR",{class:!0}),$=kt(We),ue=Je(We,"LABEL",{class:!0});var wt=dt(ue);re=Je(wt,"INPUT",{type:!0}),me=$t(wt," Buildings"),wt.forEach(xe),_e=kt(We),Fe=Je(We,"LABEL",{class:!0});var Ze=dt(Fe);gt=Je(Ze,"INPUT",{type:!0}),Ct=$t(Ze," Roads/rail"),Ze.forEach(xe),it=kt(We),je=Je(We,"LABEL",{class:!0});var De=dt(je);nt=Je(De,"INPUT",{type:!0}),Xe=$t(De," Place names"),De.forEach(xe),this.h()},h(){Re(T,"type","checkbox"),Re(y,"class","svelte-1n8wvn1"),Re(O,"class","svelte-1n8wvn1"),Re(W,"class","svelte-1n8wvn1"),Re(re,"type","checkbox"),re.disabled=Z=!C[18].overlay,Re(ue,"class","svelte-1n8wvn1"),Re(gt,"type","checkbox"),gt.disabled=zt=!C[18].overlay,Re(Fe,"class","svelte-1n8wvn1"),Re(nt,"type","checkbox"),nt.disabled=ct=!C[18].overlay,Re(je,"class","svelte-1n8wvn1")},m(We,ft){Ke(We,y,ft),Be(y,T),T.checked=C[18].overlay,Be(y,A),Ke(We,P,ft),Ke(We,O,ft),Ke(We,U,ft);for(let wt=0;wt<bt.length;wt+=1)bt[wt].m(We,ft);Ke(We,l,ft),Ke(We,W,ft),Ke(We,$,ft),Ke(We,ue,ft),Be(ue,re),re.checked=C[19].building,Be(ue,me),Ke(We,_e,ft),Ke(We,Fe,ft),Be(Fe,gt),gt.checked=C[19].transport,Be(Fe,Ct),Ke(We,it,ft),Ke(We,je,ft),Be(je,nt),nt.checked=C[19].place,Be(je,Xe),at||(rt=[nr(T,"change",C[46]),nr(re,"change",C[48]),nr(gt,"change",C[49]),nr(nt,"change",C[50])],at=!0)},p(We,ft){if(ft[0]&262144&&(T.checked=We[18].overlay),ft[0]&262656){Oe=gd;let wt;for(wt=0;wt<Oe.length;wt+=1){const Ze=bf(We,Oe,wt);bt[wt]?bt[wt].p(Ze,ft):(bt[wt]=Zf(Ze),bt[wt].c(),bt[wt].m(l.parentNode,l))}for(;wt<bt.length;wt+=1)bt[wt].d(1);bt.length=Oe.length}ft[0]&262144&&Z!==(Z=!We[18].overlay)&&(re.disabled=Z),ft[0]&524288&&(re.checked=We[19].building),ft[0]&262144&&zt!==(zt=!We[18].overlay)&&(gt.disabled=zt),ft[0]&524288&&(gt.checked=We[19].transport),ft[0]&262144&&ct!==(ct=!We[18].overlay)&&(nt.disabled=ct),ft[0]&524288&&(nt.checked=We[19].place)},d(We){We&&xe(y),We&&xe(P),We&&xe(O),We&&xe(U),tl(bt,We),We&&xe(l),We&&xe(W),We&&xe($),We&&xe(ue),We&&xe(_e),We&&xe(Fe),We&&xe(it),We&&xe(je),at=!1,ru(rt)}}}function Xf(C){let y,T,A,P,O,U,l,W=C[64].name+"",$,ue,re;return{c(){y=Ye("label"),T=Ye("input"),O=At(),U=Ye("div"),l=At(),$=Jt(W),this.h()},l(Z){y=Je(Z,"LABEL",{class:!0});var me=dt(y);T=Je(me,"INPUT",{type:!0}),O=kt(me),U=Je(me,"DIV",{class:!0}),dt(U).forEach(xe),l=kt(me),$=$t(me,W),me.forEach(xe),this.h()},h(){Re(T,"type","checkbox"),T.disabled=A=!C[18].places,T.__value=P=C[64],T.value=T.__value,C[45][0].push(T),Re(U,"class","bullet svelte-1n8wvn1"),Ji(U,"background-color",C[64].color,!1),Re(y,"class","svelte-1n8wvn1")},m(Z,me){Ke(Z,y,me),Be(y,T),T.checked=~C[7].indexOf(T.__value),Be(y,O),Be(y,U),Be(y,l),Be(y,$),ue||(re=nr(T,"change",C[52]),ue=!0)},p(Z,me){me[0]&262144&&A!==(A=!Z[18].places)&&(T.disabled=A),me[0]&128&&(T.checked=~Z[7].indexOf(T.__value))},d(Z){Z&&xe(y),C[45][0].splice(C[45][0].indexOf(T),1),ue=!1,re()}}}function v_(C){let y,T,A,P,O,U,l,W,$,ue=C[24],re=[];for(let Z=0;Z<ue.length;Z+=1)re[Z]=Xf(vf(C,ue,Z));return{c(){y=Ye("label"),T=Ye("input"),A=Jt(" Show localities"),P=At(),O=Ye("hr"),U=At();for(let Z=0;Z<re.length;Z+=1)re[Z].c();l=Pi(),this.h()},l(Z){y=Je(Z,"LABEL",{class:!0});var me=dt(y);T=Je(me,"INPUT",{type:!0}),A=$t(me," Show localities"),me.forEach(xe),P=kt(Z),O=Je(Z,"HR",{class:!0}),U=kt(Z);for(let _e=0;_e<re.length;_e+=1)re[_e].l(Z);l=Pi(),this.h()},h(){Re(T,"type","checkbox"),Re(y,"class","svelte-1n8wvn1"),Re(O,"class","svelte-1n8wvn1")},m(Z,me){Ke(Z,y,me),Be(y,T),T.checked=C[18].places,Be(y,A),Ke(Z,P,me),Ke(Z,O,me),Ke(Z,U,me);for(let _e=0;_e<re.length;_e+=1)re[_e].m(Z,me);Ke(Z,l,me),W||($=nr(T,"change",C[51]),W=!0)},p(Z,me){if(me[0]&262144&&(T.checked=Z[18].places),me[0]&17039488){ue=Z[24];let _e;for(_e=0;_e<ue.length;_e+=1){const Fe=vf(Z,ue,_e);re[_e]?re[_e].p(Fe,me):(re[_e]=Xf(Fe),re[_e].c(),re[_e].m(l.parentNode,l))}for(;_e<re.length;_e+=1)re[_e].d(1);re.length=ue.length}},d(Z){Z&&xe(y),Z&&xe(P),Z&&xe(O),Z&&xe(U),tl(re,Z),Z&&xe(l),W=!1,$()}}}function b_(C){let y;return{c(){y=Jt("Click anywhere on the map to see sheets available to download covering that location.")},l(T){y=$t(T,"Click anywhere on the map to see sheets available to download covering that location.")},m(T,A){Ke(T,y,A)},p:ds,i:ds,o:ds,d(T){T&&xe(y)}}}function w_(C){let y=cc(C[10],C[8].id)[0],T,A=cc(C[10],C[8].id,!1)[0],P,O,U=y&&Wf(C),l=A&&Kf(C);return{c(){U&&U.c(),T=At(),l&&l.c(),P=Pi()},l(W){U&&U.l(W),T=kt(W),l&&l.l(W),P=Pi()},m(W,$){U&&U.m(W,$),Ke(W,T,$),l&&l.m(W,$),Ke(W,P,$),O=!0},p(W,$){$[0]&1280&&(y=cc(W[10],W[8].id)[0]),y?U?(U.p(W,$),$[0]&1280&&Qe(U,1)):(U=Wf(W),U.c(),Qe(U,1),U.m(T.parentNode,T)):U&&(pr(),mt(U,1,1,()=>{U=null}),dr()),$[0]&1280&&(A=cc(W[10],W[8].id,!1)[0]),A?l?(l.p(W,$),$[0]&1280&&Qe(l,1)):(l=Kf(W),l.c(),Qe(l,1),l.m(P.parentNode,P)):l&&(pr(),mt(l,1,1,()=>{l=null}),dr())},i(W){O||(Qe(U),Qe(l),O=!0)},o(W){mt(U),mt(l),O=!1},d(W){U&&U.d(W),W&&xe(T),l&&l.d(W),W&&xe(P)}}}function Wf(C){let y,T,A,P,O,U=cc(C[10],C[8].id),l=[];for(let $=0;$<U.length;$+=1)l[$]=Hf(xf(C,U,$));const W=$=>mt(l[$],1,1,()=>{l[$]=null});return{c(){y=Jt("Sheets from this base map"),T=Ye("br"),A=At();for(let $=0;$<l.length;$+=1)l[$].c();P=Pi()},l($){y=$t($,"Sheets from this base map"),T=Je($,"BR",{}),A=kt($);for(let ue=0;ue<l.length;ue+=1)l[ue].l($);P=Pi()},m($,ue){Ke($,y,ue),Ke($,T,ue),Ke($,A,ue);for(let re=0;re<l.length;re+=1)l[re].m($,ue);Ke($,P,ue),O=!0},p($,ue){if(ue[0]&1280){U=cc($[10],$[8].id);let re;for(re=0;re<U.length;re+=1){const Z=xf($,U,re);l[re]?(l[re].p(Z,ue),Qe(l[re],1)):(l[re]=Hf(Z),l[re].c(),Qe(l[re],1),l[re].m(P.parentNode,P))}for(pr(),re=U.length;re<l.length;re+=1)W(re);dr()}},i($){if(!O){for(let ue=0;ue<U.length;ue+=1)Qe(l[ue]);O=!0}},o($){l=l.filter(Boolean);for(let ue=0;ue<l.length;ue+=1)mt(l[ue]);O=!1},d($){$&&xe(y),$&&xe(T),$&&xe(A),tl(l,$),$&&xe(P)}}}function Hf(C){let y,T;return y=new hm({props:{sheet:C[59]}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&1280&&(O.sheet=A[59]),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function Kf(C){let y,T,A,P,O,U=cc(C[10],C[8].id,!1),l=[];for(let $=0;$<U.length;$+=1)l[$]=Yf(yf(C,U,$));const W=$=>mt(l[$],1,1,()=>{l[$]=null});return{c(){y=Jt("Sheets from other base maps"),T=Ye("br"),A=At();for(let $=0;$<l.length;$+=1)l[$].c();P=Pi()},l($){y=$t($,"Sheets from other base maps"),T=Je($,"BR",{}),A=kt($);for(let ue=0;ue<l.length;ue+=1)l[ue].l($);P=Pi()},m($,ue){Ke($,y,ue),Ke($,T,ue),Ke($,A,ue);for(let re=0;re<l.length;re+=1)l[re].m($,ue);Ke($,P,ue),O=!0},p($,ue){if(ue[0]&1280){U=cc($[10],$[8].id,!1);let re;for(re=0;re<U.length;re+=1){const Z=yf($,U,re);l[re]?(l[re].p(Z,ue),Qe(l[re],1)):(l[re]=Yf(Z),l[re].c(),Qe(l[re],1),l[re].m(P.parentNode,P))}for(pr(),re=U.length;re<l.length;re+=1)W(re);dr()}},i($){if(!O){for(let ue=0;ue<U.length;ue+=1)Qe(l[ue]);O=!0}},o($){l=l.filter(Boolean);for(let ue=0;ue<l.length;ue+=1)mt(l[ue]);O=!1},d($){$&&xe(y),$&&xe(T),$&&xe(A),tl(l,$),$&&xe(P)}}}function Yf(C){let y,T;return y=new hm({props:{sheet:C[59]}}),{c(){ai(y.$$.fragment)},l(A){Si(y.$$.fragment,A)},m(A,P){li(y,A,P),T=!0},p(A,P){const O={};P[0]&1280&&(O.sheet=A[59]),y.$set(O)},i(A){T||(Qe(y.$$.fragment,A),T=!0)},o(A){mt(y.$$.fragment,A),T=!1},d(A){ci(y,A)}}}function T_(C){let y,T,A,P,O,U,l,W;const $=[w_,b_],ue=[];function re(Z,me){return Z[10][0]?0:1}return y=re(C),T=ue[y]=$[y](C),{c(){T.c(),A=At(),P=Ye("button"),O=Jt("Close downloads"),this.h()},l(Z){T.l(Z),A=kt(Z),P=Je(Z,"BUTTON",{class:!0});var me=dt(P);O=$t(me,"Close downloads"),me.forEach(xe),this.h()},h(){Re(P,"class","btn svelte-1n8wvn1")},m(Z,me){ue[y].m(Z,me),Ke(Z,A,me),Ke(Z,P,me),Be(P,O),U=!0,l||(W=nr(P,"click",C[53]),l=!0)},p(Z,me){let _e=y;y=re(Z),y===_e?ue[y].p(Z,me):(pr(),mt(ue[_e],1,1,()=>{ue[_e]=null}),dr(),T=ue[y],T?T.p(Z,me):(T=ue[y]=$[y](Z),T.c()),Qe(T,1),T.m(A.parentNode,A))},i(Z){U||(Qe(T),U=!0)},o(Z){mt(T),U=!1},d(Z){ue[y].d(Z),Z&&xe(A),Z&&xe(P),l=!1,W()}}}function I_(C){let y,T,A,P,O,U,l,W,$;return{c(){y=Ye("label"),T=Ye("input"),A=Jt(" Toggle split-screen"),P=At(),O=Ye("label"),U=Ye("input"),l=Jt(" Toggle 3D"),this.h()},l(ue){y=Je(ue,"LABEL",{class:!0});var re=dt(y);T=Je(re,"INPUT",{type:!0}),A=$t(re," Toggle split-screen"),re.forEach(xe),P=kt(ue),O=Je(ue,"LABEL",{class:!0});var Z=dt(O);U=Je(Z,"INPUT",{type:!0}),l=$t(Z," Toggle 3D"),Z.forEach(xe),this.h()},h(){Re(T,"type","checkbox"),Re(y,"class","svelte-1n8wvn1"),Re(U,"type","checkbox"),Re(O,"class","svelte-1n8wvn1")},m(ue,re){Ke(ue,y,re),Be(y,T),T.checked=C[18].split,Be(y,A),Ke(ue,P,re),Ke(ue,O,re),Be(O,U),U.checked=C[18].threed,Be(O,l),W||($=[nr(T,"change",C[55]),nr(U,"change",C[56]),nr(U,"change",C[57])],W=!0)},p(ue,re){re[0]&262144&&(T.checked=ue[18].split),re[0]&262144&&(U.checked=ue[18].threed)},d(ue){ue&&xe(y),ue&&xe(P),ue&&xe(O),W=!1,ru($)}}}function S_(C){let y,T,A,P=C[20]("about")+"",O,U,l,W,$,ue,re,Z,me,_e,Fe,gt,zt,Ct,it,je,nt,ct;return T=new Ns({props:{type:"info"}}),$=new Ns({props:{type:"pen"}}),_e=new Ns({props:{type:"heart"}}),it=new Ns({props:{type:"email"}}),{c(){y=Ye("a"),ai(T.$$.fragment),A=At(),O=Jt(P),l=At(),W=Ye("a"),ai($.$$.fragment),ue=Jt(" Blog"),Z=At(),me=Ye("a"),ai(_e.$$.fragment),Fe=Jt(" Support"),zt=At(),Ct=Ye("a"),ai(it.$$.fragment),je=Jt(" Contact"),this.h()},l(Xe){y=Je(Xe,"A",{href:!0});var at=dt(y);Si(T.$$.fragment,at),A=kt(at),O=$t(at,P),at.forEach(xe),l=kt(Xe),W=Je(Xe,"A",{href:!0});var rt=dt(W);Si($.$$.fragment,rt),ue=$t(rt," Blog"),rt.forEach(xe),Z=kt(Xe),me=Je(Xe,"A",{href:!0});var Oe=dt(me);Si(_e.$$.fragment,Oe),Fe=$t(Oe," Support"),Oe.forEach(xe),zt=kt(Xe),Ct=Je(Xe,"A",{href:!0});var bt=dt(Ct);Si(it.$$.fragment,bt),je=$t(bt," Contact"),bt.forEach(xe),this.h()},h(){Re(y,"href",U=el+"/"+C[0]+"/about/"),Re(W,"href",re=el+"/"+C[0]+"/blog/"),Re(me,"href",gt=el+"/"+C[0]+"/support/"),Re(Ct,"href",nt=el+"/"+C[0]+"/contact/")},m(Xe,at){Ke(Xe,y,at),li(T,y,null),Be(y,A),Be(y,O),Ke(Xe,l,at),Ke(Xe,W,at),li($,W,null),Be(W,ue),Ke(Xe,Z,at),Ke(Xe,me,at),li(_e,me,null),Be(me,Fe),Ke(Xe,zt,at),Ke(Xe,Ct,at),li(it,Ct,null),Be(Ct,je),ct=!0},p(Xe,at){(!ct||at[0]&1048576)&&P!==(P=Xe[20]("about")+"")&&Kr(O,P),(!ct||at[0]&1&&U!==(U=el+"/"+Xe[0]+"/about/"))&&Re(y,"href",U),(!ct||at[0]&1&&re!==(re=el+"/"+Xe[0]+"/blog/"))&&Re(W,"href",re),(!ct||at[0]&1&&gt!==(gt=el+"/"+Xe[0]+"/support/"))&&Re(me,"href",gt),(!ct||at[0]&1&&nt!==(nt=el+"/"+Xe[0]+"/contact/"))&&Re(Ct,"href",nt)},i(Xe){ct||(Qe(T.$$.fragment,Xe),Qe($.$$.fragment,Xe),Qe(_e.$$.fragment,Xe),Qe(it.$$.fragment,Xe),ct=!0)},o(Xe){mt(T.$$.fragment,Xe),mt($.$$.fragment,Xe),mt(_e.$$.fragment,Xe),mt(it.$$.fragment,Xe),ct=!1},d(Xe){Xe&&xe(y),ci(T),Xe&&xe(l),Xe&&xe(W),ci($),Xe&&xe(Z),Xe&&xe(me),ci(_e),Xe&&xe(zt),Xe&&xe(Ct),ci(it)}}}function E_(C){let y,T,A,P,O;return T=new Ns({props:{type:"globe"}}),{c(){y=Ye("a"),ai(T.$$.fragment),A=Jt(" \u0639\u0631\u0628\u064A"),this.h()},l(U){y=Je(U,"A",{href:!0});var l=dt(y);Si(T.$$.fragment,l),A=$t(l," \u0639\u0631\u0628\u064A"),l.forEach(xe),this.h()},h(){Re(y,"href",P=String(C[23].url).replace("en","ar"))},m(U,l){Ke(U,y,l),li(T,y,null),Be(y,A),O=!0},p(U,l){(!O||l[0]&8388608&&P!==(P=String(U[23].url).replace("en","ar")))&&Re(y,"href",P)},i(U){O||(Qe(T.$$.fragment,U),O=!0)},o(U){mt(T.$$.fragment,U),O=!1},d(U){U&&xe(y),ci(T)}}}function A_(C){let y,T,A,P,O;return T=new Ns({props:{type:"globe"}}),{c(){y=Ye("a"),ai(T.$$.fragment),A=Jt(" English"),this.h()},l(U){y=Je(U,"A",{href:!0});var l=dt(y);Si(T.$$.fragment,l),A=$t(l," English"),l.forEach(xe),this.h()},h(){Re(y,"href",P=String(C[23].url).replace("ar","en"))},m(U,l){Ke(U,y,l),li(T,y,null),Be(y,A),O=!0},p(U,l){(!O||l[0]&8388608&&P!==(P=String(U[23].url).replace("ar","en")))&&Re(y,"href",P)},i(U){O||(Qe(T.$$.fragment,U),O=!0)},o(U){mt(T.$$.fragment,U),O=!1},d(U){U&&xe(y),ci(T)}}}function k_(C){let y,T,A,P;const O=[A_,E_],U=[];function l(W,$){return W[21]?0:1}return y=l(C),T=U[y]=O[y](C),{c(){T.c(),A=Pi()},l(W){T.l(W),A=Pi()},m(W,$){U[y].m(W,$),Ke(W,A,$),P=!0},p(W,$){let ue=y;y=l(W),y===ue?U[y].p(W,$):(pr(),mt(U[ue],1,1,()=>{U[ue]=null}),dr(),T=U[y],T?T.p(W,$):(T=U[y]=O[y](W),T.c()),Qe(T,1),T.m(A.parentNode,A))},i(W){P||(Qe(T),P=!0)},o(W){mt(T),P=!1},d(W){U[y].d(W),W&&xe(A)}}}function z_(C){let y,T,A,P,O,U,l,W=C[20]("pom")+"",$,ue,re,Z,me,_e,Fe,gt,zt,Ct,it,je,nt,ct,Xe,at,rt,Oe,bt,We,ft,wt,Ze,De,Wt,si,vt,Ht,gi,ui,Ci,fi,ei,_i,$i,lt,$e,di,Ui,Mr,Ai,gr,_r,Er,Dr,Jr;function bi(ae,Ae){return ae[21]?e_:Qg}let br=bi(C),cr=br(C);O=new Ns({props:{type:C[15]?"close":"menu"}});let Hi=C[14]&&Sf(C);gt=new Ns({props:{type:"marker"}}),je=new Ns({props:{type:"layers"}}),at=new Ns({props:{type:"split",rotation:90}}),We=new Ns({props:{type:"3d"}}),Ze=new Ns({props:{type:"info"}});let Qt=C[16]&&Pf(C),tr=C[15]&&jf(),Di=C[3]&&qf(C);ui=new zp({props:{label:C[20]("baseMaps"),rtl:C[21],$$slots:{default:[y_]},$$scope:{ctx:C}}}),fi=new zp({props:{label:C[20]("overlays"),rtl:C[21],$$slots:{default:[x_]},$$scope:{ctx:C}}}),_i=new zp({props:{label:C[20]("localities"),rtl:C[21],$$slots:{default:[v_]},$$scope:{ctx:C}}});function jt(ae){C[54](ae)}let Vi={label:C[20]("download"),rtl:C[21],$$slots:{default:[T_]},$$scope:{ctx:C}};return C[18].download!==void 0&&(Vi.open=C[18].download),lt=new zp({props:Vi}),js.push(()=>lc(lt,"open",jt)),Ui=new fd({props:{$$slots:{default:[I_]},$$scope:{ctx:C}}}),Ai=new fd({props:{$$slots:{default:[S_]},$$scope:{ctx:C}}}),_r=new fd({props:{$$slots:{default:[k_]},$$scope:{ctx:C}}}),{c(){cr.c(),y=Pi(),T=At(),A=Ye("header"),P=Ye("button"),ai(O.$$.fragment),U=At(),l=Ye("div"),$=Jt(W),ue=At(),re=Ye("div"),Hi&&Hi.c(),Z=At(),me=Ye("div"),_e=Ye("label"),Fe=Ye("input"),ai(gt.$$.fragment),zt=At(),Ct=Ye("label"),it=Ye("input"),ai(je.$$.fragment),nt=At(),ct=Ye("label"),Xe=Ye("input"),ai(at.$$.fragment),rt=At(),Oe=Ye("label"),bt=Ye("input"),ai(We.$$.fragment),ft=At(),wt=Ye("button"),ai(Ze.$$.fragment),De=At(),Qt&&Qt.c(),Wt=At(),tr&&tr.c(),si=At(),vt=Ye("nav"),Ht=Ye("div"),Di&&Di.c(),gi=At(),ai(ui.$$.fragment),Ci=At(),ai(fi.$$.fragment),ei=At(),ai(_i.$$.fragment),$i=At(),ai(lt.$$.fragment),di=At(),ai(Ui.$$.fragment),Mr=At(),ai(Ai.$$.fragment),gr=At(),ai(_r.$$.fragment),this.h()},l(ae){const Ae=yd('[data-svelte="svelte-2zhgap"]',document.head);cr.l(Ae),y=Pi(),Ae.forEach(xe),T=kt(ae),A=Je(ae,"HEADER",{class:!0});var $r=dt(A);P=Je($r,"BUTTON",{class:!0});var yr=dt(P);Si(O.$$.fragment,yr),yr.forEach(xe),U=kt($r),l=Je($r,"DIV",{class:!0});var Gt=dt(l);$=$t(Gt,W),Gt.forEach(xe),$r.forEach(xe),ue=kt(ae),re=Je(ae,"DIV",{id:!0,class:!0});var hi=dt(re);Hi&&Hi.l(hi),hi.forEach(xe),Z=kt(ae),me=Je(ae,"DIV",{id:!0,class:!0});var Ti=dt(me);_e=Je(Ti,"LABEL",{title:!0,class:!0});var xr=dt(_e);Fe=Je(xr,"INPUT",{type:!0,class:!0}),Si(gt.$$.fragment,xr),xr.forEach(xe),zt=kt(Ti),Ct=Je(Ti,"LABEL",{title:!0,class:!0});var Mi=dt(Ct);it=Je(Mi,"INPUT",{type:!0,class:!0}),Si(je.$$.fragment,Mi),Mi.forEach(xe),nt=kt(Ti),ct=Je(Ti,"LABEL",{title:!0,class:!0});var Ve=dt(ct);Xe=Je(Ve,"INPUT",{type:!0,class:!0}),Si(at.$$.fragment,Ve),Ve.forEach(xe),rt=kt(Ti),Oe=Je(Ti,"LABEL",{title:!0,class:!0});var Dt=dt(Oe);bt=Je(Dt,"INPUT",{type:!0,class:!0}),Si(We.$$.fragment,Dt),Dt.forEach(xe),ft=kt(Ti),wt=Je(Ti,"BUTTON",{title:!0,class:!0});var Pt=dt(wt);Si(Ze.$$.fragment,Pt),Pt.forEach(xe),Ti.forEach(xe),De=kt(ae),Qt&&Qt.l(ae),Wt=kt(ae),tr&&tr.l(ae),si=kt(ae),vt=Je(ae,"NAV",{id:!0,class:!0});var Ii=dt(vt);Ht=Je(Ii,"DIV",{id:!0,style:!0,class:!0});var Ar=dt(Ht);Di&&Di.l(Ar),Ar.forEach(xe),gi=kt(Ii),Si(ui.$$.fragment,Ii),Ci=kt(Ii),Si(fi.$$.fragment,Ii),ei=kt(Ii),Si(_i.$$.fragment,Ii),$i=kt(Ii),Si(lt.$$.fragment,Ii),di=kt(Ii),Si(Ui.$$.fragment,Ii),Mr=kt(Ii),Si(Ai.$$.fragment,Ii),gr=kt(Ii),Si(_r.$$.fragment,Ii),Ii.forEach(xe),this.h()},h(){Re(P,"class","menu-toggle svelte-1n8wvn1"),qi(P,"menu-toggle-rtl",C[21]),Re(l,"class","title svelte-1n8wvn1"),Re(A,"class","svelte-1n8wvn1"),Re(re,"id","map-container"),Re(re,"class","svelte-1n8wvn1"),Re(Fe,"type","checkbox"),Re(Fe,"class","svelte-1n8wvn1"),Re(_e,"title","Toggle localities"),Re(_e,"class","svelte-1n8wvn1"),qi(_e,"checked",C[18].places),Re(it,"type","checkbox"),Re(it,"class","svelte-1n8wvn1"),Re(Ct,"title","Toggle overlays"),Re(Ct,"class","svelte-1n8wvn1"),qi(Ct,"checked",C[18].overlay),Re(Xe,"type","checkbox"),Re(Xe,"class","svelte-1n8wvn1"),Re(ct,"title","Toggle split-screen"),Re(ct,"class","svelte-1n8wvn1"),qi(ct,"checked",C[18].split),Re(bt,"type","checkbox"),Re(bt,"class","svelte-1n8wvn1"),Re(Oe,"title","Toggle 3D"),Re(Oe,"class","svelte-1n8wvn1"),qi(Oe,"checked",C[18].threed),Re(wt,"title","Layer information"),Re(wt,"class","svelte-1n8wvn1"),qi(wt,"checked",C[18].info),Re(me,"id","toggles"),Re(me,"class","svelte-1n8wvn1"),qi(me,"toggles-rtl",C[21]),Re(Ht,"id","search"),Ji(Ht,"--selectedItemPadding",C[21]?"0 20px 0 0":"0 0 0 20px"),Re(Ht,"class","svelte-1n8wvn1"),qi(Ht,"search-rtl",C[21]),Re(vt,"id","menu"),Re(vt,"class","svelte-1n8wvn1"),Ji(vt,"left",C[21]?"auto":C[15]?"0":"-320px",!1),Ji(vt,"right",C[0]!="ar"?"auto":C[15]?"0":"-320px",!1)},m(ae,Ae){cr.m(document.head,null),Be(document.head,y),Ke(ae,T,Ae),Ke(ae,A,Ae),Be(A,P),li(O,P,null),Be(A,U),Be(A,l),Be(l,$),Ke(ae,ue,Ae),Ke(ae,re,Ae),Hi&&Hi.m(re,null),Ke(ae,Z,Ae),Ke(ae,me,Ae),Be(me,_e),Be(_e,Fe),Fe.checked=C[18].places,li(gt,_e,null),Be(me,zt),Be(me,Ct),Be(Ct,it),it.checked=C[18].overlay,li(je,Ct,null),Be(me,nt),Be(me,ct),Be(ct,Xe),Xe.checked=C[18].split,li(at,ct,null),Be(me,rt),Be(me,Oe),Be(Oe,bt),bt.checked=C[18].threed,li(We,Oe,null),Be(me,ft),Be(me,wt),li(Ze,wt,null),Ke(ae,De,Ae),Qt&&Qt.m(ae,Ae),Ke(ae,Wt,Ae),tr&&tr.m(ae,Ae),Ke(ae,si,Ae),Ke(ae,vt,Ae),Be(vt,Ht),Di&&Di.m(Ht,null),Be(vt,gi),li(ui,vt,null),Be(vt,Ci),li(fi,vt,null),Be(vt,ei),li(_i,vt,null),Be(vt,$i),li(lt,vt,null),Be(vt,di),li(Ui,vt,null),Be(vt,Mr),li(Ai,vt,null),Be(vt,gr),li(_r,vt,null),Er=!0,Dr||(Jr=[nr(P,"click",C[28]),nr(Fe,"change",C[36]),nr(it,"change",C[37]),nr(Xe,"change",C[38]),nr(bt,"change",C[39]),nr(bt,"change",C[40]),nr(wt,"click",C[41])],Dr=!0)},p(ae,Ae){br!==(br=bi(ae))&&(cr.d(1),cr=br(ae),cr&&(cr.c(),cr.m(y.parentNode,y)));const $r={};Ae[0]&32768&&($r.type=ae[15]?"close":"menu"),O.$set($r),Ae[0]&2097152&&qi(P,"menu-toggle-rtl",ae[21]),(!Er||Ae[0]&1048576)&&W!==(W=ae[20]("pom")+"")&&Kr($,W),ae[14]?Hi?(Hi.p(ae,Ae),Ae[0]&16384&&Qe(Hi,1)):(Hi=Sf(ae),Hi.c(),Qe(Hi,1),Hi.m(re,null)):Hi&&(pr(),mt(Hi,1,1,()=>{Hi=null}),dr()),Ae[0]&262144&&(Fe.checked=ae[18].places),Ae[0]&262144&&qi(_e,"checked",ae[18].places),Ae[0]&262144&&(it.checked=ae[18].overlay),Ae[0]&262144&&qi(Ct,"checked",ae[18].overlay),Ae[0]&262144&&(Xe.checked=ae[18].split),Ae[0]&262144&&qi(ct,"checked",ae[18].split),Ae[0]&262144&&(bt.checked=ae[18].threed),Ae[0]&262144&&qi(Oe,"checked",ae[18].threed),Ae[0]&262144&&qi(wt,"checked",ae[18].info),Ae[0]&2097152&&qi(me,"toggles-rtl",ae[21]),ae[16]?Qt?(Qt.p(ae,Ae),Ae[0]&65536&&Qe(Qt,1)):(Qt=Pf(ae),Qt.c(),Qe(Qt,1),Qt.m(Wt.parentNode,Wt)):Qt&&(pr(),mt(Qt,1,1,()=>{Qt=null}),dr()),ae[15]?tr||(tr=jf(),tr.c(),tr.m(si.parentNode,si)):tr&&(tr.d(1),tr=null),ae[3]?Di?(Di.p(ae,Ae),Ae[0]&8&&Qe(Di,1)):(Di=qf(ae),Di.c(),Qe(Di,1),Di.m(Ht,null)):Di&&(pr(),mt(Di,1,1,()=>{Di=null}),dr()),(!Er||Ae[0]&2097152)&&Ji(Ht,"--selectedItemPadding",ae[21]?"0 20px 0 0":"0 0 0 20px"),Ae[0]&2097152&&qi(Ht,"search-rtl",ae[21]);const yr={};Ae[0]&1048576&&(yr.label=ae[20]("baseMaps")),Ae[0]&2097152&&(yr.rtl=ae[21]),Ae[0]&258|Ae[2]&65536&&(yr.$$scope={dirty:Ae,ctx:ae}),ui.$set(yr);const Gt={};Ae[0]&1048576&&(Gt.label=ae[20]("overlays")),Ae[0]&2097152&&(Gt.rtl=ae[21]),Ae[0]&786944|Ae[2]&65536&&(Gt.$$scope={dirty:Ae,ctx:ae}),fi.$set(Gt);const hi={};Ae[0]&1048576&&(hi.label=ae[20]("localities")),Ae[0]&2097152&&(hi.rtl=ae[21]),Ae[0]&262272|Ae[2]&65536&&(hi.$$scope={dirty:Ae,ctx:ae}),_i.$set(hi);const Ti={};Ae[0]&1048576&&(Ti.label=ae[20]("download")),Ae[0]&2097152&&(Ti.rtl=ae[21]),Ae[0]&263424|Ae[2]&65536&&(Ti.$$scope={dirty:Ae,ctx:ae}),!$e&&Ae[0]&262144&&($e=!0,Ti.open=ae[18].download,Kc(()=>$e=!1)),lt.$set(Ti);const xr={};Ae[0]&264192|Ae[2]&65536&&(xr.$$scope={dirty:Ae,ctx:ae}),Ui.$set(xr);const Mi={};Ae[0]&1048577|Ae[2]&65536&&(Mi.$$scope={dirty:Ae,ctx:ae}),Ai.$set(Mi);const Ve={};Ae[0]&10485760|Ae[2]&65536&&(Ve.$$scope={dirty:Ae,ctx:ae}),_r.$set(Ve),Ae[0]&2129920&&Ji(vt,"left",ae[21]?"auto":ae[15]?"0":"-320px",!1),Ae[0]&32769&&Ji(vt,"right",ae[0]!="ar"?"auto":ae[15]?"0":"-320px",!1)},i(ae){Er||(Qe(O.$$.fragment,ae),Qe(Hi),Qe(gt.$$.fragment,ae),Qe(je.$$.fragment,ae),Qe(at.$$.fragment,ae),Qe(We.$$.fragment,ae),Qe(Ze.$$.fragment,ae),Qe(Qt),Qe(Di),Qe(ui.$$.fragment,ae),Qe(fi.$$.fragment,ae),Qe(_i.$$.fragment,ae),Qe(lt.$$.fragment,ae),Qe(Ui.$$.fragment,ae),Qe(Ai.$$.fragment,ae),Qe(_r.$$.fragment,ae),Er=!0)},o(ae){mt(O.$$.fragment,ae),mt(Hi),mt(gt.$$.fragment,ae),mt(je.$$.fragment,ae),mt(at.$$.fragment,ae),mt(We.$$.fragment,ae),mt(Ze.$$.fragment,ae),mt(Qt),mt(Di),mt(ui.$$.fragment,ae),mt(fi.$$.fragment,ae),mt(_i.$$.fragment,ae),mt(lt.$$.fragment,ae),mt(Ui.$$.fragment,ae),mt(Ai.$$.fragment,ae),mt(_r.$$.fragment,ae),Er=!1},d(ae){cr.d(ae),xe(y),ae&&xe(T),ae&&xe(A),ci(O),ae&&xe(ue),ae&&xe(re),Hi&&Hi.d(),ae&&xe(Z),ae&&xe(me),ci(gt),ci(je),ci(at),ci(We),ci(Ze),ae&&xe(De),Qt&&Qt.d(ae),ae&&xe(Wt),tr&&tr.d(ae),ae&&xe(si),ae&&xe(vt),Di&&Di.d(),ci(ui),ci(fi),ci(_i),ci(lt),ci(Ui),ci(Ai),ci(_r),Dr=!1,ru(Jr)}}}async function V_({params:C,stuff:y}){let T=C.lang,A=C.slug.replace("/",""),P=y.places,O=P.features.find(W=>W.properties.slug==A),U=y.layers,l=y.sheets;return{props:{lang:T,layers:U,sheets:l,places:P,place:O}}}function cc(C,y,T=!0){let A=y==15?[6,8,9]:[y];return T?C.filter(P=>A.includes(P.layer)):C.filter(P=>!A.includes(P.layer))}function Jf(C){let y=C.start_year?+C.start_year.split("-")[0]:null,T=C.end_year?+C.end_year.split("-")[0]:null;return y&&T?`${y}&ndash;${T}`:y||T}function C_(C,y){C&&y&&history.replaceState(void 0,void 0,`#${y.toFixed(2)},${C.lng.toFixed(4)},${C.lat.toFixed(4)}`)}const $f=C=>C.properties;function P_(C,y,T){let A,P,O,U;xd(C,Em,jt=>T(23,U=jt));let{lang:l,layers:W,sheets:$,places:ue,place:re}=y,Z=W.find(jt=>jt.is_default),me=gd.find(jt=>jt.is_default),_e=[],Fe={},gt={},zt={},Ct={},it={},je=!1,nt=!1,ct=re?"place":null,Xe=Object.keys(zd).map(jt=>qo({key:jt},zd[jt])),at=[...Xe.filter(jt=>jt.key!="Newly built")],rt=re?{lng:re.geometry.coordinates[0],lat:re.geometry.coordinates[1],zoom:13}:{bounds:[[34.75,31.75],[35.25,32.25]]},Oe={info:!0,places:!0,overlay:!1,split:!1,download:!1,threed:!1},bt={building:!1,transport:!0,place:!0};function We(jt){let Vi=ue.features.find(ae=>ae.properties.id==jt.detail.id);T(15,nt=!1),kd(`${el}/${l}/${Vi.properties.slug}/`)}async function ft(jt=null){T(16,ct=jt),re&&kd(`${el}/${l}/`)}Ou(()=>{let jt=U.url.hash.slice(1).split(",");jt[2]&&T(17,rt={lng:+jt[1],lat:+jt[2],zoom:+jt[0]}),Md.getRTLTextPluginStatus()=="unavailable"&&Md.setRTLTextPlugin("https://www.unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.js"),T(14,je=!0)}),Am(()=>{re?(Fe.left&&Fe.left.flyTo({center:re.geometry.coordinates,zoom:13}),T(16,ct="place")):ct!="layer"&&T(16,ct=null)});const wt={en:{pom:"Palestine Open Maps",baseMaps:"Base maps",overlays:"Overlays",localities:"Localities",getUpdates:"Get updates",download:"Download maps",about:"About"},ar:{pom:"\u062E\u0631\u0627\u0626\u0637 \u0641\u0644\u0633\u0637\u064A\u0646 \u0627\u0644\u0645\u0641\u062A\u0648\u062D\u0629",baseMaps:"\u0627\u0644\u062E\u0631\u0627\u0626\u0637",overlays:"\u0627\u0644\u0637\u0628\u0642\u0627\u062A \u0627\u0644\u0623\u062E\u0631\u0649",localities:"\u0627\u0644\u0628\u0644\u062F\u0627\u062A",getUpdates:"\u062A\u0627\u0628\u0639\u0648\u0627 \u0622\u062E\u0631 \u0627\u0644\u062A\u062D\u062F\u064A\u062B\u0627\u062A",download:"\u062A\u0646\u0632\u064A\u0644 \u0627\u0644\u062E\u0631\u0627\u0626\u0637",about:"\u0639\u0646 \u0627\u0644\u0645\u0634\u0631\u0648\u0639"}},Ze=[[],[],[]],De=jt=>jt.properties.layer==Z.id,Wt=()=>T(15,nt=!nt),si=(jt,Vi)=>Vi.properties.id==jt,vt=jt=>{T(10,_e=jt.detail.event.features[0]?jt.detail.event.features.map(Vi=>Vi.properties):[]),T(15,nt=!0)};function Ht(jt,Vi){C.$$.not_equal(Fe[Vi],jt)&&(Fe[Vi]=jt,T(11,Fe))}function gi(jt,Vi){C.$$.not_equal(gt[Vi],jt)&&(gt[Vi]=jt,T(5,gt))}function ui(jt,Vi){C.$$.not_equal(zt[Vi],jt)&&(zt[Vi]=jt,T(6,zt))}function Ci(jt,Vi){C.$$.not_equal(Ct[Vi],jt)&&(Ct[Vi]=jt,T(12,Ct))}function fi(jt,Vi){C.$$.not_equal(it[Vi],jt)&&(it[Vi]=jt,T(13,it))}function ei(){Oe.places=this.checked,T(18,Oe)}function _i(){Oe.overlay=this.checked,T(18,Oe)}function $i(){Oe.split=this.checked,T(18,Oe)}function lt(){Oe.threed=this.checked,T(18,Oe)}const $e=()=>Fe.left.flyTo(Oe.threed?{pitch:40}:{pitch:0,bearing:0}),di=()=>ft("layer"),Ui=()=>ft(),Mr=jt=>jt.properties.layer==Z.id;function Ai(){Z=this.__value,T(8,Z)}function gr(){Oe.overlay=this.checked,T(18,Oe)}function _r(){me=this.__value,T(9,me)}function Er(){bt.building=this.checked,T(19,bt)}function Dr(){bt.transport=this.checked,T(19,bt)}function Jr(){bt.place=this.checked,T(19,bt)}function bi(){Oe.places=this.checked,T(18,Oe)}function br(){at=Sm(Ze[0],this.__value,this.checked),T(7,at)}const cr=()=>{T(18,Oe.download=!1,Oe),T(10,_e=[])};function Hi(jt){C.$$.not_equal(Oe.download,jt)&&(Oe.download=jt,T(18,Oe))}function Qt(){Oe.split=this.checked,T(18,Oe)}function tr(){Oe.threed=this.checked,T(18,Oe)}const Di=()=>Fe.left.flyTo(Oe.threed?{pitch:40}:{pitch:0,bearing:0});return C.$$set=jt=>{"lang"in jt&&T(0,l=jt.lang),"layers"in jt&&T(1,W=jt.layers),"sheets"in jt&&T(2,$=jt.sheets),"places"in jt&&T(3,ue=jt.places),"place"in jt&&T(4,re=jt.place)},C.$$.update=()=>{C.$$.dirty[0]&128&&T(22,A=at?["any",["in","change_2016",...at.map(jt=>jt.key)]]:[]),C.$$.dirty[0]&1&&T(21,P=l=="ar"),C.$$.dirty[0]&96&&C_(gt.left,zt.left),C.$$.dirty[0]&1&&T(20,O=jt=>km(jt,wt,l))},[l,W,$,ue,re,gt,zt,at,Z,me,_e,Fe,Ct,it,je,nt,ct,rt,Oe,bt,O,P,A,U,Xe,We,ft,De,Wt,si,vt,Ht,gi,ui,Ci,fi,ei,_i,$i,lt,$e,di,Ui,Mr,Ai,Ze,gr,_r,Er,Dr,Jr,bi,br,cr,Hi,Qt,tr,Di]}class N_ extends Qn{constructor(y){super(),es(this,y,P_,z_,ts,{lang:0,layers:1,sheets:2,places:3,place:4},null,[-1,-1,-1])}}export{N_ as default,V_ as load};
